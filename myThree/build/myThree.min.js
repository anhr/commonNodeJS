/**
 * node.js version of the MyThree
 *
 * I use MyThree in my projects for displaying of my 3D objects in the canvas.
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.myThree={})}(this,function(e){"use strict";var se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},le=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},v=function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e};function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ce(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t};function t(e,t){var o=e.__state.conversionName.toString(),n=Math.round(e.r),i=Math.round(e.g),r=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===o||"SIX_CHAR_HEX"===o){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===o?"rgb("+n+","+i+","+r+")":"CSS_RGBA"===o?"rgba("+n+","+i+","+r+","+a+")":"HEX"===o?"0x"+e.hex.toString(16):"RGB_ARRAY"===o?"["+n+","+i+","+r+"]":"RGBA_ARRAY"===o?"["+n+","+i+","+r+","+a+"]":"RGB_OBJ"===o?"{r:"+n+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===o?"{r:"+n+",g:"+i+",b:"+r+",a:"+a+"}":"HSV_OBJ"===o?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===o?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var o,a=Array.prototype.forEach,i=Array.prototype.slice,m={BREAK:{},extend:function(o){return this.each(i.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(t[e])||(o[e]=t[e])}.bind(this))},this),o},defaults:function(o){return this.each(i.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(o[e])&&(o[e]=t[e])}.bind(this))},this),o},compose:function(){var o=i.call(arguments);return function(){for(var e=i.call(arguments),t=o.length-1;0<=t;t--)e=[o[t].apply(this,e)];return e[0]}},each:function(e,t,o){if(e)if(a&&e.forEach&&e.forEach===a)e.forEach(t,o);else if(e.length===e.length+0){for(var n=void 0,n=0,i=e.length;n<i;n++)if(n in e&&t.call(o,e[n],n)===this.BREAK)return}else for(var r in e)if(t.call(o,e[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(n,i,r){var a=void 0;return function(){var e=this,t=arguments;var o=r||!a;clearTimeout(a),a=setTimeout(function(){a=null,r||n.apply(e,t)},i),o&&n.apply(e,t)}},toArray:function(e){return e.toArray?e.toArray():i.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:(o=function(e){return isNaN(e)},r.toString=function(){return o.toString()},r),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}};function r(e){return o.apply(this,arguments)}var s,l=[{litmus:m.isString,conversions:{THREE_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:t},SIX_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:t},CSS_RGB:{read:function(e){e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:t},CSS_RGBA:{read:function(e){e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:t}}},{litmus:m.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:m.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:m.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(m.isNumber(e.r)&&m.isNumber(e.g)&&m.isNumber(e.b)&&m.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(m.isNumber(e.r)&&m.isNumber(e.g)&&m.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(m.isNumber(e.h)&&m.isNumber(e.s)&&m.isNumber(e.v)&&m.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(m.isNumber(e.h)&&m.isNumber(e.s)&&m.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],c=void 0,u=void 0,p=function(){u=!1;var o=1<arguments.length?m.toArray(arguments):arguments[0];return m.each(l,function(e){if(e.litmus(o))return m.each(e.conversions,function(e,t){if(c=e.read(o),!1===u&&!1!==c)return(u=c).conversionName=t,c.conversion=e,m.BREAK}),m.BREAK}),u},d={hsv_to_rgb:function(e,t,o){var n=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),r=o*(1-t),e=o*(1-i*t),t=o*(1-(1-i)*t),n=[[o,t,r],[e,o,r],[r,o,t],[r,e,o],[t,r,o],[o,r,e]][n];return{r:255*n[0],g:255*n[1],b:255*n[2]}},rgb_to_hsv:function(e,t,o){var n=Math.min(e,t,o),i=Math.max(e,t,o),r=i-n,n=void 0;return 0===i?{h:NaN,s:0,v:0}:(n=e===i?(t-o)/r:t===i?2+(o-e)/r:4+(e-t)/r,(n/=6)<0&&(n+=1),{h:360*n,s:r/i,v:i/255})},rgb_to_hex:function(e,t,o){e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t);return e=this.hex_with_component(e,0,o)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,o){return o<<(s=8*t)|e&~(255<<s)}},f="function"==typeof Symbol&&"symbol"===se(Symbol.iterator)?function(e){return void 0===e?"undefined":se(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":se(e)},h=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},g=function(e,t,o){return t&&y(e.prototype,t),o&&y(e,o),e};function y(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function x(e,t,o){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0!==n){if("value"in n)return n.value;n=n.get;return void 0!==n?n.call(o):void 0}if(e=Object.getPrototypeOf(e),null!==e)return x(e,t,o)}var w=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":se(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},C=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":se(t))&&"function"!=typeof t?e:t},T=(g(E,[{key:"toString",value:function(){return t(this)}},{key:"toHexString",value:function(){return t(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),E);function E(){if(h(this,E),this.__state=p.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}function S(e,t,o){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||T.recalculateRGB(this,t,o),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(T.recalculateRGB(this,t,o),this.__state.space="RGB"),this.__state[t]=e}})}function A(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||T.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(T.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}T.recalculateRGB=function(e,t,o){if("HEX"===e.__state.space)e.__state[t]=d.component_from_hex(e.__state.hex,o);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");m.extend(e.__state,d.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},T.recalculateHSV=function(e){var t=d.rgb_to_hsv(e.r,e.g,e.b);m.extend(e.__state,{s:t.s,v:t.v}),m.isNaN(t.h)?m.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},T.COMPONENTS=["r","g","b","h","s","v","hex","a"],S(T.prototype,"r",2),S(T.prototype,"g",1),S(T.prototype,"b",0),A(T.prototype,"h"),A(T.prototype,"s"),A(T.prototype,"v"),Object.defineProperty(T.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(T.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=d.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var O=(g(k,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),k);function k(e,t){h(this,k),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}var P={};m.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){m.each(e,function(e){P[e]=t})});var z=/(\d+(\.\d+)?)px/;function M(e){if("0"===e||m.isUndefined(e))return 0;e=e.match(z);return m.isNull(e)?0:parseFloat(e[1])}var L={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,o){m.isUndefined(t)&&(t=!0),m.isUndefined(o)&&(o=!0),e.style.position="absolute",t&&(e.style.left=0,e.style.right=0),o&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,o,n){var i=o||{},o=P[t];if(!o)throw new Error("Event type "+t+" not supported.");var r=document.createEvent(o);switch(o){case"MouseEvents":var a=i.x||i.clientX||0,s=i.y||i.clientY||0;r.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,a,s,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":s=r.initKeyboardEvent||r.initKeyEvent;m.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),s(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:r.initEvent(t,i.bubbles||!1,i.cancelable||!0)}m.defaults(r,n),e.dispatchEvent(r)},bind:function(e,t,o,n){n=n||!1;return e.addEventListener?e.addEventListener(t,o,n):e.attachEvent&&e.attachEvent("on"+t,o),L},unbind:function(e,t,o,n){n=n||!1;return e.removeEventListener?e.removeEventListener(t,o,n):e.detachEvent&&e.detachEvent("on"+t,o),L},addClass:function(e,t){var o;return void 0===e.className?e.className=t:e.className===t||-1===(o=e.className.split(/ +/)).indexOf(t)&&(o.push(t),e.className=o.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")),L},removeClass:function(e,t){var o;return t?e.className===t?e.removeAttribute("class"):-1!==(t=(o=e.className.split(/ +/)).indexOf(t))&&(o.splice(t,1),e.className=o.join(" ")):e.className=void 0,L},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){e=getComputedStyle(e);return M(e["border-left-width"])+M(e["border-right-width"])+M(e["padding-left"])+M(e["padding-right"])+M(e.width)},getHeight:function(e){e=getComputedStyle(e);return M(e["border-top-width"])+M(e["border-bottom-width"])+M(e["padding-top"])+M(e["padding-bottom"])+M(e.height)},getOffset:function(e){var t=e,o={left:0,top:0};if(t.offsetParent)for(;o.left+=t.offsetLeft,o.top+=t.offsetTop,t=t.offsetParent,t;);return o},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},F=(w(D,O),g(D,[{key:"setValue",value:function(e){e=x(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),x(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"updateDisplay",this).call(this)}}]),D);function D(e,t){h(this,D);var t=C(this,(D.__proto__||Object.getPrototypeOf(D)).call(this,e,t)),o=t;return t.__prev=t.getValue(),t.__checkbox=document.createElement("input"),t.__checkbox.setAttribute("type","checkbox"),L.bind(t.__checkbox,"change",function(){o.setValue(!o.__prev)},!1),t.domElement.appendChild(t.__checkbox),t.updateDisplay(),t}var N=(w(R,O),g(R,[{key:"setValue",value:function(e){e=x(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e}},{key:"updateDisplay",value:function(){return L.isActive(this.__select)?this:(this.__select.value=this.getValue(),x(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"updateDisplay",this).call(this))}}]),R);function R(e,t,o){h(this,R);var n,t=C(this,(R.__proto__||Object.getPrototypeOf(R)).call(this,e,t)),o=o,i=t;return t.__select=document.createElement("select"),m.isArray(o)&&(n={},m.each(o,function(e){n[e]=e}),o=n),m.each(o,function(e,t){var o=document.createElement("option");o.innerHTML=t,o.setAttribute("value",e),i.__select.appendChild(o)}),t.updateDisplay(),L.bind(t.__select,"change",function(){var e=this.options[this.selectedIndex].value;i.setValue(e)}),t.domElement.appendChild(t.__select),t}var V=(w(j,O),g(j,[{key:"updateDisplay",value:function(){return L.isActive(this.__input)||(this.__input.value=this.getValue()),x(j.prototype.__proto__||Object.getPrototypeOf(j.prototype),"updateDisplay",this).call(this)}}]),j);function j(e,t){h(this,j);var t=C(this,(j.__proto__||Object.getPrototypeOf(j)).call(this,e,t)),o=t;function n(){o.setValue(o.__input.value)}return t.__input=document.createElement("input"),t.__input.setAttribute("type","text"),L.bind(t.__input,"keyup",n),L.bind(t.__input,"change",n),L.bind(t.__input,"blur",function(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}),L.bind(t.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),t.updateDisplay(),t.domElement.appendChild(t.__input),t}function I(e){e=e.toString();return-1<e.indexOf(".")?e.length-e.indexOf(".")-1:0}var H=(w(B,O),g(B,[{key:"setValue",value:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),x(B.prototype.__proto__||Object.getPrototypeOf(B.prototype),"setValue",this).call(this,e)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=I(e),this}}]),B);function B(e,t,o){h(this,B);t=C(this,(B.__proto__||Object.getPrototypeOf(B)).call(this,e,t)),o=o||{};return t.__min=o.min,t.__max=o.max,t.__step=o.step,m.isUndefined(t.__step)?0===t.initialValue?t.__impliedStep=1:t.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(t.initialValue))/Math.LN10))/10:t.__impliedStep=t.__step,t.__precision=I(t.__impliedStep),t}var G=(w(U,H),g(U,[{key:"updateDisplay",value:function(){var e,t;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),t=this.__precision,t=Math.pow(10,t),Math.round(e*t)/t),x(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"updateDisplay",this).call(this)}}]),U);function U(e,t,o){h(this,U);o=C(this,(U.__proto__||Object.getPrototypeOf(U)).call(this,e,t,o));o.__truncationSuspended=!1;var n=o,i=void 0;function r(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}function a(e){var t=i-e.clientY;n.setValue(n.getValue()+t*n.__impliedStep),i=e.clientY}function s(){L.unbind(window,"mousemove",a),L.unbind(window,"mouseup",s),r()}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),L.bind(o.__input,"change",function(){var e=parseFloat(n.__input.value);m.isNaN(e)||n.setValue(e)}),L.bind(o.__input,"blur",function(){r()}),L.bind(o.__input,"mousedown",function(e){L.bind(window,"mousemove",a),L.bind(window,"mouseup",s),i=e.clientY}),L.bind(o.__input,"keydown",function(e){13===e.keyCode&&(n.__truncationSuspended=!0,this.blur(),n.__truncationSuspended=!1,r())}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}function X(e,t,o,n,i){return n+(e-t)/(o-t)*(i-n)}var q=(w(W,H),g(W,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",x(W.prototype.__proto__||Object.getPrototypeOf(W.prototype),"updateDisplay",this).call(this)}}]),W);function W(e,t,o,n,i){h(this,W);var i=C(this,(W.__proto__||Object.getPrototypeOf(W)).call(this,e,t,{min:o,max:n,step:i})),r=i;function a(e){e.preventDefault();var t=r.__background.getBoundingClientRect();return r.setValue(X(e.clientX,t.left,t.right,r.__min,r.__max)),!1}function s(){L.unbind(window,"mousemove",a),L.unbind(window,"mouseup",s),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function l(e){var t=e.touches[0].clientX,e=r.__background.getBoundingClientRect();r.setValue(X(t,e.left,e.right,r.__min,r.__max))}function c(){L.unbind(window,"touchmove",l),L.unbind(window,"touchend",c),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}return i.__background=document.createElement("div"),i.__foreground=document.createElement("div"),L.bind(i.__background,"mousedown",function(e){document.activeElement.blur(),L.bind(window,"mousemove",a),L.bind(window,"mouseup",s),a(e)}),L.bind(i.__background,"touchstart",function(e){if(1!==e.touches.length)return;L.bind(window,"touchmove",l),L.bind(window,"touchend",c),l(e)}),L.addClass(i.__background,"slider"),L.addClass(i.__foreground,"slider-fg"),i.updateDisplay(),i.__background.appendChild(i.__foreground),i.domElement.appendChild(i.__background),i}var Y=(w(Z,O),g(Z,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),Z);function Z(e,t,o){h(this,Z);var t=C(this,(Z.__proto__||Object.getPrototypeOf(Z)).call(this,e,t)),n=t;return t.__button=document.createElement("div"),t.__button.innerHTML=void 0===o?"Fire":o,L.bind(t.__button,"click",function(e){return e.preventDefault(),n.fire(),!1}),L.addClass(t.__button,"button"),t.domElement.appendChild(t.__button),t}var J=(w(K,O),g(K,[{key:"updateDisplay",value:function(){var t,o=p(this.getValue());!1!==o&&(t=!1,m.each(T.COMPONENTS,function(e){if(!m.isUndefined(o[e])&&!m.isUndefined(this.__color.__state[e])&&o[e]!==this.__color.__state[e])return t=!0,{}},this),t&&m.extend(this.__color.__state,o)),m.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var e=this.__color.v<.5||.5<this.__color.s?255:0,n=255-e;m.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+e+","+e+","+e+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,$(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),m.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+e+","+e+","+e+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),K);function K(e,t){h(this,K);var o=C(this,(K.__proto__||Object.getPrototypeOf(K)).call(this,e,t));o.__color=new T(o.getValue()),o.__temp=new T(0);var n=o;o.domElement=document.createElement("div"),L.makeSelectable(o.domElement,!1),o.__selector=document.createElement("div"),o.__selector.className="selector",o.__saturation_field=document.createElement("div"),o.__saturation_field.className="saturation-field",o.__field_knob=document.createElement("div"),o.__field_knob.className="field-knob",o.__field_knob_border="2px solid ",o.__hue_knob=document.createElement("div"),o.__hue_knob.className="hue-knob",o.__hue_field=document.createElement("div"),o.__hue_field.className="hue-field",o.__input=document.createElement("input"),o.__input.type="text",o.__input_textShadow="0 1px 1px ",L.bind(o.__input,"keydown",function(e){13===e.keyCode&&l.call(this)}),L.bind(o.__input,"blur",l),L.bind(o.__selector,"mousedown",function(){L.addClass(this,"drag").bind(window,"mouseup",function(){L.removeClass(n.__selector,"drag")})}),L.bind(o.__selector,"touchstart",function(){L.addClass(this,"drag").bind(window,"touchend",function(){L.removeClass(n.__selector,"drag")})});e=document.createElement("div");function i(e){u(e),L.bind(window,"mousemove",u),L.bind(window,"touchmove",u),L.bind(window,"mouseup",a),L.bind(window,"touchend",a)}function r(e){d(e),L.bind(window,"mousemove",d),L.bind(window,"touchmove",d),L.bind(window,"mouseup",s),L.bind(window,"touchend",s)}function a(){L.unbind(window,"mousemove",u),L.unbind(window,"touchmove",u),L.unbind(window,"mouseup",a),L.unbind(window,"touchend",a),c()}function s(){L.unbind(window,"mousemove",d),L.unbind(window,"touchmove",d),L.unbind(window,"mouseup",s),L.unbind(window,"touchend",s),c()}function l(){var e=p(this.value);!1!==e?(n.__color.__state=e,n.setValue(n.__color.toOriginal())):this.value=n.__color.toString()}function c(){n.__onFinishChange&&n.__onFinishChange.call(n,n.__color.toOriginal())}function u(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=n.__saturation_field.getBoundingClientRect(),o=e.touches&&e.touches[0]||e,e=o.clientX,o=o.clientY,e=(e-t.left)/(t.right-t.left),t=1-(o-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),1<e?e=1:e<0&&(e=0),n.__color.v=t,n.__color.s=e,n.setValue(n.__color.toOriginal()),!1}function d(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=n.__hue_field.getBoundingClientRect(),t=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),n.__color.h=360*t,n.setValue(n.__color.toOriginal()),!1}return m.extend(o.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),m.extend(o.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:o.__field_knob_border+(o.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),m.extend(o.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),m.extend(o.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),m.extend(e.style,{width:"100%",height:"100%",background:"none"}),$(e,"top","rgba(0,0,0,0)","#000"),m.extend(o.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(t=o.__hue_field).style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",m.extend(o.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:o.__input_textShadow+"rgba(0,0,0,0.7)"}),L.bind(o.__saturation_field,"mousedown",i),L.bind(o.__saturation_field,"touchstart",i),L.bind(o.__field_knob,"mousedown",i),L.bind(o.__field_knob,"touchstart",i),L.bind(o.__hue_field,"mousedown",r),L.bind(o.__hue_field,"touchstart",r),o.__saturation_field.appendChild(e),o.__selector.appendChild(o.__field_knob),o.__selector.appendChild(o.__saturation_field),o.__selector.appendChild(o.__hue_field),o.__hue_field.appendChild(o.__hue_knob),o.domElement.appendChild(o.__input),o.domElement.appendChild(o.__selector),o.updateDisplay(),o}var Q=["-moz-","-o-","-webkit-","-ms-",""];function $(t,o,n,i){t.style.background="",m.each(Q,function(e){t.style.cssText+="background: "+e+"linear-gradient("+o+", "+n+" 0%, "+i+" 100%); "})}var ee=function(e,t){var o=e[t];return m.isArray(arguments[2])||m.isObject(arguments[2])?new N(e,t,arguments[2]):m.isNumber(o)?m.isNumber(arguments[2])&&m.isNumber(arguments[3])?m.isNumber(arguments[4])?new q(e,t,arguments[2],arguments[3],arguments[4]):new q(e,t,arguments[2],arguments[3]):m.isNumber(arguments[4])?new G(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new G(e,t,{min:arguments[2],max:arguments[3]}):m.isString(o)?new V(e,t):m.isFunction(o)?new Y(e,t,""):m.isBoolean(o)?new F(e,t):null},te=(w(oe,O),g(oe,[{key:"controller",set:function(e){this._controller=e},get:function(){return this._controller}}]),oe);function oe(e,t){h(this,oe);var o=C(this,(oe.__proto__||Object.getPrototypeOf(oe)).call(this,e,t));return o.arguments={object:e,property:t,opts:Array.prototype.slice.call(arguments,2)},e.property&&(o.property=e.property(o)),o}var ne=function(e,t){var t=t||document,o=document.createElement("style");o.type="text/css",o.innerHTML=e;var n=t.getElementsByTagName("head")[0];try{n.appendChild(o)}catch(e){}};var ie=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},re=(g(ae,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),m.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",L.unbind(t.domElement,"webkitTransitionEnd",e),L.unbind(t.domElement,"transitionend",e),L.unbind(t.domElement,"oTransitionEnd",e)}var t=this;L.bind(this.domElement,"webkitTransitionEnd",e),L.bind(this.domElement,"transitionend",e),L.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-L.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-L.getHeight(this.domElement)/2+"px"}}]),ae);function ae(){h(this,ae),this.backgroundElement=document.createElement("div"),m.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),L.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),m.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;L.bind(this.backgroundElement,"click",function(){e.hide()})}ne(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var ue="Default",de=function(){try{return!!window.localStorage}catch(e){return!1}}(),pe=void 0,fe=!0,me=void 0,he=!1,ge=[],ye=function t(e){var o=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),L.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=m.defaults(n,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),n=m.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),m.isUndefined(n.load)?n.load={preset:ue}:n.preset&&(n.load.preset=n.preset),m.isUndefined(n.parent)&&n.hideable&&ge.push(this),n.resizable=m.isUndefined(n.parent)&&n.resizable,n.autoPlace&&m.isUndefined(n.scrollable)&&(n.scrollable=!0);var i,r,a,s,l=de&&"true"===localStorage.getItem(Ce(0,"isLocal")),c=void 0,u=void 0;function d(e){return e.preventDefault(),r.width+=a-e.clientX,r.onResize(),a=e.clientX,!1}function p(){L.removeClass(r.__closeButton,ye.CLASS_DRAG),L.unbind(window,"mousemove",d),L.unbind(window,"mouseup",p)}function f(e){return e.preventDefault(),a=e.clientX,L.addClass(r.__closeButton,ye.CLASS_DRAG),L.bind(window,"mousemove",d),L.bind(window,"mouseup",p),!1}Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return(o.parent?o.getRoot():n.load).preset},set:function(e){o.parent?o.getRoot().preset=e:n.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),o.revert()}},width:{get:function(){return n.width},set:function(e){n.width=e,Se(o,e)}},name:{get:function(){return n.name},set:function(e){n.name=e,u&&(u.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(e){n.closed=e,n.closed?L.addClass(o.__ul,t.CLASS_CLOSED):L.removeClass(o.__ul,t.CLASS_CLOSED),this.onResize(),o.__closeButton&&(o.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return l},set:function(e){de&&((l=e)?L.bind(window,"unload",c):L.unbind(window,"unload",c),localStorage.setItem(Ce(0,"isLocal"),e))}}}),m.isUndefined(n.parent)?(this.closed=n.closed||!1,L.addClass(this.domElement,t.CLASS_MAIN),L.makeSelectable(this.domElement,!1),de&&l&&(o.useLocalStorage=!0,(i=localStorage.getItem(Ce(0,"gui")))&&(n.load=JSON.parse(i))),this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,L.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),n.closeOnTop?(L.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(L.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),L.bind(this.__closeButton,"click",function(){o.closed=!o.closed})):(void 0===n.closed&&(n.closed=!0),i=document.createTextNode(n.name),L.addClass(i,"controller-name"),u=ve(o,i),L.addClass(this.__ul,t.CLASS_CLOSED),L.addClass(u,"title"),L.bind(u,"click",function(e){return e.preventDefault(),o.closed=!o.closed,!1}),n.closed||(this.closed=!1)),n.autoPlace&&(m.isUndefined(n.parent)&&(fe&&(me=document.createElement("div"),L.addClass(me,"dg"),L.addClass(me,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(me),fe=!1),me.appendChild(this.domElement),L.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||Se(o,n.width)),this.__resizeHandler=function(){o.onResizeDebounced()},L.bind(window,"resize",this.__resizeHandler),L.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),L.bind(this.__ul,"transitionend",this.__resizeHandler),L.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&(a=void 0,(r=this).__resize_handle=document.createElement("div"),m.extend(r.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),L.bind(r.__resize_handle,"mousedown",f),L.bind(r.__closeButton,"mousedown",f),r.domElement.insertBefore(r.__resize_handle,r.domElement.firstElementChild)),c=function(){de&&"true"===localStorage.getItem(Ce(0,"isLocal"))&&localStorage.setItem(Ce(0,"gui"),JSON.stringify(o.getSaveObject()))},this.saveToLocalStorageIfPossible=c,n.parent||((s=o.getRoot()).width+=1,m.defer(function(){--s.width}))};function ve(e,t,o){var n=document.createElement("li");return t&&n.appendChild(t),o?e.__ul.insertBefore(n,o):e.__ul.appendChild(n),e.onResize(),n}function be(e){L.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&L.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function _e(e,t){e=e.__preset_select[e.__preset_select.selectedIndex];e.innerHTML=t?e.value+"*":e.value}function xe(e,t){var o=e.getRoot(),n=o.__rememberedObjects.indexOf(t.object);if(-1!==n){var i=o.__rememberedObjectIndecesToControllers[n];if(void 0===i&&(i={},o.__rememberedObjectIndecesToControllers[n]=i),i[t.property]=t,o.load&&o.load.remembered){i=o.load.remembered,o=void 0;if(i[e.preset])o=i[e.preset];else{if(!i[ue])return;o=i[ue]}o[n]&&void 0!==o[n][t.property]&&(n=o[n][t.property],t.initialValue=n,t.setValue(n))}}}function we(e,t,o,n){var i;if(t.arguments&&(t=(i=t).arguments.object,o=i.arguments.property,n={factoryArgs:i.arguments.opts}),void 0===i&&void 0===t[o])throw new Error('Object "'+t+'" has no property "'+o+'"');var r=void 0;null===(r=n.color?new J(t,o):void 0!==i&&"string"==typeof i.property?i:(l=[t,o].concat(n.factoryArgs),ee.apply(e,l)))?r=i:void 0!==i&&(i.controller=r),n.before instanceof O&&(n.before=n.before.__li),xe(e,r),L.addClass(r.domElement,"c");var a=document.createElement("span");if(L.addClass(a,"property-name"),void 0!==i&&"object"===f(i.property))for(var s in i.property)a.appendChild(i.property[s]);else a.innerHTML=r.property;var l=document.createElement("div");l.appendChild(a),l.appendChild(r.domElement);var c,u,d,p,n=ve(e,l,n.before);return L.addClass(n,ye.CLASS_CONTROLLER_ROW),r instanceof J?L.addClass(n,"color"):L.addClass(n,f(r.getValue())),c=e,u=n,(d=r).__li=u,d.__gui=c,m.extend(d,{options:function(e){if(1<arguments.length){var t=d.__li.nextElementSibling;return d.remove(),we(c,d.object,d.property,{before:t,factoryArgs:[m.toArray(arguments)]})}if(m.isArray(e)||m.isObject(e)){t=d.__li.nextElementSibling;return d.remove(),we(c,d.object,d.property,{before:t,factoryArgs:[e]})}},name:function(e){return d.__li.firstElementChild.firstElementChild.innerHTML=e,d},listen:function(){return d.__gui.listen(d),d},remove:function(){return d.__gui.remove(d),d}}),d instanceof q?(p=new G(d.object,d.property,{min:d.__min,max:d.__max,step:d.__step}),m.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=d[e],o=p[e];d[e]=p[e]=function(){var e=Array.prototype.slice.call(arguments);return o.apply(p,e),t.apply(d,e)}}),L.addClass(u,"has-slider"),d.domElement.insertBefore(p.domElement,d.domElement.firstElementChild)):d instanceof G?(n=function(e){if(m.isNumber(d.__min)&&m.isNumber(d.__max)){var t=d.__li.firstElementChild.firstElementChild.innerHTML,o=-1<d.__gui.__listening.indexOf(d);d.remove();var n=we(c,d.object,d.property,{before:d.__li.nextElementSibling,factoryArgs:[d.__min,d.__max,d.__step]});return n.name(t),o&&n.listen(),n}return e},d.min=m.compose(n,d.min),d.max=m.compose(n,d.max)):d instanceof F?(L.bind(u,"click",function(){L.fakeEvent(d.__checkbox,"click")}),L.bind(d.__checkbox,"click",function(e){e.stopPropagation()})):d instanceof Y?(L.bind(u,"click",function(){L.fakeEvent(d.__button,"click")}),L.bind(u,"mouseover",function(){L.addClass(d.__button,"hover")}),L.bind(u,"mouseout",function(){L.removeClass(d.__button,"hover")})):d instanceof J&&(L.addClass(u,"color"),d.updateDisplay=m.compose(function(e){return u.style.borderLeftColor=d.__color.toString(),e},d.updateDisplay),d.updateDisplay()),d.setValue=m.compose(function(e){return c.getRoot().__preset_select&&d.isModified()&&_e(c.getRoot(),!0),e},d.setValue),e.__controllers.push(r),r}function Ce(e,t){return document.location.href+"."+t}function Te(e,t,o){var n=document.createElement("option");n.innerHTML=t,n.value=t,e.__preset_select.appendChild(n),o&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function Ee(e,t){t.style.display=e.useLocalStorage?"block":"none"}function Se(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function Ae(i,r){var a={};return m.each(i.__rememberedObjects,function(e,t){var o={},n=i.__rememberedObjectIndecesToControllers[t];m.each(n,function(e,t){o[t]=r?e.initialValue:e.getValue()}),a[t]=o}),a}ye.toggleHide=function(){he=!he,m.each(ge,function(e){e.domElement.style.display=he?"none":""})},ye.CLASS_AUTO_PLACE="a",ye.CLASS_AUTO_PLACE_CONTAINER="ac",ye.CLASS_MAIN="main",ye.CLASS_CONTROLLER_ROW="cr",ye.CLASS_TOO_TALL="taller-than-window",ye.CLASS_CLOSED="closed",ye.CLASS_CLOSE_BUTTON="close-button",ye.CLASS_CLOSE_TOP="close-top",ye.CLASS_CLOSE_BOTTOM="close-bottom",ye.CLASS_DRAG="drag",ye.DEFAULT_WIDTH=245,ye.TEXT_CLOSED="Close Controls",ye.TEXT_OPEN="Open Controls",ye._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||ye.toggleHide()},L.bind(window,"keydown",ye._keydownHandler,!1),m.extend(ye.prototype,{add:function(e,t){return we(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return we(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;m.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&me.removeChild(this.domElement);var t=this;m.each(this.__folders,function(e){t.removeFolder(e)}),L.unbind(window,"keydown",ye._keydownHandler,!1),be(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);t=new ye(t);this.__folders[e]=t;e=ve(this,t.domElement);return L.addClass(e,"folder"),t},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],be(t);var e=this;m.each(t.__folders,function(e){t.removeFolder(e)}),m.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e,t,o=this.getRoot();o.scrollable&&(e=L.getOffset(o.__ul).top,t=0,m.each(o.__ul.childNodes,function(e){o.autoPlace&&e===o.__save_row||(t+=L.getHeight(e))}),window.innerHeight-e-20<t?(L.addClass(o.domElement,ye.CLASS_TOO_TALL),o.__ul.style.height=window.innerHeight-e-20+"px"):(L.removeClass(o.domElement,ye.CLASS_TOO_TALL),o.__ul.style.height="auto")),o.__resize_handle&&m.defer(function(){o.__resize_handle.style.height=o.__ul.offsetHeight+"px"}),o.__closeButton&&(o.__closeButton.style.width=o.width+"px")},onResizeDebounced:m.debounce(function(){this.onResize()},50),remember:function(){if(m.isUndefined(pe)&&((pe=new re).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;m.each(Array.prototype.slice.call(arguments),function(e){0===t.__rememberedObjects.length&&function(o){var e=o.__save_row=document.createElement("li");L.addClass(o.domElement,"has-save"),o.__ul.insertBefore(e,o.__ul.firstChild),L.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",L.addClass(t,"button gears");var n=document.createElement("span");n.innerHTML="Save",L.addClass(n,"button"),L.addClass(n,"save");var i=document.createElement("span");i.innerHTML="New",L.addClass(i,"button"),L.addClass(i,"save-as");var r=document.createElement("span");r.innerHTML="Revert",L.addClass(r,"button"),L.addClass(r,"revert");var a,s=o.__preset_select=document.createElement("select");o.load&&o.load.remembered?m.each(o.load.remembered,function(e,t){Te(o,t,t===o.preset)}):Te(o,ue,!1),L.bind(s,"change",function(){for(var e=0;e<o.__preset_select.length;e++)o.__preset_select[e].innerHTML=o.__preset_select[e].value;o.preset=this.value}),e.appendChild(s),e.appendChild(t),e.appendChild(n),e.appendChild(i),e.appendChild(r),de&&(a=document.getElementById("dg-local-explain"),e=document.getElementById("dg-local-storage"),document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(Ce(0,"isLocal"))&&e.setAttribute("checked","checked"),Ee(o,a),L.bind(e,"change",function(){o.useLocalStorage=!o.useLocalStorage,Ee(o,a)}));var l=document.getElementById("dg-new-constructor");L.bind(l,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||pe.hide()}),L.bind(t,"click",function(){l.innerHTML=JSON.stringify(o.getSaveObject(),void 0,2),pe.show(),l.focus(),l.select()}),L.bind(n,"click",function(){o.save()}),L.bind(i,"click",function(){var e=prompt("Enter a new preset name.");e&&o.saveAs(e)}),L.bind(r,"click",function(){o.revert()})}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&Se(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var o=this.load;return o.closed=this.closed,0<this.__rememberedObjects.length&&(o.preset=this.preset,o.remembered||(o.remembered={}),o.remembered[this.preset]=Ae(this)),o.folders={},m.each(this.__folders,function(e,t){o.folders[t]=e.getSaveObject()}),o},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Ae(this),_e(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[ue]=Ae(this,!0)),this.load.remembered[e]=Ae(this),this.preset=e,Te(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(t){m.each(this.__controllers,function(e){this.getRoot().load.remembered?xe(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),m.each(this.__folders,function(e){e.revert(e)}),t||_e(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&ie.call(window,function(){e(t)});m.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){m.each(this.__controllers,function(e){e.updateDisplay()}),m.each(this.__folders,function(e){e.updateDisplay()})}});var Oe,ke,w={Controller:O,BooleanController:F,OptionController:N,StringController:V,NumberController:H,NumberControllerBox:G,NumberControllerSlider:q,FunctionController:Y,ColorController:J,CustomController:te},g=ye,Pe={addButton:function(e,t){t=t||{};var o=document.createElement("span");return o.innerHTML=e,void 0!==t.title&&(o.title=t.title),void 0!==t.onclick&&(o.style.cursor="pointer",o.onclick=t.onclick),void 0!==t.onwheel&&(e=function(e){e=(e=e||window.event).deltaY||e.detail||e.wheelDelta;t.onwheel(e)},o.style.cursor="n-resize",o.addEventListener?"onwheel"in document?o.addEventListener("wheel",e):"onmousewheel"in document?o.addEventListener("mousewheel",e):o.addEventListener("MozMousePixelScroll",e):o.attachEvent("onmousewheel",e)),o.style.margin="0px 2px",o}},ne=(v(ze,[{key:"THREE",set:function(e){Oe?Object.is(e,Oe)||console.error("three: duplicate THREE. Please use one instance of the THREE library."):Oe=e},get:function(){return void 0===Oe&&console.error("three: invalid _THREE = "+Oe+". Call three.THREE = THREE first."),Oe}},{key:"dat",set:function(e){ke?Object.is(e,ke)||console.error("three: duplicate dat. Please use one instance of the dat library."):ke=e},get:function(){return ke}}]),ze);function ze(){le(this,ze)}ne=new ne,window.__myThree__=window.__myThree__||{},window.__myThree__.boThree&&console.error("three: duplicate three. Please use one instance of the three class."),window.__myThree__.boThree=!0,ne.isThree=function(){return Oe};var Me=ne,Le=(b(Fe,w.CustomController),Fe);
/**
 * @module ScaleController
 * @description is dat.GUI graphical user interface controller for control of the scale of threejs 3D object
 *
 * @see {@link https://threejs.org/} about threejs
 * @see {@link https://github.com/dataarts/dat.gui} about dat.GUI
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function Fe(r,a){le(this,Fe),(a=a||{}).settings=a.settings||{},a.settings.zoomMultiplier=a.settings.zoomMultiplier||1.1;var e=_(this,(Fe.__proto__||Object.getPrototypeOf(Fe)).call(this,{multiplier:a.settings.zoomMultiplier,property:function(e){var t={zoom:"Zoom",in:"in",out:"out",wheelZoom:"Scroll the mouse wheel to zoom"},o=void 0===a.getLanguageCode?"en":a.getLanguageCode();switch(o){case"ru":t.zoom="",t.in="",t.out="",t.wheelZoom="     ";break;default:if(void 0===a.lang||a.lang.languageCode!=o)break;Object.keys(a.lang).forEach(function(e){void 0!==t[e]&&(t[e]=a.lang[e])})}var n={},i=Pe.addButton;return n.zoomLabel=i(t.zoom,{title:t.wheelZoom,onwheel:function(o){r(e,function(e,t){return 0<o?e*=t:e/=t,e})}}),n.in=i("",{title:t.in,onclick:function(){r(e,function(e,t){return e*=t})}}),n.out=i("",{title:t.out,onclick:function(){r(e,function(e,t){return e/=t})}}),n}},"multiplier",1.1,10,.1));return void 0===e.property&&console.error("init() returns "+e.property),e}
/**
 * PositionController is dat.GUI graphical user interface controller for control of the position of threejs 3D object
 *
 * @see {@link https://threejs.org/} about threejs
 * @see {@link https://github.com/dataarts/dat.gui} about dat.GUI
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
var De=(b(Ne,w.CustomController),Ne);function Ne(r,a){le(this,Ne),(a=a||{}).settings=a.settings||{};var e=a.settings;a.min=a.min||.1,a.max=a.max||10,e.offset=e.offset||.1,a.step=a.step||.1;e=_(this,(Ne.__proto__||Object.getPrototypeOf(Ne)).call(this,{offset:e.offset,property:function(o){var t={offset:"Offset",add:"add",subtract:"subtract",wheelPosition:"Scroll the mouse wheel to change the position"},e=void 0===a.getLanguageCode?"en":a.getLanguageCode();switch(e){case"ru":t.offset="",t.add="",t.subtract="",t.wheelPosition="     ";break;default:if(void 0===a.lang||a.lang.languageCode!=e)break;Object.keys(a.lang).forEach(function(e){void 0!==t[e]&&(t[e]=a.lang[e])})}var n={},i=Pe.addButton;return n.Label=i(t.offset,{title:t.wheelPosition,onwheel:function(e){var t=o.controller.getValue();r(0<e?t:-t)}}),n.in=i("",{title:t.add,onclick:function(){r(o.controller.getValue())}}),n.out=i("",{title:t.subtract,onclick:function(){r(-o.controller.getValue())}}),n}},"offset",a.min,a.max,a.step));return void 0===e.property&&console.error("init() returns "+e.property),e}function Re(e,t){var o=e.__state.conversionName.toString(),n=Math.round(e.r),i=Math.round(e.g),r=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===o||"SIX_CHAR_HEX"===o){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===o?"rgb("+n+","+i+","+r+")":"CSS_RGBA"===o?"rgba("+n+","+i+","+r+","+a+")":"HEX"===o?"0x"+e.hex.toString(16):"RGB_ARRAY"===o?"["+n+","+i+","+r+"]":"RGBA_ARRAY"===o?"["+n+","+i+","+r+","+a+"]":"RGB_OBJ"===o?"{r:"+n+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===o?"{r:"+n+",g:"+i+",b:"+r+",a:"+a+"}":"HSV_OBJ"===o?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===o?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var Ve,je=Array.prototype.forEach,Ie=Array.prototype.slice,He={BREAK:{},extend:function(o){return this.each(Ie.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(t[e])||(o[e]=t[e])}.bind(this))},this),o},defaults:function(o){return this.each(Ie.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(o[e])&&(o[e]=t[e])}.bind(this))},this),o},compose:function(){var o=Ie.call(arguments);return function(){for(var e=Ie.call(arguments),t=o.length-1;0<=t;t--)e=[o[t].apply(this,e)];return e[0]}},each:function(e,t,o){if(e)if(je&&e.forEach&&e.forEach===je)e.forEach(t,o);else if(e.length===e.length+0){for(var n=void 0,n=0,i=e.length;n<i;n++)if(n in e&&t.call(o,e[n],n)===this.BREAK)return}else for(var r in e)if(t.call(o,e[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(n,i,r){var a=void 0;return function(){var e=this,t=arguments;var o=r||!a;clearTimeout(a),a=setTimeout(function(){a=null,r||n.apply(e,t)},i),o&&n.apply(e,t)}},toArray:function(e){return e.toArray?e.toArray():Ie.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:(Ve=function(e){return isNaN(e)},Be.toString=function(){return Ve.toString()},Be),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}};function Be(e){return Ve.apply(this,arguments)}var Ge,Ue=[{litmus:He.isString,conversions:{THREE_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:Re},SIX_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:Re},CSS_RGB:{read:function(e){e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:Re},CSS_RGBA:{read:function(e){e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:Re}}},{litmus:He.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:He.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:He.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(He.isNumber(e.r)&&He.isNumber(e.g)&&He.isNumber(e.b)&&He.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(He.isNumber(e.r)&&He.isNumber(e.g)&&He.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(He.isNumber(e.h)&&He.isNumber(e.s)&&He.isNumber(e.v)&&He.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(He.isNumber(e.h)&&He.isNumber(e.s)&&He.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Xe=void 0,qe=void 0,We=function(){qe=!1;var o=1<arguments.length?He.toArray(arguments):arguments[0];return He.each(Ue,function(e){if(e.litmus(o))return He.each(e.conversions,function(e,t){if(Xe=e.read(o),!1===qe&&!1!==Xe)return(qe=Xe).conversionName=t,Xe.conversion=e,He.BREAK}),He.BREAK}),qe},Ye={hsv_to_rgb:function(e,t,o){var n=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),r=o*(1-t),e=o*(1-i*t),t=o*(1-(1-i)*t),n=[[o,t,r],[e,o,r],[r,o,t],[r,e,o],[t,r,o],[o,r,e]][n];return{r:255*n[0],g:255*n[1],b:255*n[2]}},rgb_to_hsv:function(e,t,o){var n=Math.min(e,t,o),i=Math.max(e,t,o),r=i-n,n=void 0;return 0===i?{h:NaN,s:0,v:0}:(n=e===i?(t-o)/r:t===i?2+(o-e)/r:4+(e-t)/r,(n/=6)<0&&(n+=1),{h:360*n,s:r/i,v:i/255})},rgb_to_hex:function(e,t,o){e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t);return e=this.hex_with_component(e,0,o)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,o){return o<<(Ge=8*t)|e&~(255<<Ge)}},Ze="function"==typeof Symbol&&"symbol"===se(Symbol.iterator)?function(e){return void 0===e?"undefined":se(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":se(e)},Je=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},H=function(e,t,o){return t&&Ke(e.prototype,t),o&&Ke(e,o),e};function Ke(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Qe(e,t,o){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0!==n){if("value"in n)return n.value;n=n.get;return void 0!==n?n.call(o):void 0}if(e=Object.getPrototypeOf(e),null!==e)return Qe(e,t,o)}var te=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":se(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},$e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":se(t))&&"function"!=typeof t?e:t},et=(H(tt,[{key:"toString",value:function(){return Re(this)}},{key:"toHexString",value:function(){return Re(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),tt);function tt(){if(Je(this,tt),this.__state=We.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}function ot(e,t,o){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||et.recalculateRGB(this,t,o),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(et.recalculateRGB(this,t,o),this.__state.space="RGB"),this.__state[t]=e}})}function nt(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||et.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(et.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}et.recalculateRGB=function(e,t,o){if("HEX"===e.__state.space)e.__state[t]=Ye.component_from_hex(e.__state.hex,o);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");He.extend(e.__state,Ye.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},et.recalculateHSV=function(e){var t=Ye.rgb_to_hsv(e.r,e.g,e.b);He.extend(e.__state,{s:t.s,v:t.v}),He.isNaN(t.h)?He.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},et.COMPONENTS=["r","g","b","h","s","v","hex","a"],ot(et.prototype,"r",2),ot(et.prototype,"g",1),ot(et.prototype,"b",0),nt(et.prototype,"h"),nt(et.prototype,"s"),nt(et.prototype,"v"),Object.defineProperty(et.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(et.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=Ye.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var it=(H(rt,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),rt);function rt(e,t){Je(this,rt),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}var at={};He.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){He.each(e,function(e){at[e]=t})});var st=/(\d+(\.\d+)?)px/;function lt(e){if("0"===e||He.isUndefined(e))return 0;e=e.match(st);return He.isNull(e)?0:parseFloat(e[1])}var ct={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,o){He.isUndefined(t)&&(t=!0),He.isUndefined(o)&&(o=!0),e.style.position="absolute",t&&(e.style.left=0,e.style.right=0),o&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,o,n){var i=o||{},o=at[t];if(!o)throw new Error("Event type "+t+" not supported.");var r=document.createEvent(o);switch(o){case"MouseEvents":var a=i.x||i.clientX||0,s=i.y||i.clientY||0;r.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,a,s,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":s=r.initKeyboardEvent||r.initKeyEvent;He.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),s(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:r.initEvent(t,i.bubbles||!1,i.cancelable||!0)}He.defaults(r,n),e.dispatchEvent(r)},bind:function(e,t,o,n){n=n||!1;return e.addEventListener?e.addEventListener(t,o,n):e.attachEvent&&e.attachEvent("on"+t,o),ct},unbind:function(e,t,o,n){n=n||!1;return e.removeEventListener?e.removeEventListener(t,o,n):e.detachEvent&&e.detachEvent("on"+t,o),ct},addClass:function(e,t){var o;return void 0===e.className?e.className=t:e.className===t||-1===(o=e.className.split(/ +/)).indexOf(t)&&(o.push(t),e.className=o.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")),ct},removeClass:function(e,t){var o;return t?e.className===t?e.removeAttribute("class"):-1!==(t=(o=e.className.split(/ +/)).indexOf(t))&&(o.splice(t,1),e.className=o.join(" ")):e.className=void 0,ct},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){e=getComputedStyle(e);return lt(e["border-left-width"])+lt(e["border-right-width"])+lt(e["padding-left"])+lt(e["padding-right"])+lt(e.width)},getHeight:function(e){e=getComputedStyle(e);return lt(e["border-top-width"])+lt(e["border-bottom-width"])+lt(e["padding-top"])+lt(e["padding-bottom"])+lt(e.height)},getOffset:function(e){var t=e,o={left:0,top:0};if(t.offsetParent)for(;o.left+=t.offsetLeft,o.top+=t.offsetTop,t=t.offsetParent,t;);return o},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},ut=(te(dt,it),H(dt,[{key:"setValue",value:function(e){e=Qe(dt.prototype.__proto__||Object.getPrototypeOf(dt.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Qe(dt.prototype.__proto__||Object.getPrototypeOf(dt.prototype),"updateDisplay",this).call(this)}}]),dt);function dt(e,t){Je(this,dt);var t=$e(this,(dt.__proto__||Object.getPrototypeOf(dt)).call(this,e,t)),o=t;return t.__prev=t.getValue(),t.__checkbox=document.createElement("input"),t.__checkbox.setAttribute("type","checkbox"),ct.bind(t.__checkbox,"change",function(){o.setValue(!o.__prev)},!1),t.domElement.appendChild(t.__checkbox),t.updateDisplay(),t}var pt=(te(ft,it),H(ft,[{key:"setValue",value:function(e){e=Qe(ft.prototype.__proto__||Object.getPrototypeOf(ft.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e}},{key:"updateDisplay",value:function(){return ct.isActive(this.__select)?this:(this.__select.value=this.getValue(),Qe(ft.prototype.__proto__||Object.getPrototypeOf(ft.prototype),"updateDisplay",this).call(this))}}]),ft);function ft(e,t,o){Je(this,ft);var n,t=$e(this,(ft.__proto__||Object.getPrototypeOf(ft)).call(this,e,t)),o=o,i=t;return t.__select=document.createElement("select"),He.isArray(o)&&(n={},He.each(o,function(e){n[e]=e}),o=n),He.each(o,function(e,t){var o=document.createElement("option");o.innerHTML=t,o.setAttribute("value",e),i.__select.appendChild(o)}),t.updateDisplay(),ct.bind(t.__select,"change",function(){var e=this.options[this.selectedIndex].value;i.setValue(e)}),t.domElement.appendChild(t.__select),t}var mt=(te(ht,it),H(ht,[{key:"updateDisplay",value:function(){return ct.isActive(this.__input)||(this.__input.value=this.getValue()),Qe(ht.prototype.__proto__||Object.getPrototypeOf(ht.prototype),"updateDisplay",this).call(this)}}]),ht);function ht(e,t){Je(this,ht);var t=$e(this,(ht.__proto__||Object.getPrototypeOf(ht)).call(this,e,t)),o=t;function n(){o.setValue(o.__input.value)}return t.__input=document.createElement("input"),t.__input.setAttribute("type","text"),ct.bind(t.__input,"keyup",n),ct.bind(t.__input,"change",n),ct.bind(t.__input,"blur",function(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}),ct.bind(t.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),t.updateDisplay(),t.domElement.appendChild(t.__input),t}function gt(e){e=e.toString();return-1<e.indexOf(".")?e.length-e.indexOf(".")-1:0}te(yt,it),H(yt,[{key:"setValue",value:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),Qe(yt.prototype.__proto__||Object.getPrototypeOf(yt.prototype),"setValue",this).call(this,e)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=gt(e),this}}]),ne=yt;function yt(e,t,o){Je(this,yt);t=$e(this,(yt.__proto__||Object.getPrototypeOf(yt)).call(this,e,t)),o=o||{};return t.__min=o.min,t.__max=o.max,t.__step=o.step,He.isUndefined(t.__step)?0===t.initialValue?t.__impliedStep=1:t.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(t.initialValue))/Math.LN10))/10:t.__impliedStep=t.__step,t.__precision=gt(t.__impliedStep),t}var vt=(te(bt,ne),H(bt,[{key:"updateDisplay",value:function(){var e,t;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),t=this.__precision,t=Math.pow(10,t),Math.round(e*t)/t),Qe(bt.prototype.__proto__||Object.getPrototypeOf(bt.prototype),"updateDisplay",this).call(this)}}]),bt);function bt(e,t,o){Je(this,bt);o=$e(this,(bt.__proto__||Object.getPrototypeOf(bt)).call(this,e,t,o));o.__truncationSuspended=!1;var n=o,i=void 0;function r(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}function a(e){var t=i-e.clientY;n.setValue(n.getValue()+t*n.__impliedStep),i=e.clientY}function s(){ct.unbind(window,"mousemove",a),ct.unbind(window,"mouseup",s),r()}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),ct.bind(o.__input,"change",function(){var e=parseFloat(n.__input.value);He.isNaN(e)||n.setValue(e)}),ct.bind(o.__input,"blur",function(){r()}),ct.bind(o.__input,"mousedown",function(e){ct.bind(window,"mousemove",a),ct.bind(window,"mouseup",s),i=e.clientY}),ct.bind(o.__input,"keydown",function(e){13===e.keyCode&&(n.__truncationSuspended=!0,this.blur(),n.__truncationSuspended=!1,r())}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}function _t(e,t,o,n,i){return n+(e-t)/(o-t)*(i-n)}var xt=(te(wt,ne),H(wt,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",Qe(wt.prototype.__proto__||Object.getPrototypeOf(wt.prototype),"updateDisplay",this).call(this)}}]),wt);function wt(e,t,o,n,i){Je(this,wt);var i=$e(this,(wt.__proto__||Object.getPrototypeOf(wt)).call(this,e,t,{min:o,max:n,step:i})),r=i;function a(e){e.preventDefault();var t=r.__background.getBoundingClientRect();return r.setValue(_t(e.clientX,t.left,t.right,r.__min,r.__max)),!1}function s(){ct.unbind(window,"mousemove",a),ct.unbind(window,"mouseup",s),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function l(e){var t=e.touches[0].clientX,e=r.__background.getBoundingClientRect();r.setValue(_t(t,e.left,e.right,r.__min,r.__max))}function c(){ct.unbind(window,"touchmove",l),ct.unbind(window,"touchend",c),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}return i.__background=document.createElement("div"),i.__foreground=document.createElement("div"),ct.bind(i.__background,"mousedown",function(e){document.activeElement.blur(),ct.bind(window,"mousemove",a),ct.bind(window,"mouseup",s),a(e)}),ct.bind(i.__background,"touchstart",function(e){if(1!==e.touches.length)return;ct.bind(window,"touchmove",l),ct.bind(window,"touchend",c),l(e)}),ct.addClass(i.__background,"slider"),ct.addClass(i.__foreground,"slider-fg"),i.updateDisplay(),i.__background.appendChild(i.__foreground),i.domElement.appendChild(i.__background),i}var Ct=(te(Tt,it),H(Tt,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),Tt);function Tt(e,t,o){Je(this,Tt);var t=$e(this,(Tt.__proto__||Object.getPrototypeOf(Tt)).call(this,e,t)),n=t;return t.__button=document.createElement("div"),t.__button.innerHTML=void 0===o?"Fire":o,ct.bind(t.__button,"click",function(e){return e.preventDefault(),n.fire(),!1}),ct.addClass(t.__button,"button"),t.domElement.appendChild(t.__button),t}var Et=(te(St,it),H(St,[{key:"updateDisplay",value:function(){var t,o=We(this.getValue());!1!==o&&(t=!1,He.each(et.COMPONENTS,function(e){if(!He.isUndefined(o[e])&&!He.isUndefined(this.__color.__state[e])&&o[e]!==this.__color.__state[e])return t=!0,{}},this),t&&He.extend(this.__color.__state,o)),He.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var e=this.__color.v<.5||.5<this.__color.s?255:0,n=255-e;He.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+e+","+e+","+e+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,Ot(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),He.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+e+","+e+","+e+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),St);function St(e,t){Je(this,St);var o=$e(this,(St.__proto__||Object.getPrototypeOf(St)).call(this,e,t));o.__color=new et(o.getValue()),o.__temp=new et(0);var n=o;o.domElement=document.createElement("div"),ct.makeSelectable(o.domElement,!1),o.__selector=document.createElement("div"),o.__selector.className="selector",o.__saturation_field=document.createElement("div"),o.__saturation_field.className="saturation-field",o.__field_knob=document.createElement("div"),o.__field_knob.className="field-knob",o.__field_knob_border="2px solid ",o.__hue_knob=document.createElement("div"),o.__hue_knob.className="hue-knob",o.__hue_field=document.createElement("div"),o.__hue_field.className="hue-field",o.__input=document.createElement("input"),o.__input.type="text",o.__input_textShadow="0 1px 1px ",ct.bind(o.__input,"keydown",function(e){13===e.keyCode&&l.call(this)}),ct.bind(o.__input,"blur",l),ct.bind(o.__selector,"mousedown",function(){ct.addClass(this,"drag").bind(window,"mouseup",function(){ct.removeClass(n.__selector,"drag")})}),ct.bind(o.__selector,"touchstart",function(){ct.addClass(this,"drag").bind(window,"touchend",function(){ct.removeClass(n.__selector,"drag")})});e=document.createElement("div");function i(e){u(e),ct.bind(window,"mousemove",u),ct.bind(window,"touchmove",u),ct.bind(window,"mouseup",a),ct.bind(window,"touchend",a)}function r(e){d(e),ct.bind(window,"mousemove",d),ct.bind(window,"touchmove",d),ct.bind(window,"mouseup",s),ct.bind(window,"touchend",s)}function a(){ct.unbind(window,"mousemove",u),ct.unbind(window,"touchmove",u),ct.unbind(window,"mouseup",a),ct.unbind(window,"touchend",a),c()}function s(){ct.unbind(window,"mousemove",d),ct.unbind(window,"touchmove",d),ct.unbind(window,"mouseup",s),ct.unbind(window,"touchend",s),c()}function l(){var e=We(this.value);!1!==e?(n.__color.__state=e,n.setValue(n.__color.toOriginal())):this.value=n.__color.toString()}function c(){n.__onFinishChange&&n.__onFinishChange.call(n,n.__color.toOriginal())}function u(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=n.__saturation_field.getBoundingClientRect(),o=e.touches&&e.touches[0]||e,e=o.clientX,o=o.clientY,e=(e-t.left)/(t.right-t.left),t=1-(o-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),1<e?e=1:e<0&&(e=0),n.__color.v=t,n.__color.s=e,n.setValue(n.__color.toOriginal()),!1}function d(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=n.__hue_field.getBoundingClientRect(),t=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),n.__color.h=360*t,n.setValue(n.__color.toOriginal()),!1}return He.extend(o.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),He.extend(o.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:o.__field_knob_border+(o.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),He.extend(o.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),He.extend(o.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),He.extend(e.style,{width:"100%",height:"100%",background:"none"}),Ot(e,"top","rgba(0,0,0,0)","#000"),He.extend(o.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(t=o.__hue_field).style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",He.extend(o.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:o.__input_textShadow+"rgba(0,0,0,0.7)"}),ct.bind(o.__saturation_field,"mousedown",i),ct.bind(o.__saturation_field,"touchstart",i),ct.bind(o.__field_knob,"mousedown",i),ct.bind(o.__field_knob,"touchstart",i),ct.bind(o.__hue_field,"mousedown",r),ct.bind(o.__hue_field,"touchstart",r),o.__saturation_field.appendChild(e),o.__selector.appendChild(o.__field_knob),o.__selector.appendChild(o.__saturation_field),o.__selector.appendChild(o.__hue_field),o.__hue_field.appendChild(o.__hue_knob),o.domElement.appendChild(o.__input),o.domElement.appendChild(o.__selector),o.updateDisplay(),o}var At=["-moz-","-o-","-webkit-","-ms-",""];function Ot(t,o,n,i){t.style.background="",He.each(At,function(e){t.style.cssText+="background: "+e+"linear-gradient("+o+", "+n+" 0%, "+i+" 100%); "})}var kt=function(e,t){var o=e[t];return He.isArray(arguments[2])||He.isObject(arguments[2])?new pt(e,t,arguments[2]):He.isNumber(o)?He.isNumber(arguments[2])&&He.isNumber(arguments[3])?He.isNumber(arguments[4])?new xt(e,t,arguments[2],arguments[3],arguments[4]):new xt(e,t,arguments[2],arguments[3]):He.isNumber(arguments[4])?new vt(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new vt(e,t,{min:arguments[2],max:arguments[3]}):He.isString(o)?new mt(e,t):He.isFunction(o)?new Ct(e,t,""):He.isBoolean(o)?new ut(e,t):null},w=(te(Pt,it),H(Pt,[{key:"controller",set:function(e){this._controller=e},get:function(){return this._controller}}]),Pt);function Pt(e,t){Je(this,Pt);var o=$e(this,(Pt.__proto__||Object.getPrototypeOf(Pt)).call(this,e,t));return o.arguments={object:e,property:t,opts:Array.prototype.slice.call(arguments,2)},e.property&&(o.property=e.property(o)),o}te=function(e,t){var t=t||document,o=document.createElement("style");o.type="text/css",o.innerHTML=e;var n=t.getElementsByTagName("head")[0];try{n.appendChild(o)}catch(e){}};var zt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},Mt=(H(Lt,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),He.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",ct.unbind(t.domElement,"webkitTransitionEnd",e),ct.unbind(t.domElement,"transitionend",e),ct.unbind(t.domElement,"oTransitionEnd",e)}var t=this;ct.bind(this.domElement,"webkitTransitionEnd",e),ct.bind(this.domElement,"transitionend",e),ct.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-ct.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-ct.getHeight(this.domElement)/2+"px"}}]),Lt);function Lt(){Je(this,Lt),this.backgroundElement=document.createElement("div"),He.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),ct.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),He.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;ct.bind(this.backgroundElement,"click",function(){e.hide()})}te(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var Ft="Default",Dt=function(){try{return!!window.localStorage}catch(e){return!1}}(),Nt=void 0,Rt=!0,Vt=void 0,jt=!1,It=[],Ht=function t(e){var o=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),ct.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=He.defaults(n,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),n=He.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),He.isUndefined(n.load)?n.load={preset:Ft}:n.preset&&(n.load.preset=n.preset),He.isUndefined(n.parent)&&n.hideable&&It.push(this),n.resizable=He.isUndefined(n.parent)&&n.resizable,n.autoPlace&&He.isUndefined(n.scrollable)&&(n.scrollable=!0);var i,r,a,s,l=Dt&&"true"===localStorage.getItem(Wt(0,"isLocal")),c=void 0,u=void 0;function d(e){return e.preventDefault(),r.width+=a-e.clientX,r.onResize(),a=e.clientX,!1}function p(){ct.removeClass(r.__closeButton,Ht.CLASS_DRAG),ct.unbind(window,"mousemove",d),ct.unbind(window,"mouseup",p)}function f(e){return e.preventDefault(),a=e.clientX,ct.addClass(r.__closeButton,Ht.CLASS_DRAG),ct.bind(window,"mousemove",d),ct.bind(window,"mouseup",p),!1}Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return(o.parent?o.getRoot():n.load).preset},set:function(e){o.parent?o.getRoot().preset=e:n.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),o.revert()}},width:{get:function(){return n.width},set:function(e){n.width=e,Jt(o,e)}},name:{get:function(){return n.name},set:function(e){n.name=e,u&&(u.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(e){n.closed=e,n.closed?ct.addClass(o.__ul,t.CLASS_CLOSED):ct.removeClass(o.__ul,t.CLASS_CLOSED),this.onResize(),o.__closeButton&&(o.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return l},set:function(e){Dt&&((l=e)?ct.bind(window,"unload",c):ct.unbind(window,"unload",c),localStorage.setItem(Wt(0,"isLocal"),e))}}}),He.isUndefined(n.parent)?(this.closed=n.closed||!1,ct.addClass(this.domElement,t.CLASS_MAIN),ct.makeSelectable(this.domElement,!1),Dt&&l&&(o.useLocalStorage=!0,(i=localStorage.getItem(Wt(0,"gui")))&&(n.load=JSON.parse(i))),this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,ct.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),n.closeOnTop?(ct.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(ct.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),ct.bind(this.__closeButton,"click",function(){o.closed=!o.closed})):(void 0===n.closed&&(n.closed=!0),i=document.createTextNode(n.name),ct.addClass(i,"controller-name"),u=Bt(o,i),ct.addClass(this.__ul,t.CLASS_CLOSED),ct.addClass(u,"title"),ct.bind(u,"click",function(e){return e.preventDefault(),o.closed=!o.closed,!1}),n.closed||(this.closed=!1)),n.autoPlace&&(He.isUndefined(n.parent)&&(Rt&&(Vt=document.createElement("div"),ct.addClass(Vt,"dg"),ct.addClass(Vt,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Vt),Rt=!1),Vt.appendChild(this.domElement),ct.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||Jt(o,n.width)),this.__resizeHandler=function(){o.onResizeDebounced()},ct.bind(window,"resize",this.__resizeHandler),ct.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),ct.bind(this.__ul,"transitionend",this.__resizeHandler),ct.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&(a=void 0,(r=this).__resize_handle=document.createElement("div"),He.extend(r.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),ct.bind(r.__resize_handle,"mousedown",f),ct.bind(r.__closeButton,"mousedown",f),r.domElement.insertBefore(r.__resize_handle,r.domElement.firstElementChild)),c=function(){Dt&&"true"===localStorage.getItem(Wt(0,"isLocal"))&&localStorage.setItem(Wt(0,"gui"),JSON.stringify(o.getSaveObject()))},this.saveToLocalStorageIfPossible=c,n.parent||((s=o.getRoot()).width+=1,He.defer(function(){--s.width}))};function Bt(e,t,o){var n=document.createElement("li");return t&&n.appendChild(t),o?e.__ul.insertBefore(n,o):e.__ul.appendChild(n),e.onResize(),n}function Gt(e){ct.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&ct.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function Ut(e,t){e=e.__preset_select[e.__preset_select.selectedIndex];e.innerHTML=t?e.value+"*":e.value}function Xt(e,t){var o=e.getRoot(),n=o.__rememberedObjects.indexOf(t.object);if(-1!==n){var i=o.__rememberedObjectIndecesToControllers[n];if(void 0===i&&(i={},o.__rememberedObjectIndecesToControllers[n]=i),i[t.property]=t,o.load&&o.load.remembered){i=o.load.remembered,o=void 0;if(i[e.preset])o=i[e.preset];else{if(!i[Ft])return;o=i[Ft]}o[n]&&void 0!==o[n][t.property]&&(n=o[n][t.property],t.initialValue=n,t.setValue(n))}}}function qt(e,t,o,n){var i;if(t.arguments&&(t=(i=t).arguments.object,o=i.arguments.property,n={factoryArgs:i.arguments.opts}),void 0===i&&void 0===t[o])throw new Error('Object "'+t+'" has no property "'+o+'"');var r=void 0;null===(r=n.color?new Et(t,o):void 0!==i&&"string"==typeof i.property?i:(l=[t,o].concat(n.factoryArgs),kt.apply(e,l)))?r=i:void 0!==i&&(i.controller=r),n.before instanceof it&&(n.before=n.before.__li),Xt(e,r),ct.addClass(r.domElement,"c");var a=document.createElement("span");if(ct.addClass(a,"property-name"),void 0!==i&&"object"===Ze(i.property))for(var s in i.property)a.appendChild(i.property[s]);else a.innerHTML=r.property;var l=document.createElement("div");l.appendChild(a),l.appendChild(r.domElement);var c,u,d,p,n=Bt(e,l,n.before);return ct.addClass(n,Ht.CLASS_CONTROLLER_ROW),r instanceof Et?ct.addClass(n,"color"):ct.addClass(n,Ze(r.getValue())),c=e,u=n,(d=r).__li=u,d.__gui=c,He.extend(d,{options:function(e){if(1<arguments.length){var t=d.__li.nextElementSibling;return d.remove(),qt(c,d.object,d.property,{before:t,factoryArgs:[He.toArray(arguments)]})}if(He.isArray(e)||He.isObject(e)){t=d.__li.nextElementSibling;return d.remove(),qt(c,d.object,d.property,{before:t,factoryArgs:[e]})}},name:function(e){return d.__li.firstElementChild.firstElementChild.innerHTML=e,d},listen:function(){return d.__gui.listen(d),d},remove:function(){return d.__gui.remove(d),d}}),d instanceof xt?(p=new vt(d.object,d.property,{min:d.__min,max:d.__max,step:d.__step}),He.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=d[e],o=p[e];d[e]=p[e]=function(){var e=Array.prototype.slice.call(arguments);return o.apply(p,e),t.apply(d,e)}}),ct.addClass(u,"has-slider"),d.domElement.insertBefore(p.domElement,d.domElement.firstElementChild)):d instanceof vt?(n=function(e){if(He.isNumber(d.__min)&&He.isNumber(d.__max)){var t=d.__li.firstElementChild.firstElementChild.innerHTML,o=-1<d.__gui.__listening.indexOf(d);d.remove();var n=qt(c,d.object,d.property,{before:d.__li.nextElementSibling,factoryArgs:[d.__min,d.__max,d.__step]});return n.name(t),o&&n.listen(),n}return e},d.min=He.compose(n,d.min),d.max=He.compose(n,d.max)):d instanceof ut?(ct.bind(u,"click",function(){ct.fakeEvent(d.__checkbox,"click")}),ct.bind(d.__checkbox,"click",function(e){e.stopPropagation()})):d instanceof Ct?(ct.bind(u,"click",function(){ct.fakeEvent(d.__button,"click")}),ct.bind(u,"mouseover",function(){ct.addClass(d.__button,"hover")}),ct.bind(u,"mouseout",function(){ct.removeClass(d.__button,"hover")})):d instanceof Et&&(ct.addClass(u,"color"),d.updateDisplay=He.compose(function(e){return u.style.borderLeftColor=d.__color.toString(),e},d.updateDisplay),d.updateDisplay()),d.setValue=He.compose(function(e){return c.getRoot().__preset_select&&d.isModified()&&Ut(c.getRoot(),!0),e},d.setValue),e.__controllers.push(r),r}function Wt(e,t){return document.location.href+"."+t}function Yt(e,t,o){var n=document.createElement("option");n.innerHTML=t,n.value=t,e.__preset_select.appendChild(n),o&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function Zt(e,t){t.style.display=e.useLocalStorage?"block":"none"}function Jt(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function Kt(i,r){var a={};return He.each(i.__rememberedObjects,function(e,t){var o={},n=i.__rememberedObjectIndecesToControllers[t];He.each(n,function(e,t){o[t]=r?e.initialValue:e.getValue()}),a[t]=o}),a}Ht.toggleHide=function(){jt=!jt,He.each(It,function(e){e.domElement.style.display=jt?"none":""})},Ht.CLASS_AUTO_PLACE="a",Ht.CLASS_AUTO_PLACE_CONTAINER="ac",Ht.CLASS_MAIN="main",Ht.CLASS_CONTROLLER_ROW="cr",Ht.CLASS_TOO_TALL="taller-than-window",Ht.CLASS_CLOSED="closed",Ht.CLASS_CLOSE_BUTTON="close-button",Ht.CLASS_CLOSE_TOP="close-top",Ht.CLASS_CLOSE_BOTTOM="close-bottom",Ht.CLASS_DRAG="drag",Ht.DEFAULT_WIDTH=245,Ht.TEXT_CLOSED="Close Controls",Ht.TEXT_OPEN="Open Controls",Ht._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||Ht.toggleHide()},ct.bind(window,"keydown",Ht._keydownHandler,!1),He.extend(Ht.prototype,{add:function(e,t){return qt(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return qt(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;He.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Vt.removeChild(this.domElement);var t=this;He.each(this.__folders,function(e){t.removeFolder(e)}),ct.unbind(window,"keydown",Ht._keydownHandler,!1),Gt(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);t=new Ht(t);this.__folders[e]=t;e=Bt(this,t.domElement);return ct.addClass(e,"folder"),t},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Gt(t);var e=this;He.each(t.__folders,function(e){t.removeFolder(e)}),He.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e,t,o=this.getRoot();o.scrollable&&(e=ct.getOffset(o.__ul).top,t=0,He.each(o.__ul.childNodes,function(e){o.autoPlace&&e===o.__save_row||(t+=ct.getHeight(e))}),window.innerHeight-e-20<t?(ct.addClass(o.domElement,Ht.CLASS_TOO_TALL),o.__ul.style.height=window.innerHeight-e-20+"px"):(ct.removeClass(o.domElement,Ht.CLASS_TOO_TALL),o.__ul.style.height="auto")),o.__resize_handle&&He.defer(function(){o.__resize_handle.style.height=o.__ul.offsetHeight+"px"}),o.__closeButton&&(o.__closeButton.style.width=o.width+"px")},onResizeDebounced:He.debounce(function(){this.onResize()},50),remember:function(){if(He.isUndefined(Nt)&&((Nt=new Mt).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;He.each(Array.prototype.slice.call(arguments),function(e){0===t.__rememberedObjects.length&&function(o){var e=o.__save_row=document.createElement("li");ct.addClass(o.domElement,"has-save"),o.__ul.insertBefore(e,o.__ul.firstChild),ct.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",ct.addClass(t,"button gears");var n=document.createElement("span");n.innerHTML="Save",ct.addClass(n,"button"),ct.addClass(n,"save");var i=document.createElement("span");i.innerHTML="New",ct.addClass(i,"button"),ct.addClass(i,"save-as");var r=document.createElement("span");r.innerHTML="Revert",ct.addClass(r,"button"),ct.addClass(r,"revert");var a,s=o.__preset_select=document.createElement("select");o.load&&o.load.remembered?He.each(o.load.remembered,function(e,t){Yt(o,t,t===o.preset)}):Yt(o,Ft,!1),ct.bind(s,"change",function(){for(var e=0;e<o.__preset_select.length;e++)o.__preset_select[e].innerHTML=o.__preset_select[e].value;o.preset=this.value}),e.appendChild(s),e.appendChild(t),e.appendChild(n),e.appendChild(i),e.appendChild(r),Dt&&(a=document.getElementById("dg-local-explain"),e=document.getElementById("dg-local-storage"),document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(Wt(0,"isLocal"))&&e.setAttribute("checked","checked"),Zt(o,a),ct.bind(e,"change",function(){o.useLocalStorage=!o.useLocalStorage,Zt(o,a)}));var l=document.getElementById("dg-new-constructor");ct.bind(l,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Nt.hide()}),ct.bind(t,"click",function(){l.innerHTML=JSON.stringify(o.getSaveObject(),void 0,2),Nt.show(),l.focus(),l.select()}),ct.bind(n,"click",function(){o.save()}),ct.bind(i,"click",function(){var e=prompt("Enter a new preset name.");e&&o.saveAs(e)}),ct.bind(r,"click",function(){o.revert()})}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&Jt(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var o=this.load;return o.closed=this.closed,0<this.__rememberedObjects.length&&(o.preset=this.preset,o.remembered||(o.remembered={}),o.remembered[this.preset]=Kt(this)),o.folders={},He.each(this.__folders,function(e,t){o.folders[t]=e.getSaveObject()}),o},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Kt(this),Ut(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Ft]=Kt(this,!0)),this.load.remembered[e]=Kt(this),this.preset=e,Yt(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(t){He.each(this.__controllers,function(e){this.getRoot().load.remembered?Xt(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),He.each(this.__folders,function(e){e.revert(e)}),t||Ut(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&zt.call(window,function(){e(t)});He.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){He.each(this.__controllers,function(e){e.updateDisplay()}),He.each(this.__folders,function(e){e.updateDisplay()})}});var Qt={Controller:it,BooleanController:ut,OptionController:pt,StringController:mt,NumberController:ne,NumberControllerBox:vt,NumberControllerSlider:xt,FunctionController:Ct,ColorController:Et,CustomController:w};
/**
 * get position functions library
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function $t(e,t){var o=Me.THREE,e=e.geometry.attributes.position,o=4<=e.itemSize?new o.Vector4(0,0,0,0):new o.Vector3;return o.fromArray(e.array,t*e.itemSize),o}function eo(e,t){var o,n,i,r,a=Me.THREE,s=t.clone();for(;o=e,n=s,r=i=void 0,i=new a.Vector3,r=new a.Vector3,(i=n.clone()).multiply(o.scale),r.copy(i),r.applyEuler(o.rotation),i.x=r.x,i.y=r.y,i.z=r.z,i.add(o.position),s=i,e=e.parent,e&&e.parent;);return s}function to(e,t){if(-1!==t)return void 0===t?e.position:eo(e,$t(e,t))}te={isWebGLAvailable:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},isWebGL2Available:function(){try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},getWebGLErrorMessage:function(){return this.getErrorMessage(1)},getWebGL2ErrorMessage:function(){return this.getErrorMessage(2)},getErrorMessage:function(e){var t={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext},o='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>',n=document.createElement("div");return n.id="webglmessage",n.style.fontFamily="monospace",n.style.fontSize="13px",n.style.fontWeight="normal",n.style.textAlign="center",n.style.background="#fff",n.style.color="#000",n.style.padding="1.5em",n.style.width="400px",n.style.margin="5em auto 0",o=(o=t[e]?o.replace("$0","graphics card"):o.replace("$0","browser")).replace("$1",{1:"WebGL",2:"WebGL 2"}[e]),n.innerHTML=o,n}};
/**
* node.js version of the synchronous download of the file.
* @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
*
* @copyright 2011 Data Arts Team, Google Creative Lab
*
* @license under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*/function oo(t){if(this.loadXMLDoc=function(){var e;if(window.XMLHttpRequest){if(!(e=new XMLHttpRequest))throw"new XMLHttpRequest() failed!"}else{if(!window.ActiveXObject)throw"myRequest.loadXMLDoc(...) failed!";if(!(e=this.NewActiveXObject()))throw"NewActiveXObject() failed!"}return e},this.NewActiveXObject=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}return a('This browser does not support XMLHttpRequest. Probably, your security settings do not allow Web sites to use ActiveX controls installed on your computer. Refresh your Web page to find out the current status of your Web page or enable the "Initialize and script ActiveX controls not marked as safe" and "Run Active X controls and plug-ins" of the Security settings of the Internet zone of your browser.'),null},this.XMLHttpRequestStart=function(e,t){this.XMLHttpRequestStop(),this.req.onreadystatechange=e,"onerror"in this.req&&(this.req.onerror=function(e){a("XMLHttpRequest error. url: "+this.url)}),this.XMLHttpRequestReStart(t)},this.getUrl=function(){return void 0!==this.url&&null!=this.url||(this.url="XMLHttpRequest.xml"),this.url+(this.params||"")},this.XMLHttpRequestReStart=function(e){try{void 0===e&&(e=!0),this.req.open("GET",this.getUrl(),e),e&&("timeout"in this.req&&(this.req.timeout=9e4),"ontimeout"in this.req?this.req.ontimeout=function(){a("XMLHttpRequest timeout")}:(clearTimeout(this.timeout_id_SendReq),this.timeout_id_SendReq=setTimeout(function(){a("XMLHttpRequest timeout 2")},9e4))),this.req.send(null)}catch(e){a(e.message+" url: "+this.url)}},this.XMLHttpRequestStop=function(){null!=this.req&&this.req.abort()},this.ProcessReqChange=function(e){var t=this.req;switch(t.readyState){case 4:if("unknown"==typeof t.status)return consoleError('typeof XMLHttpRequest status == "unknown"'),!0;if(200==t.status)return clearTimeout(this.timeout_id_SendReq),e(this);a("Invalid XMLHttpRequest status : "+t.status+" url: "+this.url);break;case 1:case 2:case 3:break;case 0:default:throw"processReqChange(); req.readyState = "+t.readyState}return!0},this.processStatus200Error=function(){var e=this.GetElementText("error",!0);return!!e&&(a(e),!0)},this.GetElementText=function(e,t){var o=this.req;if(!o.responseXML)return 1!=t&&a("GetXMLElementText(xmlhttp, "+e+"); xmlhttp.responseXML is null.\nxmlhttp.responseText:\n"+o.responseText),null;var n=o.responseXML.getElementsByTagName(e);if(0==n.length)return 1!=t&&a('GetXMLElementText(xmlhttp, "'+e+'"); element.length == '+n.length),"";for(var i="",r=0;r<n.length;r++)if(void 0===n[r].textContent){if(void 0===n[r].text)return a("GetXMLElementText(xmlhttp, "+e+"); element["+r+"].text) == undefined"),"";""!=i&&(i+=" "),i+=n[r].text}else i+=n[r].textContent;return i},t.data)this.req=t.data.req,this.url=t.data.url,this.params=t.data.params;else try{this.req=this.loadXMLDoc()}catch(e){var o=void 0===e.message?e:e.message;return void a("Your browser is too old and is not compatible with our site.\n\n"+window.navigator.appName+" "+window.navigator.appVersion+"\n\n"+o)}function a(e){console.error(e),t.onerror(e)}this.req||consoleError("Invalid myRequest.req: "+this.req)}function no(t,o){(o=o||{}).onload=o.onload||function(){},o.onerror=o.onerror||function(){};var n,e=new oo(o);return e.url=t,e.XMLHttpRequestStart(function(){e.ProcessReqChange(function(e){e.processStatus200Error()||(n=e.req.responseText,o.onload(n,t))})},!1),n}
/**
 * node.js version of the load JavaScript file
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * Thanks to:
 *http://javascript.ru/forum/events/21439-dinamicheskaya-zagruzka-skriptov.html
 *https://learn.javascript.ru/onload-onerror
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function io(e,t){if(t.tag=t.tag||{},"string"==typeof t.tag){if("style"!==t.tag)return void console.error("Invalid options.tag: "+t.tag);t.tag={name:"style",attribute:{name:"rel",value:"stylesheet"}}}t.tag.name=t.tag.name||"script";var o=document.createElement(t.tag.name);t.tag.attribute=t.tag.attribute||{},t.tag.attribute.name=t.tag.attribute.name||"type",t.tag.attribute.value=t.tag.attribute.value||"text/javascript",o.setAttribute(t.tag.attribute.name,t.tag.attribute.value),e(o),t.appendTo.appendChild(o)}function ro(e,t){for(var o=e.querySelectorAll("script"),n=0;n<o.length;n++)if(o[n].id===t)return 1}var ao,so={sync:function(t,o){if((o=o||{}).onload=o.onload||function(){},o.onerror=o.onerror||function(){},o.appendTo=o.appendTo||document.getElementsByTagName("head")[0],ro(o.appendTo,t))o.onload();else if(t instanceof Array){for(var n,i={appendTo:o.appendTo,tag:o.tag,onload:function(e,t){console.log("loadScript.sync.onload: "+t)},onerror:function(e){o.onerror(e),n=e}},e=0;e<t.length;e++){var r=t[e];if(io(function(e){e.setAttribute("id",r),e.innerHTML=no(r,i)},i),void 0!==n)break}void 0===n&&o.onload()}else io(function(e){e.setAttribute("id",t),e.innerHTML=no(t,o)},o)},async:function(e,n){var i;function r(t){function o(){e instanceof Array&&i<e.length-1?r(e[++i]):n.onload()}ro(n.appendTo,t,n.onload)?o():io(function(e){e.setAttribute("id",t),e.readyState&&!e.onload?e.onreadystatechange=function(){"complete"==e.readyState&&void 0!==n.onload&&n.onload(),"loaded"==e.readyState&&(setTimeout(n.onload,0),this.onreadystatechange=null)}:(e.onload=function(){console.log("loadScript.async.onload() "+t),void 0!==n.onload&&o()},e.onerror=function(e){var t='loadScript: "'+this.src+'" failed';void 0!==n.onerror&&n.onerror(t,e),console.error(t)}),e.src=t},n)}(n=n||{}).appendTo=n.appendTo||document.getElementsByTagName("head")[0],n.onload=n.onload||function(){},e instanceof Array?r(e[i=0]):r(e)}},ne=(ao=function(){if(document.currentScript&&""!==document.currentScript.src)return document.currentScript.src;var e=document.getElementsByTagName("script");return""!==e[e.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]}()).substring(0,ao.lastIndexOf("/"));
/**
 * @module ColorPicker
 * @description Pure JavaScript color picker.
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * Thanks to https://github.com/DavidDurman/FlexiColorPicker
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 */so.sync(ne+"/colorpicker.css",{tag:"style"});function lo(e,t){Me.THREE.EventDispatcher;var n,i,r,a,s,l,o=Me.THREE.MOUSE,c=Me.THREE.Quaternion,u=Me.THREE.Spherical,d=Me.THREE.TOUCH,p=Me.THREE.Vector2,f=Me.THREE.Vector3;void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new f,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:o.ROTATE,MIDDLE:o.DOLLY,RIGHT:o.PAN},this.touches={ONE:d.ROTATE,TWO:d.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return x.phi},this.getAzimuthalAngle=function(){return x.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",ie),this._domElementKeyEvents=e},this.saveState=function(){m.target0.copy(m.target),m.position0.copy(m.object.position),m.zoom0=m.object.zoom},this.reset=function(){m.target.copy(m.target0),m.object.position.copy(m.position0),m.object.zoom=m.zoom0,m.object.updateProjectionMatrix(),m.dispatchEvent(h),m.update(),b=v.NONE},this.update=(n=new f,i=(new c).setFromUnitVectors(e.up,new f(0,1,0)),r=i.clone().invert(),a=new f,s=new c,l=2*Math.PI,function(){var e=m.object.position;n.copy(e).sub(m.target),n.applyQuaternion(i),x.setFromVector3(n),m.autoRotate&&b===v.NONE&&N(2*Math.PI/60/60*m.autoRotateSpeed),m.enableDamping?(x.theta+=w.theta*m.dampingFactor,x.phi+=w.phi*m.dampingFactor):(x.theta+=w.theta,x.phi+=w.phi);var t=m.minAzimuthAngle,o=m.maxAzimuthAngle;return isFinite(t)&&isFinite(o)&&(t<-Math.PI?t+=l:t>Math.PI&&(t-=l),o<-Math.PI?o+=l:o>Math.PI&&(o-=l),x.theta=t<=o?Math.max(t,Math.min(o,x.theta)):x.theta>(t+o)/2?Math.max(t,x.theta):Math.min(o,x.theta)),x.phi=Math.max(m.minPolarAngle,Math.min(m.maxPolarAngle,x.phi)),x.makeSafe(),x.radius*=C,x.radius=Math.max(m.minDistance,Math.min(m.maxDistance,x.radius)),!0===m.enableDamping?m.target.addScaledVector(T,m.dampingFactor):m.target.add(T),n.setFromSpherical(x),n.applyQuaternion(r),e.copy(m.target).add(n),m.object.lookAt(m.target),!0===m.enableDamping?(w.theta*=1-m.dampingFactor,w.phi*=1-m.dampingFactor,T.multiplyScalar(1-m.dampingFactor)):(w.set(0,0,0),T.set(0,0,0)),C=1,!!(E||a.distanceToSquared(m.object.position)>_||8*(1-s.dot(m.object.quaternion))>_)&&(m.dispatchEvent(h),a.copy(m.object.position),s.copy(m.object.quaternion),!(E=!1))}),this.dispose=function(){m.domElement.removeEventListener("contextmenu",le),m.domElement.removeEventListener("pointerdown",ee),m.domElement.removeEventListener("wheel",ne),m.domElement.removeEventListener("touchstart",re),m.domElement.removeEventListener("touchend",se),m.domElement.removeEventListener("touchmove",ae),m.domElement.ownerDocument.removeEventListener("pointermove",te),m.domElement.ownerDocument.removeEventListener("pointerup",oe),null!==m._domElementKeyEvents&&m._domElementKeyEvents.removeEventListener("keydown",ie)};var m=this,h={type:"change"},g={type:"start"},y={type:"end"},v={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},b=v.NONE,_=1e-6,x=new u,w=new u,C=1,T=new f,E=!1,S=new p,A=new p,O=new p,k=new p,P=new p,z=new p,M=new p,L=new p,F=new p;function D(){return Math.pow(.95,m.zoomSpeed)}function N(e){w.theta-=e}function R(e){w.phi-=e}var V,j,I,H=(V=new f,function(e,t){V.setFromMatrixColumn(t,0),V.multiplyScalar(-e),T.add(V)}),B=(j=new f,function(e,t){!0===m.screenSpacePanning?j.setFromMatrixColumn(t,1):(j.setFromMatrixColumn(t,0),j.crossVectors(m.object.up,j)),j.multiplyScalar(e),T.add(j)}),G=(I=new f,function(e,t){var o,n=m.domElement;m.object.isPerspectiveCamera?(o=m.object.position,I.copy(o).sub(m.target),o=I.length(),o*=Math.tan(m.object.fov/2*Math.PI/180),H(2*e*o/n.clientHeight,m.object.matrix),B(2*t*o/n.clientHeight,m.object.matrix)):m.object.isOrthographicCamera?(H(e*(m.object.right-m.object.left)/m.object.zoom/n.clientWidth,m.object.matrix),B(t*(m.object.top-m.object.bottom)/m.object.zoom/n.clientHeight,m.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),m.enablePan=!1)});function U(e){m.object.isPerspectiveCamera?C/=e:m.object.isOrthographicCamera?(m.object.zoom=Math.max(m.minZoom,Math.min(m.maxZoom,m.object.zoom*e)),m.object.updateProjectionMatrix(),E=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),m.enableZoom=!1)}function X(e){m.object.isPerspectiveCamera?C*=e:m.object.isOrthographicCamera?(m.object.zoom=Math.max(m.minZoom,Math.min(m.maxZoom,m.object.zoom/e)),m.object.updateProjectionMatrix(),E=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),m.enableZoom=!1)}function q(e){S.set(e.clientX,e.clientY)}function W(e){k.set(e.clientX,e.clientY)}function Y(e){var t;1==e.touches.length?S.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),e=.5*(e.touches[0].pageY+e.touches[1].pageY),S.set(t,e))}function Z(e){var t;1==e.touches.length?k.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),e=.5*(e.touches[0].pageY+e.touches[1].pageY),k.set(t,e))}function J(e){var t=e.touches[0].pageX-e.touches[1].pageX,e=e.touches[0].pageY-e.touches[1].pageY,e=Math.sqrt(t*t+e*e);M.set(0,e)}function K(e){var t;1==e.touches.length?A.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY),A.set(t,o)),O.subVectors(A,S).multiplyScalar(m.rotateSpeed);var o=m.domElement;N(2*Math.PI*O.x/o.clientHeight),R(2*Math.PI*O.y/o.clientHeight),S.copy(A)}function Q(e){var t;1==e.touches.length?P.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),e=.5*(e.touches[0].pageY+e.touches[1].pageY),P.set(t,e)),z.subVectors(P,k).multiplyScalar(m.panSpeed),G(z.x,z.y),k.copy(P)}function $(e){var t=e.touches[0].pageX-e.touches[1].pageX,e=e.touches[0].pageY-e.touches[1].pageY,e=Math.sqrt(t*t+e*e);L.set(0,e),F.set(0,Math.pow(L.y/M.y,m.zoomSpeed)),U(F.y),M.copy(L)}function ee(e){if(!1!==m.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){var t;switch(e.preventDefault(),(m.domElement.focus?m.domElement:window).focus(),e.button){case 0:t=m.mouseButtons.LEFT;break;case 1:t=m.mouseButtons.MIDDLE;break;case 2:t=m.mouseButtons.RIGHT;break;default:t=-1}switch(t){case o.DOLLY:if(!1===m.enableZoom)return;!void M.set(e.clientX,e.clientY),b=v.DOLLY;break;case o.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===m.enablePan)return;W(e),b=v.PAN}else{if(!1===m.enableRotate)return;q(e),b=v.ROTATE}break;case o.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===m.enableRotate)return;q(e),b=v.ROTATE}else{if(!1===m.enablePan)return;W(e),b=v.PAN}break;default:b=v.NONE}b!==v.NONE&&(m.domElement.ownerDocument.addEventListener("pointermove",te),m.domElement.ownerDocument.addEventListener("pointerup",oe),m.dispatchEvent(g))}(e)}}function te(e){if(!1!==m.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1!==m.enabled)switch(e.preventDefault(),b){case v.ROTATE:if(!1===m.enableRotate)return;!function(e){A.set(e.clientX,e.clientY),O.subVectors(A,S).multiplyScalar(m.rotateSpeed),e=m.domElement,N(2*Math.PI*O.x/e.clientHeight),R(2*Math.PI*O.y/e.clientHeight),S.copy(A),m.update()}(e);break;case v.DOLLY:if(!1===m.enableZoom)return;L.set(e.clientX,e.clientY),F.subVectors(L,M),0<F.y?U(D()):F.y<0&&X(D()),M.copy(L),!void m.update();break;case v.PAN:if(!1===m.enablePan)return;P.set(e.clientX,e.clientY),z.subVectors(P,k).multiplyScalar(m.panSpeed),G(z.x,z.y),k.copy(P),!void m.update()}}(e)}}function oe(e){switch(e.pointerType){case"mouse":case"pen":m.domElement.ownerDocument.removeEventListener("pointermove",te),m.domElement.ownerDocument.removeEventListener("pointerup",oe),!void(!1!==m.enabled&&(m.dispatchEvent(y),b=v.NONE))}}function ne(e){!1===m.enabled||!1===m.enableZoom||b!==v.NONE&&b!==v.ROTATE||(e.preventDefault(),e.stopPropagation(),m.dispatchEvent(g),(e=e).deltaY<0?X(D()):0<e.deltaY&&U(D()),m.update(),m.dispatchEvent(y))}function ie(e){!1!==m.enabled&&!1!==m.enablePan&&function(e){var t=!1;switch(e.keyCode){case m.keys.UP:G(0,m.keyPanSpeed),t=!0;break;case m.keys.BOTTOM:G(0,-m.keyPanSpeed),t=!0;break;case m.keys.LEFT:G(m.keyPanSpeed,0),t=!0;break;case m.keys.RIGHT:G(-m.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),m.update())}(e)}function re(e){if(!1!==m.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(m.touches.ONE){case d.ROTATE:if(!1===m.enableRotate)return;Y(e),b=v.TOUCH_ROTATE;break;case d.PAN:if(!1===m.enablePan)return;Z(e),b=v.TOUCH_PAN;break;default:b=v.NONE}break;case 2:switch(m.touches.TWO){case d.DOLLY_PAN:if(!1===m.enableZoom&&!1===m.enablePan)return;t=e,m.enableZoom&&J(t),m.enablePan&&Z(t),b=v.TOUCH_DOLLY_PAN;break;case d.DOLLY_ROTATE:if(!1===m.enableZoom&&!1===m.enableRotate)return;t=e,m.enableZoom&&J(t),m.enableRotate&&Y(t),b=v.TOUCH_DOLLY_ROTATE;break;default:b=v.NONE}break;default:b=v.NONE}var t;b!==v.NONE&&m.dispatchEvent(g)}}function ae(e){var t;if(!1!==m.enabled)switch(e.preventDefault(),e.stopPropagation(),b){case v.TOUCH_ROTATE:if(!1===m.enableRotate)return;K(e),m.update();break;case v.TOUCH_PAN:if(!1===m.enablePan)return;Q(e),m.update();break;case v.TOUCH_DOLLY_PAN:if(!1===m.enableZoom&&!1===m.enablePan)return;t=e,m.enableZoom&&$(t),m.enablePan&&Q(t),m.update();break;case v.TOUCH_DOLLY_ROTATE:if(!1===m.enableZoom&&!1===m.enableRotate)return;t=e,m.enableZoom&&$(t),m.enableRotate&&K(t),m.update();break;default:b=v.NONE}}function se(e){!1!==m.enabled&&(m.dispatchEvent(y),b=v.NONE)}function le(e){!1!==m.enabled&&e.preventDefault()}m.domElement.addEventListener("contextmenu",le),m.domElement.addEventListener("pointerdown",ee),m.domElement.addEventListener("wheel",ne),m.domElement.addEventListener("touchstart",re),m.domElement.addEventListener("touchend",se),m.domElement.addEventListener("touchmove",ae),this.update()}function co(e,t){lo.call(this,e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=MOUSE.PAN,this.mouseButtons.RIGHT=MOUSE.ROTATE,this.touches.ONE=TOUCH.PAN,this.touches.TWO=TOUCH.DOLLY_ROTATE}var uo=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",po=0,fo=new function e(){le(this,e);var o=this;function h(e,t,o){for(var n in e=document.createElementNS("http://www.w3.org/2000/svg",e),t)e.setAttribute(n,t[n]);for(var i=0,r=(o="[object Array]"!=Object.prototype.toString.call(o)?[o]:o)[0]&&o.length||0;i<r;i++)e.appendChild(o[i]);return e}this.paletteIndexes={BGRW:0,monochrome:1,bidirectional:2,rainbow:3},this.create=function(e,i){function r(){return"horizontal"===i.orientation}if((i=i||{}).orientation=i.orientation||"horizontal",void 0===i.direction&&(i.direction=!0),i.style=i.style||{},i.style.width=i.style.width||(r()?200:30),i.style.height=i.style.height||(r()?30:200),i.onError=i.onError||function(){},e instanceof HTMLElement!=!0){if("string"!=typeof e)return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e);if(null===(e=document.getElementById(e)))return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e)}for(var t in e.classList.add("slider-wrapper"),i.style)e.style[t]=i.style[t];var n,o,a,s,l,c=i.palette instanceof this.palette?i.palette:new this.palette(i);function u(){return"string"==typeof i.style.height?parseInt(i.style.height):i.style.height}function d(){return f.clientWidth}function p(e,t){var o;void 0!==n?void 0!==(o=c.hsv2rgb(e))?(e=o.percent,void 0===t&&(t=r()?d()*e/100:u()-u()*(i.direction?e:100-e)/100),t=t,void 0!==n&&(r()?t<0||t>d()?console.error("ColorPicker.positionIndicators: Invalid position = "+t):(n.style.top="0px",n.style.left=(i.direction?t:d()-t)-n.offsetWidth/2+"px"):t<0||t>u()?console.error("ColorPicker.positionIndicators: Invalid position = "+t):(n.style.left="0px",n.style.top=t-n.offsetHeight/2+"px")),void 0!==i.sliderIndicator.callback&&i.sliderIndicator.callback(o)):console.error("ColorPicker.setValue: invalud c = "+o):console.error("Set value of this instance of the ColorPicker is impossible because options.sliderIndicator is not defined.")}if(void 0!==i.sliderIndicator&&((n=document.createElement("div")).className="slider-indicator",r()?n.style.width="10px":n.style.height="10px",e.appendChild(n),n.style.pointerEvents="none"),"SVG"==uo){try{var f=h("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:r()?"100%":i.style.width,height:i.style.height},[h("defs",{},h("linearGradient",{id:"gradient-hsv-"+po,x1:r()&&i.direction?"100%":"0%",y1:r()||i.direction?"0%":"100%",x2:r()&&!i.direction?"100%":"0%",y2:!r()&&i.direction?"100%":"0%"},c.getPalette())),h("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv-"+po+")"})]);void 0!==n&&(f.style.cursor=r()?"e-resize":"s-resize",n.style.cursor=f.style.cursor)}catch(e){console.error("Create SVG element failed! "+e.message)}e.appendChild(f),e.style.height=u()+"px",void 0!==n&&(r()?n.style.height=parseInt(i.style.height)-2+"px":n.style.width=parseInt(i.style.width)-2+"px",i.sliderIndicator.value=i.sliderIndicator.value||0,p(i.sliderIndicator.value)),po++}else console.error("Under constraction");function m(e){var t,o,n;e.x=parseInt(e.x),e.y=parseInt(e.y),r()?(t=e.x,o=d()-1,n=100*(t=t>=d()?o:t)/o,i.direction||(n=100-n,t=o-t)):(t=e.y,o=u()-1,n=100*(1-(t=t>=u()?o:t)/o),i.direction||(n=100-n)),p(n,t)}return void 0!==n&&(o=function(){return function(e){l||m(function(e){if(window.event&&void 0!==window.event.contentOverflow)return{x:window.event.offsetX,y:window.event.offsetY};if(void 0!==e.offsetX&&void 0!==e.offsetY)return{x:e.offsetX,y:e.offsetY};var t=e.target.parentNode.parentNode;return{x:e.layerX-t.offsetLeft,y:e.layerY-t.offsetTop}}(e=e||window.event))}},l=!(s=function(e,i){var t=f;a(t,"touchstart",function(e){}),a(t,"touchmove",function(e){e.preventDefault();var t=e.srcElement.getBoundingClientRect(),o=e.touches[0].clientX-t.left,t=e.touches[0].clientY-t.top;m({x:o=o<0?0:o,y:t=t<0?0:t})}),a(t,"touchend",function(e){}),a(t,"mousedown",function(e){var o="mouseup",n="mousemove";a(window,o,function e(){function t(e,t,o){null!==e&&(e.detachEvent?e.detachEvent("on"+t,o):e.removeEventListener&&e.removeEventListener(t,o,!1))}t(window,o,e),t(window,n,i)}),a(window,n,i)}),a(t,"mouseout",function(e){l=!0}),a(t,"mouseover",function(e){l=!1})}),(a=function(e,t,o){null!==e&&(e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener&&e.addEventListener(t,o,!1))})(f,"click",o()),s(0,o())),{setValue:p}},this.palette=function(p){function e(e,t,o,n){return{percent:e,r:t,g:o,b:n}}void 0===(p=p||{}).palette&&(p.palette=o.paletteIndexes.BGRW),this.getPaletteIndex=function(){return p.palette};var f=[new e(0,0,0,255),new e(33,0,255,0),new e(66,255,255,0),new e(100,255,255,255)];switch(se(p.palette)){case"number":switch(p.palette){case o.paletteIndexes.BGRW:break;case o.paletteIndexes.monochrome:f=[new e(0,0,0,0),new e(100,255,255,255)];break;case o.paletteIndexes.bidirectional:f=[new e(0,255,48,48),new e(50,48,48,48),new e(100,48,255,48)];break;case o.paletteIndexes.rainbow:f=[new e(0,255,50,50),new e(16,252,245,40),new e(32,40,252,40),new e(50,40,252,248),new e(66,39,46,249),new e(82,255,40,251),new e(100,255,50,50)];break;default:console.error("ColorPicker.create.Palette: invalid options.palette = "+p.palette)}break;case"object":if(Array.isArray(p.palette)){f=p.palette;break}default:var t="invalid options.palette = "+p.palette;console.error("ColorPicker.create.Palette: "+t),p.onError(t)}this.getPalette=function(){var t=[];return f.forEach(function(e){t.unshift(h("stop",{offset:100-e.percent+"%","stop-color":"#"+("0"+Number(e.r).toString(16)).slice(-2).toUpperCase()+("0"+Number(e.g).toString(16)).slice(-2).toUpperCase()+("0"+Number(e.b).toString(16)).slice(-2).toUpperCase(),"stop-opacity":"1"}))}),t},this.hsv2rgb=function(e,t,o){var i=parseFloat(e);void 0!==t&&void 0!==o&&(i=100/(o-t)*(i-t));var n,r,a=f[f.length-1];100!==a.percent&&(n={},Object.keys(a).forEach(function(e){n[e]=a[e]}),n.percent=100,f.push(n));for(var s=0;s<f.length;s++){var l=f[s];if(i>=(r=void 0===r?l:r).percent&&i<=l.percent){var c=function(e,t,o,n){o-=e;return 0==o?t:Math.round(t+(n-t)/o*(i-e))},u=c(r.percent,r.r,l.percent,l.r),d=c(r.percent,r.g,l.percent,l.g),c=c(r.percent,r.b,l.percent,l.b);return{r:u,g:d,b:c,hex:"#"+(16777216|c|d<<8|u<<16).toString(16).slice(1),percent:i}}r=l}void 0!==p.onError&&p.onError("Invalid color value of the ColorPicker: "+e)},this.toColor=function(e,t,o){var n=Me.THREE;if(e instanceof n.Color)return e;o=this.hsv2rgb(e,t,o);return void 0===o&&(o={r:255,g:255,b:255}),new n.Color("rgb("+o.r+", "+o.g+", "+o.b+")")}}};
/**
 * @module cookie
 * @description node.js version of the cookie.
 * Cookies let you store user information in web pages.
 * @see {@link https://www.w3schools.com/js/js_cookies.asp}
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
function mo(){return navigator.cookieEnabled}function ho(e,t,o){mo()?(t=t.toString(),void 0===o&&(o=new Date).setTime(o.getTime()+31536e6),document.cookie=e+"="+t+("undefined"==typeof settings?"":settings)+"; expires="+o.toGMTString(),""===document.cookie&&console.error("document.cookie is empty")):vo()}function go(e,t){if(mo()){e=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return e?unescape(e[2]):void 0===t?"":t}vo()}function yo(e,t){return JSON.parse(go(e,JSON.stringify(t)))}function vo(){console.error("navigator.cookieEnabled = "+navigator.cookieEnabled)}function bo(e){this.get=function(e){return e},this.set=function(){},this.getObject=function(e,o,n){n&&Object.keys(n).forEach(function(e){var t=n[e];void 0!==t&&"function"!=typeof t&&(o[e]=JSON.parse(JSON.stringify(t)))})},this.copyObject=function(e,t){return JSON.parse(JSON.stringify(t))},this.setObject=function(){},this.isTrue=function(e){return e}}
/**
* node.js version of the cookie.
*
* @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
*
* @copyright 2011 Data Arts Team, Google Creative Lab
*
* @license under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*/var _o={set:ho,setObject:function(e,t){ho(e,JSON.stringify(t))},get:go,getObject:function(e,t,o){(new bo).getObject(e,t,yo(e,o))},copyObject:yo,defaultCookie:bo};
/**
 * @module Localization.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function xo(){return(navigator?void 0!==navigator.languages&&"unknown"!=typeof navigator.languages&&0<navigator.languages.length?navigator.languages[0]:navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage||(console.error("getLocale() failed!"),""):(console.error("getLocale() failed! !navigator"),"")).toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/)[1]}
/**
 * @module CreateFullScreenSettings
 * @description creates functions for resize of the canvas to fullscreen and restore to default size.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function wo(o,n,i,r){var a,t,s,l=!1;r.fullScreen=r.fullScreen||{},r.canvasMenu&&(a=r.canvasMenu),r.stereoEffect&&(t=r.stereoEffect),n.setSize(n.domElement.width,n.domElement.height),this.isFullScreen=function(){return l},this.setStereoEffect=function(e){t=e},this.setFullScreen=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=new o.Vector2;n.getSize(t),(l=e)?void 0!==s&&(n.setSize(s.sizeOriginal.x,s.sizeOriginal.y),n.domElement.style.position=s.position,n.domElement.style.left=s.left,n.domElement.style.top=s.top,n.domElement.style.width=s.width,n.domElement.style.height=s.height):(void 0===s&&(s={sizeOriginal:new o.Vector2,position:n.domElement.style.position,left:n.domElement.style.left,top:n.domElement.style.top,width:n.domElement.style.width,height:n.domElement.style.height},n.getSize(s.sizeOriginal)),n.setSize(window.innerWidth,window.innerHeight),n.domElement.style.position="fixed",n.domElement.style.left=0,n.domElement.style.top=0,n.domElement.style.width="100%",n.domElement.style.height="100%"),void 0!==r.fullScreen.onFullScreenToggle&&r.fullScreen.onFullScreenToggle(l),i.aspect=t.x/t.y,i.updateProjectionMatrix(),l=!l,a&&a.setFullScreenButton&&a.setFullScreenButton(l),wo.RendererSetSize(n,r.canvasMenu)},this.onclick=function(){return void 0!==t&&parseInt(t.settings.spatialMultiplex)!==Eo.spatialMultiplexsIndexs.Mono&&(t.settings.spatialMultiplex=Eo.spatialMultiplexsIndexs.Mono),this.setFullScreen(l),l}}
/**
 * @module SpriteText
 * @description A sprite based text component. Text that always faces towards the camera.
 * @see {@link https://threejs.org/docs/index.html#api/en/objects/Sprite|THREE.Sprite}
 *
 * @author Andrej Hristoliubov. {@link https://anhr.github.io/AboutMe/|AboutMe}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/
function Co(C,T){var E=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e=Me.THREE;T=T||new e.Vector3(0,0,0);var S=new e.Sprite(new e.SpriteMaterial({map:new e.Texture,sizeAttenuation:void 0!==E.sizeAttenuation&&E.sizeAttenuation})),A=document.createElement("canvas");S.material.map.minFilter=e.LinearFilter;var O=A.getContext("2d");return E.name&&(S.name=E.name),S.userData.update=function(){var e={};S.parent?To(S.parent,e):E.group&&To(E.group,e);var t=E.textHeight||e.textHeight||.04,o=E.fov||e.fov,n=E.sizeAttenuation||e.sizeAttenuation||!1,i=E.rotation||e.rotation||0,r=E.fontFace||e.fontFace||"Arial",a=E.bold||e.bold||!1,s=E.italic||e.italic||!1,l=E.fontProperties||e.fontProperties||"",c=E.rect||e.rect||{},u=E.fontColor||e.fontColor||"rgba(255, 255, 255, 1)",e=Co.getCenter(E.center||e.center,T);void 0!==o&&(t=o*t/50),c.displayRect=c.displayRect||!1;var d=c.borderThickness||5,r=l+(a?"bold ":"")+(s?"italic ":"")+"90px "+r;O.font=r;var p,f,m,h,g,y,v,b=0,_=1;if("string"==typeof C?(_=0,(p=C.split(/\r\n|\r|\n/)).forEach(function(e){e=O.measureText(e).width;b<e&&(b=e),_+=1})):b=O.measureText(C).width,b+=2*d,A.width=b,A.height=90*_+2*d,O.font=r,c.displayRect&&(O.fillStyle=c.backgroundColor||"rgba(0, 0, 0, 1)",O.strokeStyle=c.borderColor||u,O.lineWidth=d,f=O,h=m=d/2,g=A.width-d,y=A.height-d,v=void 0===c.borderRadius?0:c.borderRadius,f.beginPath(),f.moveTo(m+v,h),f.lineTo(m+g-v,h),f.quadraticCurveTo(m+g,h,m+g,h+v),f.lineTo(m+g,h+y-v),f.quadraticCurveTo(m+g,h+y,m+g-v,h+y),f.lineTo(m+v,h+y),f.quadraticCurveTo(m,h+y,m,h+y-v),f.lineTo(m,h+v),f.quadraticCurveTo(m,h,m+v,h),f.closePath(),f.fill(),f.stroke()),O.fillStyle=u,O.textBaseline="bottom",1<_)for(var x=0;x<p.length;x++){var w=p[x];O.fillText(w,d,A.height-90*(p.length-x-1)-d)}else O.fillText(C,d,A.height-d);S.material.map.image=A,S.material.map.needsUpdate=!0;t*=_;S.scale.set(t*A.width/A.height,t),S.position.copy(T),S.center=e,S.material.sizeAttenuation=n,S.material.rotation=i,S.material.needsUpdate=!0},S.userData.update(),S.userData.updateText=function(e){C=e;e={};To(S.parent,e),S.userData.update(e)},E.group&&E.group.add(S),S.userData.optionsSpriteText=E,S}function To(t,o){for(t.userData.optionsSpriteText&&Object.keys(t.userData.optionsSpriteText).forEach(function(e){void 0===o[e]&&(o[e]=t.userData.optionsSpriteText[e])});t.parent;)To(t=t.parent,o)}wo.RendererSetSize=function(r,a){r.setSizeOld||(r.setSizeOld=r.setSize,r.setSize=function(e,t,o){r.setSizeOld(e,t,o);var n=r.domElement,i=n.parentElement;setTimeout(function(){i.style.height=n.style.height,i.style.width=n.style.width,i.style.left=n.style.left,i.style.top=n.style.top,i.style.position=n.style.position,a&&a.setSize(e,t)},0)})},Co.getCenter=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],o=Me.THREE,n=e.canvas||void 0;var i,r,a,s=e.canvas?(i=n.width/2,r=n.height/2,(a=(new o.Vector3).copy(t)).project(e.camera),a.x=a.x*i+i,a.y=-a.y*r+r,a):void 0;return e instanceof o.Vector2||"object"===(void 0===e?"undefined":se(e))&&void 0!==e.x&&void 0!==e.y?e:s?new o.Vector2(s.x<n.width/2?0:1,s.y<n.height/2?1:0):new o.Vector2(0,1)},Co.updateSpriteTextGroup=function(e){var t=Me.THREE;e.children.forEach(function(e){e instanceof t.Sprite&&void 0!==e.userData.update&&e.userData.update(),Co.updateSpriteTextGroup(e)})};
/**
 * @module StereoEffect
 * @description Uses dual PerspectiveCameras for Parallax Barrier effects.
 * @see About {@link https://en.wikipedia.org/wiki/Parallax_barrier|Parallax barrier}.
 *
 * @author {@link https://anhr.github.io/AboutMe/|Andrej Hristoliubov}
 * @author {@link http://alteredqualia.com/|alteredq}
 * @author {@link http://mrdoob.com/|mrdoob}
 * @author {@link http://aleksandarrodic.com/|arodic}
 * @author {@link http://fonserbc.github.io/|fonserbc}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/
var Eo=function e(g){var y,v,b,_,x,w,C=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new ko;function T(t){t=t||{};var o={stereoEffects:"Stereo effects",spatialMultiplexName:"Spatial  multiplex",spatialMultiplexTitle:"Choose a way to do spatial multiplex.",spatialMultiplexs:{Mono:So.Mono,"Side by side":So.SbS,"Top and bottom":So.TaB},eyeSeparationName:"Eye separation",eyeSeparationTitle:"The distance between left and right cameras.",focus:"Focus",focusTitle:"Object distance.",zeroParallaxName:"Zero parallax",zeroParallaxTitle:"Distance to objects with zero parallax.",defaultButton:"Default",defaultTitle:"Restore default stereo effects settings."},e=void 0===t.getLanguageCode?"en":t.getLanguageCode();switch(e){case"ru":o.stereoEffects=" ",o.spatialMultiplexName="",o.spatialMultiplexTitle="    .",o.spatialMultiplexs={"":So.Mono," ":So.SbS," ":So.TaB},o.eyeSeparationName=" ",o.eyeSeparationTitle="     .",o.focus="",o.focusTitle="  .",o.zeroParallaxName=" 0",o.zeroParallaxTitle="     .",o.defaultButton="",o.defaultTitle="     .";break;default:if(void 0===t.lang||t.lang._languageCode!=e)break;Object.keys(t.lang).forEach(function(e){void 0!==o[e]&&(o[e]=t.lang[e])})}return o}le(this,e),g?!1!==(C=!C.boOptions?new ko(C):C).stereoEffect&&(C.dat.gui&&(C.dat.mouseenter=!1),y=Me.THREE,Ao(),C.stereoEffect=C.stereoEffect||{},v=C.stereoEffect,this.settings=v,(this.options=C).stereoEffect=this,void 0===v.spatialMultiplex&&(v.spatialMultiplex=So.Mono),v.stereo=new y.StereoCamera,v.stereo.aspect=v.stereoAspect||1,void 0===v.far&&(v.far=(new y.PerspectiveCamera).focus),v.focus=void 0===v.camera?(new y.PerspectiveCamera).focus:(new y.Vector3).distanceTo(v.camera.position),v.zeroParallax=0,v.eyeSep=v.eyeSep||(new y.StereoCamera).eyeSep/10*v.far,void 0!==v.camera&&(v.camera.focus=v.focus),this.setEyeSeparation=function(e){v.stereo.eyeSep=e},this.setEyeSeparation(v.eyeSep),this.getRendererSize=function(){return ko.EventListeners.getRendererSize(g,v.elParent)},this.render=function(e,t){var o=parseInt(v.spatialMultiplex);v.rememberSize&&!b&&(b=x&&x.getFullScreenSettings?x.getFullScreenSettings(this):new wo(y,g,t,{canvasMenu:x,stereoEffect:this})),e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld();var n=new y.Vector2;g.getSize(n),g.autoClear&&g.clear(),g.setScissorTest(!0);var i=v.zeroParallax;function r(e){return b&&_!==o&&(_=o,e.setControllerSpatialMultiplex?e.setControllerSpatialMultiplex(o):e.setSpatialMultiplex&&e.setSpatialMultiplex(o),1)}function a(e,t){r(t)&&b.setFullScreen(e)}switch(o){case So.Mono:return g.setScissor(0,0,n.width,n.height),g.setViewport(0,0,n.width,n.height),g.render(e,t),g.setScissorTest(!1),void r(this);case So.SbS:var s=n.width/2,l=0+i,c=0,u=s,d=n.height,p=s-i,f=0,m=s,h=n.height;a(!1,this);break;case So.TaB:l=0+i,c=0,u=n.width,d=n.height/2,p=0-i,f=n.height/2,m=n.width,h=n.height/2,a(!1,this);break;default:console.error('THREE.StereoEffect.render: Invalid "Spatial  multiplex" parameter: '+o)}v.stereo.update(t),g.setScissor(l,c,u,d),g.setViewport(l,c,u,d),g.render(e,v.stereo.cameraL),g.setScissor(p,f,m,h),g.setViewport(p,f,m,h),g.render(e,v.stereo.cameraR),g.setScissorTest(!1)},this.gui=function(){var e,t,o,n,i,r,a,s,l,c,u,d,p=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},f=p.folder||C.dat.gui;function m(e){e=e==So.Mono?"none":"block";a.domElement.style.display=e,void 0!==l&&(l.__li.style.display=e),u.__li.style.display=e,c.__li.style.display=e}function h(e){var t;d&&(t={},Object.keys(n).forEach(function(e){t[e]=v[e]}),C.dat.cookie.setObject(e,t))}f&&!1!==C.dat.stereoEffectsGui&&(e=p.dat||Me.dat,(p=void 0===p?{}:p).scale=p.scale||1,t=C.dat.getCookieName("StereoEffect"),o=T({getLanguageCode:C.getLanguageCode,lang:C.lang}),n={spatialMultiplex:v.spatialMultiplex,eyeSep:(new y.StereoCamera).eyeSep/10*v.far,focus:v.focus,zeroParallax:0},Object.freeze(n),C.dat.cookie.getObject(t,v,n),v.spatialMultiplex=parseInt(v.spatialMultiplex),this.setSpatialMultiplex&&this.setSpatialMultiplex(v.spatialMultiplex),i=f.addFolder(o.stereoEffects),r=i.add(v,"spatialMultiplex",o.spatialMultiplexs).onChange(function(e){m(e=parseInt(e)),h(t),p.onChangeMode&&p.onChangeMode(e),w&&w.select(e)}),e.controllerNameAndTitle(r,o.spatialMultiplexName,o.spatialMultiplexTitle),this.setControllerSpatialMultiplex=function(e){d=!1,r.setValue(e),d=!0},a=i.addFolder(o.eyeSeparationName),e.folderNameAndTitle(a,o.eyeSeparationName,o.eyeSeparationTitle),a.add(new De(function(e){v.eyeSep+=e,s.setValue(v.eyeSep)},{settings:{offset:.01},min:1e-4,max:.01,step:1e-4})),s=e.controllerZeroStep(a,v.stereo,"eyeSep",function(e){v.eyeSep=e,h(t)}),e.controllerNameAndTitle(s,o.eyeSeparationName,o.eyeSeparationTitle),void 0!==v.camera&&(v.camera.focus=v.focus),v.camera&&(l=i.add(v.camera,"focus",n.focus/10,2*n.focus,n.focus/1e3).onChange(function(e){v.focus=e,h(t)}),e.controllerNameAndTitle(l,o.focus,o.focusTitle)),f=(60-400/9)*p.scale+400/9,c=i.add(v,"zeroParallax",-f,f).onChange(function(e){v.zeroParallax=e,h(t)}),e.controllerNameAndTitle(c,o.zeroParallaxName,o.zeroParallaxTitle),u=i.add({defaultF:function(e){v.stereo.eyeSep=n.eyeSep,s.setValue(v.stereo.eyeSep),v.camera&&(v.camera.focus=n.focus,l.setValue(v.camera.focus)),v.zeroParallax=n.zeroParallax,c.setValue(v.zeroParallax)}},"defaultF"),e.controllerNameAndTitle(u,o.defaultButton,o.defaultTitle),m(v.spatialMultiplex),d=!0)},this.createCanvasMenuItem=function(e,t){x=e;var o=T({getLanguageCode:(t=t||{}).getLanguageCode,lang:t.lang}),t=Object.keys(o.spatialMultiplexs);w={name:"",title:o.stereoEffects,id:"menuButtonStereoEffects",drop:"up",items:[{name:t[So.Mono],id:"menuButtonStereoEffectsMono",radio:!0,checked:v.spatialMultiplex===So.Mono,spatialMultiplex:So.Mono,onclick:function(e){v.spatialMultiplex=So.Mono}},{name:t[So.SbS],id:"menuButtonStereoEffectsSbS",radio:!0,checked:v.spatialMultiplex===So.SbS,spatialMultiplex:So.SbS,onclick:function(e){v.spatialMultiplex=So.SbS}},{name:t[So.TaB],id:"menuButtonStereoEffectsTaB",radio:!0,checked:v.spatialMultiplex===So.TaB,spatialMultiplex:So.TaB,onclick:function(e){v.spatialMultiplex=So.TaB}}],select:function(t){w.items.forEach(function(e){e.spatialMultiplex===t&&(e.checked||e.elName.onclick({target:e.elName}))})}},this.setSpatialMultiplex=function(e){w.select(e)},e.menu.push(w)}):console.error("StereoEffect: renderer = "+g)};Eo.spatialMultiplexsIndexs={Mono:0,SbS:1,TaB:2},Object.freeze(Eo.spatialMultiplexsIndexs);var So=Eo.spatialMultiplexsIndexs;function Ao(){var m=Me.THREE;(new m.Raycaster).setStereoEffect||Object.assign(m.Raycaster.prototype,{setStereoEffect:function(o){(o=o||{}).raycasterEvents=void 0===o.raycasterEvents||o.raycasterEvents;var t,n=o.camera,i=o.renderer;o.raycasterEvents&&(t=new m.Vector2,window.addEventListener("mousemove",function(e){t.x=e.clientX/window.innerWidth*2-1,t.y=2*-(e.clientY/window.innerHeight)+1,c.setFromCamera(t,n),c.stereo.onDocumentMouseMove(e)},!1),window.addEventListener("pointerdown",function(e){c.stereo.onDocumentMouseDown(e)},!1));var r,a,s,l=void 0!==o.stereoEffect?o.stereoEffect:"undefined"!=typeof effect?effect:new Eo(i,{stereoEffect:{spatialMultiplex:So.Mono,far:n?n.far:void 0,camera:n,stereoAspect:1}}),c=this,u=new m.Vector2,d=new m.Vector2;var p=void 0;function f(e){if(void 0!==s){if(e=e||o,parseInt(l.settings.spatialMultiplex)!==So.Mono){e=s;return s=u,c.setFromCamera(u,n),t()||(s=d,c.setFromCamera(d,n),t()),void(s=e)}c.setFromCamera(s,n),t()}function t(){var e;return 0<(a=void 0!==r?Array.isArray(r)?c.intersectObjects(r):c.intersectObject(r):a).length?(e=a[0])&&e.object.userData.raycaster&&e.object.userData.raycaster.onIntersection&&(e.object.userData.raycaster.onIntersection(e,s),p=e.object):p&&(p.userData.raycaster.onIntersectionOut(),p=void 0),0<a.length}}this.stereo={onDocumentMouseMove:function(e){void 0!==r&&(e.preventDefault(),void 0===s&&(s=new m.Vector2),function(){function e(e,t){u.copy(s),d.copy(s);u[e]+=.5,u[e]*=2,d[e]-=.5,d[e]*=2;e=new m.Vector2;i.getSize(e);t=l.settings.zeroParallax/e.x*t;u.x-=t,d.x+=t}switch(l.getRendererSize().getMousePosition(s,event),parseInt(l.settings.spatialMultiplex)){case So.Mono:return;case So.SbS:e("x",4);break;case So.TaB:e("y",2);break;default:console.error("THREE.Raycaster.setStereoEffect.getMousePosition: Invalid effect.settings.spatialMultiplex = "+effect.settings.spatialMultiplex)}}(),f())},onDocumentMouseDown:function(e){var t;l.options.dat.mouseenter||a&&0<a.length&&(!a[0].object.userData.raycaster||(t=a[0]).object.userData.raycaster.onMouseDown&&t.object.userData.raycaster.onMouseDown(t))},isAddedToParticles:function(e){return!!r&&r.includes(e)},addParticle:function(e){void 0===r&&(r=[]),this.isAddedToParticles(e)?console.error('Duplicate particle "'+e.name+'"'):r.push(e)},addParticles:function(e){var t;if(void 0!==r)return Array.isArray(r)||(t=r,(r=[]).push(t)),void r.push(e);r=e},removeParticle:function(e){for(var t=0;t<r.length;t++)if(Object.is(e,r[t])){r.splice(t,1);break}},removeParticles:function(){r=void 0},getPosition:function(e){var t=e.object.geometry.attributes.position,o=4<=t.itemSize?new m.Vector4(0,0,0,0):new m.Vector3;return void 0!==e.index?(o.fromArray(t.array,e.index*t.itemSize),o.multiply(e.object.scale),o.add(e.object.position)):o=e.object.position,o}}}})}Eo.assign=Ao;var Oo={mesh:"Mesh",pointName:"Point Name",color:"olor",opacity:"Opacity"};"ru"===xo()&&(Oo.mesh="3D ",Oo.pointName=" ",Oo.color="",Oo.opacity=""),
/**
 * options of the canvas
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
!(Eo.getTextIntersection=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=ko.findSpriteTextIntersection(t.spriteOptions.group);if(o)return o;var n=Me.THREE,i=to(e.object,e.index),r=t.scales||{},a=void 0!==e.index&&void 0!==e.object.userData.player&&void 0!==e.object.userData.player.arrayFuncs,s=a?e.object.userData.player.arrayFuncs:void 0,l=void 0===s||"function"==typeof s?void 0:s[e.index],c=a&&l?l.name:void 0,o=a&&void 0!==l?Array.isArray(l.w)?Player.execFunc(l,"w",group.userData.t,t):l.w:void 0,l=!r.x&&!r.y&&!r.z;return t.spriteOptions.name=ko.findSpriteTextIntersection.spriteTextIntersectionName,new Co((""===e.object.name?"":Oo.mesh+": "+e.object.name)+(void 0===c?"":"\n"+Oo.pointName+": "+c)+(l||r.x?"\n"+(r.x&&r.x.name?r.x.name:"X")+": "+i.x:"")+(l||r.y?"\n"+(r.y&&r.y.name?r.y.name:"Y")+": "+i.y:"")+(l||r.z?"\n"+(r.z&&r.z.name?r.z.name:"Z")+": "+i.z:"")+(a&&(s[e.index]instanceof n.Vector4||s[e.index]instanceof n.Vector3||"function"==typeof s)?o instanceof n.Color?"\n"+Oo.color+": "+new n.Color(o.r,o.g,o.b).getHexString():void 0!==i.w?"\n"+(r.w&&r.w.name?r.w.name:"W")+": "+i.w:"":"")+(void 0===e.object.geometry.attributes.ca||e.object.geometry.attributes.ca.itemSize<4?"":"\n"+Oo.opacity+": "+(new n.Vector4).fromArray(e.object.geometry.attributes.ca.array,e.index*e.object.geometry.attributes.ca.itemSize).w),i,t.spriteOptions)})===te.isWebGLAvailable()&&(document.body.appendChild(te.getWebGLErrorMessage()),alert(te.getWebGLErrorMessage().innerHTML));var ko=function e(r){var t;le(this,e);var n=this;if((r=r||{}).boOptions)return r;void 0===r.a&&(r.a=1),void 0===r.b&&(r.b=0),this.setW=function(e){(e=e||r).scales=e.scales||{},e.scales.w=e.scales.w||{};var t=e.scales.w;t.name=t.name||"w",e.palette||this.setPalette(e),t.min=void 0===t.min?0:t.min,t.max=void 0===t.max?(new Me.THREE.Vector4).w:t.max},r.scales=r.scales||{};var o,i=!r.scales.x&&!r.scales.y&&!r.scales.z;function a(e){i&&(r.scales[e]=r.scales[e]||{}),r.scales[e]&&(r.scales[e].name=r.scales[e].name||e,r.scales[e].min=void 0===r.scales[e].min?-1:r.scales[e].min,r.scales[e].max=void 0===r.scales[e].max?1:r.scales[e].max)}for(o in a("x"),a("y"),a("z"),r.scales.setW=function(){n.setW()},r.point=r.point||{},r.point.size=r.point.size||5,r.point.sizePointsMaterial=r.point.sizePointsMaterial||100,this.setPalette=function(){r.palette||(r.palette=new fo.palette)},this.createOrbitControls=function(e,t,o){!1!==r.orbitControls&&((lo.prototype=Object.create(Me.THREE.EventDispatcher.prototype)).constructor=lo,(co.prototype=Object.create(Me.THREE.EventDispatcher.prototype)).constructor=co,n.orbitControls=new lo(e,t.domElement),n.orbitControls.target.set(2*o.position.x,2*o.position.y,2*o.position.z),n.orbitControls.saveState(),n.orbitControls.update())},this.restoreSceneController=function(t,o){var e,n,i;Me.dat&&(e={defaultButton:"Default",defaultTitle:"Reset player and restore camera position."},"ru"===this.getLanguageCode()&&(e.defaultButton="",e.defaultTitle="    ."),n=(new Me.THREE.Vector3).copy(o.position),i=(new Me.THREE.Vector3).copy(t.position),Me.dat.controllerNameAndTitle(r.dat.gui.add({defaultF:function(e){r.player&&r.player.setTime(r.playerOptions.min),t.position.copy(i),o.position.copy(n),!1!==r.orbitControls&&(r.orbitControls.target=new Me.THREE.Vector3,r.orbitControls.object.position.copy(t.position),r.orbitControls.update())}},"defaultF"),e.defaultButton,e.defaultTitle))},Object.defineProperties(this,(ce(t={playerOptions:{get:function(){r.playerOptions=r.playerOptions||{};var e,t=r.playerOptions;return t.min=t.min||0,t.max===1/0&&(t.max=null),null!==t.max?(void 0===t.max&&(t.max=1),t.marks=t.marks||10):t.marks=null,null===t.max?t.dt=t.dt||.1:t.dt=(t.max-t.min)/(t.marks-1),t.repeat=t.repeat||!1,t.interval=t.interval||1,t.zoomMultiplier=t.zoomMultiplier||1.1,t.offset=t.offset||.1,t.name=t.name||"",t.cameraTarget||(e=new zo.cameraTarget,Object.defineProperties(t,{cameraTarget:{get:function(){return e}}})),r.playerOptions},set:function(e){r.playerOptions=e}},a:{get:function(){return r.a}},b:{get:function(){return r.b}},dat:{get:function(){function o(t){if(le(this,o),(t=t||{}).boDat)return t;for(var e in Object.defineProperties(this,{boDat:{get:function(){return!0}},dat:{get:function(){return console.warn("get dat depreacated. Use three.dat = dat."),Me.dat},set:function(e){console.warn("Set dat depreacated. Use three.dat = dat."),e.dat&&e.dat.constructor.name===e.constructor.name&&"Object"!==e.dat.constructor.name&&console.error("duplicate dat."),e.dat=e}},cookieName:{get:function(){return t.cookieName}},gui:{get:function(){return!t.gui&&Me.dat&&(t.gui=new Me.dat.GUI),t.gui}},cookie:{get:function(){return t.cookie},set:function(e){t.cookie=e}},guiSelectPoint:{get:function(){return t.guiSelectPoint},set:function(e){t.guiSelectPoint=e}},cameraGui:{get:function(){return t.cameraGui},set:function(e){t.cameraGui=e}}}),t)void 0===this[e]&&console.error("Dat: dat."+e+" key is hidden")}var t,n;return r.dat=new o(r.dat),r.dat.gui&&(t=r.dat.gui.domElement.className,n=0,r.dat.gui.domElement.parentElement.childNodes.forEach(function(e){e.className===t&&n++}),1<n&&console.error("Options: duplicate dat.GUI"),r.dat.gui.domElement.addEventListener("mouseenter",function(e){r.dat.mouseenter=!0}),r.dat.gui.domElement.addEventListener("mouseleave",function(e){r.dat.mouseenter=!1})),!1===r.dat.cookie?r.dat.cookie=new _o.defaultCookie:void 0===r.dat.cookie&&(r.dat.cookie=_o),r.dat.getCookieName=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=r.dat.cookieName||(r.elContainer?"object"===se(r.elContainer)?r.elContainer.id:"string"==typeof r.elContainer?r.elContainer:"":"");return e+(""!==e&&""!==t?"_":"")+t},r.dat},set:function(e){r.dat=e}},getLanguageCode:{get:function(){return"string"==typeof r.getLanguageCode?function(){return r.getLanguageCode}:r.getLanguageCode||xo}},scales:{get:function(){return r.scales},set:function(e){r.scales=e}},palette:{get:function(){if(void 0!==r.palette)switch(se(r.palette)){case"number":r.palette=new fo.palette({palette:r.palette});break;case"boolean":r.palette&&(r.palette=new fo.palette);break;default:r.palette instanceof fo.palette==!1&&console.error("MyThree: invalid typeof options.palette: "+se(r.palette))}return r.palette}},boOptions:{get:function(){return!0}},point:{get:function(){return r.point}},spriteText:{get:function(){return r.spriteText||{}}},raycaster:{get:function(){if(r.raycaster)return r.raycaster},set:function(e){r.raycaster=e}},camera:{get:function(){return r.camera=r.camera||{},r.camera.position||(r.camera.position=new Me.THREE.Vector3(.4,.4,2)),r.camera.scale||(r.camera.scale=new Me.THREE.Vector3(1,1,1)),r.camera},set:function(e){r.camera=e}},cameraTarget:{get:function(){return r.cameraTarget}},elContainer:{get:function(){return r.elContainer}},canvasMenu:{get:function(){return r.canvasMenu},set:function(e){r.canvasMenu&&!0!==r.canvasMenu&&!1!==r.canvasMenu&&console.warn("Duplicate canvasMenu"),r.canvasMenu=e}},canvas:{get:function(){return r.canvas}},frustumPoints:{get:function(){return r.frustumPoints},set:function(e){r.frustumPoints&&r.frustumPoints.constructor.name===e.constructor.name&&"Object"!==r.frustumPoints.constructor.name&&console.error("duplicate frustumPoints."),r.frustumPoints=e}},stereoEffect:{get:function(){return r.stereoEffect},set:function(e){r.stereoEffect&&r.stereoEffect.constructor.name===e.constructor.name&&"Object"!==r.stereoEffect.constructor.name&&console.error("duplicate stereoEffect."),r.stereoEffect=e}},player:{get:function(){return r.player},set:function(e){r.player&&console.error("duplicate player."),r.player=e}},axesHelper:{get:function(){return r.axesHelper},set:function(e){r.axesHelper&&console.error("duplicate axesHelper."),r.axesHelper=e}}},"canvasMenu",{get:function(){return r.canvasMenu},set:function(e){r.canvasMenu&&console.error("duplicate canvasMenu."),r.canvasMenu=e}}),ce(t,"orbitControls",{get:function(){return r.orbitControls},set:function(e){r.orbitControls&&r.orbitControls.constructor.name===e.constructor.name&&"Object"!==r.orbitControls.constructor.name&&console.error("duplicate orbitControls."),r.orbitControls=e}}),ce(t,"scale",{get:function(){return 1}}),ce(t,"pointLight",{get:function(){return r.pointLight}}),ce(t,"cameraTarget",{get:function(){return r.cameraTarget}}),ce(t,"eventListeners",{get:function(){return r.eventListeners||{addParticle:function(){}}},set:function(e){r.eventListeners&&console.error("duplicate eventListeners."),r.eventListeners=e}}),t)),r)void 0===this[o]&&console.error("Options: options."+o+" key is hidden")};ko.findSpriteTextIntersection=function(e){var t;return e.children.forEach(function(e){"Sprite"===e.type&&e.name===ko.findSpriteTextIntersection.spriteTextIntersectionName&&(t=e)}),t},ko.findSpriteTextIntersection.spriteTextIntersectionName="spriteTextIntersection";w=function e(){var l;le(this,e),this.onIntersection=function(e,t,o,n,i,r){var a,s;void 0!==e.object.userData.isInfo&&!e.object.userData.isInfo()||(void 0===(a=ko.findSpriteTextIntersection(o))?((s=t.spriteText.rect?JSON.parse(JSON.stringify(t.spriteText.rect)):{}).displayRect=!0,s.backgroundColor="rgba(0, 0, 0, 1)",(a=Eo.getTextIntersection(e,{scales:t.scales,spriteOptions:{textHeight:t.spriteText.textHeight,fontColor:t.spriteText.fontColor,rect:s,group:o,center:{camera:n,canvas:i}}})).scale.divide(o.scale),o.add(a),void 0===l&&(l=r.domElement.style.cursor),r.domElement.style.cursor="pointer"):a.position.copy(e.point))},this.onIntersectionOut=function(e,t){var o=!1;do{var n=ko.findSpriteTextIntersection(e)}while(void 0!==n&&(e.remove(n),o&&console.error("Duplicate spriteTextIntersection"),o=!0),void 0!==n);t.domElement.style.cursor=l},this.onMouseDown=function(e,t){void 0!==e.object.userData.isInfo&&!e.object.userData.isInfo()||(t.guiSelectPoint?t.guiSelectPoint.select(e):t.axesHelper&&t.axesHelper.exposePosition(e))}};function Po(o,n,i,r){var a,s;le(this,Po);var l=new Me.THREE.Vector2,c=[];window.addEventListener("mousemove",function(e){var t;ko.EventListeners.getRendererSize(i).getMousePosition(l,e),o.setFromCamera(l,n),(a=o.intersectObjects(c))&&(0===a.length?s&&(s.userData.raycaster.onIntersectionOut(),s=void 0):((e=(t=a[0]).object).userData.raycaster.onIntersection(t),s=e))},!1),window.addEventListener("pointerdown",function(e){var t;void 0!==o&&(void 0===o.stereo?a&&0<a.length&&((t=a[0]).object.userData.raycaster&&(t.object.userData.raycaster.onMouseDown(t),r&&r.guiSelectPoint&&r.guiSelectPoint.select(t))):o.stereo.onDocumentMouseDown(e))},!1),this.addParticle=function(e){var t;e.userData.boFrustumPoints||(o.stereo?o.stereo.addParticle(e):(t=e,c.includes(t)?console.error('Duplicate particle "'+e.name+'"'):c.push(e)))}}ko.raycaster=new w,ko.EventListeners=(v(Po,null,[{key:"getRendererSize",value:function(e,t){(t=t||e.domElement).style.position,t.style.left,t.style.top,t.style.width,t.style.height;var t=t.getBoundingClientRect(),o=Math.round(t.left),n=Math.round(t.top),i=new Me.THREE.Vector2;return e.getSize(i),{getMousePosition:function(e,t){e.x=t.clientX/i.x*2-1-o/i.x*2,e.y=2*-(t.clientY/i.y)+1+n/i.y*2}}}}]),Po);
/**
 * @module Player
 * @description 3D objects animation.
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
var zo=function o(n){var f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};le(this,o),Fo(),!f.options&&f.frustumPoints&&(f.options=f.frustumPoints.getOptions()),f.options=f.options||new ko;var i,r,a,s,l,d,c,m=f.options;function t(e){e=e||0;var t=r.getTime();o.selectPlayScene(n,{t:t,index:e,options:f.options}),r.setIndex(e,(""===m.playerOptions.name?"":m.playerOptions.name+": ")+t),f.onSelectScene&&f.onSelectScene(e,t),m.frustumPoints&&m.frustumPoints.updateCloudPoints()}function e(){m.player.controllers.forEach(function(e){e.onRenamePlayButtons&&e.onRenamePlayButtons(a)})}function u(){a=!1,e(),s=void 0}function p(){if(i++,null!==m.playerOptions.max&&i>=m.playerOptions.marks){if(!m.playerOptions.repeat)return i=m.playerOptions.marks-1,void u();i=0}t(i=-1===i||i===m.playerOptions.marks&&null!==m.playerOptions.max?0:i)}function h(e){"ru"===e()&&(d.prevSymbolTitle=" ",d.playTitle="",d.nextSymbolTitle=" ",d.pauseTitle="",d.repeatOn=" ",d.repeatOff="  ",d.controllerTitle=" .",d.stereoEffects=" ",d.mono="",d.sideBySide=" ",d.topAndBottom=" ")}function g(e){le(this,g);var r,a,s=m.player,t=m.getLanguageCode;if(!(e=e||m.dat.gui)||!1===m.dat.playController){var o=_(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,{}));return _(o)}function l(e,t,o){var n=document.createElement("span");return n.innerHTML=e,n.title=t,n.style.cursor="pointer",n.style.margin="0px 2px",n.onclick=o,n}h(t);var c="rgb(255,255,255)",u="rgb(128,128,128)",o=_(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,{playRate:1,property:function(e){var t,o,n,i={};return r=function(e,t){i.buttonPlay.innerHTML=e,i.buttonPlay.title=t},i.buttonPrev=l(d.prevSymbol,d.prevSymbolTitle,s.prev),i.buttonPlay=l(d.playSymbol,d.playTitle,s.play3DObject),null!==s.getSettings().options.playerOptions.max&&(a=t=function(e){var t,o=e?(t=d.repeatOff,c):(t=d.repeatOn,u);i.buttonRepeat.title!==t&&(i.buttonRepeat.title=t,i.buttonRepeat.style.color=o,s.onChangeRepeat(e))},n=s.getSettings().repeat?(o=d.repeatOff,c):(o=d.repeatOn,u),i.buttonRepeat=l(d.repeat,o,function(e){t(i.buttonRepeat.title===d.repeatOn)}),i.buttonRepeat.style.color=n),i.buttonNext=l(d.nextSymbol,d.nextSymbolTitle,s.next),i}},"playRate"));return(s.PlayController=o).lang=d,o.onRenamePlayButtons=function(e){var t,e=e?(t=d.pause,d.pauseTitle):(t=d.playSymbol,d.playTitle);r(t,e,!0)},o.onChangeRepeat=function(){a(s.getSettings().options.playerOptions.repeat)},s.pushController(o),o.setValue=function(e){this._controller.domElement.childNodes[0].value=e},e.add(o).__truncationSuspended=!0,_(o)}function y(){if(c)return c.querySelector("#sliderPosition")}m.boOptions?!1!==m.player&&(o.player=this,m.boPlayer=m.boPlayer||!1,m.player?console.error("Player: duplicate player."):(m.player=this,f.cameraTarget=f.cameraTarget||{},setTimeout(function(){t()},0),i=0,(r=this).getTime=function(){var e=m.playerOptions,t=e.min+i*e.dt;return isNaN(t)&&console.error("Player.getTime(): t = "+t),null!==e.max&&t>e.max&&console.error("Player.getTime(): t = "+t+" playerOptions.max = "+e.max),t<e.min&&null!==e.max&&console.error("Player.getTime(): t = "+t+" playerOptions.min = "+e.min),t},this.setTime=function(e){this.selectScene(parseInt((e-m.playerOptions.min)/m.playerOptions.dt))},this.selectScene=function(e){if(void 0!==e)for(e=parseInt(e),null!==m.playerOptions.max&&(e>=m.playerOptions.marks?e=0:e<0&&(e=m.playerOptions.marks-1),i>m.playerOptions.marks&&(i=m.playerOptions.marks));i!==e;)i<e?i++:i--,t(i);else t(i)},this.next=function(){r.selectScene(i+1)},this.prev=function(){r.selectScene(i-1)},this.pushController=function(e){void 0!==e.object&&void 0!==e.object.playRate&&(e.object.playRate=m.playerOptions.min),this.controllers.push(e)},a=!(this.controllers=[]),this.play3DObject=function(){a?u():(a=!0,null!==m.playerOptions.max&&i>=m.playerOptions.marks-1&&(i=0),p(),e(),window.requestAnimationFrame(function e(t){if(a?window.requestAnimationFrame(e):s=void 0,void 0===s&&(l=(s=t)+1e3/m.playerOptions.interval),!isNaN(l)&&l!==1/0||(console.error("Player.animate: timeNext = "+l),a=!1),!(t<l)){for(;l<t;)l+=1e3/m.playerOptions.interval;p()}}))},this.repeat=function(){m.playerOptions.repeat=!m.playerOptions.repeat,this.onChangeRepeat(m.playerOptions.repeat)},this.getSettings=function(){return f},this.getSelectSceneIndex=function(){return i},this.onChangeRepeat=function(e){m.playerOptions.repeat=e,this.controllers.forEach(function(e){e.onChangeRepeat&&e.onChangeRepeat()})},d={prevSymbol:"",prevSymbolTitle:"Go to previous animation scene",nextSymbol:"",nextSymbolTitle:"Go to next animation scene",playSymbol:"",playTitle:"Play",pause:"",pauseTitle:"Pause",repeat:"",repeatOn:"Turn repeat on",repeatOff:"Turn repeat off",controllerTitle:"Current time.",stereoEffects:"Stereo effects",mono:"Mono",sideBySide:"Side by side",topAndBottom:"Top and bottom"},this.localization=function(){return h(0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return"en"}),d},this.PlayController=(b(g,Qt.CustomController),v(g,[{key:"controller",set:function(e){this._controller=e,this._controller.onChange(function(e){m.player.setTime(e)}),this._controller.domElement.title=this.lang.controllerTitle},get:function(){return this._controller}}]),g),this.gui=function(e){var i,r,t,o,a,n=m.dat.cookie,s=m.dat.getCookieName("Player"),l=m.getLanguageCode,c=Me.dat;function u(){null===m.playerOptions.max?m.playerOptions.dt=m.playerOptions.dt||.1:m.playerOptions.dt=(m.playerOptions.max-m.playerOptions.min)/(m.playerOptions.marks-1)}function d(){u(),n.setObject(s,m.playerOptions),f.onChangeScaleT&&f.onChangeScaleT(m.playerOptions)}function p(){null!==m.playerOptions.max&&(m.playerOptions.max=m.playerOptions.min+m.playerOptions.dt*(m.playerOptions.marks-1))}(e=e||m.dat.gui)&&!1!==m.dat.playerGui&&(p(),i=JSON.parse(JSON.stringify(m.playerOptions)),r=function(t){var e={player:"Player",playerTitle:"3D objects animation.",min:"Min",max:"Max",dt:"Step",dtTitle:"Time between frames",marks:"Frames",marksTitle:"Player frames count",interval:"Rate",intervalTitle:"Rate of changing of animation scenes per second.",time:"Time",defaultButton:"Default",defaultTitle:"Restore default player settings."},o=void 0===(t=t||{}).getLanguageCode?"en":t.getLanguageCode();switch(o){case"ru":e.player="",e.playerTitle=" 3D .",e.min="",e.max="",e.dt="",e.dtTitle="  ",e.marks="",e.marksTitle="  ",e.interval="",e.intervalTitle="    .",e.time="",e.defaultButton="",e.defaultTitle="    .";break;default:if(void 0===t.lang||t.lang._languageCode!=o)break;Object.keys(t.lang).forEach(function(e){void 0!==_lang[e]&&(_lang[e]=t.lang[e])})}return e}({getLanguageCode:l}),Object.freeze(i),t=m.playerOptions.max,o=m.playerOptions.marks,n.getObject(s,m.playerOptions,m.playerOptions),null!==t&&t!==1/0&&null!==m.playerOptions.max||(m.playerOptions.max=t,m.playerOptions.marks=o),a=e.addFolder(r.player),c.folderNameAndTitle(a,r.player,r.playerTitle),function(){var o=m.playerOptions,n={};function e(e,t){e=e.controller.getValue();o.min=t(o.min,e),n.min.setValue(o.min),o.max&&(o.max=t(o.max,e),u(),n.max.setValue(o.max)),d()}n.folder=a.addFolder(""!==o.name?o.name:r.time),n.scaleController=n.folder.add(new Le(e,{settings:f.options.playerOptions,getLanguageCode:l})).onChange(function(e){o.zoomMultiplier=e,d()});var t=new De(function(o){e(t,function(e,t){return e+=o})},{settings:f.options.playerOptions,getLanguageCode:l});n.positionController=n.folder.add(t).onChange(function(e){o.offset=e,d()}),n.min=c.controllerZeroStep(n.folder,o,"min",function(e){d()}),c.controllerNameAndTitle(n.min,r.min),p(),null!==o.max?(n.max=c.controllerZeroStep(n.folder,o,"max",function(e){d()}),c.controllerNameAndTitle(n.max,r.max)):(n.dt=c.controllerZeroStep(n.folder,o,"dt",function(e){d()}),c.controllerNameAndTitle(n.dt,r.dt,r.dtTitle)),o.marks&&(n.marks=n.folder.add(o,"marks").onChange(function(e){o.marks=parseInt(o.marks),d();var t=y();t&&(t.max=m.playerOptions.marks-1)}),c.controllerNameAndTitle(n.marks,void 0===o.marksName?r.marks:o.marksName,(void 0===o.marksTitle?r:o).marksTitle)),n.interval=n.folder.add(f.options.playerOptions,"interval",1,25,1).onChange(function(e){d()}),c.controllerNameAndTitle(n.interval,r.interval,r.intervalTitle),c.controllerNameAndTitle(n.folder.add({defaultF:function(e){o.zoomMultiplier=i.zoomMultiplier,n.scaleController.setValue(o.zoomMultiplier),o.offset=i.offset,n.positionController.setValue(o.offset),o.min=i.min,n.min.setValue(o.min),n.max&&(o.max=i.max,u(),n.max.setValue(o.max)),n.dt&&(o.dt=i.dt,n.dt.setValue(o.dt)),i.marks&&(o.marks=i.marks,n.marks&&n.marks.setValue(o.marks)),o.interval=i.interval,n.interval.setValue(o.interval),d()}},"defaultF"),r.defaultButton,r.defaultTitle)}())},this.createCanvasMenuItem=function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return"en"},t=this,o=(c=n).menu,i=t.localization(e);o.push({name:i.prevSymbol,title:i.prevSymbolTitle,onclick:function(e){t.prev()}}),o.push({name:i.playSymbol,title:i.playTitle,id:"menuButtonPlay",onclick:function(e){t.play3DObject()}}),null!==m.playerOptions.max&&o.push({name:i.repeat,title:this.getSettings().repeat?i.repeatOff:i.repeatOn,id:"menuButtonRepeat",onclick:function(e){t.repeat()}}),o.push({name:i.nextSymbol,title:i.nextSymbolTitle,onclick:function(e){t.next()}}),this.controllers.push({onRenamePlayButtons:function(e){var t,o=e?(t=i.pause,i.pauseTitle):(t=i.playSymbol,i.playTitle),e=n.querySelector("#menuButtonPlay");e.innerHTML=t,e.title=o},onChangeRepeat:function(){n.querySelector("#menuButtonRepeat").title=m.playerOptions.repeat?i.repeatOff:i.repeatOn}})},this.addSlider=function(){null!==m.playerOptions.max&&c.menu.push({name:'<input type="range" min="0" max="'+(m.playerOptions.marks-1)+'" value="0" class="slider" id="sliderPosition">',style:"float: right;"})},this.addSliderEvents=function(){var t,o,n=y();return n&&(n.onchange=function(e){o.selectScene(parseInt(n.value))},n.oninput=function(e){o.selectScene(parseInt(n.value))},o=this,n.addEventListener("pointerdown",function(e){t=!0}),n.addEventListener("pointerup",function(e){t=!1}),n.addEventListener("mousemove",function(e){t&&o.selectScene((m.playerOptions.marks-1)*e.offsetX/n.clientWidth)})),n},this.setIndex=function(e,t){"object"===se(this.PlayController)&&this.PlayController.setValue(this.getTime());var o=y();o&&(o.value=e,o.title=t)},this.onChangeScale=function(e){y().max=e.marks-1,this.selectScene(0)})):console.error("Player: call options = new Options( options ) first")};zo.cameraTarget=function e(){le(this,e);var i,o={boLook:!1},t={boLook:o.boLook,getDistanceToCamera:function(){return void 0!==this.distanceToCameraCur?this.distanceToCameraCur:this.distanceToCamera}};o.rotation={};var n,r=(t.rotation={},!1),a=!1;function s(e){Fo(),e=e||o,t.boMaual||(void 0!==e.boLook?t.boLook=e.boLook:t.boLook=o.boLook),t.camera=e.camera||o.camera,t.distanceToCamera=e.distanceToCamera||o.distanceToCamera||t.distanceToCamera||(new Mo.Vector3).copy(o.camera.position),e.rotation||(e.rotation={}),t.rotation.angle=e.rotation.angle||o.rotation.angle||0,t.rotation.axis=e.rotation.axis||o.rotation.axis||new Mo.Vector3(0,1,0)}this.get=function(e){if(e||i?i&&e&&!Object.is(i,e)&&console.error("Player.cameraTarget.get: options is ambiguous"):console.error("Player.cameraTarget.get: options = "+e),i=i||e,t.camera||a||!i.player||(o.camera=i.player.getSettings().cameraTarget.camera,o.camera&&s(),a=!0),t.camera)return t},this.init=function(e,t){if(t||i?i&&t&&!Object.is(i,t)&&console.error("Player.cameraTarget.init: options is ambiguous"):console.error("Player.cameraTarget.init: options = "+t),i=i||t,!1!==e.bodefault){if(r)return;void 0!==e.boLook&&(o.boLook=e.boLook,n=e.boLook)}else{if(!0!==e.boLook)return;r&&console.warn("playerCameraTarget().init(...): duplicate target point"),r=!0,void 0===n&&(o.boLook=!0)}o.camera=o.camera||e.camera||(i.player?i.player.getSettings().cameraTarget.camera:void 0),o.camera?(o.distanceToCamera=o.distanceToCamera||e.distanceToCamera,e.rotation=e.rotation||{},o.rotation.angle=o.rotation.angle||e.rotation.angle,o.rotation.axis=o.rotation.axis||e.rotation.axis,s(e)):console.error("playerCameraTarget().init(...): cameraTargetDefault.camera = "+o.camera)},this.changeTarget=function(e,t){Fo();var o=i.playerOptions.cameraTarget.get(),n=e.userData.player&&"function"!=typeof e.userData.player.arrayFuncs?e.userData.player.arrayFuncs[t]:{};n.cameraTarget||(n.cameraTarget={boLook:!1}),s(n.cameraTarget),o&&o.boLook?(e=eo(e,(new Mo.Vector3).fromArray(e.geometry.attributes.position.array,t*e.geometry.attributes.position.itemSize)),o.target=e):delete o.target},this.setCameraTarget=function(o){Fo();var e,t,n,i=o.playerOptions.cameraTarget.get(o),r=(i=i||i||{}).camera;r&&(i.distanceToCamera||(i.distanceToCamera=(new Mo.Vector3).copy(r.position)),i.distanceToCameraCur||(i.distanceToCameraCur=new Mo.Vector3),e=zo.getTime(),t=i.distanceToCamera,n=(new Mo.Vector3).copy(i.distanceToCameraCur),i.distanceToCameraCur.set(zo.execFunc(t,"x",e,o),zo.execFunc(t,"y",e,o),zo.execFunc(t,"z",e,o)),i.setCameraPosition||(i.setCameraPosition=function(){var e=i.target;if(i.boLook&&(e||!i.distanceToCameraCur.equals(n))){n.copy(i.distanceToCameraCur);var t=zo.getTime();if(r.position.copy(i.distanceToCameraCur),r.position.applyAxisAngle(i.rotation.axis,zo.execFunc(i.rotation,"angle",t,o)),!e){if(!zo.orbitControls)return;e=zo.orbitControls.target}r.position.add(e),r.lookAt(e),o.orbitControls&&(o.orbitControls.target.equals(e)||(o.orbitControls.target.copy(e),o.orbitControlsGui&&o.orbitControlsGui.setTarget(e)),o.orbitControls._listeners&&o.orbitControls._listeners.change[0]())}}),o.cameraGui&&o.cameraGui.update())}},zo.execFunc=function(e,t,o){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=e[t],r=n.a,a=n.b,s=void 0===i?"undefined":se(i);switch(void 0===o&&(o=n.playerOptions?n.playerOptions.min:0),s){case"undefined":return;case"string":i=new Function("t","a","b","return "+i);case"function":try{var l=i(o,r,a);if(void 0===l)throw"function returns "+l;return l}catch(e){throw console.error(e),e}case"number":return i;case"object":if(Array.isArray(i)){var c=function(e){return"function"==typeof u[e]?u[e](o,u,a):u[e]instanceof Mo.Color?u[e]:void 0};if(0===i.length)return void console.error('Player.execFunc: funcs["'+t+'"] array is empty');for(var u=i,d=i.length-1,p=null===n.playerOptions.max?1/0:n.playerOptions.max,f=n.playerOptions.min,m=(p-f)/d,h=f,g=p,y=0,v=d,b=0;b<i.length;b++)m*b+f<o&&(h=m*(y=b)+f,g=m*(v=b+1)+f);if("number"!=typeof u[y]){if("w"===t)return c(y);if("object"!==se(u[y]))return void console.error('Player.execFunc: funcs["'+t+'"] array item '+y+" typeof = "+se(u[y])+" is not number");for(b=0;b<i.length;b++){if(b===i.length-1)return u[b].v;if(v=(y=b)+1,h=u[y].t,g=u[v].t,h<=o&&o<g){var _=(u[v].v-u[y].v)/(g-h),x=u[y].v-_*h;return _*o+x}}return void console.error("Player.execFunc: value is not detected")}if(v>=i.length&&(v=y),"number"!=typeof u[v]){if("w"===t)return c(v);if("object"!==se(u[v]))return void console.error('Player.execFunc: funcs["'+t+'"] array item '+v+" typeof = "+se(u[v])+" is not number")}_=(u[v]-u[y])/(g-h),x=u[y]-_*h;return(isNaN(_)||isNaN(x))&&console.error("Player.execFunc: invalid x = "+_+" or y = "+x),_*o+x}return i.func?i.func instanceof Function?i.func(o,r,a):i.func:("w"!==t&&console.error('Player.execFunc: funcs["'+t+'"] object is not array'),i);default:console.error('Player.execFunc: Invalud typeof funcs["'+t+'"]: '+s)}},zo.selectMeshPlayScene=function(f){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};Fo();var t,m=e.t,h=e.options||{dat:!1};void 0===m&&(m=h.playerOptions.min),h.scales.setW(),!f.userData.player||h&&h.boPlayer&&f.userData.boFrustumPoints||(f.geometry&&(delete f.geometry.boundingSphere,f.geometry.boundingSphere=null),f.userData.player.selectPlayScene&&(t=function(e){for(;f.rotation[e]<0;)f.rotation[e]+=2*Math.PI;for(;f.rotation[e]>2*Math.PI;)f.rotation[e]-=2*Math.PI},f.userData.player.selectPlayScene(m),t("x"),t("y"),t("z")),function(o,i){if(f.geometry){var r,a,s=f.geometry.attributes,l=f.userData.player.arrayFuncs;if(void 0!==l){void 0===m&&console.error("setPosition: t = "+m),h&&void 0!==h.scales.w?(r=h.scales.w.min,a=h.scales.w.max):r=(a=d)-1;for(var c,u,d,p=0;p<l.length;p++)!function(){function e(e,t){e=zo.execFunc(c,e,m,h);void 0!==e&&(s.position[t](p,e),u=!0)}c=l[p],u=!1,e("x","setX"),e("y","setY"),e("z","setZ");var n=void 0;function t(){if(f.userData.player.palette)n=f.userData.player.palette.toColor(d,r,a);else{if(!h.palette){var e=255,t=255,o=255;return n=new Mo.Color("rgb("+e+", "+t+", "+o+")")}n=h.palette.toColor(d,r,a)}}"function"==typeof c.w?(d=c.w(m,o,i),a=h.scales.w?(r=h.scales.w.min,h.scales.w.max):(console.warn("Player.selectMeshPlayScene:     "),r=0,100),4<=s.position.itemSize&&s.position.setW(p,d),u=!0,t()):"object"===se(c.w)?c.w instanceof Mo.Color?n=c.w:(d=zo.execFunc(c,"w",m,h),void 0!==c.w.min&&(r=c.w.min),void 0!==c.w.max&&(a=c.w.max),t()):"number"==typeof c.w&&h.palette&&(n=h.palette.toColor(c.w,r,a)),n&&(!f.material instanceof Mo.ShaderMaterial&&f.material.vertexColors!==Mo.VertexColors&&console.error("Player.selectMeshPlayScene: Please set the vertexColors parameter of the THREE.PointsMaterial of your points to THREE.VertexColors. Example: vertexColors: THREE.VertexColors"),!zo.setColorAttribute(s,p,n)&&c instanceof Mo.Vector4&&(f.geometry.setAttribute("color",new Mo.Float32BufferAttribute(zo.getColors(l,{positions:f.geometry.attributes.position,options:h}),4)),zo.setColorAttribute(s,p,n)||console.error('Player.selectMeshPlayScene: the color attribute is not exists. Please use THREE.Vector3 instead THREE.Vector4 in the arrayFuncs or add "color" attribute'))),u&&(s.position.needsUpdate=!0),c.line&&c.line.addPoint&&c.line.addPoint(f,p,n),c.cameraTarget&&!0===c.cameraTarget.boLook&&h.playerOptions.cameraTarget.changeTarget(f,p)}()}}}(h?h.a:1,h?h.b:0),t="Player.selectMeshPlayScene: invalid mesh.scale.",f.scale.x<=0&&console.error(t+"x = "+f.scale.x),f.scale.y<=0&&console.error(t+"y = "+f.scale.y),f.scale.z<=0&&console.error(t+"z = "+f.scale.z),h&&h.guiSelectPoint&&(h.guiSelectPoint.setMesh(),-1!==(t=h.guiSelectPoint.getSelectedPointIndex())&&h.guiSelectPoint.isSelectedMesh(f)&&h.guiSelectPoint.setPosition({object:f,index:t})))},zo.setColorAttribute=function(e,t,o){"string"==typeof o&&(o=new Mo.Color(o));e=e.color||e.ca;return void 0!==e&&(e.setX(t,o.r),e.setY(t,o.g),e.setZ(t,o.b),e.needsUpdate=!0)},zo.getPoints=function(t,o){Fo(),Array.isArray(t)||(t=[t]),void 0===(o=o||{}).t&&(o.t=o.options&&o.options.player?o.options.player.getSettings().options.playerOptions.min:0);var n=o.options||new ko,e={palette:n.palette};n.setW(e);for(var i=e.scales.w.max,r=0;r<t.length;r++){var a=t[r];Array.isArray(a)?t[r]=new Mo.Vector4(void 0===a[0]?0:a[0],void 0===a[1]?0:a[1],void 0===a[2]?0:a[2],void 0===a[3]?i:a[3]):"object"===(void 0===a?"undefined":se(a))&&a instanceof Mo.Vector2==!1&&a instanceof Mo.Vector3==!1&&a instanceof Mo.Vector4==!1&&(void 0===a.vector?t[r]=new Mo.Vector4(void 0===a.x?0:a.x,void 0===a.y?0:a.y,void 0===a.z?0:a.z,void 0===a.w?0:a.w):a.vector instanceof Mo.Vector2==!0||a.vector instanceof Mo.Vector3==!0||a.vector instanceof Mo.Vector4==!0?a.vector instanceof Mo.Vector2==!0&&(t[r].vector=new Mo.Vector3(void 0===a.vector.x?0:a.vector.x,void 0===a.vector.y?0:a.vector.y,void 0===a.vector.z?0:a.vector.z)):4===a.vector.length?t[r].vector=new Mo.Vector4(void 0===a.vector[0]?0:a.vector[0],void 0===a.vector[1]?0:a.vector[1],void 0===a.vector[2]?0:a.vector[2],void 0===a.vector[3]?0:a.vector[3]):3===a.vector.length?t[r].vector=new Mo.Vector3(void 0===a.vector[0]?0:a.vector[0],void 0===a.vector[1]?0:a.vector[1],void 0===a.vector[2]?0:a.vector[2]):console.error("Player.getPoints(...) falied! item.vector.length = "+a.vector.length))}for(var s=[],r=0;r<t.length;r++){var l=function(e){return(c="number"==typeof c?new Mo.Vector4(c,0,0,0):c)instanceof Mo.Vector2||c instanceof Mo.Vector3||c instanceof Mo.Vector4?zo.execFunc(c,e,o.t,n):void 0!==c.vector?(void 0!==c.name&&(c.vector.name=c.name),c.trace&&n.player&&(c.vector.line=new zo.traceLine(n)),c.cameraTarget&&(c.vector.cameraTarget=c.cameraTarget,delete c.cameraTarget),t[r]=c.vector,c=c.vector,zo.execFunc(c,e,o.t,n)):void console.error("Player.getAxis().getPoints(): funcs.vector = "+c.vector)},c=t[r],l=c.vector instanceof Mo.Vector3==!0?new Mo.Vector3(l("x"),l("y"),l("z")):new Mo.Vector4(l("x"),l("y"),l("z"),l("w"));c.cameraTarget&&(c.cameraTarget.bodefault=!1,void 0===c.cameraTarget.boLook&&(c.cameraTarget.boLook=!0),n.playerOptions.cameraTarget.init(c.cameraTarget,n)),s.push(l)}return s};var Mo,Lo=!0;function Fo(){Me.isThree()?(Mo=Me.THREE,Object.assign(Mo.BufferGeometry.prototype,{setFromPoints:function(e,t){t=t||3;for(var o=[],n=0,i=e.length;n<i;n++){var r=e[n];o.push(r.x,r.y,r.z||0),4<=t&&o.push(r.w||0)}return this.setAttribute("position",new Mo.Float32BufferAttribute(o,t)),this}}),Object.assign(Mo.Vector4.prototype,{multiply:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,void 0!==e.w&&(this.w*=e.w),this}}),Object.assign(Mo.Vector4.prototype,{add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,void 0!==e.w&&(this.w+=e.w),this)}}),Object.assign(Mo.Points.prototype,{raycast:function(e,t){var o=new Mo.Matrix4,l=new Mo.Ray,n=new Mo.Sphere,i=new Mo.Vector3;function r(e,t,o,n,i,r,a){var s=l.distanceSqToPoint(e);s<o&&(o=new Mo.Vector3,l.closestPointToPoint(e,o),o.applyMatrix4(n),(n=i.ray.origin.distanceTo(o))<i.near||n>i.far||r.push({distance:n,distanceToRay:Math.sqrt(s),point:o,index:t,face:null,object:a}))}var a=this.geometry,s=this.matrixWorld,c=e.params.Points.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),n.copy(a.boundingSphere),n.applyMatrix4(s),n.radius+=c,!1!==e.ray.intersectsSphere(n)){o.copy(s).invert(),l.copy(e.ray).applyMatrix4(o);var o=c/((this.scale.x+this.scale.y+this.scale.z)/3),u=o*o;if(a.isBufferGeometry){var c=a.index,o=a.attributes,d=o.position.array,p=o.position.itemSize;if(null!==c)for(var f=c.array,m=0,h=f.length;m<h;m++){var g=f[m];i.fromArray(d,g*p),r(i,g,u,s,e,t,this)}else for(var y=0,v=d.length/p;y<v;y++)i.fromArray(d,y*p),r(i,y,u,s,e,t,this)}else for(var b=a.vertices,_=0,x=b.length;_<x;_++)r(b[_],_,u,s,e,t,this)}}})):console.warn("Player: can not assign. Set THREE first.")}zo.getColors=function(e,n){if(Fo(),Array.isArray(e)||(e=[e]),(n=n||{}).options=n.options||{},void 0!==n.positions&&Array.isArray(e)&&e.length!==n.positions.count)return console.error("getColors failed! arrayFuncs.length: "+e.length+" != positions.count: "+n.positions.count),n.colors;var t=Array.isArray(e)?e.length:n.positions.count;n.colors=n.colors||[],n.options.palette||n.options.setPalette();for(var i=0;i<t;i++){var o,r,a,s,l,c,u=Array.isArray(e)?e[i]:void 0;u instanceof Mo.Vector4||n.positions&&4===n.positions.itemSize?(s=r=void 0,a=u.w,u.w instanceof Object&&u.w.func?(u.w.max&&(s=u.w.max),u.w.min&&(r=u.w.min),a=u.w.func):(n.options.setW(),r=n.options.scales.w.min,s=n.options.scales.w.max),a instanceof Function&&!n.options.player&&Lo&&(Lo=!1),s=n.options.palette.toColor(void 0===u?(new Mo.Vector4).fromBufferAttribute(n.positions,i).w:a instanceof Function?a(n.options.playerOptions?n.options.playerOptions.min:0):a,r,s),n.colors.push(s.r,s.g,s.b)):n.colors instanceof Mo.Float32BufferAttribute?o=new Mo.Vector3(1,1,1):n.colors.push(1,1,1),void 0!==n.opacity?(l=0,c=getStandardNormalDistribution(0),group.children.forEach(function(e){if(e.userData.cloud)for(var t=0;t<e.geometry.attributes.position.count;t++){var o=getObjectPosition(e,t);l+=getStandardNormalDistribution(5*eo(camera,(new Mo.Vector3).fromBufferAttribute(n.positions,i)).distanceTo(o))/c}}),void 0!==debug.opacity&&(l=debug.opacity),n.colors instanceof Mo.Float32BufferAttribute?n.colors.setXYZW(i,o.x,o.y,o.z,l):n.colors.push(l)):n.colors.push(1)}return n.colors},zo.traceLine=function e(c){var u;le(this,e);var d=[];Fo(),c.player&&(this.isVisible=function(){return!!c.player&&(u?u.visible:0!==d.length&&d[0].visible)},this.visible=function(t){if(!c.player)return!1;u?u.visible=t:d.forEach(function(e){e.visible=t})},this.addPoint=function(e,t,o){var n=e.geometry.attributes.position;(s=4<=n.itemSize?new Mo.Vector4(0,0,0,0):new Mo.Vector3).fromArray(n.array,t*n.itemSize);var i=c.player?c.player.getSelectSceneIndex():0;if(null===c.playerOptions.max){if((i=Math.abs(i))<d.length-1){for(;i<d.length-1;)e.remove(d[d.length-1]),d.pop();return}var r=new Mo.BufferGeometry,a=new Float32Array(6);r.setAttribute("position",new Mo.BufferAttribute(a,3));a=new Float32Array(6);r.setAttribute("color",new Mo.Float32BufferAttribute(a,3));a=new Mo.Line(r,new Mo.LineBasicMaterial({vertexColors:Mo.VertexColors}));e.add(a),d[0]&&(a.visible=d[0].visible);var s=(new Mo.Vector3).copy(s),r=a.geometry.attributes.position.itemSize;return s.toArray(a.geometry.attributes.position.array,+r),(0===d.length?s:(new Mo.Vector3).fromArray(d[d.length-1].geometry.attributes.position.array,+r)).toArray(a.geometry.attributes.position.array,0*r),a.geometry.attributes.position.needsUpdate=!0,void 0===o&&(o=new Mo.Color(1,1,1)),zo.setColorAttribute(a.geometry.attributes,0,0===d.length?o:(new Mo.Color).fromArray(d[d.length-1].geometry.attributes.color.array,+r)),zo.setColorAttribute(a.geometry.attributes,1,o),void d.push(a)}if(void 0===u){r=new Mo.BufferGeometry;if(null!==c.playerOptions.max)if(c.playerOptions&&c.playerOptions.marks)l=c.playerOptions.marks;else{if(!c.player||!c.player.marks)return void console.error("Player.traceLine: MAX_POINTS = "+l+". Create Player first or remove all trace = true from all items of the arrayFuncs");l=c.player.marks}else l=i+1;a=new Float32Array(3*l);r.setAttribute("position",new Mo.BufferAttribute(a,3));var l=new Float32Array(3*l);r.setAttribute("color",new Mo.Float32BufferAttribute(l,3)),r.setDrawRange(i,i),(u=new Mo.Line(r,new Mo.LineBasicMaterial({vertexColors:Mo.VertexColors}))).visible=!0,e.add(u)}u.geometry&&(delete u.geometry.boundingSphere,u.geometry.boundingSphere=null),(s=(new Mo.Vector3).copy(s)).toArray(u.geometry.attributes.position.array,i*u.geometry.attributes.position.itemSize),u.geometry.attributes.position.needsUpdate=!0,void 0===o&&(o=new Mo.Color(1,1,1)),zo.setColorAttribute(u.geometry.attributes,i,o);s=u.geometry.drawRange.start,o=i+1-s;i<s&&(o=s+u.geometry.drawRange.count-(s=i)),u.geometry.setDrawRange(s,o)},this.remove=function(){void 0!==u&&(u.geometry.dispose(),u.material.dispose(),u.parent.remove(u))})},zo.getTime=function(){return zo.player?zo.player.getTime():0},zo.getItemSize=function(e){Fo();for(var t=0;t<e.length;t++)if(e[t]instanceof Mo.Vector4)return 4;return 3},zo.selectPlayScene=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=void 0!==t.t?t.t:0,n=void 0!==t.index?t.index:void 0,i=t.options||new ko;e.userData.t=o,zo.selectMeshPlayScene(e,{t:o,options:i}),e.children.forEach(function(e){zo.selectMeshPlayScene(e,{t:o,options:i})}),i.playerOptions.cameraTarget.setCameraTarget(i);e=i.playerOptions.cameraTarget.get();e&&e.setCameraPosition&&e.setCameraPosition(void 0===n)},zo.assign=function(){Fo()};
/**
 * node.js version of the synchronous download of the file.
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
var Do,No={sync:no},Ro=(Do=function(){if(document.currentScript&&""!==document.currentScript.src)return document.currentScript.src;var e=document.getElementsByTagName("script");return""!==e[e.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]}()).substring(0,Do.lastIndexOf("/"));
/**
 * @module getShaderMaterialPoints
 * @description get THREE.Points with THREE.ShaderMaterial material
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function Vo(e,t,o,n){n=n||{};var r=Me.THREE,i=void 0===n.pointsOptions?void 0===n.tMin?0:n.tMin:void 0===n.pointsOptions.tMin?0:n.pointsOptions.tMin;n.pointsOptions=n.pointsOptions||{},zo.assign();var a="function"==typeof t?t():(new r.BufferGeometry).setFromPoints(zo.getPoints(t,{options:n.options,group:e,t:i}),t[0]instanceof r.Vector3?3:4),s=n.pointsOptions.frustumPoints?n.pointsOptions.frustumPoints.pushArrayCloud(a):void 0;void 0!==n.pointsOptions&&n.pointsOptions.boFrustumPoints||(n.options.scales.w||n.options.scales.setW(),a.setAttribute("ca",new r.Float32BufferAttribute(zo.getColors(t,{opacity:void 0===n.pointsOptions?void 0:n.pointsOptions.opacity,positions:a.attributes.position,options:n.options}),4)));t=(new r.TextureLoader).load(Ro+"/textures/point.png",function(e){},function(){},function(){console.error("THREE.TextureLoader: error")});t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping;var l,c,u,d,p={pointTexture:{value:t},pointSize:{value:(void 0!==n.pointsOptions&&void 0!==n.pointsOptions.shaderMaterial&&void 0!==n.pointsOptions.shaderMaterial.point?n.pointsOptions.shaderMaterial:n.options).point.size}};void 0!==n.pointsOptions&&void 0!==n.pointsOptions.uniforms&&(l=n.pointsOptions.uniforms(p)),c=function(e){void 0!==l&&l.editShaderText(e);e=new r.Points(a,new r.ShaderMaterial({uniforms:p,vertexShader:e.vertex,fragmentShader:e.fragment,transparent:!0}));e.userData.shaderMaterial=(void 0===n.pointsOptions?n:n.pointsOptions).shaderMaterial,void 0!==n.options.saveMeshDefault&&n.options.saveMeshDefault(e),n.pointsOptions&&n.pointsOptions.frustumPoints&&(e.userData.cloud={indexArray:s}),e.userData.shaderMaterial=(void 0===n.pointsOptions?n:n.pointsOptions).shaderMaterial,o(e),e.userData.boFrustumPoints&&n.pointsOptions.group.children.forEach(function(e){n.options.frustumPoints.updateCloudPoint(e)}),void 0!==e.material.uniforms.palette&&(e.material.uniforms.palette.value.needsUpdate=!0),void 0!==e.material.uniforms.cloudPoints&&(e.material.uniforms.cloudPoints.value.needsUpdate=!0),zo.selectMeshPlayScene(e,{options:n.options});e=n.options.playerOptions.cameraTarget.get(n.options);e&&e.setCameraPosition&&e.setCameraPosition()},u=void 0===n.pointsOptions?void 0:n.pointsOptions.path,d={},(u=u||{}).vertex=u.vertex||Ro+"/getShaderMaterialPoints/vertex.c",u.fragment=u.fragment||Ro+"/getShaderMaterialPoints/fragment.c",function(e,o,n,i){i=i||{};var t=new r.FileLoader(r.DefaultLoadingManager);t.setResponseType("text"),t.load(e,function(t){var e=new r.FileLoader(r.DefaultLoadingManager);e.setResponseType("text"),e.load(o,function(e){n(t,e)},i.onProgress,i.onError)},i.onProgress,i.onError)}(u.vertex,u.fragment,function(e,t){d.vertex=e,d.fragment=t,c(d)},{onError:function(e){console.error(e.srcElement.responseURL+" status = "+e.srcElement.status+" "+e.srcElement.statusText)}})}
/**
 * @module MyPoints
 * @description Array of my points.
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/function jo(e,r,t){var o=Me.THREE;"function"!=typeof e&&0===e.length&&e.push(new o.Vector3);var a=(t=t||{}).pointsOptions||{};t.options=t.options||new ko;var s=t.options;function n(o){function t(t){function e(e){o.position[e]="function"==typeof a.position[e]?a.position[e](t,s.a,s.b):a.position[e]}t=t||a.tMin,e("x"),e("y"),e("z")}function n(t){function e(e){o.scale[e]="function"==typeof a.scale[e]?a.scale[e](t,s.a,s.b):a.scale[e]}t=t||a.tMin,e("x"),e("y"),e("z")}function i(t){function e(e){for(o.rotation[e]="function"==typeof a.rotation[e]?a.rotation[e](t,s.a,s.b):a.rotation[e];o.rotation[e]<0;)o.rotation[e]+=2*Math.PI;for(;o.rotation[e]>2*Math.PI;)o.rotation[e]-=2*Math.PI}t=t||a.tMin,e("x"),e("y"),e("z")}o.name=a.name,void 0!==a.pointIndexes&&(o.userData.pointIndexes=function(e){return a.pointIndexes(e)}),void 0!==a.pointName&&(o.userData.pointName=function(e){return a.pointName(e)}),void 0!==a.controllers&&(o.userData.addControllers=a.addControllers,o.userData.controllers=function(){return a.controllers()}),o.userData.raycaster={onIntersection:function(e,t){s.raycaster&&s.raycaster.onIntersection&&s.raycaster.onIntersection(e,t,o.parent)},onIntersectionOut:function(){s.raycaster&&s.raycaster.onIntersectionOut&&s.raycaster.onIntersectionOut()},onMouseDown:function(e){(s.raycaster&&s.raycaster.onMouseDown?s:ko).raycaster.onMouseDown(e,s)}},o.userData.player={arrayFuncs:e,selectPlayScene:function(e){t(e),n(e),i(e)}},t(),n(),i(),r.add(o),a.boFrustumPoints&&(o.userData.boFrustumPoints=a.boFrustumPoints),s.guiSelectPoint&&s.guiSelectPoint.addMesh(o),s.eventListeners.addParticle(o),void 0!==a.onReady&&a.onReady(o),!o.userData.boFrustumPoints&&s.raycaster&&s.raycaster.addParticle&&s.raycaster.addParticle(o)}s.boOptions||(s=new ko(s)),a.tMin=a.tMin||0,a.name=a.name||"",a.position=a.position||new o.Vector3(0,0,0),a.scale=a.scale||new o.Vector3(1,1,1),a.rotation=a.rotation||new o.Vector3,a.group=r,zo.assign(),!1!==a.shaderMaterial?Vo(r,e,function(e){n(e)},{options:s,pointsOptions:a}):(t=new o.Points("function"==typeof e?e():(new o.BufferGeometry).setFromPoints(zo.getPoints(e,{options:s,group:r,t:a.tMin}),4),new o.PointsMaterial({size:s.point.size/s.point.sizePointsMaterial,vertexColors:o.VertexColors})),a.frustumPoints&&(t.userData.cloud={indexArray:a.frustumPoints.pushArrayCloud(t.geometry)}),t.geometry.setAttribute("color",new o.Float32BufferAttribute(zo.getColors(e,{positions:t.geometry.attributes.position,options:s}),4)),n(t))}
/**
 * @module DropdownMenu
 * @description Creates a drop down menu in your javaScript code.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */var Io,ne={tag:"style"},te=(Io=function(){if(document.currentScript&&""!==document.currentScript.src)return document.currentScript.src;var e=document.getElementsByTagName("script");return""!==e[e.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]}()).substring(0,Io.lastIndexOf("/")),w=te.split(/(.*)(\/build)/);"/canvasMenu"===(w=(te="/build"===w[2]?w[1]:te).split(/(.*)(\/canvasMenu)/))[2]&&(te=w[1]+"/DropdownMenu"),so.sync(te+"/styles/menu.css",ne),so.sync(te+"/styles/gui.css",ne),so.sync(te+"/styles/Decorations/transparent.css",ne),so.sync(te+"/styles/Decorations/gradient.css",ne);function Ho(e){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(le(this,Ho),Me.isThree()){var t=Me.THREE;o.options=o.options||new ko;var n=o.options;if(n.boOptions){if(!1!==n.canvasMenu){n.canvasMenu=this;var i={fullScreen:"Full Screen",nonFullScreen:"Non Full Screen"},r=n.getLanguageCode;if("ru"===r()&&(i.prevSymbolTitle=" ",i.playTitle="",i.nextSymbolTitle=" ",i.pauseTitle="",i.repeatOn=" ",i.repeatOff="  ",i.controllerTitle=" .",i.stereoEffects=" ",i.mono="",i.sideBySide=" ",i.topAndBottom=" "),t&&e instanceof t.WebGLRenderer!=!0)console.error("CanvasMenu: renderer is not THREE.WebGLRenderer");else{var a,s=e.domElement,l=s.parentElement;if("DIV"===l.tagName){if(l.classList.contains("container")||l.classList.add("container"),o.menu=o.menu||[],this.menu=o.menu,o.options.stereoEffect&&o.options.stereoEffect.createCanvasMenuItem&&o.options.stereoEffect.createCanvasMenuItem(this,{getLanguageCode:n.getLanguageCode}),n.player&&n.player.createCanvasMenuItem(this,r),wo.RendererSetSize(e,this),void 0!==o.fullScreen){if(!o.fullScreen.camera)return void console.error("CanvasMenu: settings.fullScreen.camera = "+o.fullScreen.camera);a=new wo(t,e,o.fullScreen.camera,{canvasMenu:this,fullScreen:o.fullScreen}),o.fullScreen.fullScreen&&a.setFullScreen(),this.getFullScreenSettings=function(e){return a.setStereoEffect(e),a},this.isFullScreen=function(){return a.isFullScreen()},this.setFullScreen=function(e){return a.setFullScreen(e)},o.menu.push({style:"float: right;",id:"menuButtonFullScreen",onclick:function(e){a.onclick()}})}n.player&&n.player.addSlider();var c=Bo.create(o.menu,{elParent:"string"==typeof l?document.getElementById(l):l,canvas:"string"==typeof s?document.getElementById(s):s,decorations:"Transparent"});this.querySelector=function(e){return c.querySelector(e)},c.addEventListener("mouseenter",function(e){o.options.dat.mouseenter=!0,o.onOver&&o.onOver(!0)}),c.addEventListener("mouseleave",function(e){o.options.dat.mouseenter=!1,o.onOver&&o.onOver(!1)}),n.player&&n.player.addSliderEvents(),o.fullScreen&&(this.setFullScreenButton=function(e){void 0===e&&(e=o.fullScreen.fullScreen);var t=l.querySelector("#menuButtonFullScreen");return null===t||(e?(t.innerHTML="",t.title=i.nonFullScreen):(t.innerHTML="",t.title=i.fullScreen)),!0},this.setFullScreenButton(),o.options.stereoEffect&&o.options.stereoEffect.settings&&o.options.stereoEffect.settings.spatialMultiplex!==Eo.spatialMultiplexsIndexs.Mono&&this.setFullScreen(!1)),this.setSize=function(e){if(void 0!==c){for(var t,o=0,n=0;n<c.childNodes.length;n++){var i=c.childNodes[n],r=window.getComputedStyle(i),a=parseInt(r["margin-left"])+parseInt(r["margin-right"])+parseInt(r["padding-left"])+parseInt(r["padding-right"]),r=i.querySelector(".slider");null===r?o+=i.offsetWidth+a:(t=r,o+=a)}!t||0<(e=e-o)&&(t.parentElement.style.width=e+"px")}};n={set:function(e,t){this.x=e,this.y=t}};e.getSize(n),this.setSize(n.x,n.y),0===this.menu.length&&console.warn("CanvasMenu: menu is empty.")}else console.error("CanvasMenu: elContainer.tagName = "+l.tagName)}}}else console.error("CanvasMenu: call options = new Options( options ) first")}else console.warn("CanvasMenu: Set THREE first.")}
/**
 * @module DropdownMenu
 * @description Creates a drop down menu in your javaScript code.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
var Bo={create:function(e,i){switch((i=i||{}).elParent=i.elParent||document.querySelector("body"),i.decorations){case"Gradient":case"Transparent":case"Custom":break;default:console.error("DropdownMenu.create: Invalid options.decorations: "+i.decorations)}var t,s=document.createElement("menu");function o(){s.style.opacity=1,clearTimeout(t),t=setTimeout(function(){s.style.opacity=0},5e3)}return i.elParent.classList.contains("container")&&(s.className="controls"),i.canvas&&(s.style.opacity=0,i.canvas.onmouseout=function(e){s.style.opacity=0},i.canvas.onmousemove=function(e){o()},s.onmousemove=function(e){o()}),i.elParent.appendChild(s),e.forEach(function(r){var e="dropdown-child";function t(t){setTimeout(function(){var e=a.style.display;a.style.display="block",t.up?a.style.top="-"+a.offsetHeight+"px":a.style.top=n.offsetHeight-1+"px",t.left&&(a.style.left=n.offsetWidth-a.offsetWidth+"px"),a.style.display=e},0)}var o,n=document.createElement("span");switch(n.className="menuButton"+(void 0===i.decorations?"":" menuButton"+i.decorations),void 0!==r.style&&(n.style.cssText=r.style),void 0!==r.radio&&(n.style.cssText=r.style),void 0!==r.onclick&&(n.onclick=r.onclick),void 0!==r.id&&(n.id=r.id),"string"==typeof r?o=r:(o=r.name,r.id&&(n.id=r.id),r.title&&(n.title=r.title)),void 0===o?"undefined":se(o)){case"object":n.appendChild(o);break;case"string":case"undefined":n.innerHTML=o;break;default:console.error("Invalid typeof name: "+(void 0===o?"undefined":se(o)))}if(r.items){var a=document.createElement("span");if(a.className=e+" "+e+(void 0===i.decorations?"Default":i.decorations),a.title="",n.appendChild(a),r.items.forEach(function(e){var t=document.createElement("nobr"),n="checked";function i(e){return"string"==typeof e?e:!0===e.radio?(e.checked?"":"")+" "+e.name:!0===e.checkbox?(e.checked?"":"")+" "+e.name:e.name}"string"==typeof e||(e.name,t.onclick=function(o){!0===e.radio?r.items.forEach(function(e){var t;!0===e.radio&&(((t=(t=o)||window.event).target||t.srcElement)===e.elName?(e.checked=!0,e.elName.classList.add(n)):(e.checked=!1,e.elName.classList.remove(n)),e.elName.innerHTML=i(e))}):!0===e.checkbox&&(!0===e.checked?e.elName.classList.add(n):e.elName.classList.remove(n),e.checked=!e.checked,e.elName.innerHTML=i(e)),e.onclick&&e.onclick(o)}),!0===e.radio&&t.classList.add("radio"),!0===e.checkbox&&t.classList.add("checkbox"),e.id&&(t.id=e.id),e.title&&(t.title=e.title),t.innerHTML=i(e),!0===e.checked&&t.classList.add(n),a.appendChild(t),"string"!=typeof e&&(e.elName=t)}),"object"===se(r.drop))t(r.drop);else switch(r.drop){case"up":t({up:!0});break;case"left":t({left:!0});break;case void 0:setTimeout(function(){a.style.left="-"+n.clientWidth+"px",a.style.top=n.offsetHeight-1+"px"},0);break;default:console.error("Invalid menuItem.drop: "+r.drop)}}s.appendChild(n)}),s}};
/**
 * @module CanvasMenu
 * @description My [dropdown menu]{@link https://github.com/anhr/commonNodeJS/tree/master/DropdownMenu} for canvas in my [three.js]{@link https://threejs.org/} projects.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
/**
 * Remove all child objects of the object and call dispose on their geometry, material and texture.
 *
 * Thanks to https://stackoverflow.com/a/48768960/5175935
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 * @author  https://stackoverflow.com/users/6045817/%e6%ac%a7%e9%98%b3%e7%bb%b4%e6%9d%b0
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
function Go(t){for(;0<t.children.length;)Go(t.children[0]),t.remove(t.children[0]);t.geometry&&(void 0!==t.geometry.attributes&&Object.keys(t.geometry.attributes).forEach(function(e){t.geometry.deleteAttribute(e)}),t.geometry.dispose()),t.material&&(Object.keys(t.material).forEach(function(e){t.material[e]&&"function"==typeof t.material[e].dispose&&t.material[e].dispose()}),void 0!==t.material.uniforms&&t.material.uniforms.pointTexture.value.dispose(),t.material.dispose())}
/**
 * @module AxesHelper
 * @description An axis object to visualize the 1, 2 or 3 axes.
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/function Uo(t,f){le(this,Uo);var m,h=Me.THREE,o=this;function e(e){e=f.scales[e];void 0===e.marks&&(e.marks=3),void 0===e.offset&&(e.offset=.1),void 0===e.zoomMultiplier&&(e.zoomMultiplier=1.1)}function d(e){var i,r,a,o,s,l=e;function c(e){return(f.scales.posAxesIntersection[e]-t.position[e])/t.scale[e]}function u(){return.05/Math.max(Math.max(t.scale.x,t.scale.y),t.scale.z)}this.remove=function(){void 0!==o&&(Go(o),l.remove(o),a=r=i=o=void 0)},this.dottedLines=function(e){var n=(s=e)instanceof h.Vector4||s instanceof h.Vector3?s:to(s.object,s.index);if(void 0!==o){e=function(e){var t,o;switch(e){case"x":t=i;break;case"y":t=r;break;case"z":t=a;break;default:return void console.error("AxesHelper.dotLines.dottedLines.dottedLine: axesId = "+axesId)}t&&((o=t.geometry.attributes.position.array)[0]="x"===e?n.x:c("x"),o[1]="y"===e?n.y:c("y"),o[2]="z"===e?n.z:c("z"),o[3]=n.x,o[4]=n.y,o[5]=n.z,o=u(),t.material.dashSize=o,t.material.gapSize=o,t.geometry.attributes.position.needsUpdate=!0)};return e("x"),e("y"),void e("z")}function t(e){if(f.scales[e]){var t=[(new h.Vector3).copy(f.scales.posAxesIntersection),n];t[0].x="x"===e?t[1].x:c("x"),t[0].y="y"===e?t[1].y:c("y"),t[0].z="z"===e?t[1].z:c("z");e=u();void 0===f.colorsHelper&&(f.colorsHelper=128);e=new h.LineSegments((new h.BufferGeometry).setFromPoints(t),new h.LineDashedMaterial({color:"rgb("+f.colorsHelper+", "+f.colorsHelper+", "+f.colorsHelper+")",dashSize:e,gapSize:e}));return e.computeLineDistances(),o.add(e),e}}d.remove(),o=new h.Group,l.add(o),i=t("x"),r=t("y"),a=t("z")},this.update=function(){void 0!==o&&void 0!==s&&this.dottedLines(s)},this.movePointAxes=function(e,t){var o;switch(e){case mathBox.axesEnum.x:o=i;break;case mathBox.axesEnum.y:o=r;break;case mathBox.axesEnum.z:o=a;break;default:return void console.error("point.userData.movePointAxes: invalid axesId: "+e)}void 0!==o&&(o.geometry.attributes.position.array[e+3]=t,i.geometry.attributes.position.array[e]=t,r.geometry.attributes.position.array[e]=t,a.geometry.attributes.position.array[e]=t,i.geometry.attributes.position.needsUpdate=!0,r.geometry.attributes.position.needsUpdate=!0,a.geometry.attributes.position.needsUpdate=!0)}}(f=f||new ko).boOptions?!1!==f.axesHelper&&(f.camera.fov=f.camera.fov||50,f.scales=f.scales||{},f.scales.display=void 0===f.scales.display||f.scales.display,f.scales.color=f.scales.color||"rgba(255, 255, 255, 0.5)",f.scales.text=f.scales.text||{},f.scales.text.textHeight=f.scales.text.textHeight||.04,f.scales.text.precision=f.scales.text.precision||4,f.scales.text.rect=f.scales.text.rect||{},f.scales.text.rect.displayRect=void 0===f.scales.text.rect.displayRect||f.scales.text.rect.displayRect,f.scales.text.rect.borderRadius=void 0!==f.scales.text.rect.borderRadius?f.scales.text.rect.borderRadius:15,e("x"),e("y"),e("z"),this.options=f,(m=new h.Group).userData.optionsSpriteText={fontColor:f.scales.color,textHeight:f.scales.text.textHeight,fov:f.camera.fov,rect:f.scales.text.rect},t.add(m),f.scales.posAxesIntersection=f.scales.posAxesIntersection||new h.Vector3,this.createAxis=function(c){var u=new h.Group;u.visible=f.scales.display;var e=f.scales[c];if(e){var t=f.scales.color,o=1;try{var n=f.scales.color.split(/rgba\(\.*/)[1].split(/\)/)[0].split(/, */),t="rgb("+n[0]+", "+n[1]+", "+n[2]+")";void 0!==n[3]&&(o=n[3])}catch(e){}var i=new h.Line((new h.BufferGeometry).setFromPoints([new h.Vector3("x"===c&&f.scales.x?f.scales.x.min:0,"y"===c&&f.scales.y?f.scales.y.min:0,"z"===c&&f.scales.z?f.scales.z.min:0),new h.Vector3("x"===c&&f.scales.x?f.scales.x.max:0,"y"===c&&f.scales.y?f.scales.y.max:0,"z"===c&&f.scales.z?f.scales.z.max:0)]),new h.LineBasicMaterial({color:t,opacity:o,transparent:!0}));if("x"!==c&&(i.position.x=f.scales.posAxesIntersection.x),"y"!==c&&(i.position.y=f.scales.posAxesIntersection.y),"z"!==c&&(i.position.z=f.scales.posAxesIntersection.z),i.add(u),i.userData.axisName=c,m.add(i),void 0!==e.marks)for(var r=function(r){r=r||new h.Vector3(0,0,0);var a=new h.Sprite(new h.SpriteMaterial({map:new h.Texture,sizeAttenuation:!1})),s=document.createElement("canvas");a.material.map.minFilter=h.LinearFilter;var l=s.getContext("2d");return function(){var e=new h.Vector2("y"!==c?.5:0,"y"===c?.5:1);function t(){return void 0!==f.scales.text.precision?o.toPrecision(f.scales.text.precision):o.toString()}l.fillStyle=f.scales.color,l.fillRect(0,0,s.width,s.height),a.material.map.image=s,a.material.map.needsUpdate=!0,"y"===c?(a.scale.x=s.width/s.height*3/s.width,a.scale.y=1/s.height):(a.scale.x=1/s.width,a.scale.y=3/s.height),a.scale.x*=f.camera.fov/100,a.scale.y*=f.camera.fov/100,a.position.copy(r),a.center=e,a.material.sizeAttenuation=!1,a.material.needsUpdate=!0;var o="x"===c?r.x:"y"===c?r.y:r.z;function n(){var e=(.013-.05)/15;return-3*(t().length*e+.054933333333333334)}var i=new Co(t(),new h.Vector3(r.x,r.y,r.z),{group:u,rotation:"y"===c?0:-Math.PI/2,center:new h.Vector2(n(),"x"===c?1:0)});i.userData.updatePrecision=function(){i.userData.updateText(o.toPrecision(f.scales.text.precision)),i.center.x=n()},u.add(i)}(),a},a=e.max,s=e.min,l=(a-s)/(e.marks-1),d=0;d<e.marks;d++){var p=d*l+s;u.add(new r(new h.Vector3("x"===c?p:0,"y"===c?p:0,"z"===c?p:0)))}a={center:new h.Vector2("y"===c?1.1:-.1,"y"===c?0:-.1),group:u};e.name=e.name||c,u.add(new Co(e.name,new h.Vector3("x"===c?e.max:0,"y"===c?e.max:0,"z"===c?e.max:0),a)),u.add(new Co(e.name,new h.Vector3("x"===c?e.min:0,"y"===c?e.min:0,"z"===c?e.min:0),a))}},this.createAxis("x"),this.createAxis("y"),this.createAxis("z"),0===m.children.length&&console.warn("AxesHelper: Define at least one axis."),d=new d(t),this.exposePosition=function(e){void 0!==e?d.dottedLines(e):d.remove()},this.getGroup=function(){return m},this.updateAxes=function(){function e(t){m.children.forEach(function(e){e.userData.axisName===t&&(m.remove(e),o.createAxis(t))})}e("x"),e("y"),e("z"),d.update()},f.axesHelper=this):console.error("AxesHelper: call options = new Options( options ) first")}
/**
 * @module SpriteTextGui
 * @description Adds SpriteText settings folder into {@link https://github.com/anhr/dat.gui|dat.gui}.
 * @see {@link https://github.com/anhr/SpriteText|SpriteText}
 *
 * @author Andrej Hristoliubov. {@link https://anhr.github.io/AboutMe/|AboutMe}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/
function Xo(t,e,o
/**
 * @module AxesHelperGui
 * @description Adds <a href="../../AxesHelper/jsdoc/module-AxesHelper-AxesHelper.html" target="_blank">AxesHelper</a> settings folder into {@link https://github.com/anhr/dat.gui|dat.gui}.
 * @see {@link https://github.com/anhr/AxesHelper|AxesHelper}
 *
 * @author {@link https://anhr.github.io/AboutMe/|Andrej Hristoliubov}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/){var n=2<arguments.length&&void 0!==o?o:{};e.boOptions||(e=new ko(e));var i=n.folder||e.dat.gui;if(i&&!1!==e.dat.spriteTextGui){var r=n.optionsSpriteText||t.userData.optionsSpriteText||{},a=Me.THREE,s=Me.dat;0===Object.keys(r).length&&console.warn("SpriteTextGui: optionsSpriteText is empty."),a.Color.NAMES[r.fontColor]&&(o=new a.Color(r.fontColor),r.fontColor="rgba("+255*o.r+","+255*o.g+","+255*o.b+",1)");var l=JSON.parse(JSON.stringify(r));Object.freeze(l);var c={spriteText:"Sprite Text",spriteTextTitle:"Settings for text that always faces towards the camera.",text:"Text",textTitle:"The text to be displayed on the sprite.",textHeight:"Height",textHeightTitle:"Text Height.",fontFace:"Font Face",fontFaces:"Font Faces",fontFaceTitle:"Choose text font.",bold:"Bold",italic:"Italic",rotation:"Rotation",rotationTitle:"Sprite rotation",fontProperties:"Font Properties",fontPropertiesTitle:"Other font properties. The font property uses the same syntax as the CSS font property.",fontStyle:"Font Style",fontStyleTitle:"Text style being used when drawing text. Read only.",displayRect:"Border",displayRectTitle:"Display a border around the text.",borderColor:"Border Color",backgroundColor:"Background Color",borderRadius:"Border Radius",borderThickness:"Border Thickness",fontColor:"Font Color",anchor:"Anchor",anchorTitle:"The text anchor point.",sizeAttenuation:"Size Attenuation",sizeAttenuationTitle:"Whether the size of the sprite is attenuated by the camera depth. (Perspective camera only.)",defaultButton:"Default",defaultTitle:"Restore default Sprite Text settings."};switch(e.getLanguageCode()){case"ru":c.spriteText=" ",c.spriteTextTitle="  ,     .",c.text="",c.textTitle=",     .",c.textHeight="",c.textHeightTitle=" .",c.fontFace=" ",c.fontFaces=" ",c.fontFaceTitle="  .",c.bold="",c.italic="",c.rotation="",c.rotationTitle="  ",c.fontProperties="",c.fontPropertiesTitle="  .      ,     CSS.",c.fontStyle=" ",c.fontStyleTitle=" ,    .  .",c.displayRect="",c.displayRectTitle="   .",c.borderColor=" ",c.backgroundColor=" ",c.borderRadius=" ",c.borderThickness=" ",c.fontColor=" ",c.anchor="",c.anchorTitle="  .",c.sizeAttenuation="",c.sizeAttenuationTitle="        . (  .)",c.defaultButton="",c.defaultTitle="     .";break;default:if(void 0===n.lang||n.lang.languageCode!=_languageCode)break;Object.keys(n.lang).forEach(function(e){void 0!==c[e]&&(c[e]=n.lang[e])})}n.spriteFolder=n.spriteFolder||c.spriteText;var u=e.dat.getCookieName("SpriteText"),d=e.dat.cookie,e=r.group;d.getObject(u,r,r),r.group=e,t instanceof a.Sprite!=!0&&(void 0===t.userData.optionsSpriteText?t.userData.optionsSpriteText=r:void 0!==n.optionsSpriteText&&console.warn("SpriteTextGui: duplicate group.userData.optionsSpriteText"));var p=!0;n.hasOwnProperty("parentFolder")||(n.parentFolder=i);var f=n.parentFolder.addFolder(n.spriteFolder);s.folderNameAndTitle(f,n.spriteFolder,c.spriteTextTitle);i="textHeight";r.hasOwnProperty(i)&&void 0!==r[i]&&function(e,t,o,n,i){i=i||{};var r=Me.dat,a=e.add(new Le(function(e,t){t=t(s.getValue(),a.getValue());s.setValue(t),n(t)},{getLanguageCode:i.getLanguageCode,settings:i.settings})).onChange(function(e){a.zoomMultiplier=e}),s=r.controllerZeroStep(e,t,o,function(e){n(e)});i.text&&r.controllerNameAndTitle(s,i.text,i.textTitle)}(f,r,i,function(){v()},{text:c.textHeight,textTitle:c.textHeightTitle,getLanguageCode:n.getLanguageCode,settings:n.settings}),void 0!==r.fontFace&&s.controllerNameAndTitle(f.add(r,"fontFace").onChange(function(e){v()}),c.fontFace),void 0!==r.fontFaces&&s.controllerNameAndTitle(f.add(r,"fontFace",r.fontFaces).onChange(function(e){v()}),c.fontFaces,c.fontFaceTitle),r.hasOwnProperty("bold")&&s.controllerNameAndTitle(f.add(r,"bold").onChange(function(e){v()}),c.bold),r.hasOwnProperty("italic")&&s.controllerNameAndTitle(f.add(r,"italic").onChange(function(e){v()}),c.italic);var m,h,g,i="rotation";r.hasOwnProperty(i)&&(g=2*Math.PI,s.controllerNameAndTitle(f.add(r,i,0,g,g/360).onChange(function(e){v()}),c.rotation,c.rotationTitle)),r.hasOwnProperty("fontProperties")&&s.controllerNameAndTitle(f.add(r,"fontProperties").onChange(function(e){v()}),c.fontProperties,c.fontPropertiesTitle),r.hasOwnProperty("font")&&((m=f.add(r,"font")).__input.readOnly=!0,s.controllerNameAndTitle(m,c.fontStyle,c.fontStyleTitle)),r.hasOwnProperty("rect")&&(void 0===r.rect.displayRect&&(r.rect.displayRect=!1),s.controllerNameAndTitle(f.add(r.rect,"displayRect").onChange(function(e){v(),h.domElement.style.display=r.rect.displayRect?"block":"none"}),c.displayRect,c.displayRectTitle),(h=f.addFolder(c.displayRect)).domElement.style.display=r.rect.displayRect?"block":"none",g="borderThickness",r.rect.hasOwnProperty(g)&&s.controllerNameAndTitle(h.add(r.rect,g,1,30*r.rect.borderThickness,1).onChange(function(e){v()}),c.borderThickness),g="borderColor",r.rect.hasOwnProperty(g)&&s.controllerNameAndTitle(h.addColor(r.rect,g).onChange(function(e){v()}),c.borderColor),g="backgroundColor",r.rect.hasOwnProperty(g)&&s.controllerNameAndTitle(h.addColor(r.rect,g).onChange(function(e){v()}),c.backgroundColor),g="borderRadius",r.rect.hasOwnProperty(g)&&s.controllerNameAndTitle(h.add(r.rect,g,0,100,1).onChange(function(e){v()}),c.borderRadius)),r.hasOwnProperty("fontColor")&&s.controllerNameAndTitle(f.addColor(r,"fontColor").onChange(function(e){v()}),c.fontColor),r.hasOwnProperty("center")&&(r.center=Co.getCenter(r.center),y=f.addFolder("center"),s.folderNameAndTitle(y,c.anchor,c.anchorTitle),y.add(r.center,"x",0,1,.1).onChange(function(e){v()}),y.add(r.center,"y",0,1,.1).onChange(function(e){v()}));var y="sizeAttenuation";r.hasOwnProperty(y)&&void 0!==r[y]&&s.controllerNameAndTitle(f.add(r,y).onChange(function(e){v()}),c.sizeAttenuation,c.sizeAttenuationTitle),f.userData={restore:function(e){function n(e,o,n){e.__controllers.forEach(function(t){return t.property!==o?"object"!==se(n[o])?void 0:void Object.keys(n[o]).forEach(function(e){t.property===e&&t.setValue(n[o][e])}):void t.setValue(n[o])})}p=!1,Object.keys(l).forEach(function(o){n(f,o,l),"object"===se(l[o])&&Object.keys(l[o]).forEach(function(t){Object.keys(f.__folders).forEach(function(e){n(f.__folders[e],t,l[o])})}),Object.keys(f.__folders).forEach(function(t){t===o&&Object.keys(l[t]).forEach(function(e){n(f.__folders[t],e,l[t])})})}),p=!0,v()}};y={defaultF:f.userData.restore};return void 0===l&&console.error("SpriteTextGui: optionsDefault = "+l),s.controllerNameAndTitle(f.add(y,"defaultF"),c.defaultButton,c.defaultTitle),v(!0),f}function v(e){p&&(Co.updateSpriteTextGroup(t),t.userData.update&&t.userData.update(),void 0!==m&&m.setValue(r.font),e||d.setObject(u,r))}}function qo(l,e){if(l.boOptions){if((e=e||l.dat.gui)&&l.axesHelper&&!1!==l.dat&&!1!==l.dat.axesHelperGui){var o=Me.THREE,c=Me.dat,u=JSON.parse(JSON.stringify(l.scales)),d=l.axesHelper.getGroup();Object.freeze(u);var p={axesHelper:"Axes Helper",scales:"Scales",displayScales:"Display",displayScalesTitle:"Display or hide axes scales.",precision:"Precision",precisionTitle:"Formats a number to a specified length.",min:"Min",max:"Max",marks:"Marks",marksTitle:"Number of scale marks",axesIntersection:"Axes Intersection",defaultButton:"Default",defaultTitle:"Restore default Axes Helper settings.",defaultAxesIntersectionTitle:"Restore default axes intersection."};switch((l=l||{}).getLanguageCode()){case"ru":p.axesHelper=" ",p.scales="",p.displayScales="",p.displayScalesTitle="     .",p.precision="",p.precisionTitle="    .",p.min="",p.max="",p.marks="",p.marksTitle="   ",p.axesIntersection=" ",p.defaultButton="",p.defaultTitle="     .",p.defaultAxesIntersectionTitle="    .";break;default:if(void 0===l.lang||l.lang.languageCode!=languageCode)break;Object.keys(l.lang).forEach(function(e){void 0!==p[e]&&(p[e]=l.lang[e])})}var t=l.dat.cookie,n=l.dat.getCookieName("AxesHelper");t.getObject(n,l.scales,l.scales);var i,f=e.addFolder(p.axesHelper),e=f.addFolder(p.scales),r=e.add(l.scales,"display").onChange(function(t){d.children.forEach(function(e){e.children.forEach(function(e){e.visible=t})}),b(),g()});c.controllerNameAndTitle(r,p.displayScales,p.displayScalesTitle),void 0!==l.scales.text.precision&&(i=e.add(l.scales.text,"precision",2,17,1).onChange(function(e){!function t(e){e.children.forEach(function(e){e instanceof o.Sprite?void 0!==e.userData.updatePrecision&&e.userData.updatePrecision():(e instanceof o.Group||e instanceof o.Line)&&t(e)})}(d),g()}),c.controllerNameAndTitle(i,p.precision,p.precisionTitle));var a=void 0===Xo?void 0:Xo(d,{dat:{gui:l.dat.gui,cookieName:"AxesHelper_"+l.dat.getCookieName()}},{parentFolder:e}),s=f.addFolder(p.axesIntersection),m={x:{},y:{},z:{}};y("x"),y("y"),y("z");e={defaultF:function(e){m.x.controller.setValue(u.posAxesIntersection.x),m.y.controller.setValue(u.posAxesIntersection.y),m.z.controller.setValue(u.posAxesIntersection.z)}};c.controllerNameAndTitle(s.add(e,"defaultF"),p.defaultButton,p.defaultAxesIntersectionTitle),f.add(new Le(function(e,t){function o(e,t){void 0!==e&&(e.min=i(e.min,n),t.min.setValue(e.min),e.max=i(e.max,n),t.max.setValue(e.max),t.onchangeWindowRange())}var n,i;n=e.controller.getValue(),i=t,o(l.scales.x,h.x),o(l.scales.y,h.y),o(l.scales.z,h.z)},{settings:{zoomMultiplier:1.1},getLanguageCode:l.getLanguageCode})).onChange(function(e){console.warn("ScaleController.onChange")});var h={x:{},y:{},z:{}};v("x"),v("y"),v("z");e={defaultF:function(e){function t(e){h[e].defaultButton&&h[e].defaultButton.object.defaultF()}r.setValue(u.display),void 0!==i&&i.setValue(u.text.precision),a.userData.restore(),t("x"),t("y"),t("z")}};c.controllerNameAndTitle(f.add(e,"defaultF"),p.defaultButton,p.defaultTitle),b(),h.x.updateAxis&&h.x.updateAxis(),h.y.updateAxis&&h.y.updateAxis(),h.z.updateAxis&&h.z.updateAxis()}}else console.error("MoveGroupGui: call options = new Options( options ) first");function g(){t.setObject(n,l.scales)}function y(t){var e,o=l.scales[t];void 0!==o&&((e=m[t]).controller=s.add({value:l.scales.posAxesIntersection[t]},"value",o.min,o.max,(o.max-o.min)/100).onChange(function(e){l.scales.posAxesIntersection[t]=e,l.axesHelper.updateAxes(),g()}),c.controllerNameAndTitle(e.controller,o.name))}function v(t){var o,n,e,i=l.scales[t];function r(){d.children.forEach(function(e){e.userData.axisName===t&&(d.remove(e),l.axesHelper.createAxis(t))})}function a(){r(),g()}function s(e,t){e=e.controller.getValue();i.min=t(i.min,e),o.min.setValue(i.min),i.max=t(i.max,e),o.max.setValue(i.max),a()}void 0!==i&&(o=h[t],n=u[t],Object.freeze(n),o.updateAxis=r,o.onchangeWindowRange=a,o.folder=f.addFolder(i.name),o.scaleController=o.folder.add(new Le(s,{settings:i,getLanguageCode:l.getLanguageCode})).onChange(function(e){i.zoomMultiplier=e,g()}),e=new De(function(o){s(e,function(e,t){return e+=o})},{settings:i,getLanguageCode:l.getLanguageCode}),o.positionController=o.folder.add(e).onChange(function(e){i.offset=e,g()}),o.min=c.controllerZeroStep(o.folder,i,"min",function(e){a()}),c.controllerNameAndTitle(o.min,p.min),o.max=c.controllerZeroStep(o.folder,i,"max",function(e){a()}),c.controllerNameAndTitle(o.max,p.max),void 0!==i.marks&&(o.marks=c.controllerZeroStep(o.folder,i,"marks",function(e){a()}),c.controllerNameAndTitle(o.marks,void 0===i.marksName?p.marks:i.marksName,(void 0===i.marksTitle?p:i).marksTitle)),o.defaultButton=o.folder.add({defaultF:function(e){i.min=n.min,o.min.setValue(i.min),i.max=n.max,o.max.setValue(i.max),i.zoomMultiplier=n.zoomMultiplier,o.scaleController.setValue(i.zoomMultiplier),i.offset=n.offset,o.positionController.setValue(i.offset),void 0!==n.marks&&(i.marks=n.marks,o.marks.setValue(i.marks)),a()}},"defaultF"),c.controllerNameAndTitle(o.defaultButton,p.defaultButton,p.defaultTitle))}function b(){var e=l.scales.display?"block":"none";void 0!==a&&(a.domElement.style.display=e),void 0!==i&&(i.domElement.parentElement.parentElement.style.display=e)}}
/**
 * @module OrbitControlsGui
 * @description [OrbitControls]{@link https://threejs.org/docs/index.html#examples/en/controls/OrbitControls} graphical user interface
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function Wo(t,e){if(le(this,Wo),t.boOptions){if((e=e||t.dat.gui)&&t.orbitControls&&!1!==t.dat.orbitControlsGui){var i=Me.dat,r=t.orbitControls;t.orbitControlsGui=this,r.addEventListener("change",function(){c&&c.setValue(r.target.x),u&&u.setValue(r.target.y),d&&d.setValue(r.target.z)});var a={orbitControls:"Orbit Controls",defaultButton:"Default",defaultTitle:"Restore default Orbit controls settings.",target:"Target"},o=void 0===t.getLanguageCode?"en":t.getLanguageCode();switch(o){case"ru":a.defaultButton="",a.defaultTitle="  Orbit controls  .";break;default:if(void 0===t.lang||t.lang.languageCode!=o)break;Object.keys(t.lang).forEach(function(e){void 0!==a[e]&&(a[e]=t.lang[e])})}var n=e.addFolder(a.orbitControls),s=t.scales.x?n.addFolder(t.scales.x.name):void 0,l=t.scales.y?n.addFolder(t.scales.y.name):void 0,e=t.scales.z?n.addFolder(t.scales.z.name):void 0,c=p(s,"x"),u=p(l,"y"),d=p(e,"z");i.controllerNameAndTitle(n.add({defaultF:function(e){r.reset(),c.setValue(r.target.x),u.setValue(r.target.y),d.setValue(r.target.z)}},"defaultF"),a.defaultButton,a.defaultTitle),this.setTarget=function(e){c.setValue(e.x),u.setValue(e.y),d.setValue(e.z)}}}else console.error("OrbitControlsGui: call options = new Options( options ) first");function p(e,t){if(e){e.add(new De(function(e){n(r.target[t]+e)}));var o=i.controllerZeroStep(e,r.target,t,function(e){n(e)});return i.controllerNameAndTitle(o,a.target),i.controllerNameAndTitle(e.add({defaultF:function(e){n()}},"defaultF"),a.defaultButton,a.defaultTitle),o}function n(e){void 0===e&&(e=0),r.target[t]=e,r.update(),o.setValue(e)}}}var Yo;
/**
 * Modify of the dat object.
 * @see {@link https://github.com/dataarts/dat.gui} about dat.gui
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function Zo(){}void 0!==Zo&&(Yo=function(e,t,o){void 0===t&&console.warn("elNameAndTitle: name = "+t),e.innerHTML=t,void 0!==o&&(e.title=o)},Zo.GUI=g,void 0===Zo.controllerNameAndTitle?Zo.controllerNameAndTitle=function(e,t,o){Yo(e.__li.querySelector(".property-name"),t,o)}:console.error("Duplicate dat.controllerNameAndTitle method."),void 0===Zo.folderNameAndTitle?Zo.folderNameAndTitle=function(e,t,o){Yo(e.__ul.querySelector("li.title"),t,o)}:console.error("Duplicate dat.folderNameAndTitle method."),void 0===Zo.controllerZeroStep?Zo.controllerZeroStep=function(e,o,n,i){"number"!=typeof o[n]&&console.warn("typeof object[property] = "+se(o[n]));var e=e.add(o,n),r=e.__input;return e.__input=document.createElement("input"),r.value=o[n],r.onchange=function(e){o[n]=parseFloat(r.value),void 0!==i&&i(o[n])},e.setValue=function(e,t){r.value=o[n]=e,t&&i&&i(o[n])},e}:console.error("Duplicate dat.controllerZeroStep method."),void 0===Zo.controllerSetValue?Zo.controllerSetValue=function(e,t){e.setValue(t),e.__li.querySelector("select").selectedIndex=t}:console.error("Duplicate dat.controllerSetValue method.")
/**
 * @module functionsFolder
 * @description Adds the [Functions]{@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function} folder into [dat.gui]{@link https://github.com/anhr/dat.gui}.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */);function Jo(e,s,r,o){if(le(this,Jo),r.boOptions){var n=Me.dat,l=Me.THREE,t=r.scales,c=this,u=!1,d=!1,i={functions:"Functions",defaultButton:"Default",defaultTitle:"Restore default functions."},a=void 0===r.getLanguageCode?"en":r.getLanguageCode();switch(a){case"ru":i.functions="",i.defaultButton="",i.defaultTitle=" .";break;default:if(void 0===r.lang||r.lang.languageCode!=a)break;Object.keys(r.lang).forEach(function(e){void 0!==i[e]&&(i[e]=r.lang[e])})}o?(o.x=v(o.x),o.y=v(o.y),o.z=v(o.z)):o={x:"",y:"",z:""};var p=e.addFolder(i.functions),f={x:o.x,y:o.y,z:o.z,w:o.w},m={};g("x"),g("y"),g("z"),g("w");var h=p.add({defaultF:function(e){}},"defaultF");n.controllerNameAndTitle(h,i.defaultButton,i.defaultTitle),this.setFunction=function(o){var e,n,t;function i(t){void 0!==o[t]&&(m[t].__onFinishChange=function(e){b(e,t,n)},e[t]=v(o[t]),m[t].setValue(e[t]),n[t]=e[t])}(o=o||r.vector)&&(e={x:o?v(o.x):"",y:o?v(o.y):"",z:o?v(o.z):"",w:o?v(o.w):""},n={x:e.x,y:e.y,z:e.z,w:e.w},o.vectorDefault||(o.vectorDefault={x:e.x,y:e.y,z:e.z,w:e.w}),i("x"),i("y"),t=!1,o.z&&(i("z"),t=!0),h.object.defaultF=function(e){function t(e){m[e]&&(m[e].setValue(o.vectorDefault[e]),m[e].__onFinishChange(o.vectorDefault[e]))}t("x"),t("y"),t("z"),t("w")},function(e,t){if(void 0!==e){"boolean"==typeof t&&(t=t?"block":"none");for(var o=e.domElement;"LI"!==o.tagName.toUpperCase();)o=o.parentElement;o.style.display=t}}(m.z,t),i("w"))},this.setFunction(),this.displayFolder=function(e){p.domElement.style.display="boolean"==typeof e?e?"block":"none":e},this.setFocus=function(e){m[e].domElement.childNodes[0].focus(),u=!0}}else console.error("functionsFolder: call options = new Options( options ) first");function g(t){void 0!==o[t]&&(m[t]=p.add(o,t).onFinishChange(function(e){b(e,t,f)}),n.controllerNameAndTitle(m[t],y(t)))}function y(e){return t[e]&&t[e].name?t[e].name:e}function v(e){if(void 0!==e){if("object"===(void 0===e?"undefined":se(e))){if(e instanceof l.Color)return e.getStyle();if(Array.isArray(e))return JSON.stringify(e);e=e.func||e}var t=void 0===e?"undefined":se(e);switch(t){case"number":e=e.toString();case"string":return e;case"function":return e.toString().split(/return (.*)/)[1];default:return void console.error("functionsFolder.getFuncText(...): typeof func = "+t)}}}function b(t,o,e){if(e[o]!==t||u)try{var n;u=!1;var i=void 0===(e[o]=t)?"undefined":se(t);switch(i){case"string":var r,a=parseFloat(t);if(a.toString()!==t)if(5===t.replace(/\s/g,"").split(/rgb\((\d+),(\d+),(\d+)\)/).length)n=new l.Color(t);else{try{r=JSON.parse(t)}catch(e){}n=Array.isArray(r)?r:new Function("t","a","b","return "+t)}else n=a;break;case"number":n=t;break;default:return void console.error("onFinishChange( "+t+" ): invalid type = "+i)}s(n,o),d=!1}catch(e){d||(alert("Axis: "+y(o)+'. Function: "'+t+'". '+e),d=!0),c.setFocus(o)}}}function Ko(g){var y=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};le(this,Ko);var v=g.axesHelper,n=this,b=Me.THREE;if(g.boOptions){if(!1===g.dat.guiSelectPoint||!g.dat.gui)return this.add=function(e){},this.addMesh=function(e){},void(this.select=function(e){});var _,x=Me.dat;g.guiSelectPoint=n;var w=g.getLanguageCode,C={meshs:"Meshes",notSelected:"Not selected",select:"Select",position:"Position",rotation:"Rotation",points:"Points",cameraTarget:"Look",cameraTargetTitle:"Choose this point the camera is looking at.",point:"Point Local Position",pointTitle:"The position attribute of the selected point",trace:"Trace",traceTitle:"Display the trace of the point movement.",traceAllTitle:"Display the trace of the movement of all points of the mesh.",pointWorld:"Point World Position",pointWorldTitle:"The position of the selected point after scaling, moving and rotation of the mesh",mesh:"Mesh",scale:"Scale",color:"olor",opacity:"Opacity",opacityTitle:"Float in the range of 0.0 - 1.0 indicating how transparent the material is. A value of 0.0 indicates fully transparent, 1.0 is fully opaque.",defaultButton:"Default",defaultScaleTitle:"Restore default 3d object scale.",defaultPositionTitle:"Restore default 3d object position.",default3DObjectTitle:"Restore default settings of all 3d objects.",defaultRotationTitle:"Restore default 3d object rotation.",defaultLocalPositionTitle:"Restore default local position.",moveGroup:"Move Scene"},e=w();switch(e){case"ru":C.meshs="3D ",C.notSelected=" ",C.select="",C.position="",C.rotation="",C.points="",C.cameraTarget="",C.cameraTargetTitle="  ,    .",C.point="  ",C.pointTitle="Position attribute  ",C.trace="",C.traceTitle="   .",C.traceAllTitle="      3D .",C.pointWorld="  ",C.pointWorldTitle="    ,    3D ",C.mesh="3D ",C.scale="",C.color="",C.opacity="",C.opacityTitle="   0,0 - 1,0, ,   .  0.0   , 1.0 -  .",C.defaultButton="",C.defaultScaleTitle="  3D   .",C.defaultPositionTitle="  3D   .",C.default3DObjectTitle="   3D   .",C.defaultRotationTitle="  3D   .",C.defaultLocalPositionTitle="     .";break;default:if(void 0===y.lang||y.lang.languageCode!=e)break;Object.keys(y.lang).forEach(function(e){void 0!==C[e]&&(C[e]=y.lang[e])})}var T,E,S,A,O,k,P,z,M,L,F,D,N,R,V,j,I,H,B,G,U,X,d,q=!1,W=this,Y=new b.Vector3,Z=new b.Vector3,J=new b.Vector3;g.frustumPoints&&(_=new g.frustumPoints.guiSelectPoint),this.setMesh=function(){q=!0,ne(),ie(),re(),ee(),q=!1},this.setPosition=function(e){for(var t=0;t<k.__select.length;t++){var o=k.__select[t];o.selected&&Object.is(o.mesh,e.object)&&i(e)}},this.update=function(){var e,t=k.__select.options[k.__select.options.selectedIndex].mesh;!t||-1!==(e=this.getSelectedPointIndex())&&(e=to(t,e),J.x.setValue(e.x),J.y.setValue(e.y),J.z.setValue(e.z))},this.getMeshIndex=function(e){if(void 0===e)return e;for(var t=0;t<k.__select.options.length;t++){var o=k.__select.options[t];if(Object.is(o.mesh,e))return t}},this.setIndexMesh=function(e,t){void 0!==e&&(k.__select.options[e].mesh=t,this.selectPoint(-1))},this.selectPoint=function(e){D.__onChange(e),D.__select[e+1].selected=!0},this.removeMesh=function(e){var t=this.getMeshIndex(e),e=k.__select.selectedIndex;k.__select.remove(t),e===t&&(D.__onChange(-1),W.removePoints())};var K=[];return this.addMesh=function(e){if(e.parent)if(k){for(n=0;n<k.__select.options.length;n++){var t=k.__select.options[n];if(e.userData.boFrustumPoints&&void 0!==t.mesh&&t.mesh.userData.boFrustumPoints)return;if(void 0!==t.mesh&&t.mesh.uuid===e.uuid)return void console.error("guiSelectPoint.addMesh(...): Duplicate mesh.")}var o=document.createElement("option");o.innerHTML=k.__select.length+" "+(""===e.name?e.constructor:e).name,(o.mesh=e).userData.default=e.userData.default||{scale:(new b.Vector3).copy(e.scale),position:e.position instanceof b.Vector3?(new b.Vector3).copy(e.position):e.position instanceof b.Vector4?(new b.Vector4).copy(e.position):void 0,rotation:(new b.Euler).copy(e.rotation)},k.__select.appendChild(o)}else{for(var n=0;n<K.length;n++)if(K[n].uuid===e.uuid)return void console.error("guiSelectPoint.addMesh: Duplicate mesh: "+e.name);K.push(e)}},this.select=function(t){$t(t.object,t.index);void 0===T&&console.error("    ");var e=this.getMeshIndex(t.object);e&&(!1===k.__select[e].selected&&(k.__select[e].selected=!0,k.__onChange(e-1)),this.selectPoint2=function(e){void 0===t.index||isNaN(t.index)||void 0!==e&&!Object.is(t.object,e)||(t.object.userData.boFrustumPoints?_.pointIndexes(t.object.userData.pointIndexes(t.index)):D.__select[t.index+1].selected=!0,Q("block"),z=t,y.setIntersection&&y.setIntersection(t),i(t),e=(e=oe()).userData.player&&void 0!==e.userData.player.arrayFuncs&&"function"!=typeof z.object.userData.player.arrayFuncs?e.userData.player.arrayFuncs[t.index].line:void 0,I&&I.setValue(void 0!==e&&e.isVisible()),S.domElement.parentElement.parentElement.style.display=z.object.userData.player&&void 0!==z.object.userData.player.arrayFuncs?"block":"none")},this.selectPoint2(void 0))},this.isSelectedMesh=function(e){return oe()===e},this.getSelectedPointIndex=function(){if(void 0!==_&&_.isDisplay()&&g.frustumPoints&&g.frustumPoints.isDisplay()){var e=_.getSelectedIndex();return null===e?-1:e}return void 0===D?-1:D.__select.selectedOptions[0].index-1},this.add=function(e){if(e=e||g.dat.gui){var d,p,f,m;T=e.addFolder(C.meshs),k=T.add({Meshs:C.notSelected},"Meshs",ce({},C.notSelected,-1)).onChange(function(e){if(e=parseInt(e),d=oe(),!d.userData.boFrustumPoints&&(d.userData.player||(d.userData.player={}),!d.userData.player.arrayFuncs)){var t=d.geometry.attributes.position;d.userData.player.arrayFuncs=[];for(var o=0;o<t.count;o++){var n=(new b.Vector4).fromArray(d.geometry.attributes.position.array,o*t.itemSize);n.w=1,d.userData.player.arrayFuncs.push(n)}}var i="none",r="block";if(void 0===d)s=i,(d=void 0)!==v&&v.exposePosition(to(oe(),e));else{var a=void 0===d.userData.default?i:r;p.domElement.parentElement.parentElement.style.display=a,f.domElement.parentElement.parentElement.style.display=a,m.domElement.parentElement.parentElement.style.display=a;var s=r,e=i,a=r;if(D.__onChange(-1),W.removePoints(),void 0!==d.userData.controllers)d.userData.controllers();else if(e=r,a=i,d.geometry.attributes)for(var l=0;l<d.geometry.attributes.position.count;l++){var c=document.createElement("option"),u=d.userData.player&&d.userData.player.arrayFuncs?d.userData.player.arrayFuncs[l].name:"";c.innerHTML=l+(void 0===u?"":" "+u),c.setAttribute("value",l),D.__select.appendChild(c)}$(D,e),H&&$(H,!!g.player&&e),void 0!==_&&_.display(a),ne(),ie(),re(),h=void 0}P.domElement.style.display=s,void 0!==d&&void 0!==d.userData.traceAll&&H.setValue(d.userData.traceAll)}),x.controllerNameAndTitle(k,C.select),(P=T.addFolder(C.mesh)).domElement.style.display="none",P.open();var t=P.addFolder(C.scale);t.add(new Le(function(e,t){e=e.controller.getValue();d.scale.x=t(d.scale.x,e),d.scale.y=t(d.scale.y,e),d.scale.z=t(d.scale.z,e),d.needsUpdate=!0,ne(),ee(),g.frustumPoints&&g.frustumPoints.updateCloudPoint(d)},{settings:{zoomMultiplier:1.1},getLanguageCode:w}));e=new b.Vector3;g.scales.x&&(M=x.controllerZeroStep(t,e,"x",function(e){o("x",e)}),x.controllerNameAndTitle(M,g.scales.x.name)),g.scales.y&&(L=x.controllerZeroStep(t,e,"y",function(e){o("y",e)}),x.controllerNameAndTitle(L,g.scales.y.name)),g.scales.z&&(F=x.controllerZeroStep(t,e,"z",function(e){o("z",e)}),x.controllerNameAndTitle(F,g.scales.z.name)),p=t.add({defaultF:function(e){d.scale.copy(d.userData.default.scale),d.needsUpdate=!0,ne(),ee()}},"defaultF"),x.controllerNameAndTitle(p,C.defaultButton,C.defaultScaleTitle);var i=P.addFolder(C.position);r("x"),r("y"),r("z"),f=i.add({defaultF:function(e){d.position.copy(d.userData.default.position),d.needsUpdate=!0,ie(),ee()}},"defaultF"),x.controllerNameAndTitle(f,C.defaultButton,C.defaultPositionTitle);var h,l,n=P.addFolder(C.rotation);for(a("x"),a("y"),a("z"),m=n.add({defaultF:function(e){d.rotation.copy(d.userData.default.rotation),d.needsUpdate=!0,re(),ee()}},"defaultF"),x.controllerNameAndTitle(m,C.defaultButton,C.defaultRotationTitle),O=P.addFolder(C.points),(D=O.add({Points:C.notSelected},"Points",ce({},C.notSelected,-1)).onChange(function(e){var t;-1===(e=parseInt(e))?t="none":(t="block",W.select({object:oe(),index:e})),!1!==v&&void 0!==v&&v.exposePosition(to(oe(),e)),Q(t)})).__select[0].selected=!0,x.controllerNameAndTitle(D,C.select),void 0!==_&&_.create(O,w()),y.myThreejs&&(y.myThreejs.cFrustumPoints=_),g.player&&(y.cameraTarget&&g.playerOptions.cameraTarget.init(y.cameraTarget,g),(l=g.playerOptions.cameraTarget.get())&&(U=O.add(l,"boLook").onChange(function(e){var t=oe();if(t.userData.boFrustumPoints)e&&(console.warn("guiSelectPoint.cCameraTarget.onChange(...). The camera can not look at the frustum point."),U.setValue(!1));else{if(!t.userData.player){t.userData.player={arrayFuncs:[]};for(var o=0;o<t.geometry.attributes.position.count;o++)t.userData.player.arrayFuncs.push((new b.Vector3).fromArray(t.geometry.attributes.position.array,o*t.geometry.attributes.position.itemSize))}for(var n=t.userData.boFrustumPoints?_.getSelectedIndex():D.__select.options.selectedIndex-1,i="function"==typeof t.userData.player.arrayFuncs?(new b.Vector3).fromArray(t.userData.player.arrayFuncs().attributes.position.array,3*n):void 0!==t.userData.player.arrayFuncs?t.userData.player.arrayFuncs[n]:(new b.Vector3).fromArray(t.geometry.attributes.position.array,3*n),o=0;o<k.__select.options.length;o++){var r=k.__select.options[o].mesh;if(r&&r.userData.player&&r.userData.player.arrayFuncs)for(var a=r.userData.player.arrayFuncs,s=0;s<a.length;s++)a[s].cameraTarget&&(a[s].cameraTarget.boLook=!1)}if(i.cameraTarget&&(i.cameraTarget.boLook=e),g.player&&g.player.selectScene(),e)return g.cameraGui&&g.cameraGui.look(),void(i.cameraTarget||(void 0===l.boLook&&(zo.cameraTarget2.boLook=!1),(h=h||{}).target||(h.target=new b.Vector3),g.orbitControls&&h.target.copy(g.orbitControls.target),g.playerOptions.cameraTarget.changeTarget(t,n)));y.cameraTarget&&(y.cameraTarget.camera.userData.cameraTargetPoint=i.cameraTarget),g.orbitControls&&g.orbitControls.reset(),h&&(getCameraTarget()||(zo.orbitControls&&zo.orbitControls.target.copy(h.target),y.cameraTarget.camera.lookAt(h.target),i.cameraTarget=void 0))}}),x.controllerNameAndTitle(U,C.cameraTarget,C.cameraTargetTitle))),E=O.addFolder(C.point),x.folderNameAndTitle(E,C.point,C.pointTitle),A=O.addFolder(C.pointWorld),x.folderNameAndTitle(A,C.pointWorld,C.pointWorldTitle),A.open(),Q("none"),y.pointsControls&&y.pointsControls(O,$,oe),H=O.add({trace:!1},"trace").onChange(function(e){var t=oe();t.userData.traceAll=e;for(var o=0;o<t.geometry.attributes.position.count;o++)ae({object:t,index:o},e,oe);I.setValue(e)}),x.controllerNameAndTitle(H,C.trace,C.traceAllTitle),$(H,g.player),x.controllerNameAndTitle(T.add({defaultF:function(e){for(var t=0;t<k.__select.options.length;t++){var o=k.__select.options[t].mesh;o&&(o.scale.copy(o.userData.default.scale),o.position.copy(o.userData.default.position),o.rotation.copy(o.userData.default.rotation),o.needsUpdate=!0)}ne(),ie(),re(),ee(),g.frustumPoints&&g.frustumPoints.onChangeControls()}},"defaultF"),C.defaultButton,C.default3DObjectTitle),N=c("x"),R=c("y"),V=c("z"),j=c("w"),B=E.addColor({color:"#FFFFFF"},"color").onChange(function(e){var t;s(B)||void 0!==B.userData&&(t=B.userData.intersection,W.setColorAttribute(t.object.geometry.attributes,t.index,e))}),x.controllerNameAndTitle(B,g.scales.w?g.scales.w.name:C.color),G=E.add({opasity:1},"opasity",0,1,.01).onChange(function(e){var t,o;s(G)||void 0===B.userData||void 0!==(o=(t=B.userData.intersection).object).geometry.attributes.ca&&(o.geometry.attributes.ca.array[3+t.index*o.geometry.attributes.ca.itemSize]=e,o.geometry.attributes.ca.needsUpdate=!0)}),x.controllerNameAndTitle(G,C.opacity,C.opacityTitle),I=E.add({trace:!1},"trace").onChange(function(e){ae(z,e,oe)}),x.controllerNameAndTitle(I,C.trace,C.traceTitle),$(I,g.player),y.pointControls&&y.pointControls(E,$,oe,z),J.x=u("x"),J.y=u("y"),J.z=u("z"),S=E.add({defaultF:function(){var e=z.object.userData.player.arrayFuncs[z.index],t=zo.getTime();if(N.setValue("function"==typeof e.x?e.x(t,g.a,g.b):e.x),R.setValue("function"==typeof e.y?e.y(t,g.a,g.b):e.y),V.setValue("function"==typeof e.z?e.z(t,g.a,g.b):void 0===e.z?0:e.z),void 0!==e.w){if(void 0!==e.w.r)B.setValue("#"+new b.Color(e.w.r,e.w.g,e.w.b).getHexString());else{if("function"==typeof e.w)return void te(j,e.w(t));if(e.w.func)return void te(j,e.w.func(t))}parseFloat(e.w)===e.w?te(j,e.w):console.error("Restore default local position: Invalid W axis.")}else B.setValue(B.initialValue),G.setValue(G.initialValue)}},"defaultF"),x.controllerNameAndTitle(S,C.defaultButton,C.defaultLocalPositionTitle),X=new Jo(E,function(e,t){var o=oe(),n=D.__select.options.selectedIndex-1,n=o.userData.player.arrayFuncs[n];n[t]=e;for(var i=o.parent,r=0;i;){if(i.userData.t){r=i.userData.t;break}i=i.parent}var a;o.geometry.attributes.position.itemSize;switch(t){case"x":a=N;break;case"y":a=R;break;case"z":a=V;break;case"w":if(e instanceof b.Color)return void B.setValue("#"+e.getHexString());a=j;break;default:return void console.error("GuiSelectPoint new functionsFolder onFinishChange: axisName = "+t)}te(a,zo.execFunc(n,t,r,g))},g,{x:"",y:"",z:"",w:""});0<K.length;)this.addMesh(K[K.length-1]),K.pop()}function o(e,t){d.scale[e]=t,d.needsUpdate=!0,ee(),g.frustumPoints&&g.frustumPoints.updateCloudPoint(d)}function r(t){var e,o,n=g.scales[t];n&&(e=n.name,(o=i.addFolder(e)).add(new De(function(e){d.position[t]+=e,d.needsUpdate=!0,ie(),ee(),g.frustumPoints&&g.frustumPoints.updateCloudPoint(d)},{getLanguageCode:w})),n=new b.Vector3,Y[t]=x.controllerZeroStep(o,n,t,function(e){e=e,d.position[t]=e,d.needsUpdate=!0,ee()}),x.controllerNameAndTitle(Y[t],e))}function a(o){var e=g.scales[o];e&&(Z[o]=n.add(new b.Vector3,o,0,2*Math.PI,1/360).onChange(function(e){var t=oe();t.userData.boFrustumPoints||(t.rotation[o]=e,t.needsUpdate=!0),q||ee(),void 0!==g.frustumPoints&&g.frustumPoints.updateCloudPoint(t)}),x.controllerNameAndTitle(Z[o],e.name))}function s(e){return e.domElement.querySelector("input").readOnly&&(e.getValue()!==e.initialValue&&void 0===e.boSetValue&&(e.boSetValue=!0,te(e,e.initialValue),e.boSetValue=void 0,e.initialValue=e.getValue()),1)}function c(n){var e,t,o,i;return"w"===n?(t=function(e){var t,o=z.object.geometry.attributes,n=z.index;o.position.itemSize<4||(g.palette&&(t=g.palette.toColor(e,i.__min,i.__max),W.setColorAttribute(o,n,t)),o.position.setW(n,e),g.frustumPoints&&g.frustumPoints.updateCloudPointItem(z.object,z.index))},g.scales.setW(),void 0!==(e=g.scales.w).min&&void 0!==e.max?(i=E.add({value:e.min},"value",e.min,e.max,(e.max-e.min)/100).onChange(function(e){t(e)}),g.palette instanceof fo.palette&&(i.domElement.querySelector(".slider-fg").style.height="40%",o=i.domElement.querySelector(".slider"),fo.create(o,{palette:g.palette,style:{}}))):i=E.add({value:0},"value").onChange(function(e){t(e)})):(e=void 0===v?g.scales[n]:v.options?v.options.scales[n]:void 0)&&(i=E.add({value:e.min},"value",e.min,e.max,(e.max-e.min)/100).onChange(function(e){var t,o;s(i)||(t=z.object,o="x"===n?0:"y"===n?1:"z"===n?2:"w"===n?3:console.error("axisName:"+n),t.geometry.attributes.position.array[o+z.index*t.geometry.attributes.position.itemSize]=e,t.geometry.attributes.position.needsUpdate=!0,ee(z.index),g.frustumPoints&&g.frustumPoints.updateCloudPointItem(t,z.index))})),e&&x.controllerNameAndTitle(i,e.name),i}function u(e){var t=void 0===v?g.scales[e]:v.options?v.options.scales[e]:void 0;if(t){e=x.controllerZeroStep(A,{value:t.min},"value");return e.domElement.querySelector("input").readOnly=!0,x.controllerNameAndTitle(e,t.name),e}}},this.setColorAttribute=function(e,t,o){"string"==typeof o&&(o=new b.Color(o));e=e.color||e.ca;void 0!==e&&(e.setX(t,o.r),e.setY(t,o.g),e.setZ(t,o.b),e.needsUpdate=!0)},this.removePoints=function(){D.domElement.querySelectorAll("select option").forEach(function(e){return e.remove()});var e=document.createElement("option");e.innerHTML=C.notSelected,e.setAttribute("value",-1),D.__select.appendChild(e)},this.getFrustumPoints=function(){return _},this}function Q(e){var t;A.domElement.style.display=e,E.domElement.style.display=e,U&&(t=oe(),U.domElement.parentElement.parentElement.style.display=t&&t.userData.boFrustumPoints?"none":e)}function $(e,t){if(void 0!==e){"boolean"==typeof t?t=t?"block":"none":void 0===t?t="none":"string"!=typeof t&&(t="block");for(var o=e.domElement;"LI"!==o.tagName.toUpperCase();)o=o.parentElement;o.style.display=t}}function ee(e){var t,o;-1!==(e=void 0===e?n.getSelectedPointIndex():e)&&(o=to(t=k.__select.options[k.__select.options.selectedIndex].mesh,e),void 0!==v&&!1!==v&&void 0!==v&&v.exposePosition({object:t,index:e}),J.x&&J.x.setValue(o.x),J.y&&J.y.setValue(o.y),J.z&&J.z.setValue(o.z))}function te(e,t){if(e){var o=e.domElement.querySelector("input"),n=o.readOnly;return o.readOnly=!1,e.object[e.property]=t,e.__onChange&&e.__onChange.call(e,t),e.initialValue=t,e.updateDisplay(),o.readOnly=n,e}}function i(e){var t=e.object.userData.player,o="none";t&&t.arrayFuncs&&(X.setFunction(t.arrayFuncs[e.index]),o="block"),X.displayFolder(o),U&&(g.playerOptions.cameraTarget.changeTarget(e.object,e.index),U.updateDisplay());var n=$t(e.object,e.index);te(N,n.x),te(R,n.y),te(V,n.z);o=to(e.object,e.index);te(J.x,o.x),te(J.y,o.y),te(J.z,o.z);n="none",o="block";z.object.userData.player&&z.object.userData.player.arrayFuncs;var i=t&&t.arrayFuncs?t.arrayFuncs[e.index]:void 0;function r(){return"object"===se(i.w)&&i.w instanceof b.Color==!1}var a,s,l,c,u,t=void 0===i?void 0:Array.isArray(i.w)||"function"==typeof i.w?zo.execFunc(i,"w",zo.getTime(),g):r()?zo.execFunc(i.w,"func",zo.getTime(),g):i.w;void 0===t&&(void 0===e.object.geometry.attributes.ca||(s=(new b.Vector4).fromArray(e.object.geometry.attributes.ca.array,e.index*e.object.geometry.attributes.ca.itemSize),t=new b.Color(s.x,s.y,s.z),a=s.w)),t instanceof b.Color?(l=n,u=c=o,void 0===e.object.userData.player.arrayFuncs?u=c=n:(s="#"+t.getHexString(),B.initialValue=s,B.setValue(s),B.userData={intersection:e},void 0!==a?te(G,a):u=n,G.userData={intersection:e})):(l=void 0===j||void 0===t?n:(d=d||{min:j.__min,max:j.__max},r()?(j.min(("undefined"!==i.w.min?i.w:d).min),j.max(("undefined"!==i.w.max?i.w:d).max),"undefined"!==j.__min&&"undefined"!==j.__max&&j.step((j.__max-j.__min)/100)):(j.min(d.min),j.max(d.max)),te(j,t),o),u=c=n),$(j,l),$(B,c),$(G,u);e=!0===e.object.userData.boFrustumPoints;N&&(N.domElement.querySelector("input").readOnly=e),R&&(R.domElement.querySelector("input").readOnly=e),V&&(V.domElement.querySelector("input").readOnly=e),j&&(j.domElement.querySelector("input").readOnly=e),B.domElement.querySelector("input").readOnly=e,G.domElement.querySelector("input").readOnly=e,X.displayFolder(!e)}function oe(){if(k)return-1!==k.__select.options.selectedIndex?k.__select.options[k.__select.options.selectedIndex].mesh:void 0;console.error("GuiSelectPoint().getSelectedPointIndex().getMesh(): call GuiSelectPoint.add( gui ); first.")}function t(){return void 0===oe()}function ne(){var e;t()||(e=oe(),M&&M.setValue(e.scale.x),L&&L.setValue(e.scale.y),F&&F.setValue(e.scale.z))}function ie(){var e;t()||(e=oe(),Y.x&&Y.x.setValue(e.position.x),Y.y&&Y.y.setValue(e.position.y),Y.z&&Y.z.setValue(e.position.z))}function re(){var e;t()||(e=oe(),Z.x&&Z.x.setValue(e.rotation.x),Z.y&&Z.y.setValue(e.rotation.y),Z.z&&Z.z.setValue(e.rotation.z))}function ae(e,t,o){var n,i,r;e&&e.object.userData.player&&void 0!==e.object.userData.player.arrayFuncs&&(n=e.index||0,void 0!==(r=void 0===(i=e.object.userData.player.arrayFuncs[n])?void 0:i.line)&&r.visible(t),t&&void 0===i.line&&(i.line=new zo.traceLine(g),t=void 0===(t=e.object.geometry.attributes.color)?new b.Color(16777215):(e=(new b.Vector3).fromArray(t.array,n*t.itemSize),new b.Color(e.x,e.y,e.z)),i.line.addPoint(o(),n,t)))}console.error("GuiSelectPoint: call options = new Options( options ) first")}function Qo(o,a){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(le(this,Qo),a.boOptions){var e=n.folder||a.dat.gui;if(e&&!1!==a.dat.moveScene){a.axesHelper&&a.axesHelper.options?a.scales=a.axesHelper.options.scales:a.scales=a.scales||{x:{},y:{},z:{}};var t=a.cookie||new _o.defaultCookie,s=Me.dat,i="MoveGroup"+(a.cookieName?"_"+a.cookieName:""),l={scale:o.scale,position:o.position,rotation:o.rotation,x:{zoomMultiplier:1.2,offset:.1},y:{zoomMultiplier:1.2,offset:.1},z:{zoomMultiplier:1.2,offset:.1}},r=JSON.parse(JSON.stringify(l));Object.freeze(r),t.getObject(i,l,r),o.scale.copy(l.scale),o.position.copy(l.position),l.scale=o.scale,l.position=o.position,d("x"),d("y"),d("z");var c={moveGroup:"Move Group",scale:"Scale",position:"Position",rotation:"Rotation",defaultButton:"Default",defaultTitle:"Move group to default position."};switch(a.getLanguageCode()){case"ru":c.moveGroup=" ",c.scale="",c.position="",c.rotation="",c.defaultButton="",c.defaultTitle="    .";break;default:if(void 0===a.lang||a.lang.languageCode!=languageCode)break;Object.keys(a.lang).forEach(function(e){void 0!==c[e]&&(c[e]=a.lang[e])})}n.lang&&(c.moveGroup=n.lang.moveGroup||c.moveGroup);var u=e.addFolder(c.moveGroup);u.add(new Le(function(e,t){e=e.controller.getValue();p("x",t,e),p("y",t,e),p("z",t,e)},{settings:{zoomMultiplier:1.1},getLanguageCode:n.getLanguageCode})),a.scalesControllers={x:{},y:{},z:{},w:{}},a.scales&&(m(a.scales.x,a.scalesControllers.x,"x"),m(a.scales.y,a.scalesControllers.y,"y"),m(a.scales.z,a.scalesControllers.z,"z"));e={defaultF:function(e){a.scales.x&&a.scales.x.default(),a.scales.y&&a.scales.y.default(),a.scales.z&&a.scales.z.default()}};s.controllerNameAndTitle(u.add(e,"defaultF"),c.defaultButton,c.defaultTitle)}}else console.error("MoveGroupGui: call options = new Options( options ) first");function d(t){a.scales[t]&&(a.scales[t].default=function(){var e=a.scalesControllers[t];e.scale.setValue(r.scale[t]),e.scaleController.setValue(r[t].zoomMultiplier),e.position.setValue(r.position[t]),e.positionController.setValue(r[t].offset),e.rotation.setValue(r.rotation["_"+t])})}function p(e,t,o){e=a.scalesControllers[e].scale;e&&(e.setValue(t(e.getValue(),o)),f())}function f(){a.axesHelper&&a.axesHelper.updateAxes(),a.guiSelectPoint&&a.guiSelectPoint.update(),t.setObject(i,l)}function m(t,e,i){var r;void 0!==t&&(t.name=t.name||i,e.folder=u.addFolder(t.name),e.scaleController=e.folder.add(new Le(function(e,t){e=e.controller.getValue(),p(i,t,e)},{settings:l[i],getLanguageCode:n.getLanguageCode})).onChange(function(e){l[i].zoomMultiplier=e,f()}),e.scale=s.controllerZeroStep(e.folder,o.scale,i,function(e){f()}),s.controllerNameAndTitle(e.scale,c.scale),r=new De(function(o){var e,t,n;t=function(e,t){return e+=o},e=(e=r).controller.getValue(),n=i,t=t,e=e,(n=a.scalesControllers[n].position)&&(n.setValue(t(n.getValue(),e)),f())},{settings:{},getLanguageCode:n.getLanguageCode}),e.positionController=e.folder.add(r).onChange(function(e){l[i].offset=e,f()}),e.position=s.controllerZeroStep(e.folder,o.position,i,function(e){f()}),s.controllerNameAndTitle(e.position,c.position),e.rotation=e.folder.add(o.rotation,i,0,2*Math.PI,1/360).onChange(function(e){f()}),s.controllerNameAndTitle(e.rotation,c.rotation),s.controllerNameAndTitle(e.folder.add({defaultF:function(e){t.default()}},"defaultF"),c.defaultButton,c.defaultTitle))}}function $o(n,i,e){if(le(this,$o),i.boOptions){if((e=e||i.dat.gui)&&!1!==i.dat.cameraGui){var t=Me.dat;Me.THREE;i.cameraGui=this,i.orbitControls&&i.orbitControls.addEventListener("change",function(){g()});var o={camera:"Camera",position:"Position",positionTitle:"Camera position",distanceToCamera:"Distance",distanceToCameraTitle:"Distance from the camera to the point at which the camera is looking",look:"Look",lookTitle:"Camera is look at a selected point during playing.",defaultButton:"Default",defaultTitle:"Restore default camera settings."};switch(i.getLanguageCode()){case"ru":o.camera="",o.position="",o.positionTitle=" ",o.distanceToCamera="",o.distanceToCameraTitle="    ,    .",o.look="",o.lookTitle="       .",o.defaultButton="",o.defaultTitle="    .";break;default:if(void 0===i.lang||i.lang.languageCode!=_languageCode)break;Object.keys(i.lang).forEach(function(e){void 0!==o[e]&&(o[e]=i.lang[e])})}var r,a,s,l,c,u,d=e.addFolder(o.camera),p=d.addFolder(o.position),f={x:i.scales.x?t.controllerZeroStep(p,n.position,"x",function(e){n.position.x=e}):void 0,y:i.scales.y?t.controllerZeroStep(p,n.position,"y",function(e){n.position.y=e}):void 0,z:i.scales.z?t.controllerZeroStep(p,n.position,"z",function(e){n.position.z=e}):void 0};t.folderNameAndTitle(p,o.position,o.positionTitle),f.x&&t.controllerNameAndTitle(f.x,i.scales.x.name),f.y&&t.controllerNameAndTitle(f.y,i.scales.y.name),f.z&&t.controllerNameAndTitle(f.z,i.scales.z.name),i.player&&(a=function(e,t){isNaN(t)||(n.userData.cameraTarget&&(n.userData.cameraTarget.distanceToCameraCur[e]=t),s.distanceToCameraCur[e]=t,s.setCameraPosition(),g())},i.playerOptions.cameraTarget.init({camera:n},i),s=i.playerOptions.cameraTarget.get(),l=d.add(s,"boLook").onChange(function(e){i.player&&(s.boMaual=!0,i.player.selectScene(),s.boMaual=!1),e||i.orbitControls&&i.orbitControls.reset()}),t.controllerNameAndTitle(l,o.look,o.lookTitle),e=d.addFolder(o.distanceToCamera),p={x:zo.execFunc(s.distanceToCamera,"x",void 0,i),y:zo.execFunc(s.distanceToCamera,"y",void 0,i),z:zo.execFunc(s.distanceToCamera,"z",void 0,i)},c={x:t.controllerZeroStep(e,p,"x",function(e){a("x",e)}),y:t.controllerZeroStep(e,p,"y",function(e){a("y",e)}),z:t.controllerZeroStep(e,p,"z",function(e){a("z",e)})},u={x:p.x,y:p.y,z:p.z},t.folderNameAndTitle(e,o.distanceToCamera,o.distanceToCameraTitle),i.scales.x&&t.controllerNameAndTitle(c.x,i.scales.x.name),i.scales.y&&t.controllerNameAndTitle(c.y,i.scales.y.name),i.scales.z&&t.controllerNameAndTitle(c.z,i.scales.z.name),r=new Jo(e,function(e,t){var o=i.playerOptions.cameraTarget.get();o.distanceToCamera[t]=e;o=zo.execFunc(o.distanceToCamera,t,zo.getTime());c[t].setValue(o,!0),i.playerOptions.cameraTarget.init({camera:n},i)},i,s.distanceToCamera));var m={x:n.position.x,y:n.position.y,z:n.position.z},h=i.orbitControls?{x:i.orbitControls.target.x,y:i.orbitControls.target.y,z:i.orbitControls.target.z}:{x:0,y:0,z:0};t.controllerNameAndTitle(d.add({defaultF:function(e){f.x.setValue(m.x),f.y.setValue(m.y),f.z.setValue(m.z),n.position.copy(m),n.lookAt(h),i.orbitControls&&(i.orbitControls.target.copy(h),i.orbitControls.update()),c&&(c.x.setValue(u.x),c.y.setValue(u.y),c.z.setValue(u.z))}},"defaultF"),o.defaultButton,o.defaultTitle),this.update=function(){g()},this.look=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];l.getValue()!==e&&l.setValue(e)}}}else console.error("OrbitControlsGui: call options = new Options( options ) first");function g(){var e,t=i.playerOptions.cameraTarget.get(i);f.x&&f.x.setValue(n.position.x),f.y&&f.y.setValue(n.position.y),f.z&&f.z.setValue(n.position.z),c&&(e=t.getDistanceToCamera(),c.x&&c.x.setValue(e.x),c.y&&c.y.setValue(e.y),c.z&&c.z.setValue(e.z)),r&&r.setFunction(t.distanceToCamera)}}function en(t,o,e){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};le(this,en);var i,r,a,s,l=Me.dat;e.boOptions?(s=n.folder||e.dat.gui)&&!1!==e.dat.folderPoint&&(i={pointSettings:"Point",size:"Size",sizeTitle:'Size of the point with "ShaderMaterial" material',defaultButton:"Default",defaultPointTitle:"Restore point."},"ru"===e.getLanguageCode()&&(i.pointSettings="",i.size="",i.sizeTitle='     "ShaderMaterial"',i.defaultButton="",i.defaultPointTitle=" "),void 0===(r=n.defaultPoint||{}).size&&(r.size=t.size),void 0===(e=n.PCOptions||{}).min&&(e.min=.01),void 0===e.max&&(e.max=1),e.settings=e.settings||{},void 0===e.settings.offset&&(e.settings.offset=1),void 0===e.step&&(e.step=.01),e.getLanguageCode=e.getLanguageCode||n.getLanguageCode,s=(a=s.addFolder(i.pointSettings)).addFolder(i.size),l.folderNameAndTitle(s,i.size,i.sizeTitle),this.display=function(e){a.domElement.style.display=e},s.add(new De(function(e){o(t.size+e)},e)),this.size=l.controllerZeroStep(s,t,"size",function(e){o(e)}),l.controllerNameAndTitle(this.size,i.size,i.sizeTitle),l.controllerNameAndTitle(a.add({defaultF:function(e){o(r.size)}},"defaultF"),i.defaultButton,i.defaultPointTitle)):console.error("FolderPoint: call options = new Options( options ) first")}var tn={notHiddingFrustumPoints:!0};
/**
 * @module GuiSelectPoint
 *
 * @description A dat.gui based graphical user interface for select a point from the mesh.
 *
 * @see {@link https://github.com/anhr/dat.gui|dat.gui}, {@link https://threejs.org/docs/index.html#api/en/objects/Mesh|three.js mesh}.
 *
 * @author Andrej Hristoliubov. {@link https://anhr.github.io/AboutMe/|AboutMe}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/function on(N,R,e){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};le(this,on),e.getContext("webgl"),a.options=a.options||new ko;var V,s,j,I,H,B=a.options;B.boOptions?(this.getOptions=function(){return B},B.frustumPoints=this,V=Me.THREE,(s=[]).getCloudsCount=function(){for(var e=0,t=0;t<s.length;t++)e+=s[t].length;return e},this.pushArrayCloud=function(e){var t;if(4===(e=e.geometry?(t=e).geometry:e).attributes.position.itemSize){var o=s.getCloudsCount(),n=[];s.push(n);for(var i=0;i<e.attributes.position.count;i++){var r=(new V.Vector4).fromArray(e.attributes.position.array,i*e.attributes.position.itemSize);n.push(r)}return t&&(t.userData.cloud={indexArray:o}),o}console.error("FrustumPoints.pushArrayCloud: Invalid geometry.attributes.position.itemSize = "+e.attributes.position.itemSize)},this.create=function(t){if(0!==s.length){B.orbitControls&&B.orbitControls.addEventListener("change",function(){z.onChangeControls()});var P={},o=new V.Vector3,n=N.position.distanceTo(o),z=this,e=new V.Group;a.optionsShaderMaterial=a.optionsShaderMaterial||{};var M=a.optionsShaderMaterial;M.point=M.point||{},M.point.size=M.point.size||.01,M.display=void 0===M.display||M.display,M.info=void 0!==M.info&&M.info,M.stereo=M.stereo||{},M.stereo.hide=M.stereo.hide||0,M.stereo.opacity=M.stereo.opacity||.3,M.zCount=M.zCount||50,M.yCount=M.yCount||30,M.near=M.near||0,M.far=M.far||0,M.base=M.base||100,M.square=void 0!==M.square&&M.square;var v=B.dat.cookie,b=B.dat.getCookieName("FrustumPoints");Object.freeze(M),v.getObject(b,P,M),P.stereo.hide=M.stereo.hide,P.stereo.opacity=M.stereo.opacity;var L,F=new(F=function(){var c,l;this.create=function(e){c=e;var t=B.scales.w.max,e=B.scales.w.min;c.paletteA={value:1/(t-e)},c.paletteB={value:-e/(t-e)},this.cloudPoints=new this.addUniforms(V.RGBAFormat,s.getCloudsCount(),"cloudPoints"),l=256;new this.addUniforms(V.LuminanceFormat,l,"distanceTable",{height:2,onReady:function(e,t,o){for(var n,i=0,r=.5/(l-1),a=0;a<l;a++){var s=(s=i,Math.exp(-.5*s*s/(.1*.1)));i+=r,void 0!==n&&(.035<Math.abs(n-s)?r/=1.001:r*=1.001),o(a,n=s),o(a+l,i)}}})},this.addUniforms=function(e,t,o,n){n=n||{};var a=e===V.RGBAFormat?4:e===V.RGBFormat?3:e===V.LuminanceFormat?1:NaN,i=n.height||1,r=t*i,s=V.FloatType,l=new(s===V.FloatType?Float32Array:Uint8Array)(a*r);return void 0!==this.addUniforms&&console.error('Please use "new this.addUniforms(...)"'),this.updateItem=function(e,t){var o,n,i,r;"number"==typeof t?o=t:void 0===t.x?(o=t.r,n=t.g,i=t.b):(o=t.x,n=t.y,i=t.z,isNaN(t.w)&&console.error("frustumPoints.create.cloud.addUniforms.updateItem: vector.w = "+t.w+". Probably you use THREE.Color for w coordinate of the point with cloud."),r=t.w);t=void 0===n?1:void 0===i?2:void 0===r?3:4,e*=a;t!==a&&console.error("frustumPoints.create.cloud.addUniforms.updateItem: vectorSize = "+t+" !== itemSize = "+a),l[e]=o,1<a&&(l[1+e]=n,2<a&&(l[2+e]=i,3<a&&(l[3+e]=r)))},void 0!==n.onReady&&n.onReady(l,a,this.updateItem),c[o]={value:new V.DataTexture(l,t,i,e,s)},c[o].value.needsUpdate=!0,a},this.editShaderText=function(e){for(var t=0,o=0;o<s.length;o++)t+=s[o].length;e.vertex=e.vertex.replace("%scloudPointsWidth",t+"."),e.vertex=e.vertex.replace("%distanceTableWidth",l+".")},this.updateMesh=function(e){if(void 0!==e.userData.cloud&&this.cloudPoints)for(var t=0;t<e.geometry.attributes.position.count;t++){var o=(new V.Vector4).fromArray(e.geometry.attributes.position.array,t*e.geometry.attributes.position.itemSize);this.cloudPoints.updateItem(e.userData.cloud.indexArray+t,eo(e,o))}}});return R.add(e),this.onChangeControls=function(){tn.notHiddingFrustumPoints?tn.notMoveFrustumPoints||z.update():(void 0===timeoutControls&&(R.remove(H),R.remove(e),B.raycaster.removeParticle(H)),clearTimeout(timeoutControls),timeoutControls=setTimeout(function(){R.add(e),P.info&&B.raycaster.addParticle(H),clearTimeout(timeoutControls),timeoutControls=void 0,tn.notMoveFrustumPoints||z.update()},500))},i(),this.update=function(e){i(e),H&&(H.position.copy(N.position),H.rotation.set(N.rotation.x,N.rotation.y,N.rotation.z),t=N.position.distanceTo(o)/n,H.scale.x=t,H.scale.y=t,H.scale.z=t),B.guiSelectPoint&&B.guiSelectPoint.setMesh();var t=new V.Vector4(N.quaternion.x,N.quaternion.y,N.quaternion.z,N.quaternion.w);H&&(H.material.uniforms.cameraPositionDefault.value.copy(N.position),t.x=-t.x,t.y=-t.y,t.z=-t.z,H.material.uniforms.cameraPositionDefault.value.applyQuaternion(t))},this.isDisplay=function(){return P.display},this.updateCloudPoints=function(){R.children.forEach(function(e){e.userData.cloud&&(4===e.geometry.attributes.position.itemSize?F.updateMesh(e):console.error("mesh.geometry.attributes.position.itemSize = "+e.geometry.attributes.position.itemSize))}),r()},this.updateCloudPoint=function(e){F.updateMesh(e),r()},this.updateCloudPointItem=function(e,t){void 0!==e.userData.cloud&&(4!==e.geometry.attributes.position.itemSize&&console.error("points.geometry.attributes.position.itemSize = "+e.geometry.attributes.position.itemSize),F.cloudPoints.updateItem(e.userData.cloud.indexArray+t,eo(e,(new V.Vector4).fromArray(e.geometry.attributes.position.array,t*e.geometry.attributes.position.itemSize)),!0),r())},this.animate=function(){return!(!H||void 0===H.userData.shaderMaterial||L===H.userData.shaderMaterial.point.opacity)&&(L=H.userData.shaderMaterial.point.opacity,H.material.uniforms.opacity.value=H.userData.shaderMaterial.point.opacity,!0)},this.updateGuiSelectPoint=function(){var e=B.guiSelectPoint?B.guiSelectPoint.getMeshIndex(H):void 0;i(),e&&B.guiSelectPoint.setIndexMesh(e,H)},this.gui=function(e){var t=Me.dat;if((e=e||B.dat.gui)&&!1!==B.dat.guiFrustumPoints){var o={frustumPoints:"Frustum Points",frustumPointsTitle:"A cloud of the fixed points in front of the camera for describe the properties of space.",display:"Display",displayTitle:"Display or hide Frustum Points.",info:"Information",infoTitle:"Display information about frustum point if user move mouse over or click this point.",stereo:"Stereo",stereoTitle:"Frustum Points setting for stereo mode of the canvas",hide:"Hide Nearby Points",hideTitle:"Hide the nearby to the camera points in percentage to all points for more comfortable visualisation.",opacity:"Opacity",opacityTitle:"Float in the range of 0.0 - 1.0 indicating how transparent the lines is. A value of 0.0 indicates fully transparent, 1.0 is fully opaque.",near:"Near Layer",nearTitle:"Shift of the frustum layer near to the camera in percents.",far:"Far Layer",farTitle:"Shift of the frustum layer far to the camera in percents.",base:"Scale",baseTitle:"Scale of the base of the frustum points in percents.",square:"Square Base",squareTitle:"Square base of the frustum points.",defaultButton:"Default",defaultTitle:"Restore default Frustum Points settings.",zCount:"Z Count",zCountTitle:"The count of layers of the frustum of the camera's field of view.",yCount:"Y Count",yCountTitle:"The count of vertical points for each z level of the  frustum of the camera's field of view."};switch(B.getLanguageCode()){case"ru":o.frustumPoints=" ",o.frustumPointsTitle="       ",o.display="",o.displayTitle="    .",o.info="",o.infoTitle="    ,         .",o.stereo="",o.stereoTitle="      ",o.hide=" ",o.hideTitle="             .",o.opacity="",o.opacityTitle="   0.0 - 1.0, ,   .  0.0   , 1.0 -  .",o.near=" ",o.nearTitle="       .",o.far=" ",o.farTitle="       .",o.base="",o.baseTitle="    .",o.square=" ",o.squareTitle="      .",o.defaultButton="",o.defaultTitle="   .",o.zCount="Z c",o.zCountTitle="   ,    ",o.yCount="Y ",o.yCountTitle="       ,    .";break;default:if(void 0===B.lang||B.lang.languageCode!=languageCode)break;Object.keys(B.lang).forEach(function(e){void 0!==o[e]&&(o[e]=B.lang[e])})}e=e.addFolder(o.frustumPoints);t.folderNameAndTitle(e,o.frustumPoints,o.frustumPointsTitle);var n=e.add(P,"display").onChange(function(e){P.display?y():(B.raycaster&&B.raycaster.removeParticle(H),D()),g(P.display),h()});t.controllerNameAndTitle(n,o.display,o.displayTitle);var i=B.raycaster?e.add(P,"info").onChange(function(e){void 0!==H&&(P.info?B.raycaster&&B.raycaster.addParticle(H):(B.guiSelectPoint&&B.guiSelectPoint.selectPoint(-1),B.raycaster&&B.raycaster.removeParticle(H))),h()}):void 0;i&&t.controllerNameAndTitle(i,o.info,o.infoTitle);var r=e.add(P,"near",0,100,1).onChange(function(e){y()});t.controllerNameAndTitle(r,o.near,o.nearTitle);var a=e.add(P,"far",0,100,1).onChange(function(e){y()});t.controllerNameAndTitle(a,o.far,o.farTitle);var s=e.add(P,"base",0,100,1).onChange(function(e){y()});t.controllerNameAndTitle(s,o.base,o.baseTitle);var l=e.add(P,"square").onChange(function(e){y()});t.controllerNameAndTitle(l,o.square,o.squareTitle);var c=new en(P.point,function(e){void 0===e&&console.warn("under constraction"),e<0&&(e=0),H.material.uniforms.pointSize.value=e,c.size.setValue(e),P.point.size=e,h()},new ko({dat:{gui:B.dat.gui}}),{folder:e,defaultPoint:{size:.01},PCOptions:{settings:{offset:.1},max:.1}}),u=!0,d=!0,p=this,f=e.add(P,"zCount").min(3).step(1).onChange(function(e){y()});t.controllerNameAndTitle(f,o.zCount,o.zCountTitle);var m=e.add(P,"yCount").min(3).step(1).onChange(function(e){y()});t.controllerNameAndTitle(m,o.yCount,o.yCountTitle),t.controllerNameAndTitle(e.add({defaultF:function(e){u=!1,n.setValue(M.display),i&&i.setValue(M.info),r.setValue(M.near),a.setValue(M.far),s.setValue(M.base),l.setValue(M.square),c.size.setValue(M.point.size),f.setValue(M.zCount),m.setValue(M.yCount),u=!0,y(),h()}},"defaultF"),o.defaultButton,o.defaultTitle),g(P.display)}function h(){v.setObject(b,P)}function g(e){e=e?"block":"none";c.display(e),f.__li.style.display=e,m.__li.style.display=e}function y(){var e;u&&d&&(d=!1,e=B.guiSelectPoint?B.guiSelectPoint.getMeshIndex(H):void 0,B.raycaster&&B.raycaster.removeParticle(H),D(!0),p.update(function(){B.guiSelectPoint&&B.guiSelectPoint.setIndexMesh(e,H),h(),d=!0,H.userData.controllers()}))}},this}function i(e){function t(e){var t=n.pointMap[e],e=n.geometry.attributes.position;return(new V.Vector3).fromArray(e.array,t[0]*e.itemSize)}function i(e){var t=(f.y-d.y)/(C-1),o=((g.y-m.y)/(C-1)-t)/((_-1)*(_-1))*e*e+t,t=parseInt(Math.sqrt(_)),n=o/(t+parseInt(Math.sqrt(_-t*t))),t=(p.x-d.x)/(T-1),i=((h.x-m.x)/(T-1)-t)/((_-1)*(_-1))*e*e+t,r=i/parseInt(Math.sqrt(_));b.y=-o*(C-1)/2,b.x=-i*(T-1)/2;for(var a,s=0;s<C;s++)for(var l=0;l<T;l++)S<=e&&(a=new V.Vector3(b.x+i*l+r*w,b.y+o*s+n*E,b.z+x*e*e),I.push(0===l?0===s?{y:s,z:e}:{y:s}:l),c[u]=a.x,c[++u]=a.y,c[++u]=a.z,u++);++w>=parseInt(Math.sqrt(_))&&(w=0,E++)}var o,c,n,u,d,p,f,m,h,g,r,a,s,l,y,v,b,_,x,w,C,T,E,S,A,O,k;void 0===H&&(o=e,P.display&&(n=new V.CameraHelper(N),u=0,d=t("n1"),p=t("n2"),f=t("n3"),m=t("f1"),h=t("f2"),g=t("f3"),d.x=d.x*P.base/100,p.x=p.x*P.base/100,f.x=f.x*P.base/100,d.y=d.y*P.base/100,p.y=p.y*P.base/100,f.y=f.y*P.base/100,m.x=m.x*P.base/100,h.x=h.x*P.base/100,g.x=g.x*P.base/100,m.y=m.y*P.base/100,h.y=h.y*P.base/100,g.y=g.y*P.base/100,P.square&&(d.x/=N.aspect,p.x/=N.aspect,f.x/=N.aspect,m.x/=N.aspect,h.x/=N.aspect,g.x/=N.aspect),r=d.x,a=p.x,s=f.x,l=d.y,y=p.y,v=f.y,e=d.z,d.x=d.x+(m.x-d.x)*P.near/100,p.x=p.x+(h.x-p.x)*P.near/100,f.x=f.x+(g.x-f.x)*P.near/100,d.y=d.y+(m.y-d.y)*P.near/100,p.y=p.y+(h.y-p.y)*P.near/100,f.y=f.y+(g.y-f.y)*P.near/100,d.z=p.z=f.z=d.z+(m.z-d.z)*P.near/100,m.x=m.x+(r-m.x)*P.far/100,h.x=h.x+(a-h.x)*P.far/100,g.x=g.x+(s-g.x)*P.far/100,m.y=m.y+(l-m.y)*P.far/100,h.y=h.y+(y-h.y)*P.far/100,g.y=g.y+(v-g.y)*P.far/100,m.z=h.z=g.z=m.z+(e-m.z)*P.far/100,b=(new V.Vector3).copy(d),_=P.zCount,x=(m.z-d.z)/((_-1)*(_-1)),w=0,C=P.yCount,T=C*(P.square?1:parseInt(N.aspect)),E=0,P.zCount=M.zCount,P.yCount=M.yCount,S=parseInt(_*P.stereo.hide/100),A=S+_-1,P.zCount=_,P.yCount=C,D(!0),z.pointIndexes=function(e){if(void 0!==I){var t,o,n=I[e],i=e,e=(o=("object"===(void 0===n?"undefined":se(n))?t=0:(t=n,r()),n.y),a(),n.z);return{x:t,y:o,z:e}}function r(){for(i--;0<=i&&"object"!==se(I[i]);)i--;n=I[i]}function a(){for(;0<=i&&void 0===n.z;)r()}console.error("_names = "+I)},e=function(){var e=function(){if(document.currentScript&&""!==document.currentScript.src)return document.currentScript.src;var e=document.getElementsByTagName("script");return""!==e[e.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]}();return e.substring(0,e.lastIndexOf("/"))}(),O=new V.Vector3(N.position.x,N.position.y,N.position.z),k=new V.Vector4(N.quaternion.x,N.quaternion.y,N.quaternion.z,N.quaternion.w),jo(function(){var e=new V.BufferGeometry;return c=new Float32Array(3*((A-S+1)*T*C)),u=0,I=null,I=[],function e(t,o){var n;o<t||(i(t),o<=t||(i(o),(n=parseInt((t+o)/2))!==t&&(i(n),e(t+1,n-1),e(n+1,o-1))))}(S,A),e.setAttribute("position",new V.BufferAttribute(c,3)),e},R,{options:B,pointsOptions:{name:"frustum points",shaderMaterial:P,boFrustumPoints:!(H=!1),position:N.position,scale:N.scale,rotation:N.rotation,opacity:!0,pointIndexes:function(e){return z.pointIndexes(e)},path:{vertex:e+"/frustumPoints/vertex.c"},pointName:function(e){var t=z.pointIndexes(e);return void 0===t?t:"x = "+t.x+", y = "+t.y+", z = "+(t.z+S)+", i = "+e},controllers:function(){j&&j.appendChild({xCount:T,yCount:C,zCount:_})},uniforms:function(e){return F.create(e),k.x=-k.x,k.y=-k.y,k.z=-k.z,O.applyQuaternion(k),e.cameraPositionDefault={value:O},e.cameraQuaternion={value:N.quaternion},new F.addUniforms(V.RGBFormat,256,"palette",{onReady:function(e,t,o){B.scales.setW();for(var n=B.scales.w.min,i=B.scales.w.max,r=e.length/t,a=0;a<r;a++)o(a,B.palette.toColor((i-n)*a/(r-1)+n,n,i))}}),F},onReady:function(e){(H=e).userData.isInfo=function(){return P.info},P.info&&B.raycaster&&B.raycaster.addParticle(H),P.display||D(),L=void 0===H?1:(void 0===H.userData.shaderMaterial?P:H.userData.shaderMaterial).point.opacity,void 0!==o&&o(),z.update(),B.guiSelectPoint&&B.guiSelectPoint.addMesh(H)}}})))}function r(){H&&(H.material.uniforms.cloudPoints.value.needsUpdate=!0)}function D(e){void 0!==H&&(!e&&B.guiSelectPoint&&B.guiSelectPoint.removeMesh(H),R.remove(H),t.renderLists.dispose(),Go(H),H=void 0)}},this.guiSelectPoint=function(){var r=null,a=null,s=null;(j=this).create=function(o,n){var i=Me.dat;function e(e){var t={notSelected:"Not selected"};"ru"===n&&(t.notSelected=" ");t=o.add({Points:t.notSelected},"Points",ce({},t.notSelected,-1)).onChange(function(e){var t=j.getSelectedIndex();null!==t?B.guiSelectPoint.select({object:H,index:t}):B.axesHelper&&B.axesHelper.exposePosition()});return t.__select[0].selected=!0,i.controllerNameAndTitle(t,e),t}r=e("x"),a=e("y"),s=e("z")},this.appendChild=function(e){function t(e,t){e.domElement.querySelectorAll("select option").forEach(function(e){"-1"!=e.value&&e.remove()});for(var o=0;o<t;o++){var n=document.createElement("option");n.innerHTML=o,e.__select.appendChild(n)}e.setValue(-1)}t(r,e.xCount),t(a,e.yCount),t(s,e.zCount)},this.pointIndexes=function(e){void 0!==e&&(parseInt(r.getValue())!==e.x&&r.setValue(e.x),parseInt(a.getValue())!==e.y&&a.setValue(e.y),parseInt(s.getValue())!==e.z&&s.setValue(e.z))},this.getSelectedIndex=function(){if(void 0===I)return console.warn("             the cDisplay checkbox of the frustumPoints is not checked"),null;var e=parseInt(r.getValue()),t=parseInt(a.getValue()),o=parseInt(s.getValue());if(isNaN(e)||-1===e||isNaN(t)||-1===t||isNaN(o)||-1===o)return null;for(var n=0;n<I.length;n++){var i=I[n];if("object"===(void 0===i?"undefined":se(i))&&void 0!==i.z&&i.z===o)for(;n<I.length;n++)if("object"===(void 0===(i=I[n])?"undefined":se(i))&&i.y===t)for(;n<I.length;n++){if(i=I[n],"object"===(void 0===i?"undefined":se(i))&&0===e&&i.y===t)return n;if(i===e)return n}}return console.error("FrustumPoints.selectPoint: not selected"),null},this.display=function(e){r.domElement.parentElement.parentElement.style.display=e,a.domElement.parentElement.parentElement.style.display=e,s.domElement.parentElement.parentElement.style.display=e},this.isDisplay=function(){return r.domElement.parentElement.parentElement.style.display===a.domElement.parentElement.parentElement.style.display&&r.domElement.parentElement.parentElement.style.display===s.domElement.parentElement.parentElement.style.display||console.error("cFrustumPointsF.isDisplay failed!"),"none"!==r.domElement.parentElement.parentElement.style.display}},this.gui=function(){console.warn("FrustumPoints.gui(): First, call FrustumPoints.pushArrayCloud(...) for push a points to the clouds array and call FrustumPoints.create(...).")},this.animate=function(){},this.updateGuiSelectPoint=function(){},this.isDisplay=function(){},this.onChangeControls=function(){},this.updateCloudPoints=function(){},this.updateCloudPoint=function(){},this.updateCloudPointItem=function(){}):console.error("FrustumPoints: call options = new Options( options ) first")}function nn(l){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};le(this,nn);var c=new ko(e.options);if(!1===c.pointLight)return this.add=function(){},void(this.controls=function(){});var u=Me.dat,d=Me.THREE,p={},f=2*c.scale,m=e.position||new d.Vector3,h=new d.PointLight(16777215,1);return h.position.copy(m),h.name="mathBoxLight",l.add(h),this.controls=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.group||l,o=e.folder||c.dat.gui,e=e.folderName;if(void 0!==o&&!1!==c.dat.pointLightGui){var n={light:"Light",displayLight:"Display",displayLightTitle:"Display or hide the light source.",defaultButton:"Default",restoreLightTitle:"Restore position of the light source"};switch(c.getLanguageCode()){case"ru":n.light="",n.displayLight="",n.displayLightTitle="    .",n.defaultButton="",n.restoreLightTitle="   ";break;default:if(void 0===c.lang||c.lang.languageCode!=_languageCode)break;Object.keys(c.lang).forEach(function(e){void 0!==n[e]&&(n[e]=c.lang[e])})}var i,r=c.scales,a=o.addFolder(e||n.light);u.controllerNameAndTitle(a.add({display:!1},"display").onChange(function(e){e?jo(h.position,t,{pointsOptions:{onReady:function(e){i=e}}}):(t.remove(i),i=void 0)}),n.displayLight,n.displayLightTitle),s("x"),s("y"),s("z");e={restore:function(){p.x.setValue(m.x),p.y.setValue(m.y),p.z.setValue(m.z)}};u.controllerNameAndTitle(a.add(e,"restore"),n.defaultButton,n.restoreLightTitle)}function s(n){var e=r[n];e&&(p[n]=a.add(h.position,n,e.min*f,e.max*f).onChange(function(e){var t,o;void 0!==i&&(t=i.geometry.attributes.position.itemSize,(o=(new d.Vector3).fromArray(i.geometry.attributes.position.array,0*t))[n]=e,o.toArray(i.geometry.attributes.position.array,0*t),i.geometry.attributes.position.needsUpdate=!0)}),u.controllerNameAndTitle(p[n],e.name))}},this}
/**
 * @module MyThree
 * @description I use MyThree in my projects for displaying of my 3D objects in the canvas.
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 */
void 0!==Zo&&(Me.dat=Zo);var rn,an=(rn=function(){if(document.currentScript&&""!==document.currentScript.src)return document.currentScript.src;var e=document.getElementsByTagName("script");return""!==e[e.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]}()).substring(0,rn.lastIndexOf("/"));var sn=new function(){var n=[];this.push=function(e){n.push(e)},this.display=function(t,o){n.forEach(function(e){e.style.display=e!==t&&o?"none":"block"})}},ln=[],g=function e(y,v){le(this,e);var b,_,x,w,t,C=Me.THREE,T=this;ln.push({createXDobjects:y,options:v}),1<ln.length||((v=new ko(v)).raycaster={onIntersection:function(e,t){ko.raycaster.onIntersection(e,v,x,b,w,v.renderer)},onIntersectionOut:function(){ko.raycaster.onIntersectionOut(x,v.renderer)},onMouseDown:function(e,t){ko.raycaster.onMouseDown(e,t)}},t={tag:"style"},void 0!==v.dat&&(so.sync(an+"/../DropdownMenu/styles/gui.css",t),so.sync(an+"/../DropdownMenu/styles/menu.css",t)),v.saveMeshDefault=function(e){e.userData.default=e.userData.default||{},e.userData.default.scale=new C.Vector3,e.userData.default.scale.copy(e.scale),e.userData.default.position=new C.Vector3,e.userData.default.position.copy(e.position),e.userData.default.rotation=new C.Euler,e.userData.default.rotation.copy(e.rotation)},function(){null===(i=void 0===v.elContainer?document.getElementById("containerDSE"):"string"==typeof v.elContainer?document.getElementById(v.elContainer):v.elContainer)&&("string"==typeof v.elContainer&&console.warn("The "+v.elContainer+" element was not detected."),i=document.createElement("div"),document.querySelector("body").appendChild(i)),sn.push(i),i.innerHTML=No.sync(an+"/canvasContainer.html");var i=i.querySelector(".container"),r=new C.Raycaster;r.params.Points.threshold=.02,void 0!==r.setStereoEffect&&r.setStereoEffect({renderer:a,camera:b,stereoEffect:v.stereoEffect,raycasterEvents:!1});var a,s,l,e,c,u,o,t,d={},n=new C.Vector2;function p(){(b=new C.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.01,10)).position.copy(v.camera.position),b.scale.copy(v.camera.scale),v.camera=b,v.point.sizePointsMaterial=100,v.cameraTarget&&(v.cameraTarget.camera=b,v.playerOptions.cameraTarget.init(v.cameraTarget,v)),(x=new C.Scene).background=new C.Color(0),x.fog=new C.Fog(0,250,1400),x.userData.optionsSpriteText={textHeight:.04},_=new C.Group,x.add(_),v.frustumPoints&&new on(b,_,w,{options:v,optionsShaderMaterial:{point:{size:.01},stereo:{}}}),a=new C.WebGLRenderer({antialias:!0,canvas:w}),v.renderer=a,v.cursor=a.domElement.style.cursor,new Eo(a,v);var e=new nn(x,{options:v,position:new C.Vector3(2*v.scale,2*v.scale,2*v.scale)}),t=new nn(x,{options:v,position:new C.Vector3(-2*v.scale,-2*v.scale,-2*v.scale)});v.eventListeners=new ko.EventListeners(r,b,a,v),v.dat.gui&&("undefined"!=typeof WebGLDebugUtils&&v.dat.gui.add({loseContext:function(e){w.loseContext()}},"loseContext"),void 0!==v.dat.gui.__closeButton.click&&v.dat.gui.__closeButton.click(),i.querySelector("#my-gui-container").appendChild(v.dat.gui.domElement)),new zo(_,{onSelectScene:function(e,t){v.boPlayer=!0,void 0!==v.frustumPoints&&v.frustumPoints.updateCloudPoints()},options:v,cameraTarget:{camera:b},onChangeScaleT:function(e){void 0!==v.player&&v.player.onChangeScale(e),_.children.forEach(function(e){void 0!==e.userData.player&&void 0!==e.userData.player.arrayFuncs&&"function"!=typeof e.userData.player.arrayFuncs&&e.userData.player.arrayFuncs.forEach(function(e){void 0!==e.line&&(e.line.remove(),e.line=new zo.traceLine(v))})})}}),v.player&&new v.player.PlayController,v.dat.gui&&(s=v.dat.gui.addFolder(cn.settings),v.player&&v.player.gui(s)),s&&Xo(x,v,{folder:s,options:{textHeight:.05,fov:b.fov}}),v.stereoEffect&&v.stereoEffect.gui({folder:s,onChangeMode:function(e){switch(e){case Eo.spatialMultiplexsIndexs.Mono:break;case Eo.spatialMultiplexsIndexs.SbS:case Eo.spatialMultiplexsIndexs.TaB:break;default:return void console.error("myThreejs: Invalid spatialMultiplexIndex = "+e)}void 0!==v.frustumPoints&&v.frustumPoints.updateGuiSelectPoint()}}),l=function(){a.domElement.style.position,a.domElement.style.left,a.domElement.style.top,a.domElement.style.width,a.domElement.style.height;var e=new C.Vector2;return a.getSize(e),{onFullScreenToggle:function(e){sn.display(i.parentElement,!e)}}}(),new Ho(a,{fullScreen:{camera:b,onFullScreenToggle:function(e){l.onFullScreenToggle(e)}},options:v}),a.setSize(void 0!==v.canvas&&void 0!==v.canvas.width?v.canvas.width:w.clientWidth,void 0!==v.canvas&&void 0!==v.canvas.height?v.canvas.height:w.clientHeight),v.createOrbitControls(b,a,x),new Uo(x,v),s&&(new Ko(v,{cameraTarget:{camera:b,orbitControls:v.orbitControls},pointsControls:function(e,t,o){},pointControls:function(e,t,o){}}),v.guiSelectPoint&&v.guiSelectPoint.add()),d.size=v.point.size;var o,n=v.dat.getCookieName("Point");if(v.dat&&v.dat.cookie.getObject(n,v.point,v.point),y&&y(_,v),v.frustumPoints&&v.frustumPoints.create(a),v.player||zo.selectPlayScene(_,{options:v}),v.boPlayer=!1,_.children.forEach(function(e){v.saveMeshDefault(e)}),v.dat.gui&&(qo(v,s),new Qo(_,v,{folder:s}),!1!==v.orbitControls&&new Wo(v,s),new $o(b,v,s),(!1===v.axesHelper?v:v.axesHelper.options).scales,e.controls({group:_,folder:s,folderName:cn.light+" 1"}),t.controls({group:_,folder:s,folderName:cn.light+" 2"}),o=new en(v.point,function(t){(t=void 0===t?v.point.size:t)<0&&(t=0),_.children.forEach(function(e){"Points"!==e.type||e.userData.boFrustumPoints||(void 0===e.material.uniforms?e.material.size=t/v.point.sizePointsMaterial:e.material.uniforms.pointSize.value=t)}),o.size.setValue(t),v.point.size=t,v.dat.cookie.setObject(n,v.point)},v,{folder:s,defaultPoint:d}),v.frustumPoints&&v.frustumPoints.gui(s),v.restoreSceneController(b,x)),void 0!==v.stats)try{u=new Stats,i.appendChild(u.dom)}catch(e){console.error(e+". Please import Stats from '../../../three.js/dev/examples/jsm/libs/stats.module.js';")}window.addEventListener("resize",f,!1)}function f(){var e;(v.canvasMenu?v.canvasMenu.isFullScreen():!v.canvas||!1!==v.canvas.fullScreen)?e=new C.Vector2(window.innerWidth,window.innerHeight):(e=new C.Vector2,a.getSize(e)),b.aspect=e.x/e.y,b.updateProjectionMatrix(),a.setSize(e.x,e.y),void 0!==v.frustumPoints&&v.frustumPoints.update()}function m(){void 0!==u&&u.begin(),t=requestAnimationFrame(m),h(),void 0!==u&&u.end()}function h(){(v.stereoEffect&&v.stereoEffect.render?v.stereoEffect:a).render(x,b),void 0===e&&(e=new C.Vector3),void 0===c&&(c=v.point.size),(!e.equals(b.position)||c!=v.point.size||void 0!==v.frustumPoints&&v.frustumPoints.animate())&&(e.copy(b.position),c=v.point.size,_.children.forEach(function(e){if(e instanceof C.Points!=!1)if(void 0!==e.geometry.attributes.size){void 0!==v.point.opacity&&(e.material.uniforms.opacity.value=v.point.opacity);for(var t=myPoints.getGlobalScale(e),o=new C.Vector3(b.position.x/t.x,b.position.y/t.y,b.position.z/t.z),t=(t.x+t.y+t.z)/3,n=0;n<e.geometry.attributes.position.count;n++){var i=to(e,n),i=new C.Vector3(i.x,i.y,i.z).distanceTo(o);e.geometry.attributes.size.setX(n,Math.tan((void 0!==e.userData.shaderMaterial.point&&void 0!==e.userData.shaderMaterial.point.size?e.userData.shaderMaterial:v).point.size)*i*t*1),e.geometry.attributes.size.needsUpdate=!0}}else e.material.size=c/v.point.sizePointsMaterial})),v.guiSelectPoint&&v.guiSelectPoint.render&&v.guiSelectPoint.render()}w=i.querySelector("canvas"),i.addEventListener("mousemove",function(e){{var t;void 0!==r&&(void 0!==r.stereo?r.stereo.onDocumentMouseMove(e):(r.setFromCamera(n,b),0<(o=r.intersectObjects(_.children)).length&&((t=o[0])&&t.object.userData.raycaster&&t.object.userData.raycaster.onIntersection&&t.object.userData.raycaster.onIntersection(t,n))))}if(1!=e.buttons)return;h()},!1),i.addEventListener("pointerdown",function(e){if(void 0===r)return;if(void 0!==r.stereo)return void r.stereo.onDocumentMouseDown(e);r.setFromCamera(n,b),0<(o=r.intersectObjects(_.children)).length&&ko.raycaster.onMouseDown(o[0],v)},{capture:!0}),(w="undefined"!=typeof WebGLDebugUtils?WebGLDebugUtils.makeLostContextSimulatingCanvas(w):w).addEventListener("webglcontextlost",function(e){e.preventDefault(),void 0!==t?window.cancelAnimationFrame(t):console.error("myThreejs.create.onloadScripts: requestId = "+t),clearThree(x),l.onFullScreenToggle(!0),alert(cn.webglcontextlost)},!1),w.addEventListener("webglcontextrestored",function(){console.warn("webglcontextrestored"),p(),m()},!1),p(),m(),ln.shift();var g=ln.shift();void 0!==g&&T.create(g.createXDobjects,g.options)}())},cn={defaultButton:"Default",settings:"Settings",webglcontextlost:"The user agent has detected that the drawing buffer associated with a WebGLRenderingContext object has been lost.",light:"Light",opacity:"Opacity"};"ru"===xo()&&(cn.defaultButton="",cn.name="",cn.settings="",cn.webglcontextlost="  ,   ,    WebGLRenderingContext, .",cn.light="",cn.opacity=""),g.MyPoints=jo,g.StereoEffect={spatialMultiplexsIndexs:Eo.spatialMultiplexsIndexs},g.ColorPicker=fo,g.getWorldPosition=eo,g.limitAngles=function(t){function e(e){for(;t[e]>2*Math.PI;)t[e]-=2*Math.PI}e("x"),e("y"),e("z")},g.Player=zo,g.three=Me,window.__myThree__=window.__myThree__||{},window.__myThree__.boMyThree&&console.error("myThree: duplicate myThree. Please use one instance of the myThree class."),window.__myThree__.boMyThree=!0,e.default=g,Object.defineProperty(e,"__esModule",{value:!0})});
