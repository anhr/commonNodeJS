/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).myThree=t()}(this,(function(){"use strict";function e(e,t){var o=e.__state.conversionName.toString(),n=Math.round(e.r),i=Math.round(e.g),r=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===o||"SIX_CHAR_HEX"===o){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===o?"rgb("+n+","+i+","+r+")":"CSS_RGBA"===o?"rgba("+n+","+i+","+r+","+a+")":"HEX"===o?"0x"+e.hex.toString(16):"RGB_ARRAY"===o?"["+n+","+i+","+r+"]":"RGBA_ARRAY"===o?"["+n+","+i+","+r+","+a+"]":"RGB_OBJ"===o?"{r:"+n+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===o?"{r:"+n+",g:"+i+",b:"+r+",a:"+a+"}":"HSV_OBJ"===o?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===o?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var t=Array.prototype.forEach,o=Array.prototype.slice,n={BREAK:{},extend:function(e){return this.each(o.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(o){this.isUndefined(t[o])||(e[o]=t[o])}.bind(this))}),this),e},defaults:function(e){return this.each(o.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(o){this.isUndefined(e[o])&&(e[o]=t[o])}.bind(this))}),this),e},compose:function(){var e=o.call(arguments);return function(){for(var t=o.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,o,n){if(e)if(t&&e.forEach&&e.forEach===t)e.forEach(o,n);else if(e.length===e.length+0){var i,r=void 0;for(r=0,i=e.length;r<i;r++)if(r in e&&o.call(n,e[r],r)===this.BREAK)return}else for(var a in e)if(o.call(n,e[a],a)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,o){var n=void 0;return function(){var i=this,r=arguments;var a=o||!n;clearTimeout(n),n=setTimeout((function(){n=null,o||e.apply(i,r)}),t),a&&e.apply(i,r)}},toArray:function(e){return e.toArray?e.toArray():o.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return isNaN(e)})),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},i=[{litmus:n.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:n.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:n.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:n.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(n.isNumber(e.r)&&n.isNumber(e.g)&&n.isNumber(e.b)&&n.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(n.isNumber(e.r)&&n.isNumber(e.g)&&n.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(n.isNumber(e.h)&&n.isNumber(e.s)&&n.isNumber(e.v)&&n.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(n.isNumber(e.h)&&n.isNumber(e.s)&&n.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],r=void 0,a=void 0,s=function(){a=!1;var e=arguments.length>1?n.toArray(arguments):arguments[0];return n.each(i,(function(t){if(t.litmus(e))return n.each(t.conversions,(function(t,o){if(r=t.read(e),!1===a&&!1!==r)return a=r,r.conversionName=o,r.conversion=t,n.BREAK})),n.BREAK})),a},l=void 0,c={hsv_to_rgb:function(e,t,o){var n=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),r=o*(1-t),a=o*(1-i*t),s=o*(1-(1-i)*t),l=[[o,s,r],[a,o,r],[r,o,s],[r,a,o],[s,r,o],[o,r,a]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,o){var n=Math.min(e,t,o),i=Math.max(e,t,o),r=i-n,a=void 0;return 0===i?{h:NaN,s:0,v:0}:(a=e===i?(t-o)/r:t===i?2+(o-e)/r:4+(e-t)/r,(a/=6)<0&&(a+=1),{h:360*a,s:r/i,v:i/255})},rgb_to_hex:function(e,t,o){var n=this.hex_with_component(0,2,e);return n=this.hex_with_component(n,1,t),n=this.hex_with_component(n,0,o)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,o){return o<<(l=8*t)|e&~(255<<l)}},u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},p=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),f=function e(t,o,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,o);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,o,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0},m=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},h=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},g=function(){function t(){if(d(this,t),this.__state=s.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return p(t,[{key:"toString",value:function(){return e(this)}},{key:"toHexString",value:function(){return e(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function y(e,t,o){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||g.recalculateRGB(this,t,o),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(g.recalculateRGB(this,t,o),this.__state.space="RGB"),this.__state[t]=e}})}function v(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||g.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(g.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}g.recalculateRGB=function(e,t,o){if("HEX"===e.__state.space)e.__state[t]=c.component_from_hex(e.__state.hex,o);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");n.extend(e.__state,c.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},g.recalculateHSV=function(e){var t=c.rgb_to_hsv(e.r,e.g,e.b);n.extend(e.__state,{s:t.s,v:t.v}),n.isNaN(t.h)?n.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},g.COMPONENTS=["r","g","b","h","s","v","hex","a"],y(g.prototype,"r",2),y(g.prototype,"g",1),y(g.prototype,"b",0),v(g.prototype,"h"),v(g.prototype,"s"),v(g.prototype,"v"),Object.defineProperty(g.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(g.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=c.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var b=function(){function e(t,o){d(this,e),this.initialValue=t[o],this.domElement=document.createElement("div"),this.object=t,this.property=o,this.__onChange=void 0,this.__onFinishChange=void 0}return p(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),_={};n.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(e,t){n.each(e,(function(e){_[e]=t}))}));var x=/(\d+(\.\d+)?)px/;function w(e){if("0"===e||n.isUndefined(e))return 0;var t=e.match(x);return n.isNull(t)?0:parseFloat(t[1])}var S={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,o){var i=o,r=t;n.isUndefined(r)&&(r=!0),n.isUndefined(i)&&(i=!0),e.style.position="absolute",r&&(e.style.left=0,e.style.right=0),i&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,o,i){var r=o||{},a=_[t];if(!a)throw new Error("Event type "+t+" not supported.");var s=document.createEvent(a);switch(a){case"MouseEvents":var l=r.x||r.clientX||0,c=r.y||r.clientY||0;s.initMouseEvent(t,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,l,c,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var u=s.initKeyboardEvent||s.initKeyEvent;n.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),u(t,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:s.initEvent(t,r.bubbles||!1,r.cancelable||!0)}n.defaults(s,i),e.dispatchEvent(s)},bind:function(e,t,o,n){var i=n||!1;return e.addEventListener?e.addEventListener(t,o,{passive:i}):e.attachEvent&&e.attachEvent("on"+t,o),S},unbind:function(e,t,o,n){var i=n||!1;return e.removeEventListener?e.removeEventListener(t,o,i):e.detachEvent&&e.detachEvent("on"+t,o),S},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var o=e.className.split(/ +/);-1===o.indexOf(t)&&(o.push(t),e.className=o.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return S},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var o=e.className.split(/ +/),n=o.indexOf(t);-1!==n&&(o.splice(n,1),e.className=o.join(" "))}else e.className=void 0;return S},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return w(t["border-left-width"])+w(t["border-right-width"])+w(t["padding-left"])+w(t["padding-right"])+w(t.width)},getHeight:function(e){var t=getComputedStyle(e);return w(t["border-top-width"])+w(t["border-bottom-width"])+w(t["padding-top"])+w(t["padding-bottom"])+w(t.height)},getOffset:function(e){var t=e,o={left:0,top:0};if(t.offsetParent)do{o.left+=t.offsetLeft,o.top+=t.offsetTop,t=t.offsetParent}while(t);return o},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},T=function(e){function t(e,o){d(this,t);var n=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),i=n;return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),S.bind(n.__checkbox,"change",(function(){i.setValue(!i.__prev)}),!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return m(t,e),p(t,[{key:"setValue",value:function(e){var o=f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),o}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(b),C=function(e){function t(e,o,i){d(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),a=i,s=r;if(r.__select=document.createElement("select"),n.isArray(a)){var l={};n.each(a,(function(e){l[e]=e})),a=l}return n.each(a,(function(e,t){var o=document.createElement("option");o.innerHTML=t,o.setAttribute("value",e),s.__select.appendChild(o)})),r.updateDisplay(),S.bind(r.__select,"change",(function(){var e=this.options[this.selectedIndex].value;s.setValue(e)})),r.domElement.appendChild(r.__select),r}return m(t,e),p(t,[{key:"setValue",value:function(e){var o=f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),o}},{key:"updateDisplay",value:function(){return S.isActive(this.__select)?this:(this.__select.value=this.getValue(),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(b),E=function(e){function t(e,o){d(this,t);var n=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),i=n;function r(){i.setValue(i.__input.value)}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),S.bind(n.__input,"keyup",r),S.bind(n.__input,"change",r),S.bind(n.__input,"blur",(function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())})),S.bind(n.__input,"keydown",(function(e){13===e.keyCode&&this.blur()})),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return m(t,e),p(t,[{key:"updateDisplay",value:function(){return S.isActive(this.__input)||(this.__input.value=this.getValue()),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(b);function A(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var P=function(e){function t(e,o,i){d(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),a=i||{};return r.__min=a.min,r.__max=a.max,r.__step=a.step,n.isUndefined(r.__step)?0===r.initialValue?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=A(r.__impliedStep),r}return m(t,e),p(t,[{key:"setValue",value:function(e){var o=e;return void 0!==this.__min&&o<this.__min?o=this.__min:void 0!==this.__max&&o>this.__max&&(o=this.__max),void 0!==this.__step&&o%this.__step!=0&&(o=Math.round(o/this.__step)*this.__step),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,o)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=A(e),this}}]),t}(b);var O=function(e){function t(e,o,i){d(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o,i));r.__truncationSuspended=!1;var a=r,s=void 0;function l(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function c(e){var t=s-e.clientY;a.setValue(a.getValue()+t*a.__impliedStep),s=e.clientY}function u(){S.unbind(window,"mousemove",c),S.unbind(window,"mouseup",u),l()}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),S.bind(r.__input,"change",(function(){var e=parseFloat(a.__input.value);n.isNaN(e)||a.setValue(e)})),S.bind(r.__input,"blur",(function(){l()})),S.bind(r.__input,"mousedown",(function(e){S.bind(window,"mousemove",c),S.bind(window,"mouseup",u),s=e.clientY})),S.bind(r.__input,"keydown",(function(e){13===e.keyCode&&(a.__truncationSuspended=!0,this.blur(),a.__truncationSuspended=!1,l())})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return m(t,e),p(t,[{key:"updateDisplay",value:function(){var e,o,n;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),o=this.__precision,n=Math.pow(10,o),Math.round(e*n)/n),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(P);function k(e,t,o,n,i){return n+(e-t)/(o-t)*(i-n)}var z=function(e){function t(e,o,n,i,r,a){d(this,t);var s=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o,{min:n,max:i,step:r})),l=s;function c(e){l.newBool||e.preventDefault();var t=l.__background.getBoundingClientRect();return l.setValue(k(e.clientX,t.left,t.right,l.__min,l.__max)),!1}function u(){S.unbind(window,"mousemove",c),S.unbind(window,"mouseup",u),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}function p(e){var t=e.touches[0].clientX,o=l.__background.getBoundingClientRect();l.setValue(k(t,o.left,o.right,l.__min,l.__max))}function f(){S.unbind(window,"touchmove",p),S.unbind(window,"touchend",f),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),s.newBool=a,S.bind(s.__background,"mousedown",(function(e){document.activeElement.blur(),S.bind(window,"mousemove",c),S.bind(window,"mouseup",u),c(e)}),a),S.bind(s.__background,"touchstart",(function(e){if(1!==e.touches.length)return;S.bind(window,"touchmove",p),S.bind(window,"touchend",f),p(e)})),S.addClass(s.__background,"slider"),S.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return m(t,e),p(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(P),D=function(e){function t(e,o,n){d(this,t);var i=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),r=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===n?"Fire":n,S.bind(i.__button,"click",(function(e){return e.preventDefault(),r.fire(),!1})),S.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return m(t,e),p(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(b),N=function(e){function t(e,o){d(this,t);var i=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o));i.__color=new g(i.getValue()),i.__temp=new g(0);var r=i;i.domElement=document.createElement("div"),S.makeSelectable(i.domElement,!1),i.__selector=document.createElement("div"),i.__selector.className="selector",i.__saturation_field=document.createElement("div"),i.__saturation_field.className="saturation-field",i.__field_knob=document.createElement("div"),i.__field_knob.className="field-knob",i.__field_knob_border="2px solid ",i.__hue_knob=document.createElement("div"),i.__hue_knob.className="hue-knob",i.__hue_field=document.createElement("div"),i.__hue_field.className="hue-field",i.__input=document.createElement("input"),i.__input.type="text",i.__input_textShadow="0 1px 1px ",S.bind(i.__input,"keydown",(function(e){13===e.keyCode&&m.call(this)})),S.bind(i.__input,"blur",m),S.bind(i.__selector,"mousedown",(function(){S.addClass(this,"drag").bind(window,"mouseup",(function(){S.removeClass(r.__selector,"drag")}))})),S.bind(i.__selector,"touchstart",(function(){S.addClass(this,"drag").bind(window,"touchend",(function(){S.removeClass(r.__selector,"drag")}))}));var a,l=document.createElement("div");function c(e){v(e),S.bind(window,"mousemove",v),S.bind(window,"touchmove",v),S.bind(window,"mouseup",p),S.bind(window,"touchend",p)}function u(e){b(e),S.bind(window,"mousemove",b),S.bind(window,"touchmove",b),S.bind(window,"mouseup",f),S.bind(window,"touchend",f)}function p(){S.unbind(window,"mousemove",v),S.unbind(window,"touchmove",v),S.unbind(window,"mouseup",p),S.unbind(window,"touchend",p),y()}function f(){S.unbind(window,"mousemove",b),S.unbind(window,"touchmove",b),S.unbind(window,"mouseup",f),S.unbind(window,"touchend",f),y()}function m(){var e=s(this.value);!1!==e?(r.__color.__state=e,r.setValue(r.__color.toOriginal())):this.value=r.__color.toString()}function y(){r.__onFinishChange&&r.__onFinishChange.call(r,r.__color.toOriginal())}function v(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=r.__saturation_field.getBoundingClientRect(),o=e.touches&&e.touches[0]||e,n=o.clientX,i=o.clientY,a=(n-t.left)/(t.right-t.left),s=1-(i-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),a>1?a=1:a<0&&(a=0),r.__color.v=s,r.__color.s=a,r.setValue(r.__color.toOriginal()),!1}function b(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=r.__hue_field.getBoundingClientRect(),o=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return o>1?o=1:o<0&&(o=0),r.__color.h=360*o,r.setValue(r.__color.toOriginal()),!1}return n.extend(i.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),n.extend(i.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:i.__field_knob_border+(i.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),n.extend(i.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),n.extend(i.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),n.extend(l.style,{width:"100%",height:"100%",background:"none"}),M(l,"top","rgba(0,0,0,0)","#000"),n.extend(i.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(a=i.__hue_field).style.background="",a.style.cssText+="background: -moz-linear-gradient(top,\t#ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",a.style.cssText+="background: -webkit-linear-gradient(top,\t#ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -o-linear-gradient(top,\t#ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -ms-linear-gradient(top,\t#ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: linear-gradient(top,\t#ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.extend(i.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:i.__input_textShadow+"rgba(0,0,0,0.7)"}),S.bind(i.__saturation_field,"mousedown",c),S.bind(i.__saturation_field,"touchstart",c),S.bind(i.__field_knob,"mousedown",c),S.bind(i.__field_knob,"touchstart",c),S.bind(i.__hue_field,"mousedown",u),S.bind(i.__hue_field,"touchstart",u),i.__saturation_field.appendChild(l),i.__selector.appendChild(i.__field_knob),i.__selector.appendChild(i.__saturation_field),i.__selector.appendChild(i.__hue_field),i.__hue_field.appendChild(i.__hue_knob),i.domElement.appendChild(i.__input),i.domElement.appendChild(i.__selector),i.updateDisplay(),i}return m(t,e),p(t,[{key:"updateDisplay",value:function(){var e=s(this.getValue());if(!1!==e){var t=!1;n.each(g.COMPONENTS,(function(o){if(!n.isUndefined(e[o])&&!n.isUndefined(this.__color.__state[o])&&e[o]!==this.__color.__state[o])return t=!0,{}}),this),t&&n.extend(this.__color.__state,e)}n.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var o=this.__color.v<.5||this.__color.s>.5?255:0,i=255-o;n.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+o+","+o+","+o+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,M(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),n.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+o+","+o+","+o+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),t}(b),F=["-moz-","-o-","-webkit-","-ms-",""];function M(e,t,o,i){e.style.background="",n.each(F,(function(n){e.style.cssText+="background: "+n+"linear-gradient("+t+", "+o+" 0%, "+i+" 100%); "}))}var L=function(e,t){var o=e[t];return n.isArray(arguments[2])||n.isObject(arguments[2])?new C(e,t,arguments[2]):n.isNumber(o)?n.isNumber(arguments[2])&&n.isNumber(arguments[3])?n.isNumber(arguments[4])?new z(e,t,arguments[2],arguments[3],arguments[4],arguments[5]):new z(e,t,arguments[2],arguments[3]):n.isNumber(arguments[4])?new O(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new O(e,t,{min:arguments[2],max:arguments[3]}):n.isString(o)?new E(e,t):n.isFunction(o)?new D(e,t,""):n.isBoolean(o)?new T(e,t):null},I=function(e){function t(e,o){d(this,t);var n=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o));return n.arguments={object:e,property:o,opts:Array.prototype.slice.call(arguments,2)},e.property&&(n.property=e.property(n)),n}return m(t,e),p(t,[{key:"controller",set:function(e){this._controller=e},get:function(){return this._controller}}]),t}(b),R=function(e,t){var o=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e;var i=o.getElementsByTagName("head")[0];try{i.appendChild(n)}catch(e){}};var j=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},V=function(){function e(){d(this,e),this.backgroundElement=document.createElement("div"),n.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),S.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),n.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;S.bind(this.backgroundElement,"click",(function(){t.hide()}))}return p(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),n.defer((function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",S.unbind(e.domElement,"webkitTransitionEnd",t),S.unbind(e.domElement,"transitionend",t),S.unbind(e.domElement,"oTransitionEnd",t)};S.bind(this.domElement,"webkitTransitionEnd",t),S.bind(this.domElement,"transitionend",t),S.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-S.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-S.getHeight(this.domElement)/2+"px"}}]),e}(),B=function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");R(B);var H="Default",G=function(){try{return!!window.localStorage}catch(e){return!1}}(),U=void 0,X=!0,W=void 0,q=!1,Y=[],Z=function e(t){var o=this,i=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),S.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=n.defaults(i,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),i=n.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),n.isUndefined(i.load)?i.load={preset:H}:i.preset&&(i.load.preset=i.preset),n.isUndefined(i.parent)&&i.hideable&&Y.push(this),i.resizable=n.isUndefined(i.parent)&&i.resizable,i.autoPlace&&n.isUndefined(i.scrollable)&&(i.scrollable=!0);var r,a=G&&"true"===localStorage.getItem(te(this,"isLocal")),s=void 0,l=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return o.parent?o.getRoot().preset:i.load.preset},set:function(e){o.parent?o.getRoot().preset=e:i.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),o.revert()}},width:{get:function(){return i.width},set:function(e){i.width=e,ie(o,e)}},name:{get:function(){return i.name},set:function(e){i.name=e,l&&(l.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(t){i.closed=t,i.closed?S.addClass(o.__ul,e.CLASS_CLOSED):S.removeClass(o.__ul,e.CLASS_CLOSED),this.onResize(),o.__closeButton&&(o.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return a},set:function(e){G&&(a=e,e?S.bind(window,"unload",s):S.unbind(window,"unload",s),localStorage.setItem(te(o,"isLocal"),e))}}}),n.isUndefined(i.parent)){if(this.closed=i.closed||!1,S.addClass(this.domElement,e.CLASS_MAIN),S.makeSelectable(this.domElement,!1),G&&a){o.useLocalStorage=!0;var c=localStorage.getItem(te(this,"gui"));c&&(i.load=JSON.parse(c))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,S.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),i.closeOnTop?(S.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(S.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),S.bind(this.__closeButton,"click",(function(){o.closed=!o.closed}))}else{void 0===i.closed&&(i.closed=!0);var u=document.createTextNode(i.name);S.addClass(u,"controller-name"),l=J(o,u);S.addClass(this.__ul,e.CLASS_CLOSED),S.addClass(l,"title"),S.bind(l,"click",(function(e){return e.preventDefault(),o.closed=!o.closed,!1})),i.closed||(this.closed=!1)}i.autoPlace&&(n.isUndefined(i.parent)&&(X&&(W=document.createElement("div"),S.addClass(W,"dg"),S.addClass(W,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(W),X=!1),W.appendChild(this.domElement),S.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||ie(o,i.width)),this.__resizeHandler=function(){o.onResizeDebounced()},S.bind(window,"resize",this.__resizeHandler),S.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),S.bind(this.__ul,"transitionend",this.__resizeHandler),S.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&function(e){var t=void 0;function o(o){return o.preventDefault(),e.width+=t-o.clientX,e.onResize(),t=o.clientX,!1}function i(){S.removeClass(e.__closeButton,Z.CLASS_DRAG),S.unbind(window,"mousemove",o),S.unbind(window,"mouseup",i)}function r(n){return n.preventDefault(),t=n.clientX,S.addClass(e.__closeButton,Z.CLASS_DRAG),S.bind(window,"mousemove",o),S.bind(window,"mouseup",i),!1}e.__resize_handle=document.createElement("div"),n.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),S.bind(e.__resize_handle,"mousedown",r),S.bind(e.__closeButton,"mousedown",r),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}(this),s=function(){G&&"true"===localStorage.getItem(te(o,"isLocal"))&&localStorage.setItem(te(o,"gui"),JSON.stringify(o.getSaveObject()))},this.saveToLocalStorageIfPossible=s,i.parent||((r=o.getRoot()).width+=1,n.defer((function(){r.width-=1})))};function J(e,t,o){var n=document.createElement("li");return t&&n.appendChild(t),o?e.__ul.insertBefore(n,o):e.__ul.appendChild(n),e.onResize(),n}function K(e){S.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&S.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function Q(e,t){var o=e.__preset_select[e.__preset_select.selectedIndex];o.innerHTML=t?o.value+"*":o.value}function $(e,t){var o=e.getRoot(),n=o.__rememberedObjects.indexOf(t.object);if(-1!==n){var i=o.__rememberedObjectIndecesToControllers[n];if(void 0===i&&(i={},o.__rememberedObjectIndecesToControllers[n]=i),i[t.property]=t,o.load&&o.load.remembered){var r=o.load.remembered,a=void 0;if(r[e.preset])a=r[e.preset];else{if(!r[H])return;a=r[H]}if(a[n]&&void 0!==a[n][t.property]){var s=a[n][t.property];t.initialValue=s,t.setValue(s)}}}}function ee(e,t,o,i){var r;if(t.arguments&&(t=(r=t).arguments.object,o=r.arguments.property,i={factoryArgs:r.arguments.opts}),void 0===r&&void 0===t[o])throw new Error('Object "'+t+'" has no property "'+o+'"');var a=void 0;if(i.color)a=new N(t,o);else if(void 0!==r&&"string"==typeof r.property)a=r;else{var s=[t,o].concat(i.factoryArgs);a=L.apply(e,s)}null===a?a=r:void 0!==r&&(r.controller=a),i.before instanceof b&&(i.before=i.before.__li),$(e,a),S.addClass(a.domElement,"c");var l=document.createElement("span");if(S.addClass(l,"property-name"),void 0!==r&&"object"===u(r.property))for(var c in r.property)l.appendChild(r.property[c]);else l.innerHTML=a.property;var d=document.createElement("div");d.appendChild(l),d.appendChild(a.domElement);var p=J(e,d,i.before);return S.addClass(p,Z.CLASS_CONTROLLER_ROW),a instanceof N?S.addClass(p,"color"):S.addClass(p,u(a.getValue())),function(e,t,o){if(o.__li=t,o.__gui=e,n.extend(o,{options:function(t){if(arguments.length>1){var i=o.__li.nextElementSibling;return o.remove(),ee(e,o.object,o.property,{before:i,factoryArgs:[n.toArray(arguments)]})}if(n.isArray(t)||n.isObject(t)){var r=o.__li.nextElementSibling;return o.remove(),ee(e,o.object,o.property,{before:r,factoryArgs:[t]})}},name:function(e){return o.__li.firstElementChild.firstElementChild.innerHTML=e,o},listen:function(){return o.__gui.listen(o),o},remove:function(){return o.__gui.remove(o),o}}),o instanceof z){var i=new O(o.object,o.property,{min:o.__min,max:o.__max,step:o.__step});n.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(e){var t=o[e],n=i[e];o[e]=i[e]=function(){var e=Array.prototype.slice.call(arguments);return n.apply(i,e),t.apply(o,e)}})),S.addClass(t,"has-slider"),o.domElement.insertBefore(i.domElement,o.domElement.firstElementChild)}else if(o instanceof O){var r=function(t){if(n.isNumber(o.__min)&&n.isNumber(o.__max)){var i=o.__li.firstElementChild.firstElementChild.innerHTML,r=o.__gui.__listening.indexOf(o)>-1;o.remove();var a=ee(e,o.object,o.property,{before:o.__li.nextElementSibling,factoryArgs:[o.__min,o.__max,o.__step]});return a.name(i),r&&a.listen(),a}return t};o.min=n.compose(r,o.min),o.max=n.compose(r,o.max)}else o instanceof T?(S.bind(t,"click",(function(){S.fakeEvent(o.__checkbox,"click")})),S.bind(o.__checkbox,"click",(function(e){e.stopPropagation()}))):o instanceof D?(S.bind(t,"click",(function(){S.fakeEvent(o.__button,"click")})),S.bind(t,"mouseover",(function(){S.addClass(o.__button,"hover")})),S.bind(t,"mouseout",(function(){S.removeClass(o.__button,"hover")}))):o instanceof N&&(S.addClass(t,"color"),o.updateDisplay=n.compose((function(e){return t.style.borderLeftColor=o.__color.toString(),e}),o.updateDisplay),o.updateDisplay());o.setValue=n.compose((function(t){return e.getRoot().__preset_select&&o.isModified()&&Q(e.getRoot(),!0),t}),o.setValue)}(e,p,a),e.__controllers.push(a),a}function te(e,t){return document.location.href+"."+t}function oe(e,t,o){var n=document.createElement("option");n.innerHTML=t,n.value=t,e.__preset_select.appendChild(n),o&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function ne(e,t){t.style.display=e.useLocalStorage?"block":"none"}function ie(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function re(e,t){var o={};return n.each(e.__rememberedObjects,(function(i,r){var a={},s=e.__rememberedObjectIndecesToControllers[r];n.each(s,(function(e,o){a[o]=t?e.initialValue:e.getValue()})),o[r]=a})),o}function ae(e){0!==e.length&&j.call(window,(function(){ae(e)})),n.each(e,(function(e){e.updateDisplay()}))}Z.toggleHide=function(){q=!q,n.each(Y,(function(e){e.domElement.style.display=q?"none":""}))},Z.CLASS_AUTO_PLACE="a",Z.CLASS_AUTO_PLACE_CONTAINER="ac",Z.CLASS_MAIN="main",Z.CLASS_CONTROLLER_ROW="cr",Z.CLASS_TOO_TALL="taller-than-window",Z.CLASS_CLOSED="closed",Z.CLASS_CLOSE_BUTTON="close-button",Z.CLASS_CLOSE_TOP="close-top",Z.CLASS_CLOSE_BOTTOM="close-bottom",Z.CLASS_DRAG="drag",Z.DEFAULT_WIDTH=245,Z.TEXT_CLOSED="Close Controls",Z.TEXT_OPEN="Open Controls",Z._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||Z.toggleHide()},S.bind(window,"keydown",Z._keydownHandler,!1),n.extend(Z.prototype,{add:function(e,t){return ee(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return ee(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;n.defer((function(){t.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&W.removeChild(this.domElement);var e=this;n.each(this.__folders,(function(t){e.removeFolder(t)})),S.unbind(window,"keydown",Z._keydownHandler,!1),K(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var o=new Z(t);this.__folders[e]=o;var n=J(this,o.domElement);return S.addClass(n,"folder"),o},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],K(e);var t=this;n.each(e.__folders,(function(t){e.removeFolder(t)})),n.defer((function(){t.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=S.getOffset(e.__ul).top,o=0;n.each(e.__ul.childNodes,(function(t){e.autoPlace&&t===e.__save_row||(o+=S.getHeight(t))})),window.innerHeight-t-20<o?(S.addClass(e.domElement,Z.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(S.removeClass(e.domElement,Z.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&n.defer((function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:n.debounce((function(){this.onResize()}),50),remember:function(){if(n.isUndefined(U)&&((U=new V).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n\tHere\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n\t<textarea id="dg-new-constructor"></textarea>\n\n\t<div id="dg-save-locally">\n\n\t\t<input id="dg-local-storage" type="checkbox"/> Automatically save\n\t\tvalues to <code>localStorage</code> on exit.\n\n\t\t<div id="dg-local-explain">The values saved to <code>localStorage</code> will\n\t\t\toverride those passed to <code>dat.GUI</code>\'s constructor. This makes it\n\t\t\teasier to work incrementally, but <code>localStorage</code> is fragile,\n\t\t\tand your friends may not see the same values you do.\n\n\t\t</div>\n\n\t</div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;n.each(Array.prototype.slice.call(arguments),(function(t){0===e.__rememberedObjects.length&&function(e){var t=e.__save_row=document.createElement("li");S.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),S.addClass(t,"save-row");var o=document.createElement("span");o.innerHTML="&nbsp;",S.addClass(o,"button gears");var i=document.createElement("span");i.innerHTML="Save",S.addClass(i,"button"),S.addClass(i,"save");var r=document.createElement("span");r.innerHTML="New",S.addClass(r,"button"),S.addClass(r,"save-as");var a=document.createElement("span");a.innerHTML="Revert",S.addClass(a,"button"),S.addClass(a,"revert");var s=e.__preset_select=document.createElement("select");e.load&&e.load.remembered?n.each(e.load.remembered,(function(t,o){oe(e,o,o===e.preset)})):oe(e,H,!1);if(S.bind(s,"change",(function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value})),t.appendChild(s),t.appendChild(o),t.appendChild(i),t.appendChild(r),t.appendChild(a),G){var l=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(te(e,"isLocal"))&&c.setAttribute("checked","checked"),ne(e,l),S.bind(c,"change",(function(){e.useLocalStorage=!e.useLocalStorage,ne(e,l)}))}var u=document.getElementById("dg-new-constructor");S.bind(u,"keydown",(function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||U.hide()})),S.bind(o,"click",(function(){u.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),U.show(),u.focus(),u.select()})),S.bind(i,"click",(function(){e.save()})),S.bind(r,"click",(function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)})),S.bind(a,"click",(function(){e.revert()}))}(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)})),this.autoPlace&&ie(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=re(this)),e.folders={},n.each(this.__folders,(function(t,o){e.folders[o]=t.getSaveObject()})),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=re(this),Q(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[H]=re(this,!0)),this.load.remembered[e]=re(this),this.preset=e,oe(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){n.each(this.__controllers,(function(t){this.getRoot().load.remembered?$(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}),this),n.each(this.__folders,(function(e){e.revert(e)})),e||Q(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&ae(this.__listening)},updateDisplay:function(){n.each(this.__controllers,(function(e){e.updateDisplay()})),n.each(this.__folders,(function(e){e.updateDisplay()}))}});var se,le,ce,ue,de=I,pe=Z,fe=function(e,t){t=t||{};var o=document.createElement("span");if(o.innerHTML=e,void 0!==t.title&&(o.title=t.title),void 0!==t.onclick&&(o.style.cursor="pointer",o.onclick=t.onclick),void 0!==t.onwheel){function n(e){var o=(e=e||window.event).deltaY||e.detail||e.wheelDelta;t.onwheel(o)}o.style.cursor="n-resize",o.addEventListener?"onwheel"in document?o.addEventListener("wheel",n,{passive:!0}):"onmousewheel"in document?o.addEventListener("mousewheel",n):o.addEventListener("MozMousePixelScroll",n):o.attachEvent("onmousewheel",n)}return o.style.margin="0px 2px",o};class me{constructor(){}set THREE(e){if(se)return void(Object.is(e,se)||console.error("three: duplicate THREE. Please use one instance of the THREE library."));se=e,ce=this;const t=e.Float32BufferAttribute,o=e.Line3,n=e.Plane,i=e.Triangle,r=e.Vector3;function a(){const e=new r,t=new o,a=new n,s=new r,l=new i;this.ConvexHull=class{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new p,this.unassigned=new p,this.vertices=[]}setFromPoints(e){!0!==Array.isArray(e)&&console.error("THREE.ConvexHull: Points parameter is not an array."),e.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(let t=0,o=e.length;t<o;t++)this.vertices.push(new d(e[t]));return this.compute(),this}setFromObject(e){const t=[];return e.updateMatrixWorld(!0),e.traverse((function(e){const o=e.geometry;if(void 0!==o){if(o.isGeometry)return void console.error("THREE.ConvexHull no longer supports Geometry. Use THREE.BufferGeometry instead.");if(o.isBufferGeometry){const n=o.attributes.position;if(void 0!==n)for(let o=0,i=n.count;o<i;o++){const i=new r;i.fromBufferAttribute(n,o).applyMatrix4(e.matrixWorld),t.push(i)}}}})),this.setFromPoints(t)}containsPoint(e){const t=this.faces;for(let o=0,n=t.length;o<n;o++){if(t[o].distanceToPoint(e)>this.tolerance)return!1}return!0}intersectRay(e,t){const o=this.faces;let n=-1/0,i=1/0;for(let t=0,r=o.length;t<r;t++){const r=o[t],a=r.distanceToPoint(e.origin),s=r.normal.dot(e.direction);if(a>0&&s>=0)return null;const l=0!==s?-a/s:0;if(!(l<=0)&&(s>0?i=Math.min(l,i):n=Math.max(l,n),n>i))return null}return n!==-1/0?e.at(n,t):e.at(i,t),t}intersectsRay(t){return null!==this.intersectRay(t,e)}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return e.face=t,null===t.outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(null!==e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(null!==e.outside){const t=e.outside;let o=e.outside;for(;null!==o.next&&o.next.face===e;)o=o.next;return this.assigned.removeSubList(t,o),t.prev=o.next=null,e.outside=null,t}}deleteFaceVertices(e,t){const o=this.removeAllVerticesFromFace(e);if(void 0!==o)if(void 0===t)this.unassigned.appendChain(o);else{let e=o;do{const o=e.next;t.distanceToPoint(e.point)>this.tolerance?this.addVertexToFace(e,t):this.unassigned.append(e),e=o}while(null!==e)}return this}resolveUnassignedPoints(e){if(!1===this.unassigned.isEmpty()){let t=this.unassigned.first();do{const o=t.next;let n=this.tolerance,i=null;for(let o=0;o<e.length;o++){const r=e[o];if(0===r.mark){const e=r.distanceToPoint(t.point);if(e>n&&(n=e,i=r),n>1e3*this.tolerance)break}}null!==i&&this.addVertexToFace(t,i),t=o}while(null!==t)}return this}computeExtremes(){const e=new r,t=new r,o=[],n=[];for(let e=0;e<3;e++)o[e]=n[e]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let i=0,r=this.vertices.length;i<r;i++){const r=this.vertices[i],a=r.point;for(let t=0;t<3;t++)a.getComponent(t)<e.getComponent(t)&&(e.setComponent(t,a.getComponent(t)),o[t]=r);for(let e=0;e<3;e++)a.getComponent(e)>t.getComponent(e)&&(t.setComponent(e,a.getComponent(e)),n[e]=r)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:o,max:n}}computeInitialHull(){const e=this.vertices,o=this.computeExtremes(),n=o.min,i=o.max;let r=0,l=0;for(let e=0;e<3;e++){const t=i[e].point.getComponent(e)-n[e].point.getComponent(e);t>r&&(r=t,l=e)}const u=n[l],d=i[l];let p,f;r=0,t.set(u.point,d.point);for(let o=0,n=this.vertices.length;o<n;o++){const n=e[o];if(n!==u&&n!==d){t.closestPointToPoint(n.point,!0,s);const e=s.distanceToSquared(n.point);e>r&&(r=e,p=n)}}r=-1,a.setFromCoplanarPoints(u.point,d.point,p.point);for(let t=0,o=this.vertices.length;t<o;t++){const o=e[t];if(o!==u&&o!==d&&o!==p){const e=Math.abs(a.distanceToPoint(o.point));e>r&&(r=e,f=o)}}const m=[];if(a.distanceToPoint(f.point)<0){m.push(c.create(u,d,p),c.create(f,d,u),c.create(f,p,d),c.create(f,u,p));for(let e=0;e<3;e++){const t=(e+1)%3;m[e+1].getEdge(2).setTwin(m[0].getEdge(t)),m[e+1].getEdge(1).setTwin(m[t+1].getEdge(0))}}else{m.push(c.create(u,p,d),c.create(f,u,d),c.create(f,d,p),c.create(f,p,u));for(let e=0;e<3;e++){const t=(e+1)%3;m[e+1].getEdge(2).setTwin(m[0].getEdge((3-e)%3)),m[e+1].getEdge(0).setTwin(m[t+1].getEdge(1))}}for(let e=0;e<4;e++)this.faces.push(m[e]);for(let t=0,o=e.length;t<o;t++){const o=e[t];if(o!==u&&o!==d&&o!==p&&o!==f){r=this.tolerance;let e=null;for(let t=0;t<4;t++){const n=this.faces[t].distanceToPoint(o.point);n>r&&(r=n,e=this.faces[t])}null!==e&&this.addVertexToFace(o,e)}}return this}reindexFaces(){const e=[];for(let t=0;t<this.faces.length;t++){const o=this.faces[t];0===o.mark&&e.push(o)}return this.faces=e,this}nextVertexToAdd(){if(!1===this.assigned.isEmpty()){let e,t=0;const o=this.assigned.first().face;let n=o.outside;do{const i=o.distanceToPoint(n.point);i>t&&(t=i,e=n),n=n.next}while(null!==n&&n.face===o);return e}}computeHorizon(e,t,o,n){let i;this.deleteFaceVertices(o),o.mark=1,i=null===t?t=o.getEdge(0):t.next;do{const t=i.twin,o=t.face;0===o.mark&&(o.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,t,o,n):n.push(i)),i=i.next}while(i!==t);return this}addAdjoiningFace(e,t){const o=c.create(e,t.tail(),t.head());return this.faces.push(o),o.getEdge(-1).setTwin(t.twin),o.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let o=null,n=null;for(let i=0;i<t.length;i++){const r=t[i],a=this.addAdjoiningFace(e,r);null===o?o=a:a.next.setTwin(n),this.newFaces.push(a.face),n=a}return o.next.setTwin(n),this}addVertexToHull(e){const t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;for(this.computeInitialHull();void 0!==(e=this.nextVertexToAdd());)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}};class c{constructor(){this.normal=new r,this.midpoint=new r,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}static create(e,t,o){const n=new c,i=new u(e,n),r=new u(t,n),a=new u(o,n);return i.next=a.prev=r,r.next=i.prev=a,a.next=r.prev=i,n.edge=i,n.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){const e=this.edge.tail(),t=this.edge.head(),o=this.edge.next.head();return l.set(e.point,t.point,o.point),l.getNormal(this.normal),l.getMidpoint(this.midpoint),this.area=l.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}class u{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1}lengthSquared(){const e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}}class d{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}}class p{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this}remove(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return null===this.head}}}this.ConvexHull=(new a).ConvexHull;const s=ue.THREE.Vector2,l=ue.THREE.Box3,c=ue.THREE.BufferAttribute,u=ue.THREE.Uint16BufferAttribute,d=ue.THREE.Uint32BufferAttribute,p=ue.THREE.Sphere,f=ue.THREE.Object3D,m=ue.THREE.Matrix4,h=ue.THREE.Matrix3,g=ue.THREE.arrayMax,y=ue.THREE.MathUtils;class v{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const o=this._listeners;void 0===o[e]&&(o[e]=[]),-1===o[e].indexOf(t)&&o[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const o=this._listeners;return void 0!==o[e]&&-1!==o[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const o=this._listeners[e];if(void 0!==o){const e=o.indexOf(t);-1!==e&&o.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const o=t.slice(0);for(let t=0,n=o.length;t<n;t++)o[t].call(this,e);e.target=null}}}let b=0;const _=new m,x=new f,w=new r,S=new l,T=new l,C=new r;class E extends v{constructor(){super(),Object.defineProperty(this,"id",{value:b++}),this.uuid=y.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(g(e)>65535?d:u)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,o=0){this.groups.push({start:e,count:t,materialIndex:o})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const o=this.attributes.normal;if(void 0!==o){const t=(new h).getNormalMatrix(e);o.applyNormalMatrix(t),o.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return _.makeRotationFromQuaternion(e),this.applyMatrix4(_),this}rotateX(e){return _.makeRotationX(e),this.applyMatrix4(_),this}rotateY(e){return _.makeRotationY(e),this.applyMatrix4(_),this}rotateZ(e){return _.makeRotationZ(e),this.applyMatrix4(_),this}translate(e,t,o){return _.makeTranslation(e,t,o),this.applyMatrix4(_),this}scale(e,t,o){return _.makeScale(e,t,o),this.applyMatrix4(_),this}lookAt(e){return x.lookAt(e),x.updateMatrix(),this.applyMatrix4(x.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(w).negate(),this.translate(w.x,w.y,w.z),this}setFromPoints(e){const o=[];for(let t=0,n=e.length;t<n;t++){const n=e[t];o.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new t(o,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new l);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new r(-1/0,-1/0,-1/0),new r(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,o=t.length;e<o;e++){const o=t[e];S.setFromBufferAttribute(o),this.morphTargetsRelative?(C.addVectors(this.boundingBox.min,S.min),this.boundingBox.expandByPoint(C),C.addVectors(this.boundingBox.max,S.max),this.boundingBox.expandByPoint(C)):(this.boundingBox.expandByPoint(S.min),this.boundingBox.expandByPoint(S.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new p);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new r,1/0);if(e){const o=this.boundingSphere.center;if(S.setFromBufferAttribute(e),t)for(let e=0,o=t.length;e<o;e++){const o=t[e];T.setFromBufferAttribute(o),this.morphTargetsRelative?(C.addVectors(S.min,T.min),S.expandByPoint(C),C.addVectors(S.max,T.max),S.expandByPoint(C)):(S.expandByPoint(T.min),S.expandByPoint(T.max))}S.getCenter(o);let n=0;for(let t=0,i=e.count;t<i;t++)C.fromBufferAttribute(e,t),n=Math.max(n,o.distanceToSquared(C));if(t)for(let i=0,r=t.length;i<r;i++){const r=t[i],a=this.morphTargetsRelative;for(let t=0,i=r.count;t<i;t++)C.fromBufferAttribute(r,t),a&&(w.fromBufferAttribute(e,t),C.add(w)),n=Math.max(n,o.distanceToSquared(C))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const o=e.array,n=t.position.array,i=t.normal.array,a=t.uv.array,l=n.length/3;void 0===t.tangent&&this.setAttribute("tangent",new c(new Float32Array(4*l),4));const u=t.tangent.array,d=[],p=[];for(let e=0;e<l;e++)d[e]=new r,p[e]=new r;const f=new r,m=new r,h=new r,g=new s,y=new s,v=new s,b=new r,_=new r;function x(e,t,o){f.fromArray(n,3*e),m.fromArray(n,3*t),h.fromArray(n,3*o),g.fromArray(a,2*e),y.fromArray(a,2*t),v.fromArray(a,2*o),m.sub(f),h.sub(f),y.sub(g),v.sub(g);const i=1/(y.x*v.y-v.x*y.y);isFinite(i)&&(b.copy(m).multiplyScalar(v.y).addScaledVector(h,-y.y).multiplyScalar(i),_.copy(h).multiplyScalar(y.x).addScaledVector(m,-v.x).multiplyScalar(i),d[e].add(b),d[t].add(b),d[o].add(b),p[e].add(_),p[t].add(_),p[o].add(_))}let w=this.groups;0===w.length&&(w=[{start:0,count:o.length}]);for(let e=0,t=w.length;e<t;++e){const t=w[e],n=t.start;for(let e=n,i=n+t.count;e<i;e+=3)x(o[e+0],o[e+1],o[e+2])}const S=new r,T=new r,C=new r,E=new r;function A(e){C.fromArray(i,3*e),E.copy(C);const t=d[e];S.copy(t),S.sub(C.multiplyScalar(C.dot(t))).normalize(),T.crossVectors(E,t);const o=T.dot(p[e])<0?-1:1;u[4*e]=S.x,u[4*e+1]=S.y,u[4*e+2]=S.z,u[4*e+3]=o}for(let e=0,t=w.length;e<t;++e){const t=w[e],n=t.start;for(let e=n,i=n+t.count;e<i;e+=3)A(o[e+0]),A(o[e+1]),A(o[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let o=this.getAttribute("normal");if(void 0===o)o=new c(new Float32Array(3*t.count),3),this.setAttribute("normal",o);else for(let e=0,t=o.count;e<t;e++)o.setXYZ(e,0,0,0);const n=new r,i=new r,a=new r,s=new r,l=new r,u=new r,d=new r,p=new r;if(e)for(let r=0,c=e.count;r<c;r+=3){const c=e.getX(r+0),f=e.getX(r+1),m=e.getX(r+2);n.fromBufferAttribute(t,c),i.fromBufferAttribute(t,f),a.fromBufferAttribute(t,m),d.subVectors(a,i),p.subVectors(n,i),d.cross(p),s.fromBufferAttribute(o,c),l.fromBufferAttribute(o,f),u.fromBufferAttribute(o,m),s.add(d),l.add(d),u.add(d),o.setXYZ(c,s.x,s.y,s.z),o.setXYZ(f,l.x,l.y,l.z),o.setXYZ(m,u.x,u.y,u.z)}else for(let e=0,r=t.count;e<r;e+=3)n.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),d.subVectors(a,i),p.subVectors(n,i),d.cross(p),o.setXYZ(e+0,d.x,d.y,d.z),o.setXYZ(e+1,d.x,d.y,d.z),o.setXYZ(e+2,d.x,d.y,d.z);this.normalizeNormals(),o.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const o=this.attributes;for(const n in o){if(void 0===e.attributes[n])continue;const i=o[n].array,r=e.attributes[n],a=r.array,s=r.itemSize*t,l=Math.min(a.length,i.length-s);for(let e=0,t=s;e<l;e++,t++)i[t]=a[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,o=e.count;t<o;t++)C.fromBufferAttribute(e,t),C.normalize(),e.setXYZ(t,C.x,C.y,C.z)}toNonIndexed(){function e(e,t){const o=e.array,n=e.itemSize,i=e.normalized,r=new o.constructor(t.length*n);let a=0,s=0;for(let i=0,l=t.length;i<l;i++){a=e.isInterleavedBufferAttribute?t[i]*e.data.stride+e.offset:t[i]*n;for(let e=0;e<n;e++)r[s++]=o[a++]}return new c(r,n,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new E,o=this.index.array,n=this.attributes;for(const i in n){const r=e(n[i],o);t.setAttribute(i,r)}const i=this.morphAttributes;for(const n in i){const r=[],a=i[n];for(let t=0,n=a.length;t<n;t++){const n=e(a[t],o);r.push(n)}t.morphAttributes[n]=r}t.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let e=0,o=r.length;e<o;e++){const o=r[e];t.addGroup(o.start,o.count,o.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const o in t)void 0!==t[o]&&(e[o]=t[o]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const o=this.attributes;for(const t in o){const n=o[t];e.data.attributes[t]=n.toJSON(e.data)}const n={};let i=!1;for(const t in this.morphAttributes){const o=this.morphAttributes[t],r=[];for(let t=0,n=o.length;t<n;t++){const n=o[t];r.push(n.toJSON(e.data))}r.length>0&&(n[t]=r,i=!0)}i&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(e.data.groups=JSON.parse(JSON.stringify(r)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const o=e.index;null!==o&&this.setIndex(o.clone(t));const n=e.attributes;for(const e in n){const o=n[e];this.setAttribute(e,o.clone(t))}const i=e.morphAttributes;for(const e in i){const o=[],n=i[e];for(let e=0,i=n.length;e<i;e++)o.push(n[e].clone(t));this.morphAttributes[e]=o}this.morphTargetsRelative=e.morphTargetsRelative;const r=e.groups;for(let e=0,t=r.length;e<t;e++){const t=r[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}E.prototype.isBufferGeometry=!0;this.ConvexGeometry=class extends E{constructor(e){super();const o=[],n=[];void 0===a&&console.error("THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on ConvexHull");const i=(new ce.ConvexHull).setFromPoints(e).faces;for(let e=0;e<i.length;e++){const t=i[e];let r=t.edge;do{const e=r.head().point;o.push(e.x,e.y,e.z),n.push(t.normal.x,t.normal.y,t.normal.z),r=r.next}while(r!==t.edge)}this.setAttribute("position",new t(o,3)),this.setAttribute("normal",new t(n,3))}};const A=ue.THREE.MOUSE,P=ue.THREE.Quaternion,O=ue.THREE.Spherical,k=ue.THREE.TOUCH,z={type:"change"},D={type:"start"},N={type:"end"};this.OrbitControls=class extends v{constructor(e,t){super(),void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new r,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:A.ROTATE,MIDDLE:A.DOLLY,RIGHT:A.PAN},this.touches={ONE:k.ROTATE,TWO:k.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",Q),this._domElementKeyEvents=e},this.saveState=function(){o.target0.copy(o.target),o.position0.copy(o.object.position),o.zoom0=o.object.zoom},this.reset=function(){o.target.copy(o.target0),o.object.position.copy(o.position0),o.object.zoom=o.zoom0,o.object.updateProjectionMatrix(),o.dispatchEvent(z),o.update(),i=n.NONE},this.update=function(){const t=new r,s=(new P).setFromUnitVectors(e.up,new r(0,1,0)),f=s.clone().invert(),m=new r,h=new P,g=2*Math.PI;return function(){const e=o.object.position;t.copy(e).sub(o.target),t.applyQuaternion(s),l.setFromVector3(t),o.autoRotate&&i===n.NONE&&C(2*Math.PI/60/60*o.autoRotateSpeed),o.enableDamping?(l.theta+=c.theta*o.dampingFactor,l.phi+=c.phi*o.dampingFactor):(l.theta+=c.theta,l.phi+=c.phi);let r=o.minAzimuthAngle,y=o.maxAzimuthAngle;return isFinite(r)&&isFinite(y)&&(r<-Math.PI?r+=g:r>Math.PI&&(r-=g),y<-Math.PI?y+=g:y>Math.PI&&(y-=g),l.theta=r<=y?Math.max(r,Math.min(y,l.theta)):l.theta>(r+y)/2?Math.max(r,l.theta):Math.min(y,l.theta)),l.phi=Math.max(o.minPolarAngle,Math.min(o.maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=u,l.radius=Math.max(o.minDistance,Math.min(o.maxDistance,l.radius)),!0===o.enableDamping?o.target.addScaledVector(d,o.dampingFactor):o.target.add(d),t.setFromSpherical(l),t.applyQuaternion(f),e.copy(o.target).add(t),o.object.lookAt(o.target),!0===o.enableDamping?(c.theta*=1-o.dampingFactor,c.phi*=1-o.dampingFactor,d.multiplyScalar(1-o.dampingFactor)):(c.set(0,0,0),d.set(0,0,0)),u=1,!!(p||m.distanceToSquared(o.object.position)>a||8*(1-h.dot(o.object.quaternion))>a)&&(o.dispatchEvent(z),m.copy(o.object.position),h.copy(o.object.quaternion),p=!1,!0)}}(),this.dispose=function(){o.domElement.removeEventListener("contextmenu",$),o.domElement.removeEventListener("pointerdown",q),o.domElement.removeEventListener("pointercancel",J),o.domElement.removeEventListener("wheel",K),o.domElement.removeEventListener("pointermove",Y),o.domElement.removeEventListener("pointerup",Z),null!==o._domElementKeyEvents&&o._domElementKeyEvents.removeEventListener("keydown",Q)};const o=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=n.NONE;const a=1e-6,l=new O,c=new O;let u=1;const d=new r;let p=!1;const f=new s,m=new s,h=new s,g=new s,y=new s,v=new s,b=new s,_=new s,x=new s,w=[],S={};function T(){return Math.pow(.95,o.zoomSpeed)}function C(e){c.theta-=e}function E(e){c.phi-=e}const F=function(){const e=new r;return function(t,o){e.setFromMatrixColumn(o,0),e.multiplyScalar(-t),d.add(e)}}(),M=function(){const e=new r;return function(t,n){!0===o.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(o.object.up,e)),e.multiplyScalar(t),d.add(e)}}(),L=function(){const e=new r;return function(t,n){const i=o.domElement;if(o.object.isPerspectiveCamera){const r=o.object.position;e.copy(r).sub(o.target);let a=e.length();a*=Math.tan(o.object.fov/2*Math.PI/180),F(2*t*a/i.clientHeight,o.object.matrix),M(2*n*a/i.clientHeight,o.object.matrix)}else o.object.isOrthographicCamera?(F(t*(o.object.right-o.object.left)/o.object.zoom/i.clientWidth,o.object.matrix),M(n*(o.object.top-o.object.bottom)/o.object.zoom/i.clientHeight,o.object.matrix)):(console.warn("WARNING: OrbitControls encountered an unknown camera type - pan disabled."),o.enablePan=!1)}}();function I(e){o.object.isPerspectiveCamera?u/=e:o.object.isOrthographicCamera?(o.object.zoom=Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom*e)),o.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls encountered an unknown camera type - dolly/zoom disabled."),o.enableZoom=!1)}function R(e){o.object.isPerspectiveCamera?u*=e:o.object.isOrthographicCamera?(o.object.zoom=Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom/e)),o.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls encountered an unknown camera type - dolly/zoom disabled."),o.enableZoom=!1)}function j(e){f.set(e.clientX,e.clientY)}function V(e){g.set(e.clientX,e.clientY)}function B(){if(1===w.length)f.set(w[0].pageX,w[0].pageY);else{const e=.5*(w[0].pageX+w[1].pageX),t=.5*(w[0].pageY+w[1].pageY);f.set(e,t)}}function H(){if(1===w.length)g.set(w[0].pageX,w[0].pageY);else{const e=.5*(w[0].pageX+w[1].pageX),t=.5*(w[0].pageY+w[1].pageY);g.set(e,t)}}function G(){const e=w[0].pageX-w[1].pageX,t=w[0].pageY-w[1].pageY,o=Math.sqrt(e*e+t*t);b.set(0,o)}function U(e){if(1==w.length)m.set(e.pageX,e.pageY);else{const t=oe(e),o=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);m.set(o,n)}h.subVectors(m,f).multiplyScalar(o.rotateSpeed);const t=o.domElement;C(2*Math.PI*h.x/t.clientHeight),E(2*Math.PI*h.y/t.clientHeight),f.copy(m)}function X(e){if(1===w.length)y.set(e.pageX,e.pageY);else{const t=oe(e),o=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);y.set(o,n)}v.subVectors(y,g).multiplyScalar(o.panSpeed),L(v.x,v.y),g.copy(y)}function W(e){const t=oe(e),n=e.pageX-t.x,i=e.pageY-t.y,r=Math.sqrt(n*n+i*i);_.set(0,r),x.set(0,Math.pow(_.y/b.y,o.zoomSpeed)),I(x.y),b.copy(_)}function q(e){!1!==o.enabled&&(0===w.length&&(o.domElement.setPointerCapture(e.pointerId),o.domElement.addEventListener("pointermove",Y),o.domElement.addEventListener("pointerup",Z)),function(e){w.push(e)}(e),"touch"===e.pointerType?function(e){switch(te(e),w.length){case 1:switch(o.touches.ONE){case k.ROTATE:if(!1===o.enableRotate)return;B(),i=n.TOUCH_ROTATE;break;case k.PAN:if(!1===o.enablePan)return;H(),i=n.TOUCH_PAN;break;default:i=n.NONE}break;case 2:switch(o.touches.TWO){case k.DOLLY_PAN:if(!1===o.enableZoom&&!1===o.enablePan)return;o.enableZoom&&G(),o.enablePan&&H(),i=n.TOUCH_DOLLY_PAN;break;case k.DOLLY_ROTATE:if(!1===o.enableZoom&&!1===o.enableRotate)return;o.enableZoom&&G(),o.enableRotate&&B(),i=n.TOUCH_DOLLY_ROTATE;break;default:i=n.NONE}break;default:i=n.NONE}i!==n.NONE&&o.dispatchEvent(D)}(e):function(e){let t;switch(e.button){case 0:t=o.mouseButtons.LEFT;break;case 1:t=o.mouseButtons.MIDDLE;break;case 2:t=o.mouseButtons.RIGHT;break;default:t=-1}switch(t){case A.DOLLY:if(!1===o.enableZoom)return;!function(e){b.set(e.clientX,e.clientY)}(e),i=n.DOLLY;break;case A.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===o.enablePan)return;V(e),i=n.PAN}else{if(!1===o.enableRotate)return;j(e),i=n.ROTATE}break;case A.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===o.enableRotate)return;j(e),i=n.ROTATE}else{if(!1===o.enablePan)return;V(e),i=n.PAN}break;default:i=n.NONE}i!==n.NONE&&o.dispatchEvent(D)}(e))}function Y(e){!1!==o.enabled&&("touch"===e.pointerType?function(e){switch(te(e),i){case n.TOUCH_ROTATE:if(!1===o.enableRotate)return;U(e),o.update();break;case n.TOUCH_PAN:if(!1===o.enablePan)return;X(e),o.update();break;case n.TOUCH_DOLLY_PAN:if(!1===o.enableZoom&&!1===o.enablePan)return;!function(e){o.enableZoom&&W(e),o.enablePan&&X(e)}(e),o.update();break;case n.TOUCH_DOLLY_ROTATE:if(!1===o.enableZoom&&!1===o.enableRotate)return;!function(e){o.enableZoom&&W(e),o.enableRotate&&U(e)}(e),o.update();break;default:i=n.NONE}}(e):function(e){if(!1===o.enabled)return;switch(i){case n.ROTATE:if(!1===o.enableRotate)return;!function(e){m.set(e.clientX,e.clientY),h.subVectors(m,f).multiplyScalar(o.rotateSpeed);const t=o.domElement;C(2*Math.PI*h.x/t.clientHeight),E(2*Math.PI*h.y/t.clientHeight),f.copy(m),o.update()}(e);break;case n.DOLLY:if(!1===o.enableZoom)return;!function(e){_.set(e.clientX,e.clientY),x.subVectors(_,b),x.y>0?I(T()):x.y<0&&R(T()),b.copy(_),o.update()}(e);break;case n.PAN:if(!1===o.enablePan)return;!function(e){y.set(e.clientX,e.clientY),v.subVectors(y,g).multiplyScalar(o.panSpeed),L(v.x,v.y),g.copy(y),o.update()}(e)}}(e))}function Z(e){!1!==o.enabled&&(e.pointerType,o.dispatchEvent(N),i=n.NONE,ee(e),0===w.length&&(o.domElement.releasePointerCapture(e.pointerId),o.domElement.removeEventListener("pointermove",Y),o.domElement.removeEventListener("pointerup",Z)))}function J(e){ee(e)}function K(e){!1===o.enabled||!1===o.enableZoom||i!==n.NONE&&i!==n.ROTATE||(e.preventDefault(),o.dispatchEvent(D),function(e){e.deltaY<0?R(T()):e.deltaY>0&&I(T()),o.update()}(e),o.dispatchEvent(N))}function Q(e){!1!==o.enabled&&!1!==o.enablePan&&function(e){let t=!1;switch(e.code){case o.keys.UP:L(0,o.keyPanSpeed),t=!0;break;case o.keys.BOTTOM:L(0,-o.keyPanSpeed),t=!0;break;case o.keys.LEFT:L(o.keyPanSpeed,0),t=!0;break;case o.keys.RIGHT:L(-o.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),o.update())}(e)}function $(e){!1!==o.enabled&&e.preventDefault()}function ee(e){delete S[e.pointerId];for(let t=0;t<w.length;t++)if(w[t].pointerId==e.pointerId)return void w.splice(t,1)}function te(e){let t=S[e.pointerId];void 0===t&&(t=new s,S[e.pointerId]=t),t.set(e.pageX,e.pageY)}function oe(e){const t=e.pointerId===w[0].pointerId?w[1]:w[0];return S[t.pointerId]}o.domElement.addEventListener("contextmenu",$),o.domElement.addEventListener("pointerdown",q),o.domElement.addEventListener("pointercancel",J),o.domElement.addEventListener("wheel",K,{passive:!1}),this.update()}}}get THREE(){return void 0===se&&console.error("three: invalid _THREE = "+se+". Call three.THREE = THREE first."),se}set dat(e){le?Object.is(e,le)||console.error("three: duplicate dat. Please use one instance of the dat library."):le=e}get dat(){return le}}window.__myThree__=window.__myThree__||{},window.__myThree__.three?ue=window.__myThree__.three:((ue=new me).isThree=function(){return se},window.__myThree__.three=ue);var he=ue;
/**
   * @module ScaleController
   * @description is dat.GUI graphical user interface controller for control of the scale of threejs 3D object
   * 
   * @see {@link https://threejs.org/} about threejs
   * @see {@link https://github.com/dataarts/dat.gui} about dat.GUI
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */class ge extends de{constructor(e,t){(t=t||{}).settings=t.settings||{},t.settings.zoomMultiplier=t.settings.zoomMultiplier||1.1,super({multiplier:t.settings.zoomMultiplier,property:function(o){var n={zoom:"Zoom",in:"in",out:"out",wheelZoom:"Scroll the mouse wheel to zoom"},i=void 0===t.getLanguageCode?"en":t.getLanguageCode();switch(i){case"ru":n.zoom="Изменить",n.in="увеличить",n.out="уменьшить",n.wheelZoom="Прокрутите колесико мыши для изменения масштаба";break;default:if(void 0===t.lang||t.lang.languageCode!=i)break;Object.keys(t.lang).forEach((function(e){void 0!==n[e]&&(n[e]=t.lang[e])}))}var r={},a=fe;return r.zoomLabel=a(n.zoom,{title:n.wheelZoom,onwheel:function(t){e(o,(function(e,o){return t>0?e*=o:e/=o,e}))}}),r.in=a("↑",{title:n.in,onclick:function(){e(o,(function(e,t){return e*=t}))}}),r.out=a("↓",{title:n.out,onclick:function(){e(o,(function(e,t){return e/=t}))}}),r}},"multiplier",1.1,10,.1,t.newBool),void 0===this.property&&console.error("init() returns "+this.property)}}
/**
   * PositionController is dat.GUI graphical user interface controller for control of the position of threejs 3D object
   * 
   * @see {@link https://threejs.org/} about threejs
   * @see {@link https://github.com/dataarts/dat.gui} about dat.GUI
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */
class ye extends de{constructor(e,t){(t=t||{}).settings=t.settings||{};var o=t.settings;void 0===t.min&&(t.min=.1),void 0===t.max&&(t.max=10),void 0===o.offset&&(o.offset=.1),void 0===t.step&&(t.step=.1),super({offset:o.offset,property:function(o){var n={offset:"Offset",add:"add",subtract:"subtract",wheelPosition:"Scroll the mouse wheel to change the position"},i=void 0===t.getLanguageCode?"en":t.getLanguageCode();switch(i){case"ru":n.offset="Сдвиг",n.add="добавить",n.subtract="вычесть",n.wheelPosition="Прокрутите колесико мыши для изменения позиции";break;default:if(void 0===t.lang||t.lang.languageCode!=i)break;Object.keys(t.lang).forEach((function(e){void 0!==n[e]&&(n[e]=t.lang[e])}))}var r={},a=fe;return r.Label=a(n.offset,{title:n.wheelPosition,onwheel:function(t){var n=o.controller.getValue();e(t>0?n:-n)}}),r.in=a("↑",{title:n.add,onclick:function(){e(o.controller.getValue())}}),r.out=a("↓",{title:n.subtract,onclick:function(){e(-o.controller.getValue())}}),r}},"offset",t.min,t.max,t.step),void 0===this.property&&console.error("init() returns "+this.property)}}function ve(e,t){var o=e.__state.conversionName.toString(),n=Math.round(e.r),i=Math.round(e.g),r=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===o||"SIX_CHAR_HEX"===o){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===o?"rgb("+n+","+i+","+r+")":"CSS_RGBA"===o?"rgba("+n+","+i+","+r+","+a+")":"HEX"===o?"0x"+e.hex.toString(16):"RGB_ARRAY"===o?"["+n+","+i+","+r+"]":"RGBA_ARRAY"===o?"["+n+","+i+","+r+","+a+"]":"RGB_OBJ"===o?"{r:"+n+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===o?"{r:"+n+",g:"+i+",b:"+r+",a:"+a+"}":"HSV_OBJ"===o?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===o?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var be=Array.prototype.forEach,_e=Array.prototype.slice,xe={BREAK:{},extend:function(e){return this.each(_e.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(o){this.isUndefined(t[o])||(e[o]=t[o])}.bind(this))}),this),e},defaults:function(e){return this.each(_e.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(o){this.isUndefined(e[o])&&(e[o]=t[o])}.bind(this))}),this),e},compose:function(){var e=_e.call(arguments);return function(){for(var t=_e.call(arguments),o=e.length-1;o>=0;o--)t=[e[o].apply(this,t)];return t[0]}},each:function(e,t,o){if(e)if(be&&e.forEach&&e.forEach===be)e.forEach(t,o);else if(e.length===e.length+0){var n,i=void 0;for(i=0,n=e.length;i<n;i++)if(i in e&&t.call(o,e[i],i)===this.BREAK)return}else for(var r in e)if(t.call(o,e[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,o){var n=void 0;return function(){var i=this,r=arguments;var a=o||!n;clearTimeout(n),n=setTimeout((function(){n=null,o||e.apply(i,r)}),t),a&&e.apply(i,r)}},toArray:function(e){return e.toArray?e.toArray():_e.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return isNaN(e)})),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},we=[{litmus:xe.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:ve},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:ve},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:ve},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:ve}}},{litmus:xe.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:xe.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:xe.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(xe.isNumber(e.r)&&xe.isNumber(e.g)&&xe.isNumber(e.b)&&xe.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(xe.isNumber(e.r)&&xe.isNumber(e.g)&&xe.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(xe.isNumber(e.h)&&xe.isNumber(e.s)&&xe.isNumber(e.v)&&xe.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(xe.isNumber(e.h)&&xe.isNumber(e.s)&&xe.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Se=void 0,Te=void 0,Ce=function(){Te=!1;var e=arguments.length>1?xe.toArray(arguments):arguments[0];return xe.each(we,(function(t){if(t.litmus(e))return xe.each(t.conversions,(function(t,o){if(Se=t.read(e),!1===Te&&!1!==Se)return Te=Se,Se.conversionName=o,Se.conversion=t,xe.BREAK})),xe.BREAK})),Te},Ee=void 0,Ae={hsv_to_rgb:function(e,t,o){var n=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),r=o*(1-t),a=o*(1-i*t),s=o*(1-(1-i)*t),l=[[o,s,r],[a,o,r],[r,o,s],[r,a,o],[s,r,o],[o,r,a]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,o){var n=Math.min(e,t,o),i=Math.max(e,t,o),r=i-n,a=void 0;return 0===i?{h:NaN,s:0,v:0}:(a=e===i?(t-o)/r:t===i?2+(o-e)/r:4+(e-t)/r,(a/=6)<0&&(a+=1),{h:360*a,s:r/i,v:i/255})},rgb_to_hex:function(e,t,o){var n=this.hex_with_component(0,2,e);return n=this.hex_with_component(n,1,t),n=this.hex_with_component(n,0,o)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,o){return o<<(Ee=8*t)|e&~(255<<Ee)}},Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oe=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ke=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),ze=function e(t,o,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,o);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,o,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0},De=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Ne=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},Fe=function(){function e(){if(Oe(this,e),this.__state=Ce.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return ke(e,[{key:"toString",value:function(){return ve(this)}},{key:"toHexString",value:function(){return ve(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function Me(e,t,o){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||Fe.recalculateRGB(this,t,o),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(Fe.recalculateRGB(this,t,o),this.__state.space="RGB"),this.__state[t]=e}})}function Le(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||Fe.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(Fe.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}Fe.recalculateRGB=function(e,t,o){if("HEX"===e.__state.space)e.__state[t]=Ae.component_from_hex(e.__state.hex,o);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");xe.extend(e.__state,Ae.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},Fe.recalculateHSV=function(e){var t=Ae.rgb_to_hsv(e.r,e.g,e.b);xe.extend(e.__state,{s:t.s,v:t.v}),xe.isNaN(t.h)?xe.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},Fe.COMPONENTS=["r","g","b","h","s","v","hex","a"],Me(Fe.prototype,"r",2),Me(Fe.prototype,"g",1),Me(Fe.prototype,"b",0),Le(Fe.prototype,"h"),Le(Fe.prototype,"s"),Le(Fe.prototype,"v"),Object.defineProperty(Fe.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(Fe.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=Ae.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var Ie=function(){function e(t,o){Oe(this,e),this.initialValue=t[o],this.domElement=document.createElement("div"),this.object=t,this.property=o,this.__onChange=void 0,this.__onFinishChange=void 0}return ke(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),Re={};xe.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(e,t){xe.each(e,(function(e){Re[e]=t}))}));var je=/(\d+(\.\d+)?)px/;function Ve(e){if("0"===e||xe.isUndefined(e))return 0;var t=e.match(je);return xe.isNull(t)?0:parseFloat(t[1])}var Be={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,o){var n=o,i=t;xe.isUndefined(i)&&(i=!0),xe.isUndefined(n)&&(n=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,o,n){var i=o||{},r=Re[t];if(!r)throw new Error("Event type "+t+" not supported.");var a=document.createEvent(r);switch(r){case"MouseEvents":var s=i.x||i.clientX||0,l=i.y||i.clientY||0;a.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,s,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=a.initKeyboardEvent||a.initKeyEvent;xe.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:a.initEvent(t,i.bubbles||!1,i.cancelable||!0)}xe.defaults(a,n),e.dispatchEvent(a)},bind:function(e,t,o,n){var i=n||!1;return e.addEventListener?e.addEventListener(t,o,{passive:i}):e.attachEvent&&e.attachEvent("on"+t,o),Be},unbind:function(e,t,o,n){var i=n||!1;return e.removeEventListener?e.removeEventListener(t,o,i):e.detachEvent&&e.detachEvent("on"+t,o),Be},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var o=e.className.split(/ +/);-1===o.indexOf(t)&&(o.push(t),e.className=o.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return Be},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var o=e.className.split(/ +/),n=o.indexOf(t);-1!==n&&(o.splice(n,1),e.className=o.join(" "))}else e.className=void 0;return Be},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return Ve(t["border-left-width"])+Ve(t["border-right-width"])+Ve(t["padding-left"])+Ve(t["padding-right"])+Ve(t.width)},getHeight:function(e){var t=getComputedStyle(e);return Ve(t["border-top-width"])+Ve(t["border-bottom-width"])+Ve(t["padding-top"])+Ve(t["padding-bottom"])+Ve(t.height)},getOffset:function(e){var t=e,o={left:0,top:0};if(t.offsetParent)do{o.left+=t.offsetLeft,o.top+=t.offsetTop,t=t.offsetParent}while(t);return o},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},He=function(e){function t(e,o){Oe(this,t);var n=Ne(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),i=n;return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),Be.bind(n.__checkbox,"change",(function(){i.setValue(!i.__prev)}),!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return De(t,e),ke(t,[{key:"setValue",value:function(e){var o=ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),o}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Ie),Ge=function(e){function t(e,o,n){Oe(this,t);var i=Ne(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),r=n,a=i;if(i.__select=document.createElement("select"),xe.isArray(r)){var s={};xe.each(r,(function(e){s[e]=e})),r=s}return xe.each(r,(function(e,t){var o=document.createElement("option");o.innerHTML=t,o.setAttribute("value",e),a.__select.appendChild(o)})),i.updateDisplay(),Be.bind(i.__select,"change",(function(){var e=this.options[this.selectedIndex].value;a.setValue(e)})),i.domElement.appendChild(i.__select),i}return De(t,e),ke(t,[{key:"setValue",value:function(e){var o=ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),o}},{key:"updateDisplay",value:function(){return Be.isActive(this.__select)?this:(this.__select.value=this.getValue(),ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(Ie),Ue=function(e){function t(e,o){Oe(this,t);var n=Ne(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),i=n;function r(){i.setValue(i.__input.value)}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),Be.bind(n.__input,"keyup",r),Be.bind(n.__input,"change",r),Be.bind(n.__input,"blur",(function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())})),Be.bind(n.__input,"keydown",(function(e){13===e.keyCode&&this.blur()})),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return De(t,e),ke(t,[{key:"updateDisplay",value:function(){return Be.isActive(this.__input)||(this.__input.value=this.getValue()),ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Ie);function Xe(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var We=function(e){function t(e,o,n){Oe(this,t);var i=Ne(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),r=n||{};return i.__min=r.min,i.__max=r.max,i.__step=r.step,xe.isUndefined(i.__step)?0===i.initialValue?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=Xe(i.__impliedStep),i}return De(t,e),ke(t,[{key:"setValue",value:function(e){var o=e;return void 0!==this.__min&&o<this.__min?o=this.__min:void 0!==this.__max&&o>this.__max&&(o=this.__max),void 0!==this.__step&&o%this.__step!=0&&(o=Math.round(o/this.__step)*this.__step),ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,o)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=Xe(e),this}}]),t}(Ie);var qe=function(e){function t(e,o,n){Oe(this,t);var i=Ne(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o,n));i.__truncationSuspended=!1;var r=i,a=void 0;function s(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function l(e){var t=a-e.clientY;r.setValue(r.getValue()+t*r.__impliedStep),a=e.clientY}function c(){Be.unbind(window,"mousemove",l),Be.unbind(window,"mouseup",c),s()}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),Be.bind(i.__input,"change",(function(){var e=parseFloat(r.__input.value);xe.isNaN(e)||r.setValue(e)})),Be.bind(i.__input,"blur",(function(){s()})),Be.bind(i.__input,"mousedown",(function(e){Be.bind(window,"mousemove",l),Be.bind(window,"mouseup",c),a=e.clientY})),Be.bind(i.__input,"keydown",(function(e){13===e.keyCode&&(r.__truncationSuspended=!0,this.blur(),r.__truncationSuspended=!1,s())})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return De(t,e),ke(t,[{key:"updateDisplay",value:function(){var e,o,n;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),o=this.__precision,n=Math.pow(10,o),Math.round(e*n)/n),ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(We);function Ye(e,t,o,n,i){return n+(e-t)/(o-t)*(i-n)}var Ze=function(e){function t(e,o,n,i,r,a){Oe(this,t);var s=Ne(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o,{min:n,max:i,step:r})),l=s;function c(e){l.newBool||e.preventDefault();var t=l.__background.getBoundingClientRect();return l.setValue(Ye(e.clientX,t.left,t.right,l.__min,l.__max)),!1}function u(){Be.unbind(window,"mousemove",c),Be.unbind(window,"mouseup",u),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}function d(e){var t=e.touches[0].clientX,o=l.__background.getBoundingClientRect();l.setValue(Ye(t,o.left,o.right,l.__min,l.__max))}function p(){Be.unbind(window,"touchmove",d),Be.unbind(window,"touchend",p),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),s.newBool=a,Be.bind(s.__background,"mousedown",(function(e){document.activeElement.blur(),Be.bind(window,"mousemove",c),Be.bind(window,"mouseup",u),c(e)}),a),Be.bind(s.__background,"touchstart",(function(e){if(1!==e.touches.length)return;Be.bind(window,"touchmove",d),Be.bind(window,"touchend",p),d(e)})),Be.addClass(s.__background,"slider"),Be.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return De(t,e),ke(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(We),Je=function(e){function t(e,o,n){Oe(this,t);var i=Ne(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o)),r=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===n?"Fire":n,Be.bind(i.__button,"click",(function(e){return e.preventDefault(),r.fire(),!1})),Be.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return De(t,e),ke(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(Ie),Ke=function(e){function t(e,o){Oe(this,t);var n=Ne(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o));n.__color=new Fe(n.getValue()),n.__temp=new Fe(0);var i=n;n.domElement=document.createElement("div"),Be.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",Be.bind(n.__input,"keydown",(function(e){13===e.keyCode&&d.call(this)})),Be.bind(n.__input,"blur",d),Be.bind(n.__selector,"mousedown",(function(){Be.addClass(this,"drag").bind(window,"mouseup",(function(){Be.removeClass(i.__selector,"drag")}))})),Be.bind(n.__selector,"touchstart",(function(){Be.addClass(this,"drag").bind(window,"touchend",(function(){Be.removeClass(i.__selector,"drag")}))}));var r,a=document.createElement("div");function s(e){f(e),Be.bind(window,"mousemove",f),Be.bind(window,"touchmove",f),Be.bind(window,"mouseup",c),Be.bind(window,"touchend",c)}function l(e){m(e),Be.bind(window,"mousemove",m),Be.bind(window,"touchmove",m),Be.bind(window,"mouseup",u),Be.bind(window,"touchend",u)}function c(){Be.unbind(window,"mousemove",f),Be.unbind(window,"touchmove",f),Be.unbind(window,"mouseup",c),Be.unbind(window,"touchend",c),p()}function u(){Be.unbind(window,"mousemove",m),Be.unbind(window,"touchmove",m),Be.unbind(window,"mouseup",u),Be.unbind(window,"touchend",u),p()}function d(){var e=Ce(this.value);!1!==e?(i.__color.__state=e,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function p(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}function f(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__saturation_field.getBoundingClientRect(),o=e.touches&&e.touches[0]||e,n=o.clientX,r=o.clientY,a=(n-t.left)/(t.right-t.left),s=1-(r-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),a>1?a=1:a<0&&(a=0),i.__color.v=s,i.__color.s=a,i.setValue(i.__color.toOriginal()),!1}function m(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__hue_field.getBoundingClientRect(),o=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return o>1?o=1:o<0&&(o=0),i.__color.h=360*o,i.setValue(i.__color.toOriginal()),!1}return xe.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),xe.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),xe.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),xe.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),xe.extend(a.style,{width:"100%",height:"100%",background:"none"}),$e(a,"top","rgba(0,0,0,0)","#000"),xe.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(r=n.__hue_field).style.background="",r.style.cssText+="background: -moz-linear-gradient(top,\t#ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",r.style.cssText+="background: -webkit-linear-gradient(top,\t#ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -o-linear-gradient(top,\t#ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -ms-linear-gradient(top,\t#ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: linear-gradient(top,\t#ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",xe.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),Be.bind(n.__saturation_field,"mousedown",s),Be.bind(n.__saturation_field,"touchstart",s),Be.bind(n.__field_knob,"mousedown",s),Be.bind(n.__field_knob,"touchstart",s),Be.bind(n.__hue_field,"mousedown",l),Be.bind(n.__hue_field,"touchstart",l),n.__saturation_field.appendChild(a),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}return De(t,e),ke(t,[{key:"updateDisplay",value:function(){var e=Ce(this.getValue());if(!1!==e){var t=!1;xe.each(Fe.COMPONENTS,(function(o){if(!xe.isUndefined(e[o])&&!xe.isUndefined(this.__color.__state[o])&&e[o]!==this.__color.__state[o])return t=!0,{}}),this),t&&xe.extend(this.__color.__state,e)}xe.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var o=this.__color.v<.5||this.__color.s>.5?255:0,n=255-o;xe.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+o+","+o+","+o+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,$e(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),xe.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+o+","+o+","+o+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),t}(Ie),Qe=["-moz-","-o-","-webkit-","-ms-",""];function $e(e,t,o,n){e.style.background="",xe.each(Qe,(function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+o+" 0%, "+n+" 100%); "}))}var et=function(e,t){var o=e[t];return xe.isArray(arguments[2])||xe.isObject(arguments[2])?new Ge(e,t,arguments[2]):xe.isNumber(o)?xe.isNumber(arguments[2])&&xe.isNumber(arguments[3])?xe.isNumber(arguments[4])?new Ze(e,t,arguments[2],arguments[3],arguments[4],arguments[5]):new Ze(e,t,arguments[2],arguments[3]):xe.isNumber(arguments[4])?new qe(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new qe(e,t,{min:arguments[2],max:arguments[3]}):xe.isString(o)?new Ue(e,t):xe.isFunction(o)?new Je(e,t,""):xe.isBoolean(o)?new He(e,t):null},tt=function(e){function t(e,o){Oe(this,t);var n=Ne(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o));return n.arguments={object:e,property:o,opts:Array.prototype.slice.call(arguments,2)},e.property&&(n.property=e.property(n)),n}return De(t,e),ke(t,[{key:"controller",set:function(e){this._controller=e},get:function(){return this._controller}}]),t}(Ie),ot=function(e,t){var o=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e;var i=o.getElementsByTagName("head")[0];try{i.appendChild(n)}catch(e){}};var nt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},it=function(){function e(){Oe(this,e),this.backgroundElement=document.createElement("div"),xe.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),Be.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),xe.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;Be.bind(this.backgroundElement,"click",(function(){t.hide()}))}return ke(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),xe.defer((function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",Be.unbind(e.domElement,"webkitTransitionEnd",t),Be.unbind(e.domElement,"transitionend",t),Be.unbind(e.domElement,"oTransitionEnd",t)};Be.bind(this.domElement,"webkitTransitionEnd",t),Be.bind(this.domElement,"transitionend",t),Be.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-Be.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-Be.getHeight(this.domElement)/2+"px"}}]),e}(),rt=function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");ot(rt);var at="Default",st=function(){try{return!!window.localStorage}catch(e){return!1}}(),lt=void 0,ct=!0,ut=void 0,dt=!1,pt=[],ft=function e(t){var o=this,n=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),Be.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=xe.defaults(n,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),n=xe.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),xe.isUndefined(n.load)?n.load={preset:at}:n.preset&&(n.load.preset=n.preset),xe.isUndefined(n.parent)&&n.hideable&&pt.push(this),n.resizable=xe.isUndefined(n.parent)&&n.resizable,n.autoPlace&&xe.isUndefined(n.scrollable)&&(n.scrollable=!0);var i,r=st&&"true"===localStorage.getItem(bt(this,"isLocal")),a=void 0,s=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return o.parent?o.getRoot().preset:n.load.preset},set:function(e){o.parent?o.getRoot().preset=e:n.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),o.revert()}},width:{get:function(){return n.width},set:function(e){n.width=e,St(o,e)}},name:{get:function(){return n.name},set:function(e){n.name=e,s&&(s.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(t){n.closed=t,n.closed?Be.addClass(o.__ul,e.CLASS_CLOSED):Be.removeClass(o.__ul,e.CLASS_CLOSED),this.onResize(),o.__closeButton&&(o.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return r},set:function(e){st&&(r=e,e?Be.bind(window,"unload",a):Be.unbind(window,"unload",a),localStorage.setItem(bt(o,"isLocal"),e))}}}),xe.isUndefined(n.parent)){if(this.closed=n.closed||!1,Be.addClass(this.domElement,e.CLASS_MAIN),Be.makeSelectable(this.domElement,!1),st&&r){o.useLocalStorage=!0;var l=localStorage.getItem(bt(this,"gui"));l&&(n.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,Be.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),n.closeOnTop?(Be.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(Be.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),Be.bind(this.__closeButton,"click",(function(){o.closed=!o.closed}))}else{void 0===n.closed&&(n.closed=!0);var c=document.createTextNode(n.name);Be.addClass(c,"controller-name"),s=mt(o,c);Be.addClass(this.__ul,e.CLASS_CLOSED),Be.addClass(s,"title"),Be.bind(s,"click",(function(e){return e.preventDefault(),o.closed=!o.closed,!1})),n.closed||(this.closed=!1)}n.autoPlace&&(xe.isUndefined(n.parent)&&(ct&&(ut=document.createElement("div"),Be.addClass(ut,"dg"),Be.addClass(ut,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(ut),ct=!1),ut.appendChild(this.domElement),Be.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||St(o,n.width)),this.__resizeHandler=function(){o.onResizeDebounced()},Be.bind(window,"resize",this.__resizeHandler),Be.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),Be.bind(this.__ul,"transitionend",this.__resizeHandler),Be.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&wt(this),a=function(){st&&"true"===localStorage.getItem(bt(o,"isLocal"))&&localStorage.setItem(bt(o,"gui"),JSON.stringify(o.getSaveObject()))},this.saveToLocalStorageIfPossible=a,n.parent||((i=o.getRoot()).width+=1,xe.defer((function(){i.width-=1})))};function mt(e,t,o){var n=document.createElement("li");return t&&n.appendChild(t),o?e.__ul.insertBefore(n,o):e.__ul.appendChild(n),e.onResize(),n}function ht(e){Be.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&Be.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function gt(e,t){var o=e.__preset_select[e.__preset_select.selectedIndex];o.innerHTML=t?o.value+"*":o.value}function yt(e,t){var o=e.getRoot(),n=o.__rememberedObjects.indexOf(t.object);if(-1!==n){var i=o.__rememberedObjectIndecesToControllers[n];if(void 0===i&&(i={},o.__rememberedObjectIndecesToControllers[n]=i),i[t.property]=t,o.load&&o.load.remembered){var r=o.load.remembered,a=void 0;if(r[e.preset])a=r[e.preset];else{if(!r[at])return;a=r[at]}if(a[n]&&void 0!==a[n][t.property]){var s=a[n][t.property];t.initialValue=s,t.setValue(s)}}}}function vt(e,t,o,n){var i;if(t.arguments&&(t=(i=t).arguments.object,o=i.arguments.property,n={factoryArgs:i.arguments.opts}),void 0===i&&void 0===t[o])throw new Error('Object "'+t+'" has no property "'+o+'"');var r=void 0;if(n.color)r=new Ke(t,o);else if(void 0!==i&&"string"==typeof i.property)r=i;else{var a=[t,o].concat(n.factoryArgs);r=et.apply(e,a)}null===r?r=i:void 0!==i&&(i.controller=r),n.before instanceof Ie&&(n.before=n.before.__li),yt(e,r),Be.addClass(r.domElement,"c");var s=document.createElement("span");if(Be.addClass(s,"property-name"),void 0!==i&&"object"===Pe(i.property))for(var l in i.property)s.appendChild(i.property[l]);else s.innerHTML=r.property;var c=document.createElement("div");c.appendChild(s),c.appendChild(r.domElement);var u=mt(e,c,n.before);return Be.addClass(u,ft.CLASS_CONTROLLER_ROW),r instanceof Ke?Be.addClass(u,"color"):Be.addClass(u,Pe(r.getValue())),function(e,t,o){if(o.__li=t,o.__gui=e,xe.extend(o,{options:function(t){if(arguments.length>1){var n=o.__li.nextElementSibling;return o.remove(),vt(e,o.object,o.property,{before:n,factoryArgs:[xe.toArray(arguments)]})}if(xe.isArray(t)||xe.isObject(t)){var i=o.__li.nextElementSibling;return o.remove(),vt(e,o.object,o.property,{before:i,factoryArgs:[t]})}},name:function(e){return o.__li.firstElementChild.firstElementChild.innerHTML=e,o},listen:function(){return o.__gui.listen(o),o},remove:function(){return o.__gui.remove(o),o}}),o instanceof Ze){var n=new qe(o.object,o.property,{min:o.__min,max:o.__max,step:o.__step});xe.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(e){var t=o[e],i=n[e];o[e]=n[e]=function(){var e=Array.prototype.slice.call(arguments);return i.apply(n,e),t.apply(o,e)}})),Be.addClass(t,"has-slider"),o.domElement.insertBefore(n.domElement,o.domElement.firstElementChild)}else if(o instanceof qe){var i=function(t){if(xe.isNumber(o.__min)&&xe.isNumber(o.__max)){var n=o.__li.firstElementChild.firstElementChild.innerHTML,i=o.__gui.__listening.indexOf(o)>-1;o.remove();var r=vt(e,o.object,o.property,{before:o.__li.nextElementSibling,factoryArgs:[o.__min,o.__max,o.__step]});return r.name(n),i&&r.listen(),r}return t};o.min=xe.compose(i,o.min),o.max=xe.compose(i,o.max)}else o instanceof He?(Be.bind(t,"click",(function(){Be.fakeEvent(o.__checkbox,"click")})),Be.bind(o.__checkbox,"click",(function(e){e.stopPropagation()}))):o instanceof Je?(Be.bind(t,"click",(function(){Be.fakeEvent(o.__button,"click")})),Be.bind(t,"mouseover",(function(){Be.addClass(o.__button,"hover")})),Be.bind(t,"mouseout",(function(){Be.removeClass(o.__button,"hover")}))):o instanceof Ke&&(Be.addClass(t,"color"),o.updateDisplay=xe.compose((function(e){return t.style.borderLeftColor=o.__color.toString(),e}),o.updateDisplay),o.updateDisplay());o.setValue=xe.compose((function(t){return e.getRoot().__preset_select&&o.isModified()&&gt(e.getRoot(),!0),t}),o.setValue)}(e,u,r),e.__controllers.push(r),r}function bt(e,t){return document.location.href+"."+t}function _t(e,t,o){var n=document.createElement("option");n.innerHTML=t,n.value=t,e.__preset_select.appendChild(n),o&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function xt(e,t){t.style.display=e.useLocalStorage?"block":"none"}function wt(e){var t=void 0;function o(o){return o.preventDefault(),e.width+=t-o.clientX,e.onResize(),t=o.clientX,!1}function n(){Be.removeClass(e.__closeButton,ft.CLASS_DRAG),Be.unbind(window,"mousemove",o),Be.unbind(window,"mouseup",n)}function i(i){return i.preventDefault(),t=i.clientX,Be.addClass(e.__closeButton,ft.CLASS_DRAG),Be.bind(window,"mousemove",o),Be.bind(window,"mouseup",n),!1}e.__resize_handle=document.createElement("div"),xe.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),Be.bind(e.__resize_handle,"mousedown",i),Be.bind(e.__closeButton,"mousedown",i),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function St(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function Tt(e,t){var o={};return xe.each(e.__rememberedObjects,(function(n,i){var r={},a=e.__rememberedObjectIndecesToControllers[i];xe.each(a,(function(e,o){r[o]=t?e.initialValue:e.getValue()})),o[i]=r})),o}function Ct(e){0!==e.length&&nt.call(window,(function(){Ct(e)})),xe.each(e,(function(e){e.updateDisplay()}))}ft.toggleHide=function(){dt=!dt,xe.each(pt,(function(e){e.domElement.style.display=dt?"none":""}))},ft.CLASS_AUTO_PLACE="a",ft.CLASS_AUTO_PLACE_CONTAINER="ac",ft.CLASS_MAIN="main",ft.CLASS_CONTROLLER_ROW="cr",ft.CLASS_TOO_TALL="taller-than-window",ft.CLASS_CLOSED="closed",ft.CLASS_CLOSE_BUTTON="close-button",ft.CLASS_CLOSE_TOP="close-top",ft.CLASS_CLOSE_BOTTOM="close-bottom",ft.CLASS_DRAG="drag",ft.DEFAULT_WIDTH=245,ft.TEXT_CLOSED="Close Controls",ft.TEXT_OPEN="Open Controls",ft._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||ft.toggleHide()},Be.bind(window,"keydown",ft._keydownHandler,!1),xe.extend(ft.prototype,{add:function(e,t){return vt(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return vt(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;xe.defer((function(){t.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&ut.removeChild(this.domElement);var e=this;xe.each(this.__folders,(function(t){e.removeFolder(t)})),Be.unbind(window,"keydown",ft._keydownHandler,!1),ht(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var o=new ft(t);this.__folders[e]=o;var n=mt(this,o.domElement);return Be.addClass(n,"folder"),o},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],ht(e);var t=this;xe.each(e.__folders,(function(t){e.removeFolder(t)})),xe.defer((function(){t.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=Be.getOffset(e.__ul).top,o=0;xe.each(e.__ul.childNodes,(function(t){e.autoPlace&&t===e.__save_row||(o+=Be.getHeight(t))})),window.innerHeight-t-20<o?(Be.addClass(e.domElement,ft.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(Be.removeClass(e.domElement,ft.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&xe.defer((function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:xe.debounce((function(){this.onResize()}),50),remember:function(){if(xe.isUndefined(lt)&&((lt=new it).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n\tHere\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n\t<textarea id="dg-new-constructor"></textarea>\n\n\t<div id="dg-save-locally">\n\n\t\t<input id="dg-local-storage" type="checkbox"/> Automatically save\n\t\tvalues to <code>localStorage</code> on exit.\n\n\t\t<div id="dg-local-explain">The values saved to <code>localStorage</code> will\n\t\t\toverride those passed to <code>dat.GUI</code>\'s constructor. This makes it\n\t\t\teasier to work incrementally, but <code>localStorage</code> is fragile,\n\t\t\tand your friends may not see the same values you do.\n\n\t\t</div>\n\n\t</div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;xe.each(Array.prototype.slice.call(arguments),(function(t){0===e.__rememberedObjects.length&&function(e){var t=e.__save_row=document.createElement("li");Be.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),Be.addClass(t,"save-row");var o=document.createElement("span");o.innerHTML="&nbsp;",Be.addClass(o,"button gears");var n=document.createElement("span");n.innerHTML="Save",Be.addClass(n,"button"),Be.addClass(n,"save");var i=document.createElement("span");i.innerHTML="New",Be.addClass(i,"button"),Be.addClass(i,"save-as");var r=document.createElement("span");r.innerHTML="Revert",Be.addClass(r,"button"),Be.addClass(r,"revert");var a=e.__preset_select=document.createElement("select");e.load&&e.load.remembered?xe.each(e.load.remembered,(function(t,o){_t(e,o,o===e.preset)})):_t(e,at,!1);if(Be.bind(a,"change",(function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value})),t.appendChild(a),t.appendChild(o),t.appendChild(n),t.appendChild(i),t.appendChild(r),st){var s=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(bt(e,"isLocal"))&&l.setAttribute("checked","checked"),xt(e,s),Be.bind(l,"change",(function(){e.useLocalStorage=!e.useLocalStorage,xt(e,s)}))}var c=document.getElementById("dg-new-constructor");Be.bind(c,"keydown",(function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||lt.hide()})),Be.bind(o,"click",(function(){c.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),lt.show(),c.focus(),c.select()})),Be.bind(n,"click",(function(){e.save()})),Be.bind(i,"click",(function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)})),Be.bind(r,"click",(function(){e.revert()}))}(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)})),this.autoPlace&&St(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=Tt(this)),e.folders={},xe.each(this.__folders,(function(t,o){e.folders[o]=t.getSaveObject()})),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Tt(this),gt(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[at]=Tt(this,!0)),this.load.remembered[e]=Tt(this),this.preset=e,_t(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){xe.each(this.__controllers,(function(t){this.getRoot().load.remembered?yt(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}),this),xe.each(this.__folders,(function(e){e.revert(e)})),e||gt(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&Ct(this.__listening)},updateDisplay:function(){xe.each(this.__controllers,(function(e){e.updateDisplay()})),xe.each(this.__folders,(function(e){e.updateDisplay()}))}});var Et=tt;
/**
   * get position functions library
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */function At(e,t){const o=e.userData.myObject?e.userData.myObject.guiPoints.getPositionId:void 0;o&&(t=o(t));const n=he.THREE,i=e.geometry,r=i.attributes.position,a=r.itemSize,s=a>=4?new n.Vector4(0,0,0,0):new n.Vector3,l=e.geometry.drawRange,c=t*a;if(null===e.geometry.index){let e;null===i.index?l.count!=1/0&&(t<l.start||t>=l.start+l.count)&&(e=""):l.count!=1/0&&(c<l.start||c>=l.start+l.count)&&(e=". offset = "+c),null!=e&&console.error("getObjectLocalPosition: index = "+t+e+" is out of range = { start: "+l.start+", count: "+l.count+" }")}return s.fromArray(r.array,c),s}function Pt(e,t){const o=he.THREE;var n=t.clone();function i(e,t){var n=new o.Vector3,i=new o.Vector3;return(n=t.clone()).multiply(e.scale),i.copy(n),i.applyEuler(e.rotation),n.x=i.x,n.y=i.y,n.z=i.z,n.add(e.position),n}do{n=i(e,n),e=e.parent}while(e&&e.parent);return n}function Ot(e,t){if(-1!==t)return void 0===t?e.position:Pt(e,At(e,t))}
/**
   * node.js version of the synchronous download of the file.
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */function kt(e){if(this.loadXMLDoc=function(){var e;if(window.XMLHttpRequest){if(!(e=new XMLHttpRequest))throw"new XMLHttpRequest() failed!"}else{if(!window.ActiveXObject)throw"myRequest.loadXMLDoc(...) failed!";if(!(e=this.NewActiveXObject()))throw"NewActiveXObject() failed!"}return e},this.NewActiveXObject=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}return o('This browser does not support XMLHttpRequest. Probably, your security settings do not allow Web sites to use ActiveX controls installed on your computer. Refresh your Web page to find out the current status of your Web page or enable the "Initialize and script ActiveX controls not marked as safe" and "Run Active X controls and plug-ins" of the Security settings of the Internet zone of your browser.'),null},this.XMLHttpRequestStart=function(e,t){this.XMLHttpRequestStop(),this.req.onreadystatechange=e,"onerror"in this.req&&(this.req.onerror=function(e){o("XMLHttpRequest error. url: "+this.url)}),this.XMLHttpRequestReStart(t)},this.getUrl=function(){return void 0!==this.url&&null!=this.url||o("XMLHttpRequest: Invalid url: "+this.url),this.url+(this.params?this.params:"")},this.XMLHttpRequestReStart=function(e){try{if(void 0===e&&(e=!0),this.req.open("GET",this.getUrl(),e),e){"timeout"in this.req&&(this.req.timeout=9e4),"ontimeout"in this.req?this.req.ontimeout=function(){o("XMLHttpRequest timeout")}:(clearTimeout(this.timeout_id_SendReq),this.timeout_id_SendReq=setTimeout((function(){o("XMLHttpRequest timeout 2")}),9e4))}this.req.send(null)}catch(e){o(e.message+" url: "+this.url)}},this.XMLHttpRequestStop=function(){null!=this.req&&this.req.abort()},this.ProcessReqChange=function(e){var t=this.req;switch("undefined"==typeof isIE||isIE,t.readyState){case 4:if("unknown"==typeof t.status)return consoleError('typeof XMLHttpRequest status == "unknown"'),!0;if(200==t.status)return clearTimeout(this.timeout_id_SendReq),e(this);o("Invalid XMLHttpRequest status : "+t.status+" url: "+this.url);break;case 1:case 2:case 3:break;default:throw"processReqChange(); req.readyState = "+t.readyState}return!0},this.processStatus200Error=function(){var e=this.GetElementText("error",!0);return!!e&&(o(e),!0)},this.GetElementText=function(e,t){var n=this.req;if(!n.responseXML)return 1!=t&&o("GetXMLElementText(xmlhttp, "+e+"); xmlhttp.responseXML is null.\nxmlhttp.responseText:\n"+n.responseText),null;var i=n.responseXML.getElementsByTagName(e);if(0==i.length)return 1!=t&&o('GetXMLElementText(xmlhttp, "'+e+'"); element.length == '+i.length),"";for(var r="",a=0;a<i.length;a++)if(void 0===i[a].textContent){if(void 0===i[a].text)return o("GetXMLElementText(xmlhttp, "+e+"); element["+a+"].text) == undefined"),"";""!=r&&(r+=" "),r+=i[a].text}else r+=i[a].textContent;return r},e.data)this.req=e.data.req,this.url=e.data.url,this.params=e.data.params;else try{this.req=this.loadXMLDoc()}catch(e){var t;return t=void 0===e.message?e:e.message,void o("Your browser is too old and is not compatible with our site.\n\n"+window.navigator.appName+" "+window.navigator.appVersion+"\n\n"+t)}function o(t){console.error(t),e.onerror(t)}this.req||consoleError("Invalid myRequest.req: "+this.req)}function zt(e,t){!0===(t=t||{}).async&&console.warn("Load file asynchronously is deprecated. Please use fetch."),t.onload=t.onload||function(){},t.onerror=t.onerror||function(){};var o,n=new kt(t);return n.url=e,n.XMLHttpRequestStart((function(){n.ProcessReqChange((function(n){n.processStatus200Error()||(o=n.req.responseText,t.onload(o,e))}))}),void 0!==t.async),o}
/**
   * node.js version of the load JavaScript file
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * Thanks to:
   *http://javascript.ru/forum/events/21439-dinamicheskaya-zagruzka-skriptov.html
   *https://learn.javascript.ru/onload-onerror
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */function Dt(e,t){if(t.tag=t.tag||{},"string"==typeof t.tag){if("style"!==t.tag)return void console.error("Invalid options.tag: "+t.tag);t.tag={name:"style",attribute:{name:"rel",value:"stylesheet"}}}t.tag.name=t.tag.name||"script";var o=document.createElement(t.tag.name);t.tag.attribute=t.tag.attribute||{},t.tag.attribute.name=t.tag.attribute.name||"type",t.tag.attribute.value=t.tag.attribute.value||"text/javascript",o.setAttribute(t.tag.attribute.name,t.tag.attribute.value),e(o),t.appendTo.appendChild(o)}function Nt(e,t,o){for(var n=e.querySelectorAll("script"),i=0;i<n.length;i++){if(n[i].id===t)return!0}return!1}var Ft={sync:function(e,t){if((t=t||{}).onload=t.onload||function(){},t.onerror=t.onerror||function(){},t.appendTo=t.appendTo||document.getElementsByTagName("head")[0],Nt(t.appendTo,e))t.onload();else if(e instanceof Array){for(var o,n={appendTo:t.appendTo,tag:t.tag,onload:function(e,t){console.log("loadScript.sync.onload: "+t)},onerror:function(e){t.onerror(e),o=e}},i=0;i<e.length;i++){var r=e[i];if(Dt((function(e){e.setAttribute("id",r),e.innerHTML=zt(r,n)}),n),void 0!==o)break}void 0===o&&t.onload()}else Dt((function(o){o.setAttribute("id",e),o.innerHTML=zt(e,t)}),t)},async:function(e,t){var o;function n(i){function r(){e instanceof Array&&o<e.length-1?(o++,n(e[o])):t.onload()}Nt(t.appendTo,i,t.onload)?r():Dt((function(e){e.setAttribute("id",i),e.readyState&&!e.onload?e.onreadystatechange=function(){"complete"==e.readyState&&void 0!==t.onload&&t.onload(),"loaded"==e.readyState&&(setTimeout(t.onload,0),this.onreadystatechange=null)}:(e.onload=function(){console.log("loadScript.async.onload() "+i),void 0!==t.onload&&r()},e.onerror=function(e){var o='loadScript: "'+this.src+'" failed';void 0!==t.onerror&&t.onerror(o,e),console.error(o)}),e.src=i}),t)}(t=t||{}).appendTo=t.appendTo||document.getElementsByTagName("head")[0],t.onload=t.onload||function(){},n(e instanceof Array?e[o=0]:e)}};
/**
   * @module ColorPicker
   * @description Pure JavaScript color picker.
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * Thanks to https://github.com/DavidDurman/FlexiColorPicker
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   */const Mt=function(){const e=function(){if(document.currentScript&&""!==document.currentScript.src)return document.currentScript.src;const e=document.getElementsByTagName("script");return""!==e[e.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]}();return e.substring(0,e.lastIndexOf("/"))}();Ft.sync(Mt+"/colorpicker.css",{tag:"style"});const Lt=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",It="http://www.w3.org/2000/svg";var Rt=0;class jt{constructor(){const e=this;function t(e,t,o){for(var n in e=document.createElementNS(It,e),t)e.setAttribute(n,t[n]);"[object Array]"!=Object.prototype.toString.call(o)&&(o=[o]);for(var i=0,r=o[0]&&o.length||0;i<r;i++)e.appendChild(o[i]);return e}this.paletteIndexes={BGYW:0,monochrome:1,bidirectional:2,rainbow:3},this.create=function(e,o){function n(){return"horizontal"===o.orientation}if((o=o||{}).orientation=o.orientation||"horizontal",void 0===o.direction&&(o.direction=!0),o.style=o.style||{},o.style.width=o.style.width||(n()?200:30),o.style.height=o.style.height||(n()?30:200),o.onError=o.onError||function(){},e instanceof HTMLElement!=!0){if("string"!=typeof e)return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e);if(null===(e=document.getElementById(e)))return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e)}for(var i in e.classList.add("slider-wrapper"),o.style)e.style[i]=o.style[i];const r=o.palette instanceof this.palette?o.palette:new this.palette(o);var a,s;function l(){return"string"==typeof o.style.height?parseInt(o.style.height):o.style.height}function c(){return a.clientWidth}function u(e,t){if(void 0===s)return void console.error("Set value of this instance of the ColorPicker is impossible because options.sliderIndicator is not defined.");const i=r.hsv2rgb(e);void 0!==i?(e=i.percent,void 0===t&&(t=n()?c()*e/100:l()-l()*(o.direction?e:100-e)/100),function(e){if(void 0===s)return;if(n()){if(e<0||e>c())return void console.error("ColorPicker.positionIndicators: Invalid position = "+e);s.style.top="0px",s.style.left=(o.direction?e:c()-e)-s.offsetWidth/2+"px"}else{if(e<0||e>l())return void console.error("ColorPicker.positionIndicators: Invalid position = "+e);s.style.left="0px",s.style.top=e-s.offsetHeight/2+"px"}}(t),void 0!==o.sliderIndicator.callback&&o.sliderIndicator.callback(i)):console.error("ColorPicker.setValue: invalud c = "+i)}if(void 0!==o.sliderIndicator&&((s=document.createElement("div")).className="slider-indicator",n()?s.style.width="10px":s.style.height="10px",e.appendChild(s),s.style.pointerEvents="none"),"SVG"==Lt){try{const f="linearGradient";a=t("svg",{xmlns:It,version:"1.1",width:n()?"100%":o.style.width,height:o.style.height},[t("defs",{},t(f,{id:"gradient-hsv-"+Rt,x1:n()&&o.direction?"100%":"0%",y1:n()||o.direction?"0%":"100%",x2:n()&&!o.direction?"100%":"0%",y2:!n()&&o.direction?"100%":"0%"},r.getPalette())),t("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv-"+Rt+")"})]),void 0!==s&&(a.style.cursor=n()?"e-resize":"s-resize",s.style.cursor=a.style.cursor)}catch(m){console.error("Create SVG element failed! "+m.message)}e.appendChild(a),e.style.height=l()+"px",void 0!==s&&(n()?s.style.height=parseInt(o.style.height)-2+"px":s.style.width=parseInt(o.style.width)-2+"px",o.sliderIndicator.value=o.sliderIndicator.value||0,u(o.sliderIndicator.value)),Rt++}else console.error("Under constraction");function d(e){var t,i,r;e.x=parseInt(e.x),e.y=parseInt(e.y),n()?(t=e.x,i=c()-1,t>=c()&&(t=i),r=100*t/i,o.direction||(r=100-r,t=i-t)):(t=e.y,i=l()-1,t>=l()&&(t=i),r=100*(1-t/i),o.direction||(r=100-r)),u(r,t)}if(void 0!==s){var p=!1;function h(){return function(e){p||d(function(e){if(window.event&&void 0!==window.event.contentOverflow)return{x:window.event.offsetX,y:window.event.offsetY};if(void 0!==e.offsetX&&void 0!==e.offsetY)return{x:e.offsetX,y:e.offsetY};var t=e.target.parentNode.parentNode;return{x:e.layerX-t.offsetLeft,y:e.layerY-t.offsetTop}}(e=e||window.event))}}function g(e,t,o){null!==e&&(e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener&&e.addEventListener(t,o,!1))}function y(e,t){var o=a;g(o,"touchstart",(function(e){})),g(o,"touchmove",(function(e){e.preventDefault();var t=e.srcElement.getBoundingClientRect(),o=e.touches[0].clientX-t.left,n=e.touches[0].clientY-t.top;o<0&&(o=0),n<0&&(n=0),d({x:o,y:n})})),g(o,"touchend",(function(e){})),g(o,"mousedown",(function(e){const o="mouseup",n="mousemove";g(window,o,(function e(){function i(e,t,o){null!==e&&(e.detachEvent?e.detachEvent("on"+t,o):e.removeEventListener&&e.removeEventListener(t,o,!1))}i(window,o,e),i(window,n,t)})),g(window,n,t)})),g(o,"mouseout",(function(e){p=!0})),g(o,"mouseover",(function(e){p=!1}))}g(a,"click",h()),y(0,h())}return{setValue:u}},this.palette=function(o){function n(e,t,o,n){return{percent:e,r:t,g:o,b:n}}void 0===(o=o||{}).palette&&(o.palette=e.paletteIndexes.BGYW),this.getPaletteIndex=function(){return o.palette};var i=[new n(0,0,0,255),new n(33,0,255,0),new n(66,255,255,0),new n(100,255,255,255)];switch(typeof o.palette){case"number":switch(o.palette){case e.paletteIndexes.BGYW:break;case e.paletteIndexes.monochrome:i=[new n(0,0,0,0),new n(100,255,255,255)];break;case e.paletteIndexes.bidirectional:i=[new n(0,255,48,48),new n(50,48,48,48),new n(100,48,255,48)];break;case e.paletteIndexes.rainbow:i=[new n(0,255,50,50),new n(16,252,245,40),new n(32,40,252,40),new n(50,40,252,248),new n(66,39,46,249),new n(82,255,40,251),new n(100,255,50,50)];break;default:console.error("ColorPicker.create.Palette: invalid options.palette = "+o.palette)}break;case"object":if(Array.isArray(o.palette)){i=o.palette;break}default:var r="invalid options.palette = "+o.palette;console.error("ColorPicker.create.Palette: "+r),o.onError(r)}this.isPalette=function(){return!0},this.getPalette=function(){const e=[];return i.forEach((function(o){e.unshift(t("stop",{offset:100-o.percent+"%","stop-color":"#"+("0"+Number(o.r).toString(16)).slice(-2).toUpperCase()+("0"+Number(o.g).toString(16)).slice(-2).toUpperCase()+("0"+Number(o.b).toString(16)).slice(-2).toUpperCase(),"stop-opacity":"1"}))})),e},this.hsv2rgb=function(e,t,n){var r=parseFloat(e);isNaN(r)&&(r=n),void 0!==t&&void 0!==n&&(r=100/(n-t)*(r-t));var a,s=i[i.length-1];if(100!==s.percent){const c={};Object.keys(s).forEach((function(e){c[e]=s[e]})),c.percent=100,i.push(c)}for(var l=0;l<i.length;l++){const u=i[l];if(void 0===a&&(a=u),r>=a.percent&&r<=u.percent){function d(e,t,o,n){var i=o-e;return 0===i?t:Math.round(t+(n-t)/i*(r-e))}const p=d(a.percent,a.r,u.percent,u.r),f=d(a.percent,a.g,u.percent,u.g),m=d(a.percent,a.b,u.percent,u.b);return{r:p,g:f,b:m,hex:"#"+(16777216|m|f<<8|p<<16).toString(16).slice(1),percent:r}}a=u}void 0!==o.onError&&o.onError("Invalid color value of the ColorPicker: "+e)},this.toColor=function(e,t,o){const n=he.THREE;if(e instanceof n.Color)return e;var i=this.hsv2rgb(e,t,o);return void 0===i&&(i={r:255,g:255,b:255}),new n.Color("rgb("+i.r+", "+i.g+", "+i.b+")")}}}}var Vt=jt=new jt;
/**
   * @module cookie
   * @description node.js version of the cookie.
   * Cookies let you store user information in web pages.
   * @see {@link https://www.w3schools.com/js/js_cookies.asp}
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */function Bt(){return navigator.cookieEnabled}function Ht(e,t,o){Bt()?(t=t.toString(),void 0===o&&(o=new Date).setTime(o.getTime()+31536e6),document.cookie=e+"="+t+("undefined"==typeof settings?"":settings)+"; expires="+o.toGMTString(),""===document.cookie&&console.error("document.cookie is empty")):Xt()}function Gt(e,t){if(Bt()){var o=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");if(o){const e=o[2],n=typeof t;return"number"===n?e%1==0?parseInt(e):parseFloat(e):"boolean"===n?"true"===e:unescape(e)}return void 0===t?"":t}Xt()}function Ut(e,t){return JSON.parse(Gt(e,JSON.stringify(t)))}function Xt(){console.error("navigator.cookieEnabled = "+navigator.cookieEnabled)}class Wt{constructor(e){this.get=function(e){return e},this.set=function(){},this.getObject=function(e,t,o){o&&Object.keys(o).forEach((function(e){var n=o[e];void 0!==n&&"function"!=typeof n&&null!=n&&(t[e]=JSON.parse(JSON.stringify(n)))}))},this.copyObject=function(e,t){return JSON.parse(JSON.stringify(t))},this.setObject=function(){},this.isTrue=function(e){return e}}}var qt=Object.freeze({__proto__:null,isEnabled:Bt,set:Ht,setObject:function(e,t){Ht(e,JSON.stringify(t))},get:Gt,getObject:function(e,t,o){void 0===o&&(o=t),(new Wt).getObject(e,t,Ut(e,o))},copyObject:Ut,remove:function(e){if(Bt()){var t=new Date;t.setTime(t.getTime()-1),document.cookie=e+="=; expires="+t.toGMTString()}else Xt()},defaultCookie:Wt});
/**
   * @module Localization.
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */function Yt(){return(navigator?void 0!==navigator.languages&&"unknown"!=typeof navigator.languages&&navigator.languages.length>0?navigator.languages[0]:navigator.language?navigator.language:navigator.browserLanguage?navigator.browserLanguage:navigator.systemLanguage?navigator.systemLanguage:navigator.userLanguage?navigator.userLanguage:(console.error("getLocale() failed!"),""):(console.error("getLocale() failed! !navigator"),"")).toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/)[1]}
/**
   * @module CreateFullScreenSettings
   * @description creates functions for resize of the canvas to fullscreen and restore to default size.
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */function Zt(e,t,o,n){var i,r,a,s=!1;n.fullScreen=n.fullScreen||{},n.canvasMenu&&(i=n.canvasMenu),n.stereoEffect&&(r=n.stereoEffect),t.setSize(t.domElement.width,t.domElement.height),this.isFullScreen=function(){return s},this.setStereoEffect=function(e){r=e},this.setFullScreen=function(r=!1,l=!1){setTimeout((function(){l&&n.fullScreen.arrayContainersLength&&n.fullScreen.arrayContainersLength()>1&&(r=!0);const c=new e.Vector2;t.getSize(c),(s=r)?void 0!==a&&(t.setSize(a.sizeOriginal.x,a.sizeOriginal.y),t.domElement.style.position=a.position,t.domElement.style.left=a.left,t.domElement.style.top=a.top,t.domElement.style.width=a.width,t.domElement.style.height=a.height):(void 0===a&&(a={sizeOriginal:new e.Vector2,position:t.domElement.style.position,left:t.domElement.style.left,top:t.domElement.style.top,width:t.domElement.style.width,height:t.domElement.style.height},t.getSize(a.sizeOriginal)),t.setSize(window.innerWidth,window.innerHeight),t.domElement.style.position="fixed",t.domElement.style.left=0,t.domElement.style.top=0,t.domElement.style.width="100%",t.domElement.style.height="100%"),void 0!==n.fullScreen.onFullScreenToggle&&n.fullScreen.onFullScreenToggle(s),o.aspect=c.x/c.y,o.updateProjectionMatrix(),s=!s,i&&i.setFullScreenButton&&i.setFullScreenButton(s),Zt.RendererSetSize(t,n.canvasMenu)}),0)},this.onclick=function(){return void 0!==r&&parseInt(r.settings.spatialMultiplex)!==Qt.spatialMultiplexsIndexs.Mono&&(r.settings.spatialMultiplex=Qt.spatialMultiplexsIndexs.Mono),this.setFullScreen(s),s}}
/**
   * @module SpriteText
   * @description A sprite based text component. Text that always faces towards the camera.
   * @see {@link https://threejs.org/docs/index.html#api/en/objects/Sprite|THREE.Sprite}
   * 
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
  */
function Jt(e,t,o={}){"number"==typeof e&&(e=e.toString()),e=e.replaceAll("\t","\t");const n=he.THREE;t=t||new n.Vector3(0,0,0);const i=new n.Sprite(new n.SpriteMaterial({map:new n.Texture,sizeAttenuation:void 0!==o.sizeAttenuation&&o.sizeAttenuation})),r=document.createElement("canvas");i.material.map.minFilter=n.LinearFilter;const a=r.getContext("2d");return o.name&&(i.name=o.name),i.userData.update=function(){const n={};i.parent?Kt(i.parent,n):o.group&&Kt(o.group,n);var s=o.textHeight||n.textHeight||.04;const l=o.fov||n.fov,c=o.sizeAttenuation||n.sizeAttenuation||!1,u=o.rotation||n.rotation||0,d=o.fontFace||n.fontFace||"Arial",p=o.bold||n.bold||!1,f=o.italic||n.italic||!1,m=o.fontProperties||n.fontProperties||"",h=o.rect||n.rect||{},g=o.fontColor||n.fontColor||"rgba(255, 255, 255, 1)",y=Jt.getCenter(o.center||n.center,t);void 0!==l&&(s=l*s/50),h.displayRect=h.displayRect||!1;const v=h.borderThickness?h.borderThickness:5,b=`${m}${p?"bold ":""}${f?"italic ":""}90px ${d}`;a.font=b;var _,x=0,w=1;"string"==typeof e?(w=0,(_=e.split(/\r\n|\r|\n/)).forEach((function(e){var t=a.measureText(e).width;x<t&&(x=t),w+=1}))):x=a.measureText(e).width;const S=x+=2*v;if(r.width=S,r.height=90*w+2*v,a.font=b,h.displayRect){a.fillStyle=h.backgroundColor?h.backgroundColor:"rgba(0, 0, 0, 1)",a.strokeStyle=h.borderColor?h.borderColor:g,a.lineWidth=v,T=a,C=v/2,E=v/2,A=r.width-v,P=r.height-v,O=void 0===h.borderRadius?0:h.borderRadius,T.beginPath(),T.moveTo(C+O,E),T.lineTo(C+A-O,E),T.quadraticCurveTo(C+A,E,C+A,E+O),T.lineTo(C+A,E+P-O),T.quadraticCurveTo(C+A,E+P,C+A-O,E+P),T.lineTo(C+O,E+P),T.quadraticCurveTo(C,E+P,C,E+P-O),T.lineTo(C,E+O),T.quadraticCurveTo(C,E,C+O,E),T.closePath(),T.fill(),T.stroke()}var T,C,E,A,P,O;if(a.fillStyle=g,a.textBaseline="bottom",w>1)for(var k=0;k<_.length;k++){const e=_[k];a.fillText(e,v,r.height-90*(_.length-k-1)-v)}else a.fillText(e,v,r.height-v);i.material.map.image=r,i.material.map.needsUpdate=!0;const z=s*w;i.scale.set(z*r.width/r.height,z),i.position.copy(t),i.center=y,i.material.sizeAttenuation=c,i.material.rotation=u,i.material.needsUpdate=!0},i.userData.update(),i.userData.updateText=function(t){e=t;const o={};Kt(i.parent,o),i.userData.update(o)},o.group?o.group.add(i):he.group?he.group.add(i):he.scene&&he.scene.add(i),i.userData.optionsSpriteText=o,i}function Kt(e,t){for(e.userData.optionsSpriteText&&Object.keys(e.userData.optionsSpriteText).forEach((function(o){void 0===t[o]&&(t[o]=e.userData.optionsSpriteText[o])}));e.parent;)Kt(e=e.parent,t)}Zt.RendererSetSize=function(e,t){e.setSizeOld||(e.setSizeOld=e.setSize,e.setSize=function(o,n,i){e.setSizeOld(o,n,i);const r=e.domElement,a=r.parentElement;setTimeout((function(){a.style.height=r.style.height,a.style.width=r.style.width,a.style.left=r.style.left,a.style.top=r.style.top,a.style.position=r.style.position,t&&t.setSize(o,n)}),0)})},Jt.getCenter=function(e={},t){const o=he.THREE,n=e.canvas?e.canvas:void 0;const i=e.canvas?function(){const i=n.width/2,r=n.height/2,a=(new o.Vector3).copy(t);return a.project(e.camera),a.x=a.x*i+i,a.y=-a.y*r+r,a}():void 0;return e instanceof o.Vector2||"object"==typeof e&&void 0!==e.x&&void 0!==e.y?e:i?new o.Vector2(i.x<n.width/2?0:1,i.y<n.height/2?1:0):new o.Vector2(0,1)},Jt.updateSpriteTextGroup=function(e){const t=he.THREE;e.children.forEach((function(e){e instanceof t.Sprite&&void 0!==e.userData.update&&e.userData.update(),Jt.updateSpriteTextGroup(e)}))};
/**
   * @module StereoEffect
   * @description Uses dual PerspectiveCameras for Parallax Barrier effects.
   * @see About {@link https://en.wikipedia.org/wiki/Parallax_barrier|Parallax barrier}.
   * 
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   * @author {@link http://alteredqualia.com/|alteredq}
   * @author {@link http://mrdoob.com/|mrdoob}
   * @author {@link http://aleksandarrodic.com/|arodic}
   * @author {@link http://fonserbc.github.io/|fonserbc}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
  */
class Qt{constructor(e,t=new ao){if(!e)return void console.error("StereoEffect: renderer = "+e);if(t.boOptions||(t=new ao(t)),!1===t.stereoEffect)return;t.dat.gui&&(t.dat.mouseenter=!1);const o=he.THREE;eo(),t.stereoEffect||(t.stereoEffect={});const n=t.stereoEffect;var i,r,a,s;function l(e){e=e||{};const t={stereoEffects:"Stereo effects",spatialMultiplexName:"Spatial\tmultiplex",spatialMultiplexTitle:"Choose a way to do spatial multiplex.",spatialMultiplexs:{Mono:$t.Mono,"Side by side":$t.SbS,"Top and bottom":$t.TaB},eyeSeparationName:"Eye separation",eyeSeparationTitle:"The distance between left and right cameras.",focus:"Focus",focusTitle:"Object distance.",zeroParallaxName:"Zero parallax",zeroParallaxTitle:"Distance to objects with zero parallax.",defaultButton:"Default",defaultTitle:"Restore default stereo effects settings."},o=void 0===e.getLanguageCode?"en":e.getLanguageCode();switch(o){case"ru":t.stereoEffects="Стерео эффекты",t.spatialMultiplexName="Мультиплекс",t.spatialMultiplexTitle="Выберите способ создания пространственного мультиплексирования.",t.spatialMultiplexs={"Моно":$t.Mono,"Слева направо":$t.SbS,"Сверху вниз":$t.TaB},t.eyeSeparationName="Развод камер",t.eyeSeparationTitle="Расстояние между левой и правой камерами.",t.focus="Фокус",t.focusTitle="Расстояние до объекта.",t.zeroParallaxName="Параллакс 0",t.zeroParallaxTitle="Расстояние до объектов с нулевым параллаксом.",t.defaultButton="Восстановить",t.defaultTitle="Восстановить настройки стерео эффектов по умолчанию.";break;default:if(void 0===e.lang||e.lang._languageCode!=o)break;Object.keys(e.lang).forEach((function(o){void 0!==t[o]&&(t[o]=e.lang[o])}))}return t}this.settings=n,this.options=t,t.stereoEffect=this,void 0===n.spatialMultiplex&&(n.spatialMultiplex=$t.Mono),n.stereo=new o.StereoCamera,n.stereo.aspect=n.stereoAspect||1,void 0===n.far&&(n.far=(new o.PerspectiveCamera).focus),n.focus=void 0===n.camera?(new o.PerspectiveCamera).focus:(new o.Vector3).distanceTo(n.camera.position),n.zeroParallax=0,n.eyeSep=n.eyeSep||(new o.StereoCamera).eyeSep/10*n.far,void 0!==n.camera&&(n.camera.focus=n.focus),this.setEyeSeparation=function(e){n.stereo.eyeSep=e},this.setEyeSeparation(n.eyeSep),this.getRendererSize=function(){return ao.raycaster.EventListeners.getRendererSize(e,n.elParent)},this.render=function(s,l){const c=parseInt(n.spatialMultiplex);n.rememberSize&&!i&&(i=a&&a.getFullScreenSettings?a.getFullScreenSettings(this):new Zt(o,e,l,{canvasMenu:a,stereoEffect:this})),s.updateMatrixWorld(),null===l.parent&&l.updateMatrixWorld();const u=new o.Vector2;var d,p,f,m,h,g,y,v;e.getSize(u),e.autoClear&&e.clear(),e.setScissorTest(!0);const b=n.zeroParallax;function _(e){return!(!i||r===c)&&(r=c,e.setControllerSpatialMultiplex?e.setControllerSpatialMultiplex(c):e.setSpatialMultiplex&&e.setSpatialMultiplex(c),!0)}function x(e,t){_(t)&&i.setFullScreen(e)}switch(c){case $t.Mono:return e.setScissor(0,0,u.width,u.height),e.setViewport(0,0,u.width,u.height),e.render(s,l),e.setScissorTest(!1),void(t.canvasMenu?_(this):x(!0,this));case $t.SbS:const o=u.width/2;d=0+b,p=0,f=o,m=u.height,h=o-b,g=0,y=o,v=u.height,x(!1,this);break;case $t.TaB:d=0+b,p=0,f=u.width,m=u.height/2,h=0-b,g=u.height/2,y=u.width,v=u.height/2,x(!1,this);break;default:console.error('THREE.StereoEffect.render: Invalid "Spatial\tmultiplex" parameter: '+c)}n.stereo.update(l),e.setScissor(d,p,f,m),e.setViewport(d,p,f,m),e.render(s,n.stereo.cameraL),e.setScissor(h,g,y,v),e.setViewport(h,g,y,v),e.render(s,n.stereo.cameraR),e.setScissorTest(!1)},this.gui=function(e={}){const i=e.folder||t.dat.gui;if(!i||!1===t.dat.stereoEffectsGui)return;const r=e.dat||he.dat;void 0===e&&(e={}),e.scale=e.scale||1;const a=t.dat.getCookieName("StereoEffect"),c=l({getLanguageCode:t.getLanguageCode,lang:t.lang}),u={spatialMultiplex:n.spatialMultiplex,eyeSep:(new o.StereoCamera).eyeSep/10*n.far,focus:n.focus,zeroParallax:0};function d(e){const t=e==$t.Mono?"none":"block";m.domElement.style.display=t,void 0!==g&&(g.__li.style.display=t),b.__li.style.display=t,v.__li.style.display=t}Object.freeze(u),t.dat.cookie.getObject(a,n,u),n.spatialMultiplex=parseInt(n.spatialMultiplex),this.setSpatialMultiplex&&this.setSpatialMultiplex(n.spatialMultiplex);const p=i.addFolder(c.stereoEffects),f=p.add(n,"spatialMultiplex",c.spatialMultiplexs).onChange((function(t){d(t=parseInt(t)),x(a),e.onChangeMode&&e.onChangeMode(t),s&&s.select(t)}));r.controllerNameAndTitle(f,c.spatialMultiplexName,c.spatialMultiplexTitle),this.setControllerSpatialMultiplex=function(e){_=!1,f.setValue(e),_=!0};const m=p.addFolder(c.eyeSeparationName);r.folderNameAndTitle(m,c.eyeSeparationName,c.eyeSeparationTitle),m.add(new ye((function(e){n.eyeSep+=e,h.setValue(n.eyeSep)}),{settings:{offset:.01},min:1e-4,max:.01,step:1e-4}));const h=r.controllerZeroStep(m,n.stereo,"eyeSep",(function(e){n.eyeSep=e,x(a)}));var g;r.controllerNameAndTitle(h,c.eyeSeparationName,c.eyeSeparationTitle),void 0!==n.camera&&(n.camera.focus=n.focus),n.camera&&(g=p.add(n.camera,"focus",u.focus/10,2*u.focus,u.focus/1e3).onChange((function(e){n.focus=e,x(a)})),r.controllerNameAndTitle(g,c.focus,c.focusTitle));const y=(60-400/9)*e.scale+400/9,v=p.add(n,"zeroParallax",-y,y).onChange((function(e){n.zeroParallax=e,x(a)}));r.controllerNameAndTitle(v,c.zeroParallaxName,c.zeroParallaxTitle);const b=p.add({defaultF:function(e){n.stereo.eyeSep=u.eyeSep,h.setValue(n.stereo.eyeSep),n.camera&&(n.camera.focus=u.focus,g.setValue(n.camera.focus)),n.zeroParallax=u.zeroParallax,v.setValue(n.zeroParallax)}},"defaultF");r.controllerNameAndTitle(b,c.defaultButton,c.defaultTitle),d(n.spatialMultiplex);var _=!0;function x(e){if(!_)return;const o={};Object.keys(u).forEach((function(e){o[e]=n[e]})),t.dat.cookie.setObject(e,o)}},this.createCanvasMenuItem=function(e,t){a=e;const o=l({getLanguageCode:(t=t||{}).getLanguageCode,lang:t.lang}),i=Object.keys(o.spatialMultiplexs);(s={name:"⚭",title:o.stereoEffects,id:"menuButtonStereoEffects",drop:"up",items:[{name:i[$t.Mono],id:"menuButtonStereoEffectsMono",radio:!0,checked:n.spatialMultiplex===$t.Mono,spatialMultiplex:$t.Mono,onclick:function(e){n.spatialMultiplex=$t.Mono}},{name:i[$t.SbS],id:"menuButtonStereoEffectsSbS",radio:!0,checked:n.spatialMultiplex===$t.SbS,spatialMultiplex:$t.SbS,onclick:function(e){n.spatialMultiplex=$t.SbS}},{name:i[$t.TaB],id:"menuButtonStereoEffectsTaB",radio:!0,checked:n.spatialMultiplex===$t.TaB,spatialMultiplex:$t.TaB,onclick:function(e){n.spatialMultiplex=$t.TaB}}]}).select=function(e){s.items.forEach((function(t){t.spatialMultiplex===e&&(t.checked||t.elName.onclick({target:t.elName}))}))},this.setSpatialMultiplex=function(e){s.select(e)},e.menu.push(s)}}}Qt.spatialMultiplexsIndexs={Mono:0,SbS:1,TaB:2},Object.freeze(Qt.spatialMultiplexsIndexs);const $t=Qt.spatialMultiplexsIndexs;function eo(){const e=he.THREE;(new e.Raycaster).setStereoEffect||Object.assign(e.Raycaster.prototype,{setStereoEffect:function(t={}){if(!1===t.stereoEffect)return;t.raycasterEvents=void 0===t.raycasterEvents||t.raycasterEvents;const o=t.camera,n=t.renderer;if(t.raycasterEvents){const t=new e.Vector2;window.addEventListener("mousemove",(function(e){t.x=e.clientX/window.innerWidth*2-1,t.y=-e.clientY/window.innerHeight*2+1,r.setFromCamera(t,o),r.stereo.onDocumentMouseMove(e)}),!1),window.addEventListener("pointerdown",(function(e){r.stereo.onDocumentMouseDown(e)}),!1)}const i=void 0!==t.stereoEffect?t.stereoEffect:"undefined"!=typeof effect?effect:new Qt(n,t.options),r=this,a=new e.Vector2,s=new e.Vector2;var l,c;function u(){function t(t,o){a.copy(c),s.copy(c);a[t]+=.5,a[t]*=2,s[t]-=.5,s[t]*=2;const r=new e.Vector2;n.getSize(r);const l=i.settings.zeroParallax/r.x*o;a.x-=l,s.x+=l}switch(i.getRendererSize().getMousePosition(c,event),parseInt(i.settings.spatialMultiplex)){case $t.Mono:return;case $t.SbS:t("x",4);break;case $t.TaB:t("y",2);break;default:return void console.error("THREE.Raycaster.setStereoEffect.getMousePosition: Invalid effect.settings.spatialMultiplex = "+effect.settings.spatialMultiplex)}}this.stereo={onDocumentMouseMove:function(d){void 0!==l&&(d.preventDefault(),void 0===c&&(c=new e.Vector2),u(),function(){if(void 0!==c){if(parseInt(i.settings.spatialMultiplex)!==$t.Mono){const t=c;return c=a,r.setFromCamera(a,o),e()||(c=s,r.setFromCamera(s,o),e()),void(c=t)}r.setFromCamera(c,o),e()}function e(){ao.raycaster.intersectionsInOut(l,r,n,c,t)}}())},isAddedToParticles:function(e){return!!l&&l.includes(e)},addParticle:function(e){void 0===l&&(l=[]),this.isAddedToParticles(e)?console.error('Duplicate particle "'+e.name+'"'):l.push(e)},addParticles:function(e){if(void 0===l)l=e;else{if(!Array.isArray(l)){var t=l;(l=[]).push(t)}l.push(e)}},removeParticle:function(e){for(var t=0;t<l.length;t++)if(Object.is(e,l[t])){l.splice(t,1);break}},removeParticles:function(){l=void 0},getPosition:function(t){const o=t.object.geometry.attributes.position;var n=o.itemSize>=4?new e.Vector4(0,0,0,0):new e.Vector3;return void 0!==t.index?(n.fromArray(o.array,t.index*o.itemSize),n.multiply(t.object.scale),n.add(t.object.position)):n=t.object.position,n}}}})}Qt.assign=eo;const to={mesh:"Mesh",pointName:"Point Name",color:"Сolor",opacity:"Opacity"};if("ru"===Yt())to.mesh="3D объект",to.pointName="Имя точки",to.color="Цвет",to.opacity="Непрозрачность";
/**
   * View and edit some parameters on the web page.
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   * Thanks to https://stackoverflow.com/a/11900218/5175935
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */
function oo(e,t,o,n){if(e){if("string"==typeof e.controller){const t=e.controller;e.controller=document.getElementById(e.controller),e.controller||console.warn('createController: invalid settings.controller = "'+t+'"')}if(!e.controller){null===e.controller&&console.warn("createController: invalid settings.controller = "+e.controller);var i=document.getElementById(t);i||(i=document.createElement(n.elementName?n.elementName:"input"),document.querySelector("body").appendChild(i)),e.controller=i}if(void 0!==n.value&&function(t){void 0!==e.controller.value?e.controller.value=t:e.controller.innerHTML=t}(n.value),void 0!==n.onchange&&null===e.controller.onchange&&(e.controller.onchange=n.onchange),void 0!==n.title&&""===e.controller.title&&(e.controller.title=n.title),e.elSlider){if("string"==typeof e.elSlider){const t=e.elSlider;e.elSlider=document.getElementById(e.elSlider),e.elSlider||console.warn('createController: invalid settings.elSlider = "'+t+'"')}if(e.elSlider&&!0!==e.elSlider||(n.axisName&&(e.elSlider=document.getElementById(n.axisName+"Slider")),e.elSlider||(e.elSlider=document.createElement("div"),e.controller?e.controller.parentElement.appendChild(e.elSlider):document.querySelector("body").appendChild(e.elSlider))),e.boSetValue=!0,e.colorpicker||(e.colorpicker=Vt.create(e.elSlider,{duplicate:!0,sliderIndicator:{callback:function(t){if(e.boSetValue||!e.controller)return;const o=t.percent/100;e.controller.onchange({currentTarget:{value:o}}),e.controller.value=o},value:100*n.value},style:{border:"1px solid black",width:e.controller.clientWidth+"px",height:e.controller.clientHeight+"px"},onError:function(e){alert("Horizontal Colorpicker with slider indicator error: "+e)}})),void 0!==n.value){var r=100*n.value;r<0&&(r=0),r>100&&(r=100),e.boSetValue=!0,e.colorpicker.setValue(r),e.boSetValue=!1}}if(!1!==e.elName){if(null===e.elName&&console.warn("createController: invalid settings.elName = "+e.elName),"string"==typeof e.elName){const t=e.elName;e.elName=document.getElementById(e.elName),e.elName||console.warn('createController: invalid settings.elName = "'+t+'"')}var a="";e.elName||(n.axisName&&(e.elName=document.getElementById(n.axisName+"Name")),e.elName||(e.elName=document.createElement("span"),e.controller.parentElement.insertBefore(e.elName,e.controller),a=" = ")),""===e.elName.innerHTML&&(e.elName.innerHTML=o()+a)}}}
/**
   * options of the canvas
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */var no;Qt.getTextIntersection=function(e,t){const o=ao.findSpriteTextIntersection(t.spriteOptions.group);if(o)return o;const n=he.THREE,i=e.object.userData.myObject,r=i?i.guiPoints:void 0,a=r?r.searchNearestEdgeVerticeId:void 0,s=a?a(e.index,e):void 0,l=Ot(e.object,null!=s?s:e.index),c=t.scales||{},u=void 0!==e.index&&void 0!==e.object.userData.player&&void 0!==e.object.userData.player.arrayFuncs,d=u?e.object.userData.player.arrayFuncs:void 0,p=()=>d.intersection?d.intersection(e.index):d[e.index],f=void 0===d||"function"==typeof d?void 0:d.intersection?d.intersection(e.index):d[e.index],m=u&&f?f.name:void 0,h=u&&void 0!==f?Array.isArray(f.w)?Player.execFunc(f,"w",group.userData.t,t):f.w:void 0;e.object.userData.onIntersection&&e.object.userData.onIntersection();const g=!c.x&&!c.y&&!c.z;return t.spriteOptions.name=ao.findSpriteTextIntersection.spriteTextIntersectionName,new Jt((""===e.object.name?e.object.type:e.object.name)+(void 0===m?"":"\n"+to.pointName+": "+m)+(void 0===e.index?"":"\nID: "+(null!=s?s:e.index))+(!g&&!c.x||c.x&&!c.x.isAxis()?"":"\n\t"+(c.x&&c.x.name||0===c.x.name?c.x.name:"X")+": "+l.x)+(!g&&!c.y||c.y&&!c.y.isAxis()?"":"\n\t"+(c.y&&c.y.name||0===c.y.name?c.y.name:"Y")+": "+l.y)+(!g&&!c.z||c.z&&!c.z.isAxis()?"":"\n\t"+(c.z&&c.z.name||0===c.z.name?c.z.name:"Z")+": "+l.z)+(u&&(p()instanceof n.Vector4||p()instanceof n.Vector3||"function"==typeof d)?h instanceof n.Color?"\n"+to.color+": "+new n.Color(h.r,h.g,h.b).getHexString():void 0!==l.w?"\n\t"+(c.w&&c.w.name?c.w.name:"W")+": "+l.w:"":"")+(void 0===e.object.geometry.attributes.ca||e.object.geometry.attributes.ca.itemSize<4?"":"\n"+to.opacity+": "+(new n.Vector4).fromArray(e.object.geometry.attributes.ca.array,e.index*e.object.geometry.attributes.ca.itemSize).w)+(e.object.userData.raycaster&&e.object.userData.raycaster.text?e.object.userData.raycaster.text(e):""),e.pointSpriteText?e.pointSpriteText:e.point,t.spriteOptions)};class io{constructor(e){const t=this;if((e=e||{}).boOptions)return e;var o;void 0===e.a&&(e.a=1),void 0===e.b&&(e.b=0),this.setW=function(o){(o=o||e).scales=o.scales||{},o.scales.w,o.palette||t.setPalette()},e.scales=e.scales||{};const n=!e.scales.x&&!e.scales.y&&!e.scales.z;function i(t){n&&(e.scales[t]=e.scales[t]||{}),e.scales[t]}for(var r in i("x"),i("y"),i("z"),e.point=e.point||{},void 0===e.point.size&&(e.point.size=5),e.point.sizePointsMaterial=e.point.sizePointsMaterial||100,this.setPalette=function(t){t?e.palette=t:e.palette||(e.palette=new Vt.palette)},this.createOrbitControls=function(o,n,i){if(!1===e.orbitControls)return;const r=e.orbitControls||{};t.orbitControls=new he.OrbitControls(o,n.domElement),void 0!==r.enableRotate&&(t.orbitControls.enableRotate=r.enableRotate),t.orbitControls.target.set(2*i.position.x,2*i.position.y,2*i.position.z),t.orbitControls.saveState(),t.orbitControls.update(),t.frustumPoints&&t.orbitControls.addEventListener("change",(function(){t.frustumPoints.onChangeControls()}))},this.restoreSceneController=function(t,o){if(!he.dat||!1===e.dat)return;const n={defaultButton:"Default",defaultTitle:"Reset player and restore camera position."};if("ru"===this.getLanguageCode())n.defaultButton="Восстановить",n.defaultTitle="Восстановить положение камеры и проигрывателя.";const i=(new he.THREE.Vector3).copy(o.position),r=(new he.THREE.Vector3).copy(t.position);he.dat.controllerNameAndTitle(e.dat.gui.add({defaultF:function(n){e.player&&e.player.selectScene(e.playerOptions.selectSceneIndex),t.position.copy(r),o.position.copy(i),!1!==e.orbitControls&&(e.orbitControls.target=new he.THREE.Vector3,e.orbitControls.object.position.copy(t.position),e.orbitControls.update())}},"defaultF"),n.defaultButton,n.defaultTitle)},Object.defineProperties(this,{playerOptions:{get:function(){e.playerOptions=e.playerOptions||{};const t=e.playerOptions;if(t.min=t.min||0,t.max===1/0&&(t.max=null),null!==t.max?(void 0===t.max&&(t.max=1),t.marks=t.marks||10):t.marks=null,null===t.max?t.dt=t.dt||.1:t.dt=(t.max-t.min)/(t.marks-1),t.repeat=t.repeat||!1,t.interval=null!=t.interval?t.interval:1,t.zoomMultiplier=t.zoomMultiplier||1.1,t.offset=t.offset||.1,t.name=t.name||"",!t.cameraTarget){const e=new fo.cameraTarget;Object.defineProperties(t,{cameraTarget:{get:function(){return e}}})}return e.playerOptions},set:function(t){e.playerOptions=t}},a:{get:function(){return e.a}},b:{get:function(){return e.b}},dat:{get:function(){return!1===e.dat||(e.dat=new class{constructor(t){if((t=t||{}).boDat)return t;for(var o in Object.defineProperties(this,{boDat:{get:function(){return!0}},dat:{get:function(){return console.warn("get dat depreacated. Use three.dat = dat."),he.dat},set:function(e){console.warn("Set dat depreacated. Use three.dat = dat."),e.dat&&e.dat.constructor.name===e.constructor.name&&"Object"!==e.dat.constructor.name&&console.error("duplicate dat."),e.dat=e}},cookieName:{get:function(){return t.cookieName}},gui:{get:function(){return!t.gui&&he.dat&&(t.gui=new he.dat.GUI,e.dat.parent&&function(){const e=document.createElement("div");t.parent.appendChild(e),e.appendChild(t.gui.domElement),e.style.position="absolute",e.style.top="0px",e.style.right="0px"}()),t.gui}},cookie:{get:function(){return t.cookie},set:function(e){t.cookie=e}},guiSelectPoint:{get:function(){return t.guiSelectPoint},set:function(e){t.guiSelectPoint=e}},cameraGui:{get:function(){return t.cameraGui},set:function(e){t.cameraGui=e}},playerGui:{get:function(){return t.playerGui}},orbitControlsGui:{get:function(){return t.orbitControlsGui}},axesHelperGui:{get:function(){return t.axesHelperGui}},playController:{get:function(){return t.playController}},stereoEffectsGui:{get:function(){return t.playController}},moveScene:{get:function(){return t.moveScene}},spriteTextGui:{get:function(){return t.spriteTextGui}},folderPoint:{get:function(){return t.folderPoint},set:function(e){t.folderPoint=e}},pointLightGui:{get:function(){return t.pointLightGui}},parent:{get:function(){return t.parent}}}),t)void 0===this[o]&&console.error("Dat: dat."+o+" key is hidden")}}(e.dat),e.dat.gui&&(setTimeout((function(){const t=e.dat.gui.domElement.className;var o=0;e.dat.gui.domElement.parentElement.childNodes.forEach((function(e){e.className===t&&o++})),o>1&&console.error("Options: duplicate dat.GUI")}),0),e.dat.gui.domElement.addEventListener("mouseenter",(function(t){e.dat.mouseenter=!0})),e.dat.gui.domElement.addEventListener("mouseleave",(function(t){e.dat.mouseenter=!1}))),!1===e.dat.cookie?e.dat.cookie=new qt.defaultCookie:void 0===e.dat.cookie&&(e.dat.cookie=qt),e.dat.getCookieName=function(t=""){const o=e.dat.cookieName||(e.elContainer?"object"==typeof e.elContainer?e.elContainer.id:"string"==typeof e.elContainer?e.elContainer:"":"");return t+(""!==t&&""!==o?"_":"")+o}),e.dat},set:function(t){e.dat=t}},getLanguageCode:{get:function(){return"string"==typeof e.getLanguageCode?function(){return e.getLanguageCode}:e.getLanguageCode||Yt}},scales:{get:function(){return e.scales.boScales||(e.scales=new class{constructor(o){class n{constructor(t,o){let n=t[o];this.isAxis=function(){return!(t&&(t.x||t.y||t.z)&&!n)};const i=i=>{n||(t[o]={},n=t[o]),i(),n.step=Math.abs(e.scales.w.min-e.scales.w.max)/100,e.guiSelectPoint&&e.guiSelectPoint.setAxisControl("w",n)};for(var r in Object.defineProperties(this,{boScale:{get:function(){return!0}},isColor:{get:()=>n?n.isColor:void 0,set:e=>{n.isColor=e}},min:{get:()=>n&&n.min?n.min:"w"===o?0:-1,set:e=>{i((()=>{n.min=e}))}},max:{get:function(){return n&&n.max?n.max:"w"===o?(new he.THREE.Vector4).w:1},set:e=>{i((()=>{n.max=e}))}},name:{get:function(){return n&&void 0!==n.name?n.name:o},set:function(t){n&&(n.name=t,e.guiSelectPoint&&e.guiSelectPoint.setAxisName(o,t))}},marks:{get:function(){if(n)return n.marks||(n.marks=3),n.marks}}}),n)void 0===this[r]&&console.error("Options.Scales: scale."+r+" key is hidden")}}const i={x:new n(e.scales,"x"),y:new n(e.scales,"y"),z:new n(e.scales,"z"),w:new n(e.scales,"w")};for(var r in Object.defineProperties(this,{boScales:{get:function(){return!0}},x:{get:function(){return i.x},set:function(t){void 0===t?(delete o.x,delete i.x,i.x=new n(o,"x")):o.x=t,e.guiSelectPoint&&e.guiSelectPoint.updateScale("x")}},y:{get:function(){return i.y},set:function(t){void 0===t?(delete o.y,delete i.y,i.y=new n(o,"y")):o.y=t,e.guiSelectPoint&&e.guiSelectPoint.updateScale("y")}},z:{get:function(){return i.z},set:function(t){void 0===t?(delete o.z,delete i.z,i.z=new n(o,"z")):o.z=t,e.guiSelectPoint&&e.guiSelectPoint.updateScale("z")}},w:{get:function(){return i.w},set:function(e){o.w=e}},setW:{get:function(){return t.setW}},display:{get:function(){return void 0===o.display&&(o.display=!0),o.display},set:function(e){o.display=e}},text:{get:function(){return void 0===o.text&&(o.text={}),o.text},set:function(e){o.text=e}},posAxesIntersection:{get:function(){return o.posAxesIntersection},set:function(e){o.posAxesIntersection=e}}}),o)void 0===this[r]&&console.error("Options: scales."+r+" key is hidden")}}(e.scales)),e.scales},set:function(t){e.scales=t}},palette:{get:function(){switch(void 0===e.palette&&(e.palette=!0),typeof e.palette){case"number":e.palette=new Vt.palette({palette:e.palette});break;case"boolean":e.palette&&(e.palette=new Vt.palette);break;case"string":const t=new he.THREE.Color(e.palette);e.palette=new Vt.palette({palette:[{percent:0,r:255*t.r,g:255*t.g,b:255*t.b}]});break;default:Array.isArray(e.palette)?e.palette=new Vt.palette({palette:e.palette}):e.palette.isPalette()||console.error("MyThree: invalid typeof options.palette: "+typeof e.palette)}return e.palette}},boOptions:{get:function(){return!0}},point:{get:function(){return{get size(){return e.point.size},set size(t){e.point.size!==t&&(e.point.size=t,e.dat&&e.dat.folderPoint&&e.dat.folderPoint.size.setValue(t))},get sizePointsMaterial(){return e.point.sizePointsMaterial},set sizePointsMaterial(t){e.point.sizePointsMaterial=t}}}},spriteText:{get:function(){return e.spriteText?e.spriteText:{}}},raycaster:{get:function(){if(e.raycaster)return e.raycaster},set:function(t){e.raycaster=t}},camera:{get:function(){return e.camera=e.camera||{},e.camera.position||(e.camera.position=new he.THREE.Vector3(.4,.4,2)),e.camera.scale||(e.camera.scale=new he.THREE.Vector3(1,1,1)),e.camera},set:function(t){e.camera=t}},cameraTarget:{get:function(){return e.cameraTarget}},elContainer:{get:function(){return e.elContainer}},canvasMenu:{get:function(){return e.canvasMenu},set:function(t){e.canvasMenu&&!0!==e.canvasMenu&&!1!==e.canvasMenu&&console.warn("Duplicate canvasMenu"),e.canvasMenu=t}},canvas:{get:function(){return e.canvas?e.canvas:{fullScreen:!0}}},frustumPoints:{get:function(){return e.frustumPoints},set:function(t){e.frustumPoints&&e.frustumPoints.constructor.name===t.constructor.name&&"Object"!==e.frustumPoints.constructor.name&&console.error("duplicate frustumPoints."),e.frustumPoints=t}},stereoEffect:{get:function(){return e.stereoEffect},set:function(t){e.stereoEffect&&e.stereoEffect.constructor.name===t.constructor.name&&"Object"!==e.stereoEffect.constructor.name&&console.error("duplicate stereoEffect."),e.stereoEffect=t}},player:{get:function(){return e.player},set:function(t){e.player&&console.error("duplicate player."),e.player=t}},time:{get:function(){return e.player?e.player.getTime():0}},axesHelper:{get:function(){return e.axesHelper},set:function(t){e.axesHelper&&console.error("duplicate axesHelper."),e.axesHelper=t}},canvasMenu:{get:function(){return e.canvasMenu},set:function(t){e.canvasMenu&&console.error("duplicate canvasMenu."),e.canvasMenu=t}},orbitControls:{get:function(){return e.orbitControls},set:function(t){e.orbitControls&&e.orbitControls.constructor.name===t.constructor.name&&"Object"!==e.orbitControls.constructor.name&&console.error("duplicate orbitControls."),e.orbitControls=t}},scale:{get:function(){return 1}},pointLight:{get:function(){return e.pointLight}},cameraTarget:{get:function(){return e.cameraTarget}},eventListeners:{get:function(){if(e.eventListeners)return e.eventListeners},set:function(t){e.eventListeners&&console.error("duplicate eventListeners."),e.eventListeners=t}},guiSelectPoint:{get:function(){return e.guiSelectPoint},set:function(t){e.guiSelectPoint&&null!=t&&console.error("duplicate guiSelectPoint."),e.guiSelectPoint=t}},controllers:{get:function(){if(void 0===no){no=!0;const t=document.getElementById("time"),o=document.getElementById("prev"),n=document.getElementById("play"),i=document.getElementById("next"),r=!!(o||n||i),a=!(!t&&!r);!e.controllers&&a&&(e.controllers={t:{}},t&&(e.controllers.t.controller=t)),e.controllers&&(!e.controllers.player&&r&&(e.controllers.player={}),e.controllers.player&&(!e.controllers.player.buttonPrev&&o&&(e.controllers.player.buttonPrev=o),!e.controllers.player.buttonPlay&&n&&(e.controllers.player.buttonPlay=n),!e.controllers.player.buttonNext&&i&&(e.controllers.player.buttonNext=i)))}return e.controllers&&!e.controllers.boControllers&&(e.controllers=new class{constructor(t){for(var n in t=t||{},Object.defineProperties(this,{boControllers:{get:function(){return!0}},t:{get:function(){null===t.t&&console.error("options.controllers.t = "+t.t);const n=document.getElementById("time");if(!t.t){if(!n)return;t.t={elName:document.getElementById("tName")}}return!t.t.controller&&n&&(t.t.controller=n),t.t&&(oo(t.t,"t",(function(){return e.playerOptions&&e.playerOptions.name?e.playerOptions.name:"t"}),{onchange:function(n){e.player?!1===e.player.setTime(t.t.controller.value)&&(alert(o.timeAlert+t.t.controller.value),t.t.controller.focus()):console.error("options.controllers.t.onchange: create Player instance first. "+t.t.value)}}),void 0!==o&&""===t.t.controller.title&&(t.t.controller.title=o.controllerTTitle)),t.t}},player:{get:function(){return t.player}}}),t)void 0===this[n]&&console.error("Controllers: controllers."+n+" key is hidden")}}(e.controllers)),e.controllers}},title:{get:function(){return e.title}},traces:{get:()=>e.traces,set:t=>{e.traces=t}}}),e)void 0===this[r]&&console.error("Options: options."+r+" key is hidden");switch(this.playerOptions.cameraTarget.init(this.cameraTarget,this,!1),o={timeAlert:"Invalid time fromat: ",controllerTTitle:"Current time."},this.getLanguageCode()){case"ru":o.timeAlert="Неправильный формат времени: ",o.controllerTTitle="Текущее время.";break;default:if(void 0===e.lang||e.lang.languageCode!=languageCode)break;Object.keys(e.lang).forEach((function(t){void 0!==o[t]&&(o[t]=e.lang[t])}))}he.options||(he.options=this)}}io.findSpriteTextIntersection=function(e){var t;return e.children.forEach((function(e){"Sprite"!==e.type||e.name!==io.findSpriteTextIntersection.spriteTextIntersectionName||(t=e)})),t},io.findSpriteTextIntersection.spriteTextIntersectionName="spriteTextIntersection";io.raycaster=new class{constructor(){var e;this.onIntersection=function(t,o,n,i,r){t.object.userData.myObject&&(t.object.userData.myObject.guiPoints.boMouseOver=!0);const a=t.object.geometry.drawRange;if(t.index<a.start||a.count!=1/0&&t.index>=a.start+a.count)return!1;const s=r.domElement;if(void 0!==t.object.userData.isInfo&&!t.object.userData.isInfo())return!1;var l=io.findSpriteTextIntersection(n);if(l&&(!t.pointSpriteText||t.object.userData.raycaster&&t.object.userData.raycaster.text)&&(n.remove(l),l=void 0),void 0===l){const a=(o=new io(o)).spriteText.rect?JSON.parse(JSON.stringify(o.spriteText.rect)):{};a.displayRect=!0,a.backgroundColor="rgba(0, 0, 0, 1)",(l=Qt.getTextIntersection(t,{scales:o.scales,spriteOptions:{textHeight:o.spriteText.textHeight,fontColor:o.spriteText.fontColor,rect:a,group:n,center:{camera:i,canvas:s}}})).scale.divide(n.scale),n.add(l),void 0===e&&(e=r.domElement.style.cursor),r.domElement.style.cursor="pointer"}else t.pointSpriteText&&l.position.copy(t.pointSpriteText);return!0},this.onIntersectionOut=function(o,n){var i=!1;do{var r=io.findSpriteTextIntersection(o);void 0!==r&&(o.remove(r),i&&console.error("Duplicate spriteTextIntersection"),i=!0)}while(void 0!==r);t.forEach((e=>{e.object.userData.myObject&&delete e.object.userData.myObject.guiPoints.boMouseOver})),n.domElement.style.cursor=e},this.onMouseDown=function(e,t){if(void 0===e.object.userData.isInfo||e.object.userData.isInfo())if(t.guiSelectPoint&&e.object.userData.myObject){const o=e.object.userData.myObject.guiPoints,n=o.searchNearestEdgeVerticeId;o.verticeId=n?n(e.index,e):e.index,0!=o.isSetIntersectionIndex&&null!=o.verticeId&&(e.index=o.verticeId),t.guiSelectPoint.select(e),delete o.verticeId}else e.object.userData.onMouseDown&&e.object.userData.onMouseDown(e),t.axesHelper&&t.axesHelper.exposePosition(e)};const t=[];var o;this.intersectionsInOut=function(e,n,i,r,a={}){void 0!==e&&(o=Array.isArray(e)?n.intersectObjects(e):n.intersectObject(e));for(let e=0;e<o.length;e++){const l=o[e],c=window.__myThree__.three;l.pointSpriteText=new c.THREE.Vector3,a.options.stereoEffect&&a.options.stereoEffect.settings.spatialMultiplex===Qt.spatialMultiplexsIndexs.Mono?n.ray.at(c.options.camera.near+(c.options.camera.far-c.options.camera.near)/1e3,l.pointSpriteText):l.pointSpriteText=l.point;var s=!1;if(t.forEach((function(e){e.object!==l.object||(s=!0)})),s||t.push(l),l&&l.object.userData.raycaster&&l.object.userData.raycaster.onIntersection)l.object.userData.raycaster.onIntersection(l,r);else if(a.scene){if(io.raycaster.onIntersection(l,a.options,a.scene,a.camera,i))return}else console.error("THREE.Raycaster.setStereoEffect(): settings.scene = "+a.scene)}return t.forEach((function(e){var n=!1;o.forEach((function(t){e.object===t.object&&(n=!0)})),n||(e.object.userData.raycaster&&e.object.userData.raycaster.onIntersectionOut?e.object.userData.raycaster.onIntersectionOut():a.scene&&io.raycaster.onIntersectionOut(a.scene,i),t.splice(t.findIndex((t=>t===e)),1))})),o},this.EventListeners=class{constructor(e,t,n={}){var i;const r=he.THREE,a=new r.Vector2,s=[],l=new r.Raycaster,c=n.options||{};l.params.Points.threshold=void 0!==n.threshold?n.threshold:.03,l.params.Line.threshold=l.params.Points.threshold,l.setStereoEffect&&l.setStereoEffect({options:n.options,renderer:t,camera:e,scene:n.scene,stereoEffect:c.stereoEffect,raycasterEvents:!1});const u=c.renderer?c.renderer.domElement:window;u.addEventListener("mousemove",(function(r){if(void 0===l.stereo){if(io.raycaster.EventListeners.getRendererSize(t).getMousePosition(a,r),l.setFromCamera(a,e),o=l.intersectObjects(s))if(0===o.length)i&&(i.userData.raycaster&&i.userData.raycaster.onIntersectionOut?i.userData.raycaster.onIntersectionOut():io.raycaster.onIntersectionOut(n.scene,t),i=void 0);else{const r=o[0],s=r.object;s.userData.raycaster&&s.userData.raycaster.onIntersection?s.userData.raycaster.onIntersection(r,a):io.raycaster.onIntersection(r,c,n.scene,e,t),i=s}}else l.stereo.onDocumentMouseMove(r)}),!1),u.addEventListener("pointerdown",(function(e){if(void 0!==l&&o&&o.length>0){const t=o[0];t.object.userData.raycaster&&t.object.userData.raycaster.onMouseDown?t.object.userData.raycaster.onMouseDown(t,e):io.raycaster.onMouseDown(t,c)}}),!1),this.addParticle=function(e){e.userData.boFrustumPoints||(l.stereo?l.stereo.addParticle(e):!function(e){return s.includes(e)}(e)?s.push(e):console.error('Duplicate particle "'+e.name+'"'))},this.removeParticle=function(e){if(e.userData.boFrustumPoints)return;if(l.stereo)return void l.stereo.removeParticle(e);const t=s.indexOf(e);-1!==t&&s.splice(t,1)}}static getRendererSize(e,t){(t=t||e.domElement).style.position,t.style.left,t.style.top,t.style.width,t.style.height;const o=t.getBoundingClientRect(),n=Math.round(o.left),i=Math.round(o.top),r=new he.THREE.Vector2;return e.getSize(r),{getMousePosition:function(e,t){e.x=t.clientX/r.x*2-1-n/r.x*2,e.y=-t.clientY/r.y*2+1+i/r.y*2}}}}}};var ro,ao=io;
/**
   * @module Player
   * @description 3D objects animation.
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */class so{constructor(e,t={}){po(),!t.options&&t.frustumPoints&&(t.options=t.frustumPoints.getOptions()),t.options=t.options||new ao;const o=t.options;if(!o.boOptions)return void console.error("Player: call options = new Options( options ) first");if(!1===o.player)return;if(o.boPlayer=o.boPlayer||!1,o.player)return void console.error("Player: duplicate player.");function n(n){n=n||0;const i=r.getTime(n);so.selectPlayScene(e,{t:i,index:n,options:t.options}),r.setIndex(n,(""===o.playerOptions.name?"":o.playerOptions.name+": ")+i),t.onSelectScene&&(r.selectScenePause=t.onSelectScene(n,i)),o.frustumPoints&&o.frustumPoints.updateCloudPoints()}o.player=this,t.cameraTarget=t.cameraTarget||{},setTimeout((function(){n()}),0),o.playerOptions.selectSceneIndex=o.playerOptions.selectSceneIndex||0;var i=o.playerOptions.selectSceneIndex;const r=this;this.getTimeId=function(){return i},this.getTime=function(e){const t=o.playerOptions,n=t.min+(null!=e?e:i)*t.dt;return isNaN(n)&&console.error("Player.getTime(): t = "+n),null!==t.max&&n>t.max&&console.error("Player.getTime(): t = "+n+" playerOptions.max = "+t.max),n<t.min&&null!==t.max&&console.error("Player.getTime(): t = "+n+" playerOptions.min = "+t.min),n},this.setTime=function(e){return this.selectScene(parseInt((e-o.playerOptions.min)/o.playerOptions.dt))};const a=[];this.selectScene=function(e){if(0==a.length){if(void 0===e)return n(i),!0;if(isNaN(e))return console.error("Player.selectScene: index = "+e),!1;for(e=parseInt(e),null!==o.playerOptions.max&&(e>=o.playerOptions.marks?e=0:e<0&&(e=o.playerOptions.marks-1),i>o.playerOptions.marks&&(i=o.playerOptions.marks));i!==e;)i<e?i++:i--,!0===this.selectScenePause?a.push(i):n(i);return!0}},this.next=function(){r.selectScene(i+1)},this.prev=function(){r.selectScene(i-1)},this.pushController=function(e){void 0!==e.object&&void 0!==e.object.playRate&&(e.object.playRate=o.playerOptions.min),this.controllers.push(e)},this.controllers=[];var s,l,c=!1;function u(){o.player.controllers.forEach((function(e){e.onRenamePlayButtons&&e.onRenamePlayButtons(c)}))}function d(){c=!1,u(),s=void 0}function p(){if(i++,null!==o.playerOptions.max&&i>=o.playerOptions.marks){if(!o.playerOptions.repeat)return i=o.playerOptions.marks-1,void d();i=0}(-1===i||i===o.playerOptions.marks&&null!==o.playerOptions.max)&&(i=0),n(i)}function f(e){if(r.selectScenePause)return;if(c?window.requestAnimationFrame(f):s=void 0,void 0===s&&(l=(s=e)+1e3/o.playerOptions.interval),(isNaN(l)||l===1/0)&&(console.error("Player.animate: timeNext = "+l),c=!1),e<l||!c)return;const t=1e3/o.playerOptions.interval;if(t>0)for(;e>l;)l+=t;p()}this.play3DObject=function(){c?d():(c=!0,null!==o.playerOptions.max&&i>=o.playerOptions.marks-1&&(i=0),p(),u(),window.requestAnimationFrame(f))},this.continue=()=>{a.length>0?n(a.shift()):(r.selectScenePause=!1,window.requestAnimationFrame(f))},this.repeat=function(){o.playerOptions.repeat=!o.playerOptions.repeat,this.onChangeRepeat(o.playerOptions.repeat)},this.getSettings=function(){return t},this.getSelectSceneIndex=function(){return i},this.onChangeRepeat=function(e){o.playerOptions.repeat=e,this.controllers.forEach((function(e){e.onChangeRepeat&&e.onChangeRepeat()}))};const m={prevSymbol:"←",prevSymbolTitle:"Go to previous animation scene",nextSymbol:"→",nextSymbolTitle:"Go to next animation scene",playSymbol:"►",playTitle:"Play",pause:"❚❚",pauseTitle:"Pause",repeat:"⥀",repeatOn:"Turn repeat on",repeatOff:"Turn repeat off",controllerTitle:"Current time.",stereoEffects:"Stereo effects",mono:"Mono",sideBySide:"Side by side",topAndBottom:"Top and bottom"};function h(e){if("ru"===e())m.prevSymbolTitle="Кадр назад",m.playTitle="Проиграть",m.nextSymbolTitle="Кадр вперед",m.pauseTitle="Пауза",m.repeatOn="Повторять проигрывание",m.repeatOff="Остановить повтор проигрывания",m.controllerTitle="Текущее время.",m.stereoEffects="Стерео эффекты",m.mono="Моно",m.sideBySide="Слева направо",m.topAndBottom="Сверху вниз"}var g;function y(){if(g)return g.querySelector("#sliderPosition")}this.localization=function(e=function(){return"en"}){return h(e),m},this.PlayController=class extends Et{constructor(e){const t=o.player,n=o.getLanguageCode;if(t.createControllersButtons(o),!(e=e||o.dat.gui)||!1===o.dat.playController)return void super({});function i(e,t,o){const n=document.createElement("span");return n.innerHTML=e,n.title=t,n.style.cursor="pointer",n.style.margin="0px 2px",n.onclick=o,n}var r,a;h(n);const s="rgb(255,255,255)",l="rgb(128,128,128)";super({playRate:1,property:function(e){var o={};if(r=function(e,t){o.buttonPlay.innerHTML=e,o.buttonPlay.title=t},o.buttonPrev=i(m.prevSymbol,m.prevSymbolTitle,t.prev),o.buttonPlay=i(c?m.pause:m.playSymbol,c?m.pauseTitle:m.playTitle,t.play3DObject),null!==t.getSettings().options.playerOptions.max){function d(e){var n,i;e?(n=m.repeatOff,i=s):(n=m.repeatOn,i=l),o.buttonRepeat.title!==n&&(o.buttonRepeat.title=n,o.buttonRepeat.style.color=i,t.onChangeRepeat(e))}function p(e){d(o.buttonRepeat.title===m.repeatOn)}var n,u;a=d,t.getSettings().repeat?(n=m.repeatOff,u=s):(n=m.repeatOn,u=l),o.buttonRepeat=i(m.repeat,n,p),o.buttonRepeat.style.color=u}return o.buttonNext=i(m.nextSymbol,m.nextSymbolTitle,t.next),o}},"playRate"),t.PlayController=this,this.lang=m,this.onRenamePlayButtons=function(e){var t,o;e?(t=m.pause,o=m.pauseTitle):(t=m.playSymbol,o=m.playTitle),r(t,o,!0)},this.onChangeRepeat=function(){a(t.getSettings().options.playerOptions.repeat)},t.pushController(this),this.setValue=function(e){this._controller.domElement.childNodes[0].value=e};e.add(this).__truncationSuspended=!0}set controller(e){this._controller=e,this._controller.onChange((function(e){o.player.setTime(e)})),this._controller.domElement.title=this.lang.controllerTitle}get controller(){return this._controller}},this.gui=function(e){const n=o.dat.cookie,i=o.dat.getCookieName("Player"),r=o.getLanguageCode,a=he.dat;if(!(e=e||o.dat.gui)||!1===o.dat.playerGui)return;function s(){null===o.playerOptions.max?o.playerOptions.dt=o.playerOptions.dt||.1:o.playerOptions.dt=(o.playerOptions.max-o.playerOptions.min)/(o.playerOptions.marks-1)}function l(){s(),n.setObject(i,o.playerOptions),t.onChangeScaleT&&t.onChangeScaleT(o.playerOptions)}function c(){null!==o.playerOptions.max&&(o.playerOptions.max=o.playerOptions.min+o.playerOptions.dt*(o.playerOptions.marks-1))}c();const u={},d=function(e){const t={player:"Player",playerTitle:"3D objects animation.",min:"Min",max:"Max",dt:"Step",dtTitle:"Time between frames",marks:"Frames",marksTitle:"Player frames count",interval:"Rate",intervalTitle:"Rate of changing of animation scenes per second.",time:"Time",defaultButton:"Default",defaultTitle:"Restore default player settings."},o=void 0===(e=e||{}).getLanguageCode?"en":e.getLanguageCode();switch(o){case"ru":t.player="Проигрыватель",t.playerTitle="Анимация 3D объектов.",t.min="Минимум",t.max="Максимум",t.dt="Шаг",t.dtTitle="Веремя между кадрами",t.marks="Кадры",t.marksTitle="Количество кадров проигрывателя",t.interval="Темп",t.intervalTitle="Скорость смены кадров в секунду.",t.time="Время",t.defaultButton="Восстановить",t.defaultTitle="Восстановить настройки проигрывателя по умолчанию.";break;default:if(void 0===e.lang||e.lang._languageCode!=o)break;Object.keys(e.lang).forEach((function(t){void 0!==_lang[t]&&(_lang[t]=e.lang[t])}))}return t}({getLanguageCode:r});Object.keys(o.playerOptions).forEach((e=>{u[e]=o.playerOptions[e]})),Object.freeze(u);const p=o.playerOptions.max,f=o.playerOptions.marks;n.getObject(i,o.playerOptions,u),null!==p&&p!==1/0&&null!==o.playerOptions.max||(o.playerOptions.max=p,o.playerOptions.marks=f);const m=e.addFolder(d.player);a.folderNameAndTitle(m,d.player,d.playerTitle),function(){const e=o.playerOptions,n={};function i(t,o){var i=t.controller.getValue();e.min=o(e.min,i),n.min.setValue(e.min),e.max&&(e.max=o(e.max,i),s(),n.max.setValue(e.max)),l()}n.folder=m.addFolder(""!==e.name?e.name:d.time),n.scaleController=n.folder.add(new ge(i,{settings:t.options.playerOptions,getLanguageCode:r})).onChange((function(t){e.zoomMultiplier=t,l()}));const p=new ye((function(e){i(p,(function(t,o){return t+=e}))}),{settings:t.options.playerOptions,getLanguageCode:r});n.positionController=n.folder.add(p).onChange((function(t){e.offset=t,l()})),n.min=a.controllerZeroStep(n.folder,e,"min",(function(e){l()})),a.controllerNameAndTitle(n.min,d.min),c(),null!==e.max?(n.max=a.controllerZeroStep(n.folder,e,"max",(function(e){l()})),a.controllerNameAndTitle(n.max,d.max)):(n.dt=a.controllerZeroStep(n.folder,e,"dt",(function(e){l()})),a.controllerNameAndTitle(n.dt,d.dt,d.dtTitle)),e.marks&&(n.marks=n.folder.add(e,"marks").onChange((function(t){e.marks=parseInt(e.marks),l();const n=y();n&&(n.max=o.playerOptions.marks-1)})),a.controllerNameAndTitle(n.marks,void 0===e.marksName?d.marks:e.marksName,void 0===e.marksTitle?d.marksTitle:e.marksTitle)),t.options.playerOptions.intervalOptions||(t.options.playerOptions.intervalOptions={});const f=t.options.playerOptions.intervalOptions;f.min=null!=f.min?f.min:t.options.playerOptions.interval<1?t.options.playerOptions.interval:1,f.max=null===f.max?1/0:null!=f.max?f.max:t.options.playerOptions.interval>25?t.options.playerOptions.interval:25,f.max===1/0?n.interval=n.folder.add(t.options.playerOptions,"interval").onChange((function(e){l()})):n.interval=n.folder.add(t.options.playerOptions,"interval",f.min,f.max,1).onChange((function(e){l()})),a.controllerNameAndTitle(n.interval,d.interval,d.intervalTitle),a.controllerNameAndTitle(n.folder.add({defaultF:function(t){e.zoomMultiplier=u.zoomMultiplier,n.scaleController.setValue(e.zoomMultiplier),e.offset=u.offset,n.positionController.setValue(e.offset),e.min=u.min,n.min.setValue(e.min),n.max&&(e.max=u.max,s(),n.max.setValue(e.max)),n.dt&&(e.dt=u.dt,n.dt.setValue(e.dt)),u.marks&&(e.marks=u.marks,n.marks&&n.marks.setValue(e.marks)),e.interval=u.interval,n.interval.setValue(e.interval),(u.interval>n.interval.__max||u.interval<n.interval.__min)&&(n.interval.domElement.childNodes[0].childNodes[0].value=u.interval,e.interval=u.interval),l()}},"defaultF"),d.defaultButton,d.defaultTitle)}()},this.createControllersButtons=function(e){if(!e.controllers||!e.controllers.player)return;const t=e.controllers.player;if(null===t.buttonPrev&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonPrev = "+t.buttonPrev),t.buttonPrev){const o="string"==typeof t.buttonPrev?document.getElementById(t.buttonPrev):t.buttonPrev;null===o&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonPrev = "+t.buttonPrev),o&&(o.value=m.prevSymbol,o.title=m.prevSymbolTitle,o.onclick=function(t){e.player&&e.player.prev()},t.buttonPrev=o)}if(null===t.buttonPlay&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonPlay = "+t.buttonPlay),t.buttonPlay){const o="string"==typeof t.buttonPlay?document.getElementById(t.buttonPlay):t.buttonPlay;null===o&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonPlay = "+t.buttonPlay),o&&(o.value=c?m.pause:m.playSymbol,o.title=c?m.pauseTitle:m.playTitle,o.onclick=function(t){e.player&&e.player.play3DObject()},t.buttonPlay=o)}if(null===t.buttonNext&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonNext = "+t.buttonNext),t.buttonNext){const o="string"==typeof t.buttonNext?document.getElementById(t.buttonNext):t.buttonNext;null===o&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonNext = "+t.buttonNext),o&&(o.value=m.nextSymbol,o.title=m.nextSymbolTitle,o.onclick=function(t){e.player&&e.player.next()},t.buttonNext=o)}},this.createCanvasMenuItem=function(e,t=function(){return"en"}){g=e;const n=this,i=e.menu,r=n.localization(t);i.push({name:r.prevSymbol,title:r.prevSymbolTitle,onclick:function(e){n.prev()}}),i.push({name:c?r.pause:r.playSymbol,title:c?r.pauseTitle:r.playTitle,id:"menuButtonPlay",onclick:function(e){n.play3DObject()}}),null!==o.playerOptions.max&&i.push({name:r.repeat,title:this.getSettings().repeat?r.repeatOff:r.repeatOn,id:"menuButtonRepeat",onclick:function(e){n.repeat()}}),i.push({name:r.nextSymbol,title:r.nextSymbolTitle,onclick:function(e){n.next()}}),this.controllers.push({onRenamePlayButtons:function(t){var n,i;t?(n=r.pause,i=r.pauseTitle):(n=r.playSymbol,i=r.playTitle);const a=e.querySelector("#menuButtonPlay");a.innerHTML=n,a.title=i,o.controllers&&o.controllers.player&&o.controllers.player.buttonPlay&&(o.controllers.player.buttonPlay.value=n,o.controllers.player.buttonPlay.title=i)},onChangeRepeat:function(){e.querySelector("#menuButtonRepeat").title=o.playerOptions.repeat?r.repeatOff:r.repeatOn}})},this.addSlider=function(){null!==o.playerOptions.max&&g.menu.push({name:'<input type="range" min="0" max="'+(o.playerOptions.marks-1)+'" value="0" class="slider" id="sliderPosition">',style:"float: right;"})},this.addSliderEvents=function(){const e=y();if(e){var t;e.onchange=function(t){n.selectScene(parseInt(e.value))},e.oninput=function(t){n.selectScene(parseInt(e.value))};const n=this;e.addEventListener("pointerdown",(e=>{t=!0})),e.addEventListener("pointerup",(e=>{t=!1})),e.addEventListener("mousemove",(i=>{t&&n.selectScene((o.playerOptions.marks-1)*i.offsetX/e.clientWidth)}))}return e},this.setIndex=function(e,t){const n=this.getTime();o.controllers&&o.controllers.t&&(o.controllers.t.controller.value=n),"object"==typeof this.PlayController&&this.PlayController.setValue(n);const i=y();i&&(i.value=e,i.title=t)},this.onChangeScale=function(e){y().max=e.marks-1,this.selectScene(0)}}}so.cameraTarget=class{constructor(){const e={boLook:!1},t={boLook:e.boLook,getDistanceToCamera(){return void 0!==this.distanceToCameraCur?this.distanceToCameraCur:this.distanceToCamera}};var o;e.rotation={},t.rotation={};var n,i=!1,r=!1;function a(o){po(),o||(o=e),t.boMaual||(void 0!==o.boLook?t.boLook=o.boLook:t.boLook=e.boLook),e.camera=e.camera||o.camera,t.camera=o.camera||e.camera,t.distanceToCamera=o.distanceToCamera||e.distanceToCamera||t.distanceToCamera||(new co.Vector3).copy(e.camera.position),o.rotation||(o.rotation={}),void 0!==o.rotation.angle?t.rotation.angle=o.rotation.angle:t.rotation.angle=e.rotation.angle||0,t.rotation.axis=o.rotation.axis||e.rotation.axis||new co.Vector3(0,1,0)}this.get=function(n){if(n||o?o&&n&&!Object.is(o,n)&&console.error("Player.cameraTarget.get: options is ambiguous"):console.error("Player.cameraTarget.get: options = "+n),o=o||n,t.camera||r||!o.player||(e.camera=o.player.getSettings().cameraTarget.camera,e.camera&&a(),r=!0),t.camera)return t},this.init=function(t,r,s=!0){if(t){if(r||o?o&&r&&!Object.is(o,r)&&console.error("Player.cameraTarget.init: options is ambiguous"):console.error("Player.cameraTarget.init: options = "+r),o=o||r,!1!==t.bodefault){if(i)return;void 0!==t.boLook&&(e.boLook=t.boLook,n=t.boLook)}else{if(!0!==t.boLook)return;i&&console.warn("playerCameraTarget().init(...): duplicate target point"),i=!0,void 0===n&&(e.boLook=!0)}e.camera=e.camera||t.camera||(o.player?o.player.getSettings().cameraTarget.camera:void 0),e.camera||!s?(e.distanceToCamera=e.distanceToCamera||t.distanceToCamera,t.rotation=t.rotation||{},e.rotation.angle=e.rotation.angle||t.rotation.angle,e.rotation.axis=e.rotation.axis||t.rotation.axis,a(t)):console.error("playerCameraTarget().init(...): cameraTargetDefault.camera = "+e.camera)}},this.changeTarget=function(e,t,n){po();const i=e.userData.player&&"function"!=typeof e.userData.player.arrayFuncs?e.userData.player.arrayFuncs[e.userData.myObject.guiPoints.seletedIndex(t)]:{};null!=i&&(i.cameraTarget||(i.cameraTarget={boLook:!1}),a(i.cameraTarget));const r=(o=o||n).playerOptions.cameraTarget.get(o);if(r)if(r&&r.boLook){const o=Pt(e,(new co.Vector3).fromArray(e.geometry.attributes.position.array,t*e.geometry.attributes.position.itemSize));r.target=o}else delete r.target},this.setCameraTarget=function(e){po();var t=e.playerOptions.cameraTarget.get(e);t||(t=t||{});const o=t.camera;if(!o)return;t.distanceToCamera||(t.distanceToCamera=(new co.Vector3).copy(o.position)),t.distanceToCameraCur||(t.distanceToCameraCur=new co.Vector3);const n=e.time,i=t.distanceToCamera,r=(new co.Vector3).copy(t.distanceToCameraCur);t.distanceToCameraCur.set(so.execFunc(i,"x",n,e),so.execFunc(i,"y",n,e),so.execFunc(i,"z",n,e)),t.setCameraPosition||(t.setCameraPosition=function(){var n=t.target;if(!t.boLook||!n&&t.distanceToCameraCur.equals(r))return;r.copy(t.distanceToCameraCur);const i=e.time;if(o.position.copy(t.distanceToCameraCur),o.position.applyAxisAngle(t.rotation.axis,so.execFunc(t.rotation,"angle",i,e)),!n){if(!so.orbitControls)return;n=so.orbitControls.target}o.position.add(n),o.lookAt(n),e.orbitControls&&(e.orbitControls.target.equals(n)||(e.orbitControls.target.copy(n),e.orbitControlsGui&&e.orbitControlsGui.setTarget(n)),e.orbitControls._listeners&&e.orbitControls._listeners.change[0]())}),e.cameraGui&&e.cameraGui.update()}}},so.execFunc=function(e,t,o,n={}){var i=e[t];const r=n.a,a=n.b,s=typeof i;switch(void 0===o&&(o=n.playerOptions?n.playerOptions.min:0),s){case"undefined":return;case"number":return i;case"string":i=new Function("t","a","b","return "+i);case"function":try{const h=i(o,r,a);if(void 0===h)throw"function returns "+h;if(!Array.isArray(h))return h;i=h}catch(g){throw console.error(g),g}case"object":if(Array.isArray(i)){if(0===i.length)return void console.error('Player.execFunc: funcs["'+t+'"] array is empty');const y=i,v=i.length-1,b=null===n.playerOptions.max?1/0:n.playerOptions.max,_=n.playerOptions.min,x=(b-_)/v;for(var l=_,c=b,u=0,d=v,p=0;p<i.length;p++)x*p+_<o&&(l=x*(u=p)+_,c=x*(d=p+1)+_);function w(e){return"function"==typeof y[e]?y[e](o,y,a):y[e]instanceof co.Color?y[e]:void 0}if("number"!=typeof y[u]){if("w"===t)return w(u);if("object"==typeof y[u]){for(p=0;p<i.length;p++){if(p===i.length-1)return y[p].v;if(d=p+1,l=y[u=p].t,c=y[d].t,l<=o&&c>o){var f=(y[d].v-y[u].v)/(c-l),m=y[u].v-f*l;return f*o+m}}return void console.error("Player.execFunc: value is not detected")}return void console.error('Player.execFunc: funcs["'+t+'"] array item '+u+" typeof = "+typeof y[u]+" is not number")}if(d>=i.length&&(d=u),"number"!=typeof y[d]){if("w"===t)return w(d);if("object"!=typeof y[d])return void console.error('Player.execFunc: funcs["'+t+'"] array item '+d+" typeof = "+typeof y[d]+" is not number")}f=(y[d]-y[u])/(c-l),m=y[u]-f*l;return(isNaN(f)||isNaN(m))&&console.error("Player.execFunc: invalid x = "+f+" or y = "+m),f*o+m}return i.func?i.func instanceof Function?i.func(o,r,a):i.func:("w"!==t&&console.error('Player.execFunc: funcs["'+t+'"] object is not array'),i);default:console.error('Player.execFunc: Invalud typeof funcs["'+t+'"]: '+s)}};var lo=new class{constructor(){function e(e){function t(t){const o=e+t;return{get controllerId(){return this.boUsed?void 0:o},get elController(){return document.getElementById(this.controllerId)},nameId:o+"Name",get elName(){return document.getElementById(this.nameId)}}}return{func:t("Func"),position:t("Position"),worldPosition:t("WorldPosition")}}this.x=e("x"),this.y=e("y"),this.z=e("z"),this.w=e("w")}};so.selectMeshPlayScene=function(e,t={}){po();var o=t.t,n=t.options||{dat:!1};if(n=new ao(n),void 0===o&&(o=n.playerOptions.min),n.scales.setW(),!e.userData.player||n&&n.boPlayer&&e.userData.boFrustumPoints)return;if(e.geometry&&(delete e.geometry.boundingSphere,e.geometry.boundingSphere=null),e.userData.player.selectPlayScene){function s(t){for(;e.rotation[t]<0;)e.rotation[t]+=2*Math.PI;for(;e.rotation[t]>2*Math.PI;)e.rotation[t]-=2*Math.PI}e.userData.player.selectPlayScene(o),s("x"),s("y"),s("z")}!function(t,i){if(!e.geometry||e.userData.nd)return;const a=e.geometry.attributes,s=e.userData.player.arrayFuncs;var l,c;if(void 0!==s&&(void 0===o&&console.error("setPosition: t = "+o),n&&void 0!==n.scales.w?(l=n.scales.w.min,c=n.scales.w.max):l=(c=f)-1,!e.userData.myObject||!e.userData.myObject.isSetPosition))for(var u=0;u<s.length;u++){var d=s[u],p=!1;function m(e,t){var i=so.execFunc(d,e,o,n);void 0!==i&&(a.position[t](u,i),p=!0)}let h;function g(){if(e.userData.player.palette)h=e.userData.player.palette.toColor(f,l,c);else{if(!n.palette){const e={r:255,g:255,b:255};return h=new co.Color("rgb("+e.r+", "+e.g+", "+e.b+")"),h}h=n.palette.toColor(f,l,c)}}if(m("x","setX"),m("y","setY"),m("z","setZ"),m("w","setW"),"function"==typeof d.w){var f=d.w(o,t,i);n.scales.w?(l=n.scales.w.min,c=n.scales.w.max):(console.warn("Player.selectMeshPlayScene: Кажется эти экстремумы заданы неверно"),l=0,c=100),a.position.itemSize>=4&&a.position.setW(u,f),p=!0,g()}else if("object"==typeof d.w)if(d.w instanceof co.Color)h=d.w;else{f=so.execFunc(d,"w",o,n);void 0!==d.w.min&&(l=d.w.min),void 0!==d.w.max&&(c=d.w.max),g()}h=r(void 0===d.w?(new co.Vector4).w:"number"==typeof d.w?d.w:so.execFunc(d,"w",o,n),e,u,h),p&&(a.position.needsUpdate=!0),d.trace&&!d.line&&(d.line=new so.traceLine(n),d.trace=!1),d.line&&d.line.addPoint&&d.line.addPoint(e,u,h),d.cameraTarget&&!0===d.cameraTarget.boLook&&n.playerOptions.cameraTarget.changeTarget(e,u,n)}}(n?n.a:1,n?n.b:0);const i="Player.selectMeshPlayScene: invalid mesh.scale.";function r(e,t,o,i){if(t.geometry.attributes.position.itemSize<4)return;if(n.palette&&(i=n.palette.toColor(e,n.scales.w.min,n.scales.w.max)),!i)return;const r=t.geometry.attributes,a=t.userData.player.arrayFuncs;return!so.setColorAttribute(r,o,i)&&a[o]instanceof co.Vector4&&(t.userData.player&&a?(t.geometry.setAttribute("color",new co.Float32BufferAttribute(so.getColors(a,{positions:r.position,options:n}),4)),so.setColorAttribute(r,o,i)||console.error('Player.selectMeshPlayScene: the color attribute is not exists. Please use THREE.Vector3 instead THREE.Vector4 in the arrayFuncs or add "color" attribute')):console.error("Player.selectMeshPlayScene: set color attribute failed. Invalid mesh.userData.player.arrayFuncs")),i}if(e.scale.x<=0&&console.error(i+"x = "+e.scale.x),e.scale.y<=0&&console.error(i+"y = "+e.scale.y),e.scale.z<=0&&console.error(i+"z = "+e.scale.z),e.userData.player&&e.userData.player.arrayFuncs&&e.userData.player.arrayFuncs instanceof Array&&e.userData.player.arrayFuncs.forEach((function(t,o){if(t.controllers){if(!ro)switch(ro={controllerXTitle:"X position",controllerYTitle:"Y position",controllerZTitle:"Z position",controllerWTitle:"color index",controllerWorld:"World",controllerXWorldTitle:"X world position",controllerYWorldTitle:"Y world position",controllerZWorldTitle:"Z world position",controllerWWorldTitle:"color index",controllerXFunctionTitle:"X = f(t)",controllerYFunctionTitle:"Y = f(t)",controllerZFunctionTitle:"Z = f(t)",controllerWFunctionTitle:"W = f(t)",positionAlert:"Invalid position fromat: "},n.getLanguageCode()){case"ru":ro.controllerXTitle="Позиция X",ro.controllerYTitle="Позиция Y",ro.controllerZTitle="Позиция Z",ro.controllerWTitle="Индекс цвета",ro.controllerWorld="Абсолютный",ro.controllerXWorldTitle="Абсолютная позиция X",ro.controllerYWorldTitle="Абсолютная позиция Y",ro.controllerZWorldTitle="Абсолютная позиция Z",ro.controllerWWorldTitle="Индекс цвета",ro.positionAlert="Неправильный формат позиции точки: ";break;default:if(void 0===n.lang||n.lang.languageCode!=languageCode)break;Object.keys(n.lang).forEach((function(e){void 0!==ro[e]&&(ro[e]=n.lang[e])}))}const i=At(e,o);function a(i,a){const s="x"===a?0:"y"===a?1:"z"===a?2:"w"===a?3:void 0;"w"===a&&(r(i,e,o),n.guiSelectPoint&&n.guiSelectPoint.update());const l=s+e.geometry.attributes.position.itemSize*o,c=e.geometry.attributes.position.array[l];e.geometry.attributes.position.array[l]=i;const u=t.controllers[a];if(isNaN(e.geometry.attributes.position.array[l])){alert(ro.positionAlert+i);const t=u.position.controller;return t.focus(),t.value=c,void(e.geometry.attributes.position.array[l]=c)}if(e.geometry.attributes.position.needsUpdate=!0,n.axesHelper&&n.axesHelper.updateAxes(),n.guiSelectPoint&&n.guiSelectPoint.update(),u.worldPosition&&u.worldPosition.controller){u.worldPosition.controller.innerHTML=Ot(e,o)[a]}}function s(o){var r=t.controllers[o];if(!1===r)return;const s="position";function l(e){lo[o][e].elController&&(r[e]||(lo[o][e].boUsed?console.warn('Player.selectMeshPlayScene createControllers: Same controller is using for different points. Controller ID is "'+lo[o][e].controllerId+'""'):(r[e]={controller:lo[o][e].elController,elName:!!lo[o][e].elName&&lo[o][e].elName},lo[o][e].boUsed=!0,e===s&&"w"===o&&(r[e].elSlider=!0))))}!r&&(lo[o].func.elController||lo[o].position.elController||lo[o].worldPosition.elController)&&(r={},t.controllers[o]=r),r&&(l("func"),l(s),l("worldPosition"),oo(r.func,lo[o].func.controllerId,(function(){return n.scales[o].name+" = f(t)"}),{value:t[o],title:"x"===o?ro.controllerXFunctionTitle:"y"===o?ro.controllerYFunctionTitle:"z"===o?ro.controllerZFunctionTitle:"w"===o?ro.controllerWFunctionTitle:"",onchange:function(e){try{t[o]=e.currentTarget.value;const i=so.execFunc(t,o,n.player.getTime(),n);if(r.position&&r.position.controller){const e=r.position.controller;e.onchange({currentTarget:{value:i}}),e.value=i}else a(i,o);n.guiSelectPoint&&n.guiSelectPoint.update()}catch(i){alert("Axis: "+n.scales[o].name+'. Function: "'+t[o]+'". '+i),e.currentTarget.focus()}}}),oo(r.position,o+"Position",(function(){return n.scales[o].name}),{value:i[o],title:"x"===o?ro.controllerXTitle:"y"===o?ro.controllerYTitle:"z"===o?ro.controllerZTitle:"w"===o?ro.controllerWTitle:"",onchange:function(e){a(e.currentTarget.value,o)},axisName:o}),oo(r.worldPosition,o+"WorldPosition",(function(){return ro.controllerWorld+" "+n.scales[o].name}),{value:Pt(e,i)[o],title:"x"===o?ro.controllerXWorldTitle:"y"===o?ro.controllerYWorldTitle:"z"===o?ro.controllerZWorldTitle:"w"===o?ro.controllerWTitle:""}))}if(t.name){t.controllers.pointName||(t.controllers.pointName="pointName");const l="string"==typeof t.controllers.pointName?document.getElementById(t.controllers.pointName):t.controllers.pointName;l&&(l.innerHTML=t.name)}s("x"),s("y"),s("z"),s("w")}})),n&&n.guiSelectPoint){n.guiSelectPoint.setMesh();var a=n.guiSelectPoint.getSelectedPointIndex();-1!==a&&n.guiSelectPoint.isSelectedMesh(e)&&n.guiSelectPoint.setPosition({object:e,index:a})}else n.axesHelper&&n.axesHelper.movePosition()},so.setColorAttribute=function(e,t,o){"string"==typeof o&&(o=new co.Color(o));const n=e.color;return void 0!==n&&(n.setX(t,o.r),n.setY(t,o.g),n.setZ(t,o.b),n.needsUpdate=!0,!0)},so.getPoints=function(e,t){po(),Array.isArray(e)||(e=[e]),void 0===(t=t||{}).t&&(t.t=t.options&&t.options.player?t.options.player.getSettings().options.playerOptions.min:0);const o=t.options||new ao,n=new ao({palette:o.palette});o.setW(n);const i=n.scales.w.max;for(var r=0;r<e.length;r++){var a=e[r];Array.isArray(a)?e[r]=new co.Vector4(void 0===a[0]?0:a[0],void 0===a[1]?0:a[1],void 0===a[2]?0:a[2],void 0===a[3]?i:a[3]):"object"==typeof a&&a instanceof co.Vector2==!1&&a instanceof co.Vector3==!1&&a instanceof co.Vector4==!1&&(void 0===a.vector?e[r]=new co.Vector4(void 0===a.x?0:a.x,void 0===a.y?0:a.y,void 0===a.z?0:a.z,void 0===a.w?0:a.w):a.vector instanceof co.Vector2==!0||a.vector instanceof co.Vector3==!0||a.vector instanceof co.Vector4==!0?a.vector instanceof co.Vector2==!0&&(e[r].vector=new co.Vector3(void 0===a.vector.x?0:a.vector.x,void 0===a.vector.y?0:a.vector.y,void 0===a.vector.z?0:a.vector.z)):4===a.vector.length?e[r].vector=new co.Vector4(void 0===a.vector[0]?0:a.vector[0],void 0===a.vector[1]?0:a.vector[1],void 0===a.vector[2]?0:a.vector[2],void 0===a.vector[3]?0:a.vector[3]):3===a.vector.length?e[r].vector=new co.Vector3(void 0===a.vector[0]?0:a.vector[0],void 0===a.vector[1]?0:a.vector[1],void 0===a.vector[2]?0:a.vector[2]):a.vector.length<3?e[r].vector=new co.Vector4(void 0===a.vector[0]?0:a.vector[0],void 0===a.vector[1]?0:a.vector[1]):console.error("Player.getPoints(...) falied! item.vector.length = "+a.vector.length))}const s=[];for(r=0;r<e.length;r++){var l=e[r];function c(n){if("number"==typeof l&&(l=new co.Vector4(l,0,0,0)),l instanceof co.Vector2||l instanceof co.Vector3||l instanceof co.Vector4){return so.execFunc(l,n,t.t,o)}if(void 0!==l.vector)return void 0!==l.name&&(l.vector.name=l.name),l.trace&&(l.vector.trace=l.trace),l.controllers&&(l.vector.controllers=l.controllers),l.cameraTarget&&(l.vector.cameraTarget=l.cameraTarget,delete l.cameraTarget),e[r]=l.vector,l=l.vector,so.execFunc(l,n,t.t,o);console.error("Player.getAxis().getPoints(): funcs.vector = "+l.vector)}const u=l.vector instanceof co.Vector3==!0?new co.Vector3(c("x"),c("y"),c("z")):new co.Vector4(c("x"),c("y"),c("z"),c("w"));l.cameraTarget&&(l.cameraTarget.bodefault=!1,void 0===l.cameraTarget.boLook&&(l.cameraTarget.boLook=!0),o.playerOptions.cameraTarget.init(l.cameraTarget,o)),s.push(u)}return s};var co,uo=!0;function po(){he.isThree()?(co=he.THREE,Object.assign(co.BufferGeometry.prototype,{setFromPoints:function(e,t){t=t||e.itemSize||3;for(var o=[],n=0,i=e.length;n<i;n++){var r=e[n];o.push(r.x,r.y,r.z||0),t>=4&&o.push(r.w||0)}return this.setAttribute("position",new co.Float32BufferAttribute(o,t)),this}}),Object.assign(co.Vector4.prototype,{multiply:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,void 0!==e.w&&(this.w*=e.w),this}}),Object.assign(co.Vector4.prototype,{add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,void 0!==e.w&&(this.w+=e.w),this)}}),Object.assign(co.Points.prototype,{raycast:function(e,t){const o=new co.Matrix4,n=new co.Ray,i=new co.Sphere,r=new co.Vector3;function a(e,t,o,i,r,a,s){const l=n.distanceSqToPoint(e);if(l<o){const o=new co.Vector3;n.closestPointToPoint(e,o),o.applyMatrix4(i);const c=r.ray.origin.distanceTo(o);if(c<r.near||c>r.far)return;a.push({distance:c,distanceToRay:Math.sqrt(l),point:o,index:t,face:null,object:s})}}const s=this.geometry,l=this.matrixWorld,c=e.params.Points.threshold;if(null===s.boundingSphere&&s.computeBoundingSphere(),i.copy(s.boundingSphere),i.applyMatrix4(l),i.radius+=c,!1===e.ray.intersectsSphere(i))return;o.copy(l).invert(),n.copy(e.ray).applyMatrix4(o);const u=c/((this.scale.x+this.scale.y+this.scale.z)/3),d=u*u;if(s.isBufferGeometry){const o=s.index,n=s.attributes,i=n.position.array,c=n.position.itemSize;if(null!==o){const n=o.array;for(let o=0,s=n.length;o<s;o++){const s=n[o];r.fromArray(i,s*c),a(r,s,d,l,e,t,this)}}else for(let o=0,n=i.length/c;o<n;o++)r.fromArray(i,o*c),a(r,o,d,l,e,t,this)}else{const o=s.vertices;for(let n=0,i=o.length;n<i;n++)a(o[n],n,d,l,e,t,this)}}})):console.warn("Player: can not assign. Set THREE first.")}so.getColors=function(e,t){if(po(),Array.isArray(e)||(e=[e]),(t=t||{}).options=t.options||{},void 0!==t.positions&&Array.isArray(e)&&e.length!==t.positions.count)return console.error("getColors failed! arrayFuncs.length: "+e.length+" != positions.count: "+t.positions.count),t.colors;const o=Array.isArray(e)?e.length:t.positions.count;t.colors=t.colors||[];const n=[];t.options.palette||t.options.setPalette();for(var i=0;i<o;i++){const o=3*i;if(o>=t.colors.length){const o=Array.isArray(e)?e[i]:void 0;if(o instanceof co.Vector4||t.positions&&4===t.positions.itemSize){let e,s;var r=o.w;o.w instanceof Object&&o.w.func?(o.w.max&&(s=o.w.max),o.w.min&&(e=o.w.min),r=o.w.func):(t.options.setW(),e=t.options.scales.w.min,s=t.options.scales.w.max),r instanceof Function&&!t.options.player&&uo&&(uo=!1);const l=t.options.playerOptions?t.options.playerOptions.min:0;var a=t.options.palette.toColor(void 0===o?(new co.Vector4).fromBufferAttribute(t.positions,i).w:r instanceof Function?r(l):"string"==typeof r?so.execFunc(o,"w",l,t.options):void 0===r?(new co.Vector4).w:r,e,s);n.push(a.r,a.g,a.b)}else if(t.colors instanceof co.Float32BufferAttribute)new co.Vector3(1,1,1);else if(null!=t.color){const e=new co.Color(t.color);n.push(e.r,e.g,e.b)}else n.push(1,1,1)}else n.push(t.colors[o],t.colors[o+1],t.colors[o+2]);t.opacity instanceof Array?n.push(i<t.opacity.length?t.opacity[i]:1):n.push(1)}return t.colors=n,t.colors},so.traceLine=class{constructor(e){var t;const o=[];po(),e.player&&(this.isVisible=function(){return!!e.player&&(t?t.visible:0!==o.length&&o[0].visible)},this.visible=function(n){if(!e.player)return!1;t?t.visible=n:o.forEach((function(e){e.visible=n}))},this.addPoint=function(n,i,r){const a=n.geometry.attributes.position;var s=a.itemSize>=4?new co.Vector4(0,0,0,0):new co.Vector3;s.fromArray(a.array,i*a.itemSize);var l=e.player?e.player.getSelectSceneIndex():0;if(null===e.playerOptions.max){if((l=Math.abs(l))<o.length-1){for(;l<o.length-1;)n.remove(o[o.length-1]),o.pop();return}const e=new co.BufferGeometry,t=2,i=new Float32Array(3*t);e.setAttribute("position",new co.BufferAttribute(i,3));const a=new Float32Array(3*t);e.setAttribute("color",new co.Float32BufferAttribute(a,3));const c=new co.Line(e,new co.LineBasicMaterial({vertexColors:!0}));n.add(c),o[0]&&(c.visible=o[0].visible),s=(new co.Vector3).copy(s);const u=c.geometry.attributes.position.itemSize;s.toArray(c.geometry.attributes.position.array,1*u);return(0===o.length?s:(new co.Vector3).fromArray(o[o.length-1].geometry.attributes.position.array,1*u)).toArray(c.geometry.attributes.position.array,0*u),c.geometry.attributes.position.needsUpdate=!0,void 0===r&&(r=new co.Color(1,1,1)),so.setColorAttribute(c.geometry.attributes,0,0===o.length?r:(new co.Color).fromArray(o[o.length-1].geometry.attributes.color.array,1*u)),so.setColorAttribute(c.geometry.attributes,1,r),void o.push(c)}if(void 0===t){const o=new co.BufferGeometry;var c;if(null!==e.playerOptions.max)if(e.playerOptions&&e.playerOptions.marks)c=e.playerOptions.marks;else{if(!e.player||!e.player.marks)return void console.error("Player.traceLine: MAX_POINTS = "+c+". Create Player first or remove all trace = true from all items of the arrayFuncs");c=e.player.marks}else c=l+1;const i=new Float32Array(3*c);o.setAttribute("position",new co.BufferAttribute(i,3));const r=new Float32Array(3*c);o.setAttribute("color",new co.Float32BufferAttribute(r,3)),o.setDrawRange(l,l),(t=new co.Line(o,new co.LineBasicMaterial({vertexColors:!0}))).visible=!0,n.add(t)}t.geometry&&(delete t.geometry.boundingSphere,t.geometry.boundingSphere=null),(s=(new co.Vector3).copy(s)).toArray(t.geometry.attributes.position.array,l*t.geometry.attributes.position.itemSize),t.geometry.attributes.position.needsUpdate=!0,void 0===r&&(r=new co.Color(1,1,1)),so.setColorAttribute(t.geometry.attributes,l,r);var u=t.geometry.drawRange.start,d=l+1-u;u>l&&(d=u+t.geometry.drawRange.count-(u=l));t.geometry.setDrawRange(u,d)},this.remove=function(){void 0!==t&&(t.geometry.dispose(),t.material.dispose(),t.parent.remove(t))})}},so.getItemSize=function(e){po();for(var t=0;t<e.length;t++){if(e[t]instanceof co.Vector4)return 4}return 3},so.selectPlayScene=function(e,t={}){const o=void 0!==t.t?t.t:0,n=void 0!==t.index?t.index:void 0,i=t.options||new ao;e.userData.index=n,e.userData.t=o,"object"==typeof i.player&&(i.player.endSelect=()=>{so.selectMeshPlayScene(e,{t:o,options:i}),function e(t){t.children.forEach((function(t){t instanceof co.Group?e(t):so.selectMeshPlayScene(t,{t:o,options:i})}))}(e),i.playerOptions.cameraTarget.setCameraTarget(i);const t=i.playerOptions.cameraTarget.get();t&&t.setCameraPosition&&t.setCameraPosition(void 0===n)}),e.userData.endSelect||"object"!=typeof i.player||i.player.endSelect()},so.assign=function(){po()};var fo=so;
/**
   * @module myObject
   * @description Base class for my threejs objects.
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   * 
  */const mo="MyObject";class ho{constructor(e={},t){const o=this;e.overriddenProperties||(e.overriddenProperties={}),e.overriddenProperties.setDrawRange||(e.overriddenProperties.setDrawRange=(e,t)=>{}),e.overriddenProperties.getPlayerTimesLength=()=>1,e.overriddenProperties.positionOffsetId||(e.overriddenProperties.positionOffsetId=e=>e),e.guiPoints&&(this.guiPoints=e.guiPoints),e.object=e.object||{},e.object.geometry=e.object.geometry||{},this.isSetPosition=e.isSetPosition;const n=e.options?e.options.player.getTimeId():0,i=e.object.geometry,r=i.position;0!==n||r&&r.isPositionProxy||(i.position=new Proxy(r||[],{get:(t,o)=>{const n=parseInt(o);return isNaN(n)?"isPositionProxy"===o||t[o]:new Proxy(t[n],{set:(t,o,i)=>{const r=parseInt(o);return isNaN(r)?(t[o]=i,!0):(t[r]=i,e.bufferGeometry.userData.position[n][r]=i,!0)}})}}));const a=he.THREE;e.bufferGeometry||(e.bufferGeometry=new a.BufferGeometry,Object.defineProperty(e.bufferGeometry.userData,"timeId",{get:()=>0,set:e=>{},configurable:!0})),this.bufferGeometry=e.bufferGeometry,t&&(e.object.geometry.position||(e.object.geometry.position=t)),this.setVerticesRange=(t,o)=>{const n=e.bufferGeometry,i=n.attributes.position,r=i&&null!=n.index?i.itemSize:1;this.setDrawRange(t*r,o*r,n.drawRange.types.vertices)},this.setEdgesRange=(t=0,o)=>{const n=e.bufferGeometry.drawRange;t=null!=t?t:n.start;const i=2*e.object.geometry.indices[0].timeEdgesCount;this.setDrawRange(i*t,i*((null!=o?o:e.options.player.getTimeId()+1)-t),n.types.edges)},this.setDrawRange=(t,o,n)=>{e.debug&&(null!=n?e.bufferGeometry.drawRange.type=n:console.error(mo+": setDrawRange(...). Invalid type = "+n),Number.isInteger(t)&&(o==1/0||Number.isInteger(o))||console.error(mo+": setDrawRange(...). Invalid drawRange = { start: "+t+", count: "+o+" }")),e.overriddenProperties.setDrawRange(t,o)};const s=()=>e.overriddenProperties.getPlayerTimesLength(),l=()=>{e.bufferGeometry.drawRange.types={vertices:0,edges:1}},c=(t,n)=>{const i=null!=e.object.geometry.rCount,r=i?t*n*e.object.geometry.rCount:e.object.geometry.MAX_POINTS;l(),null!=r&&this.setVerticesRange(0,i?t*n*s():1/0),i&&(e.bufferGeometry.userData.drawRange=()=>e.bufferGeometry.drawRange);const c=new Float32Array((null!=r?r:n)*t);e.bufferGeometry.setAttribute("position",new a.Float32BufferAttribute(c,t)),e.bufferGeometry.userData.positionOffsetId=e=>this.positionOffsetId(e),e.bufferGeometry.userData.position=new Proxy(e.bufferGeometry.attributes.position,{get:(t,n)=>{const i=parseInt(n);if(!isNaN(i)){const n=this.positionOffset(t,i),r=t.array,s=new Proxy([],{get:(l,c)=>{const u=parseInt(c);if(!isNaN(u)){if(u>=t.itemSize)return;return r[n+u]}switch(c){case"forEach":return e=>{for(let o=0;o<t.itemSize;o++)e(r[n+o],o)};case"length":return t.itemSize;case"toJSON":return e=>{let t="[";return s.forEach((e=>{t+=e+", "})),t.substring(0,t.length-2)+"]"};case"x":return r[n+0];case"y":return r[n+1];case"z":return r[n+2];case"w":if(t.itemSize<4)return;return r[n+3];case"angles":return e.object.geometry.times[l.timeId][i];case"edges":return e.object.geometry.times[0][i].edges;case"vector":const o=l.vector;if(o)return console.error("Under constraction"),o;{const e=s;switch(e.length){case 3:return new a.Vector3(e[0],e[1],e[2]);case 4:return new a.Vector4(e[0],e[1],e[2],e[3])}console.error(mo+": get vertice.vector failed. Invalid vertice.length = "+e.length)}return l[c]}if(o.getPositionItem){const e=o.getPositionItem(s,c);if(null!=e)return e}return l[c]},set:(e,t,o)=>{const i=parseInt(t);return isNaN(i)?(e[t]=o,!0):(r[n+i]=o,!0)}});return s}switch(n){case"length":return t.count;case"itemSize":return t.itemSize}return console.error(mo+": get settings.bufferGeometry.userData.position. Invalid name: "+n),t[n]}}),o.setW&&o.setW();const u=e.object.geometry.opacity?4:3,d=new Float32Array((null!=r?r:n)*u);if(4===u){let t=u-1;const o=e.object.geometry.opacity;for(;t<d.length;)d[t]=o,t+=u}e.bufferGeometry.setAttribute("color",new a.Float32BufferAttribute(d,u))};this.setPositionAttributeFromPoints=(t,o)=>{const n=e.bufferAttributes,i=e.bufferGeometry;if(n)return Object.keys(n).forEach((e=>{i.attributes[e]&&console.error(mo+".setPositionAttributeFromPoints: Duplicated attribute: "+e),i.setAttribute(e,n[e])})),e.overriddenProperties.setTracesIndices(i),void l();if(o&&delete i.attributes.position,!i.attributes.position){c(this.pointLength?this.pointLength():void 0===t[0].w?3:4,t.length);const e=this.classSettings&&null!=this.classSettings.debug&&0!=this.classSettings.debug.log;for(let o=0;o<s();o++){e&&console.log("timeId = "+o);for(let n=0;n<t.length;n++){const t=this.setPositionAttributeFromPoint(n,void 0,o);e&&console.log("\tvertice["+n+"] = "+JSON.stringify(t))}e&&console.log("")}}return i},this.verticeColor=(t,n,i)=>{const r=e.object.geometry.colors;if(r){const e=3*t;if(null!=r[e])return[r[e],r[e+1],r[e+2]]}const s=e.object.color;if("function"==typeof s)return s(i);if(null!=s&&"object"!=typeof s)return new a.Color(o.color());const l=()=>new a.Color(o.color());let c;if(n)c=n.w;else if(o.getPoint)c=o.getPoint(t).w;else{const e=o.bufferGeometry.attributes.position;if(4!=e.itemSize)return l();c=(new a.Vector4).fromBufferAttribute(e,t).w}return void 0===c?l():c},this.getPositionData=(t,n)=>{o.guiPoints&&o.guiPoints.verticeId&&(t=o.guiPoints.verticeId,n=o.guiPoints.timeId),void 0===n&&(n=0),void 0===(t=parseInt(t))&&console.error(mo+".getPositionData. Invalid i = "+t);const i=e.bufferGeometry.userData,r=void 0===i.positionBlockLength?0:i.positionBlockLength,a=e.bufferGeometry.attributes.position.itemSize,s=r*n+t;return{verticeId:s,itemSize:a,positionBlockLength:r,positionId:s*a}},this.setPositionAttributeFromPoint=(t,n,i)=>{n=n||o.getPoint(t,i);const r=e.bufferGeometry.attributes,s=this.getPositionData(t,i),l=s.positionBlockLength;let c=s.itemSize,u=s.positionId,d=r.position.array;d[u]=null!=n.x?n.x:null!=n[0]?n[0]:0,c>1&&(d[++u]=null!=n.y?n.y:null!=n[1]?n[1]:0),c>2&&(d[++u]=null!=n.z?n.z:null!=n[2]?n[2]:0);const p=n.w;c>3&&(d[++u]=p);const f=e.bufferGeometry.drawRange;(f.count===1/0||(f.start+f.count)*(null===e.bufferGeometry.index?c:1)<u)&&(this.setVerticesRange(f.start,(u-f.start+1)/c),Number.isInteger(f.count)||f.count==1/0||console.error(mo+".setPositionAttributeFromPoint failed. Invalid drawRange.count = "+f.count)),c=r.color.itemSize;let m=t*c+(void 0===i?0:l*i*c);d=r.color.array;const h=this.verticeColor(t,n,i);if("number"==typeof h){if(e.options){const o=e.options.scales.w;fo.setColorAttribute(r,t+(void 0===i?0:l*i),e.options.palette.toColor(h,o.min,o.max))}m+=r.color.itemSize-1}else Array.isArray(h)?h.forEach((e=>d[m++]=e)):h instanceof a.Color?(d[m++]=h.r,d[m++]=h.g,d[m++]=h.b):console.error(mo+".setPositionAttributeFromPoint: Invalid verticeColor = "+h);return r.color.itemSize>3&&this.verticeOpacity(t),n},this.verticeOpacity=(t,o,n)=>{const i=e.bufferGeometry.attributes.color;if(4!=i.itemSize)return void console.error(mo+".verticeOpacity: Invalid color.itemSize = "+i.itemSize);const r=i.array,a=e.object.geometry.opacity?e.object.geometry.opacity[t]:void 0;r[i.itemSize*t+3]=o?n:void 0===a?1:a,i.needsUpdate=!0},this.verticesOpacity=(t,n)=>{const i=e.bufferGeometry.attributes.color;if(i&&i.itemSize>3)for(let e=0;e<i.count;e++)this.verticeOpacity(e,t,n);else{const e=o.object3D;e?(e.material.transparent=t,e.material.opacity=t?n:1,e.material.needsUpdate=!0):console.error(mo+".verticesOpacity: Invalid object3D")}},this.color=()=>{const t=null!=e.object.color?e.object.color:null!=e.pointsOptions?e.pointsOptions.color:void 0;return null!=t?"function"==typeof t?t():t:this.defaultColor},this.positionOffsetId=t=>e.overriddenProperties.positionOffsetId(t)}get defaultColor(){return"white"}get isOpacity(){return!!(this.bufferGeometry.attributes.color&&this.bufferGeometry.attributes.color.itemSize>3)&&(this.object3D.material.transparent||console.error(mo+".isOpacity: invalid this.object3D.material.transparent = "+this.object3D.material.transparent),!0)}positionOffset(e,t){return this.classSettings.settings,this.positionOffsetId(t)*e.itemSize}}
/**
   * @module getShaderMaterialPoints
   * @description get THREE.Points with THREE.ShaderMaterial material
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */const go=function(){const e=function(){if(document.currentScript&&""!==document.currentScript.src)return document.currentScript.src;const e=document.getElementsByTagName("script");return""!==e[e.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]}();return e.substring(0,e.lastIndexOf("/"))}(),yo={array:[],setItem:function(e,t){this.array.push({path:e,text:t})},getItem:function(e){for(var t=0;t<this.array.length;t++)if(this.array[t].path===e)return this.array[t].text}},vo={array:[],setItem:function(e,t){this.array.push({path:e,text:t})},getItem:function(e){for(var t=0;t<this.array.length;t++)if(this.array[t].path===e)return this.array[t].text}};class bo extends ho{constructor(e,t,o,n={}){super(n,t);const i=he.THREE,r=void 0===n.pointsOptions?void 0===n.tMin?0:n.tMin:void 0===n.pointsOptions.tMin?0:n.pointsOptions.tMin;var a;if(n.options=n.options||new ao,n.pointsOptions=n.pointsOptions||{},fo.assign(),t instanceof i.BufferGeometry){a=t,t=[];for(var s=0;s<a.attributes.position.count;s++)t.push((new i.Vector3).fromBufferAttribute(a.attributes.position,s))}else if("function"==typeof t)a=t();else if(n.pointsOptions.bufferGeometry)a=n.pointsOptions.bufferGeometry;else{const o=null!=t?fo.getPoints(t,{options:n.options,group:e,t:r}):void 0;this.getPoint=e=>o[e],a=this.setPositionAttributeFromPoints(o)}const l=n.pointsOptions.frustumPoints?n.pointsOptions.frustumPoints.pushArrayCloud(a):void 0,c=(new i.TextureLoader).load(go+"/textures/point.png",(function(e){}),(function(){}),(function(){console.error("THREE.TextureLoader: error")}));c.wrapS=i.RepeatWrapping,c.wrapT=i.RepeatWrapping;const u={pointTexture:{value:c},pointSize:{value:void 0!==n.pointsOptions&&void 0!==n.pointsOptions.shaderMaterial&&void 0!==n.pointsOptions.shaderMaterial.point?n.pointsOptions.shaderMaterial.point.size:n.options.point.size}};var d;void 0!==n.pointsOptions&&void 0!==n.pointsOptions.uniforms&&(d=n.pointsOptions.uniforms(u)),function(e,t){const o={};(t=t||{}).vertex=t.vertex||go+"/getShaderMaterialPoints/vertex.c",t.fragment=t.fragment||go+"/getShaderMaterialPoints/fragment.c",function(e,t,o,n){n=n||{};var r=yo.getItem(e);function a(){const e=vo.getItem(t);if(e)o(r,e);else{const e=new i.FileLoader(i.DefaultLoadingManager);e.setResponseType("text"),e.load(t,(function(e){vo.setItem(t,e),o(r,e)}),n.onProgress,n.onError)}}if(r)a();else{const t=new i.FileLoader(i.DefaultLoadingManager);t.setResponseType("text"),t.load(e,(function(t){yo.setItem(e,t),r=t,a()}),n.onProgress,n.onError)}}(t.vertex,t.fragment,(function(t,n){o.vertex=t,o.fragment=n,e(o)}),{onError:function(e){console.error(e.srcElement.responseURL+" status = "+e.srcElement.status+" "+e.srcElement.statusText)}})}((function(e){void 0!==d&&d.editShaderText(e);const t=new i.Points(a,new i.ShaderMaterial({uniforms:u,vertexShader:e.vertex,fragmentShader:e.fragment,transparent:!0}));t.userData.shaderMaterial=void 0===n.pointsOptions?n.shaderMaterial:n.pointsOptions.shaderMaterial,void 0!==n.options.saveMeshDefault&&n.options.saveMeshDefault(t),n.pointsOptions&&n.pointsOptions.frustumPoints&&(t.userData.cloud={indexArray:l}),t.userData.shaderMaterial=void 0===n.pointsOptions?n.shaderMaterial:n.pointsOptions.shaderMaterial,o(t),t.userData.boFrustumPoints&&n.pointsOptions.group.children.forEach((function(e){n.options.frustumPoints.updateCloudPoint(e)})),void 0!==t.material.uniforms.palette&&(t.material.uniforms.palette.value.needsUpdate=!0),void 0!==t.material.uniforms.cloudPoints&&(t.material.uniforms.cloudPoints.value.needsUpdate=!0);const r=n.options.playerOptions.cameraTarget.get(n.options);r&&r.setCameraPosition&&r.setCameraPosition()}),void 0===n.pointsOptions?void 0:n.pointsOptions.path)}}
/**
   * @module MyPoints
   * @description Array of my points.
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
  */class _o extends ho{constructor(e,t,o){super(o,e);const n=this,i=he.THREE;t=t||he.scene,void 0!==e||o.bufferGeometry.attributes.position||console.error("MyPoints: Vertices was not defined"),null!=e&&"function"!=typeof e&&0===e.length&&e.push(new i.Vector3),o.pointsOptions=o.pointsOptions||{};const r=o.pointsOptions;o.options=o.options||new ao;var a=o.options;if(a.boOptions||(a=new ao(a)),r.tMin=r.tMin||0,r.name=r.name||"",r.position=r.position||new i.Vector3(0,0,0),r.scale=r.scale||new i.Vector3(1,1,1),r.rotation=r.rotation||new i.Vector3,r.group=t,""!==r.name&&r.elements){null===r.elements.pointsName&&console.warn("MyPoints: Points name element is not exists"),r.elements.pointsName||(r.elements.pointsName="pointsName");const e="string"==typeof r.elements.pointsName?document.getElementById(r.elements.pointsName):r.elements.pointsName;e?e.innerHTML=r.name:console.warn('MyPoints: Element with id: "'+r.elements.pointsName+'" is not exists')}if(fo.assign(),!1!==r.shaderMaterial)new bo(t,e,(function(e){s(e)}),{options:a,pointsOptions:r,object:{geometry:{position:o.object.geometry.position,opacity:o.object.geometry.opacity}},bufferGeometry:o.bufferGeometry});else{let n;if("function"==typeof e)n=e();else{const o=fo.getPoints(e,{options:a,group:t,t:r.tMin});this.getPoint=e=>o[e],n=this.setPositionAttributeFromPoints(o)}const l=new i.Points(n,new i.PointsMaterial({size:a.point.size/a.point.sizePointsMaterial,vertexColors:!0,transparent:!!o.pointsOptions.opacity||void 0}));r.frustumPoints&&(l.userData.cloud={indexArray:r.frustumPoints.pushArrayCloud(l.geometry)}),s(l)}function s(s){var l;if(n.object3D=s,s.name=r.name,void 0!==r.pointIndexes&&(s.userData.pointIndexes=function(e){return r.pointIndexes(e)}),void 0!==r.pointName&&(s.userData.pointName=function(e){return r.pointName(e)}),void 0!==r.controllers&&(s.userData.addControllers=r.addControllers,s.userData.controllers=function(){return r.controllers()}),o.pointsOptions.raycaster&&(s.userData.raycaster=o.pointsOptions.raycaster),e instanceof i.BufferGeometry){l=[];for(var c=0;c<e.attributes.position.count;c++)l.push((new i.Vector3).fromBufferAttribute(e.attributes.position,c))}else l=e;function u(e){function t(t){s.position[t]="function"==typeof r.position[t]?r.position[t](e,a.a,a.b):r.position[t]}e=e||r.tMin,t("x"),t("y"),t("z")}function d(e){function t(t){s.scale[t]="function"==typeof r.scale[t]?r.scale[t](e,a.a,a.b):r.scale[t]}e=e||r.tMin,t("x"),t("y"),t("z")}function p(e){function t(t){for(s.rotation[t]="function"==typeof r.rotation[t]?r.rotation[t](e,a.a,a.b):r.rotation[t];s.rotation[t]<0;)s.rotation[t]+=2*Math.PI;for(;s.rotation[t]>2*Math.PI;)s.rotation[t]-=2*Math.PI}e=e||r.tMin,t("x"),t("y"),t("z")}s.userData.player={arrayFuncs:l,selectPlayScene:function(e){u(e),d(e),p(e)}},u(),d(),p(),t.add(s),s.userData.myObject=n,s.userData.opacity=e=>{n.verticesOpacity(!1,e)},r.boFrustumPoints&&(s.userData.boFrustumPoints=r.boFrustumPoints),a.guiSelectPoint&&a.guiSelectPoint.addMesh(s),a.eventListeners&&a.eventListeners.addParticle(s),void 0!==r.onReady&&r.onReady(s),!s.userData.boFrustumPoints&&a.raycaster&&a.raycaster.addParticle&&a.raycaster.addParticle(s)}}}
/**
   * @module DropdownMenu
   * @description Creates a drop down menu in your javaScript code.
   * 
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */var xo={tag:"style"};var wo=function(){const e=function(){if(document.currentScript&&""!==document.currentScript.src)return document.currentScript.src;const e=document.getElementsByTagName("script");return""!==e[e.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]}();return e.substring(0,e.lastIndexOf("/"))}(),So=wo.split(/(.*)(\/build)/);"/build"===So[2]&&(wo=So[1]),"/canvasMenu"===(So=wo.split(/(.*)(\/canvasMenu)/))[2]&&(wo=So[1]+"/DropdownMenu"),Ft.sync(wo+"/styles/menu.css",xo),Ft.sync(wo+"/styles/gui.css",xo),Ft.sync(wo+"/styles/Decorations/transparent.css",xo),Ft.sync(wo+"/styles/Decorations/gradient.css",xo);
/**
   * @module DropdownMenu
   * @description Creates a drop down menu in your javaScript code.
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */
var To={create:function(e,t){switch((t=t||{}).elParent=t.elParent||document.querySelector("body"),t.decorations){case"Gradient":case"Transparent":case"Custom":case void 0:break;default:console.error("DropdownMenu.create: Invalid options.decorations: "+t.decorations)}var o,n=document.createElement("menu");function i(){n.style.opacity=1,clearTimeout(o),o=setTimeout((function(){n.style.opacity=0}),5e3)}return t.elParent.classList.contains("container")&&(n.className="controls"),t.canvas&&(n.style.opacity=0,t.canvas.onmouseout=function(e){n.style.opacity=0},t.canvas.onmousemove=function(e){i()},n.onmousemove=function(e){i()}),t.elParent.appendChild(n),e.forEach((function(e){var o="dropdown-child";function i(e){setTimeout((function(){var t=s.style.display;s.style.display="block",e.up?s.style.top="-"+s.offsetHeight+"px":s.style.top=a.offsetHeight-1+"px",e.left&&(s.style.left=a.offsetWidth-s.offsetWidth+"px"),s.style.display=t}),0)}var r,a=document.createElement("span");switch(a.className="menuButton"+(void 0===t.decorations?"":" menuButton"+t.decorations),void 0!==e.style&&(a.style.cssText=e.style),void 0!==e.radio&&(a.style.cssText=e.style),void 0!==e.onclick&&(a.onclick=e.onclick),void 0!==e.id&&(a.id=e.id),"string"==typeof e?r=e:(r=e.name,e.id&&(a.id=e.id),e.title&&(a.title=e.title)),typeof r){case"object":a.appendChild(r);break;case"string":case"undefined":a.innerHTML=r;break;default:console.error("Invalid typeof name: "+typeof r)}if(e.items){var s=document.createElement("span");if(s.className=o+" "+o+(void 0===t.decorations?"Default":t.decorations),s.title="",a.appendChild(s),e.items.forEach((function(t){var o=document.createElement("nobr"),n="checked";function i(e){return"string"==typeof e?e:!0===e.radio?(e.checked?"◉":"◎")+" "+e.name:!0===e.checkbox?(e.checked?"☑":"☐")+" "+e.name:e.name}"string"==typeof t||(t.name,o.onclick=function(o){!0===t.radio?e.items.forEach((function(e){!0===e.radio&&(function(e){return e||(e=window.event),e.target||e.srcElement}(o)===e.elName?(e.checked=!0,e.elName.classList.add(n)):(e.checked=!1,e.elName.classList.remove(n)),e.elName.innerHTML=i(e))})):!0===t.checkbox&&(!0===t.checked?t.elName.classList.add(n):t.elName.classList.remove(n),t.checked=!t.checked,t.elName.innerHTML=i(t)),t.onclick&&t.onclick(o)}),!0===t.radio&&o.classList.add("radio"),!0===t.checkbox&&o.classList.add("checkbox"),t.id&&(o.id=t.id),t.title&&(o.title=t.title),o.innerHTML=i(t),!0===t.checked&&o.classList.add(n),s.appendChild(o),"string"!=typeof t&&(t.elName=o)})),"object"==typeof e.drop)i(e.drop);else switch(e.drop){case"up":i({up:!0});break;case"left":i({left:!0});break;case void 0:setTimeout((function(){s.style.left="-"+a.clientWidth+"px",s.style.top=a.offsetHeight-1+"px"}),0);break;default:console.error("Invalid menuItem.drop: "+e.drop)}}n.appendChild(a)})),n}};
/**
   * @module CanvasMenu
   * @description My [dropdown menu]{@link https://github.com/anhr/commonNodeJS/tree/master/DropdownMenu} for canvas in my [three.js]{@link https://threejs.org/} projects.
   * 
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */class Co{constructor(e,t={}){if(!he.isThree())return void console.warn("CanvasMenu: Set THREE first.");const o=he.THREE;t.options=t.options||new ao;const n=t.options;if(!n.boOptions)return void console.error("CanvasMenu: call options = new Options( options ) first");if(!1===n.canvasMenu)return;n.canvasMenu=this;const i={fullScreen:"Full Screen",nonFullScreen:"Non Full Screen"},r=n.getLanguageCode;if("ru"===r())i.prevSymbolTitle="Кадр назад",i.playTitle="Проиграть",i.nextSymbolTitle="Кадр вперед",i.pauseTitle="Пауза",i.repeatOn="Повторять проигрывание",i.repeatOff="Остановить повтор проигрывания",i.controllerTitle="Текущее время.",i.stereoEffects="Стерео эффекты",i.mono="Моно",i.sideBySide="Слева направо",i.topAndBottom="Сверху вниз";if(o&&e instanceof o.WebGLRenderer!=!0)return void console.error("CanvasMenu: renderer is not THREE.WebGLRenderer");const a=e.domElement,s=a.parentElement;if("DIV"!==s.tagName)return void console.error("CanvasMenu: elContainer.tagName = "+s.tagName);const l="container";var c;if(s.classList.contains(l)||s.classList.add(l),t.menu=t.menu||[],this.menu=t.menu,t.options.stereoEffect&&t.options.stereoEffect.createCanvasMenuItem&&t.options.stereoEffect.createCanvasMenuItem(this,{getLanguageCode:n.getLanguageCode}),n.player&&n.player.createCanvasMenuItem(this,r),Zt.RendererSetSize(e,this),void 0!==t.fullScreen){if(!t.fullScreen.camera)return void console.error("CanvasMenu: settings.fullScreen.camera = "+t.fullScreen.camera);c=new Zt(o,e,t.fullScreen.camera,{canvasMenu:this,fullScreen:t.fullScreen}),!1!==n.canvas.fullScreen&&c.setFullScreen(!1,!0),this.getFullScreenSettings=function(e){return c.setStereoEffect(e),c},this.isFullScreen=function(){return c.isFullScreen()},this.setFullScreen=function(e){return c.setFullScreen(e)},n.canvas.noButtonFullScreen||t.menu.push({style:"float: right;",id:"menuButtonFullScreen",onclick:function(e){c.onclick()}})}n.player&&n.player.addSlider();const u=To.create(t.menu,{elParent:"string"==typeof s?document.getElementById(s):s,canvas:"string"==typeof a?document.getElementById(a):a,decorations:"Transparent"});this.querySelector=function(e){return u.querySelector(e)},u.addEventListener("mouseenter",(function(e){t.options.dat&&(t.options.dat.mouseenter=!0),t.onOver&&t.onOver(!0)})),u.addEventListener("mouseleave",(function(e){t.options.dat&&(t.options.dat.mouseenter=!1),t.onOver&&t.onOver(!1)})),n.player&&n.player.addSliderEvents(),t.fullScreen&&(this.setFullScreenButton=function(e){void 0===e&&(e=!1!==n.canvas.fullScreen);const t=s.querySelector("#menuButtonFullScreen");return null===t||(e?(t.innerHTML="⤦",t.title=i.nonFullScreen):(t.innerHTML="⤢",t.title=i.fullScreen)),!0},this.setFullScreenButton(),t.options.stereoEffect&&t.options.stereoEffect.settings&&t.options.stereoEffect.settings.spatialMultiplex!==Qt.spatialMultiplexsIndexs.Mono&&this.setFullScreen(!1)),this.setSize=function(e){if(void 0!==u){for(var t,o=0,n=0;n<u.childNodes.length;n++){var i=u.childNodes[n],r=window.getComputedStyle(i),a=parseInt(r["margin-left"])+parseInt(r["margin-right"])+parseInt(r["padding-left"])+parseInt(r["padding-right"]),s=i.querySelector(".slider");null===s?o+=i.offsetWidth+a:(t=s,o+=a)}if(t){var l=e-o;l>0&&(t.parentElement.style.width=l+"px")}}};const d={set:function(e,t){this.x=e,this.y=t}};e.getSize(d),this.setSize(d.x,d.y),0===this.menu.length&&console.warn("CanvasMenu: menu is empty.")}}
/**
   * Remove all child objects of the object and call dispose on their geometry, material and texture.
   * 
   * Thanks to https://stackoverflow.com/a/48768960/5175935
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   * @author [欧阳维杰]{@link https://stackoverflow.com/users/6045817/%e6%ac%a7%e9%98%b3%e7%bb%b4%e6%9d%b0}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */function Eo(e){for(;e.children.length>0;)Eo(e.children[0]),e.remove(e.children[0]);e.geometry&&(void 0!==e.geometry.attributes&&Object.keys(e.geometry.attributes).forEach((t=>{e.geometry.deleteAttribute(t)})),e.geometry.dispose()),e.material&&(Object.keys(e.material).forEach((t=>{e.material[t]&&"function"==typeof e.material[t].dispose&&e.material[t].dispose()})),void 0!==e.material.uniforms&&e.material.uniforms.pointTexture.value.dispose(),e.material.dispose())}
/**
   * @module AxesHelper
   * @description An axis object to visualize the 1, 2 or 3 axes.
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
  */class Ao{constructor(e,t){const o=he.THREE,n=this;if(!(t=t||new ao).boOptions)return void console.error("AxesHelper: call options = new Options( options ) first");if(!1===t.axesHelper)return;function i(e){const o=t.scales[e];o&&(void 0===o.offset&&(o.offset=.1),void 0===o.zoomMultiplier&&(o.zoomMultiplier=1.1))}t.camera.fov=t.camera.fov||50,t.scales=t.scales||{},t.scales.color=t.scales.color||"rgba(255, 255, 255, 0.5)",t.scales.text.textHeight=t.scales.text.textHeight||.04,t.scales.text.precision=t.scales.text.precision||4,t.scales.text.rect=t.scales.text.rect||{},t.scales.text.rect.displayRect=void 0===t.scales.text.rect.displayRect||t.scales.text.rect.displayRect,t.scales.text.rect.borderRadius=void 0!==t.scales.text.rect.borderRadius?t.scales.text.rect.borderRadius:15,i("x"),i("y"),i("z"),this.options=t;const r=new o.Group;function a(n){var i,r,s,l,c,u=n;function d(o){return(t.scales.posAxesIntersection[o]-e.position[o])/e.scale[o]}function p(){return.05/Math.max(Math.max(e.scale.x,e.scale.y),e.scale.z)}this.remove=function(){void 0!==l&&(Eo(l),u.remove(l),l=void 0,i=void 0,r=void 0,s=void 0)},this.dottedLines=function(e){const n=(c=e)instanceof o.Vector4||c instanceof o.Vector3?c:Ot(c.object,c.index);if(void 0!==l){function m(e){var t;switch(e){case"x":t=i;break;case"y":t=r;break;case"z":t=s;break;default:return void console.error("AxesHelper.dotLines.dottedLines.dottedLine: axesId = "+axesId)}if(t){var o=t.geometry.attributes.position.array;o[0]="x"===e?n.x:d("x"),o[1]="y"===e?n.y:d("y"),o[2]="z"===e?n.z:d("z"),o[3]=n.x,o[4]=n.y,o[5]=n.z;var a=p();t.material.dashSize=a,t.material.gapSize=a,t.geometry.attributes.position.needsUpdate=!0}}return m("x"),m("y"),void m("z")}function f(e){if(t.scales[e].isAxis()){var i=[(new o.Vector3).copy(t.scales.posAxesIntersection),n];i[0].x="x"===e?i[1].x:d("x"),i[0].y="y"===e?i[1].y:d("y"),i[0].z="z"===e?i[1].z:d("z");var r=p();void 0===t.colorsHelper&&(t.colorsHelper=128);var a=new o.LineSegments((new o.BufferGeometry).setFromPoints(i),new o.LineDashedMaterial({color:"rgb("+t.colorsHelper+", "+t.colorsHelper+", "+t.colorsHelper+")",dashSize:r,gapSize:r}));return a.computeLineDistances(),l.add(a),a}}a.remove(),l=new o.Group,u.add(l),i=f("x"),r=f("y"),s=f("z")},this.update=function(){void 0!==l&&void 0!==c&&this.dottedLines(c)},this.movePointAxes=function(e,t){var o;switch(e){case mathBox.axesEnum.x:o=i;break;case mathBox.axesEnum.y:o=r;break;case mathBox.axesEnum.z:o=s;break;default:return void console.error("point.userData.movePointAxes: invalid axesId: "+e)}void 0!==o&&(o.geometry.attributes.position.array[e+3]=t,i.geometry.attributes.position.array[e]=t,r.geometry.attributes.position.array[e]=t,s.geometry.attributes.position.array[e]=t,i.geometry.attributes.position.needsUpdate=!0,r.geometry.attributes.position.needsUpdate=!0,s.geometry.attributes.position.needsUpdate=!0)}}var s;r.userData.optionsSpriteText={fontColor:t.scales.color,textHeight:t.scales.text.textHeight,fov:t.camera.fov,rect:t.scales.text.rect},e.add(r),t.scales.posAxesIntersection=t.scales.posAxesIntersection||new o.Vector3,this.createAxis=function(e){const n=new o.Group;n.visible=t.scales.display;const i=t.scales[e];if(!i.isAxis())return;var a=t.scales.color,s=1;try{var l=t.scales.color.split(/rgba\(\.*/)[1].split(/\)/)[0].split(/, */);a="rgb("+l[0]+", "+l[1]+", "+l[2]+")",void 0!==l[3]&&(s=l[3])}catch(e){}const c=new o.Line((new o.BufferGeometry).setFromPoints([new o.Vector3("x"!==e?0:t.scales.x?t.scales.x.min:0,"y"!==e?0:t.scales.y?t.scales.y.min:0,"z"!==e?0:t.scales.z?t.scales.z.min:0),new o.Vector3("x"!==e?0:t.scales.x?t.scales.x.max:0,"y"!==e?0:t.scales.y?t.scales.y.max:0,"z"!==e?0:t.scales.z?t.scales.z.max:0)]),new o.LineBasicMaterial({color:a,opacity:s,transparent:!0}));if("x"!==e&&(c.position.x=t.scales.posAxesIntersection.x),"y"!==e&&(c.position.y=t.scales.posAxesIntersection.y),"z"!==e&&(c.position.z=t.scales.posAxesIntersection.z),c.add(n),c.userData.axisName=e,r.add(c),void 0!==i.marks){const r=function(i){i=i||new o.Vector3(0,0,0);const r=!1,a=new o.Sprite(new o.SpriteMaterial({map:new o.Texture,sizeAttenuation:r})),s=document.createElement("canvas");a.material.map.minFilter=o.LinearFilter;const l=s.getContext("2d");return function(){const c=new o.Vector2("y"!==e?.5:0,"y"===e?.5:1);function u(){return void 0!==t.scales.text.precision?d.toPrecision(t.scales.text.precision):d.toString()}l.fillStyle=t.scales.color,l.fillRect(0,0,s.width,s.height),a.material.map.image=s,a.material.map.needsUpdate=!0,"y"===e?(a.scale.x=s.width/s.height*3/s.width,a.scale.y=1/s.height):(a.scale.x=1/s.width,a.scale.y=3/s.height),a.scale.x*=t.camera.fov/100,a.scale.y*=t.camera.fov/100,a.position.copy(i),a.center=c,a.material.sizeAttenuation=r,a.material.needsUpdate=!0;var d="x"===e?i.x:"y"===e?i.y:i.z;function p(){const e=(.013-.05)/15,t=.013-17*e;return-3*(u().length*e+t)}const f=new Jt(u(),new o.Vector3(i.x,i.y,i.z),{group:n,rotation:"y"===e?0:-Math.PI/2,center:new o.Vector2(p(),"x"===e?1:0)});f.userData.updatePrecision=function(){f.userData.updateText(d.toPrecision(t.scales.text.precision)),f.center.x=p()},n.add(f)}(),a},a=i.max,s=i.min,l=(a-s)/(i.marks-1);for(var u=0;u<i.marks;u++){const t=u*l+s;n.add(new r(new o.Vector3("x"===e?t:0,"y"===e?t:0,"z"===e?t:0)))}}var d={center:new o.Vector2("y"===e?1.1:-.1,"y"===e?0:-.1),group:n};n.add(new Jt(i.name,new o.Vector3("x"===e?i.max:0,"y"===e?i.max:0,"z"===e?i.max:0),d)),n.add(new Jt(i.name,new o.Vector3("x"===e?i.min:0,"y"===e?i.min:0,"z"===e?i.min:0),d))},this.createAxis("x"),this.createAxis("y"),this.createAxis("z"),0===r.children.length&&console.warn("AxesHelper: Define at least one axis."),a=new a(e),this.exposePosition=function(e){if(s=e,void 0===e)return s=void 0,void a.remove();a.dottedLines(e)},this.movePosition=function(){s&&this.exposePosition(s)},this.getGroup=function(){return r},this.updateAxes=function(){function e(e){r.children.forEach((function(t){t.userData.axisName===e&&(r.remove(t),n.createAxis(e))}))}e("x"),e("y"),e("z"),a.update()},t.axesHelper=this}}
/**
   * @module SpriteTextGui
   * @description Adds SpriteText settings folder into {@link https://github.com/anhr/dat.gui|dat.gui}.
   * @see {@link https://github.com/anhr/SpriteText|SpriteText}
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
  */var Po=0;function Oo(e,t,o={}){t=new ao(t);const n=o.folder||t.dat.gui;if(!n||!1===t.dat.spriteTextGui)return;const i=o.optionsSpriteText||e.userData.optionsSpriteText||{},r=he.THREE,a=he.dat;if(0===Object.keys(i).length&&console.warn("SpriteTextGui: optionsSpriteText is empty."),r.Color.NAMES[i.fontColor]){const e=new r.Color(i.fontColor);i.fontColor="rgba("+255*e.r+","+255*e.g+","+255*e.b+",1)"}const s=JSON.parse(JSON.stringify(i));Object.freeze(s);const l={spriteText:"Sprite Text",spriteTextTitle:"Settings for text that always faces towards the camera.",text:"Text",textTitle:"The text to be displayed on the sprite.",textHeight:"Height",textHeightTitle:"Text Height.",fontFace:"Font Face",fontFaces:"Font Faces",fontFaceTitle:"Choose text font.",bold:"Bold",italic:"Italic",rotation:"Rotation",rotationTitle:"Sprite rotation",fontProperties:"Font Properties",fontPropertiesTitle:"Other font properties. The font property uses the same syntax as the CSS font property.",fontStyle:"Font Style",fontStyleTitle:"Text style being used when drawing text. Read only.",displayRect:"Border",displayRectTitle:"Display a border around the text.",borderColor:"Border Color",backgroundColor:"Background Color",borderRadius:"Border Radius",borderThickness:"Border Thickness",fontColor:"Font Color",anchor:"Anchor",anchorTitle:"The text anchor point.",sizeAttenuation:"Size Attenuation",sizeAttenuationTitle:"Whether the size of the sprite is attenuated by the camera depth. (Perspective camera only.)",defaultButton:"Default",defaultTitle:"Restore default Sprite Text settings."};switch(t.getLanguageCode()){case"ru":l.spriteText="Текстовый спрайт",l.spriteTextTitle="Настройки для текста, который всегда обращен к камере.",l.text="Текст",l.textTitle="Текст, который будет отображен в спрайте.",l.textHeight="Высота",l.textHeightTitle="Высота текста.",l.fontFace="Имя шрифта",l.fontFaces="Имена шрифтов",l.fontFaceTitle="Выберите шрифта текста.",l.bold="Жирный",l.italic="Наклонный",l.rotation="Вращение",l.rotationTitle="Вращение текстового спрайта",l.fontProperties="Дополнительно",l.fontPropertiesTitle="Дополнительные свойства шрифта. Свойство шрифта использует тот же синтаксис, что и свойство шрифта CSS.",l.fontStyle="Стиль шрифта",l.fontStyleTitle="Стиль шрифта, используемый при рисовании текста. Не редактируется.",l.displayRect="Рамка",l.displayRectTitle="Отобразить рамку вокруг текста.",l.borderColor="Цвет рамки",l.backgroundColor="Цвет фона",l.borderRadius="Зкругление углов",l.borderThickness="Толщина рамки",l.fontColor="Цвет шрифта",l.anchor="Якорь",l.anchorTitle="Точка привязки текста.",l.sizeAttenuation="Размер",l.sizeAttenuationTitle="Будет ли размер спрайта зависеть от расстояния до камеры. (Только перспективная камера.)",l.defaultButton="Восстановить",l.defaultTitle="Восстановить настройки текстового спрайта по умолчанию.";break;default:if(void 0===o.lang||o.lang.languageCode!=_languageCode)break;Object.keys(o.lang).forEach((function(e){void 0!==l[e]&&(l[e]=o.lang[e])}))}o.spriteFolder=o.spriteFolder||l.spriteText,Po++;const c=t.dat.getCookieName("SpriteText"+Po),u=t.dat.cookie,d=i.group;u.getObject(c,i,i),i.group=d,e instanceof r.Sprite!=!0&&(void 0===e.userData.optionsSpriteText?e.userData.optionsSpriteText=i:void 0!==o.optionsSpriteText&&console.warn("SpriteTextGui: duplicate group.userData.optionsSpriteText"));var p=!0;function f(t){p&&(Jt.updateSpriteTextGroup(e),e.userData.update&&e.userData.update(),void 0!==v&&v.setValue(i.font),t||u.setObject(c,i))}o.hasOwnProperty("parentFolder")||(o.parentFolder=n);const m=o.parentFolder.addFolder(o.spriteFolder);a.folderNameAndTitle(m,o.spriteFolder,l.spriteTextTitle);const h="textHeight";i.hasOwnProperty(h)&&void 0!==i[h]&&function(e,t,o,n,i){i=i||{};const r=he.dat;var a=e.add(new ge((function(e,t){var o=t(s.getValue(),a.getValue());s.setValue(o),n(o)}),{getLanguageCode:i.getLanguageCode,settings:i.settings})).onChange((function(e){a.zoomMultiplier=e})),s=r.controllerZeroStep(e,t,o,(function(e){n(e)}));i.text&&r.controllerNameAndTitle(s,i.text,i.textTitle)}(m,i,h,(function(){f()}),{text:l.textHeight,textTitle:l.textHeightTitle,getLanguageCode:o.getLanguageCode,settings:o.settings}),void 0!==i.fontFace&&a.controllerNameAndTitle(m.add(i,"fontFace").onChange((function(e){f()})),l.fontFace),void 0!==i.fontFaces&&a.controllerNameAndTitle(m.add(i,"fontFace",i.fontFaces).onChange((function(e){f()})),l.fontFaces,l.fontFaceTitle),i.hasOwnProperty("bold")&&a.controllerNameAndTitle(m.add(i,"bold").onChange((function(e){f()})),l.bold),i.hasOwnProperty("italic")&&a.controllerNameAndTitle(m.add(i,"italic").onChange((function(e){f()})),l.italic);const g="rotation";if(i.hasOwnProperty(g)){var y=2*Math.PI;a.controllerNameAndTitle(m.add(i,g,0,y,(y-0)/360).onChange((function(e){f()})),l.rotation,l.rotationTitle)}if(i.hasOwnProperty("fontProperties")&&a.controllerNameAndTitle(m.add(i,"fontProperties").onChange((function(e){f()})),l.fontProperties,l.fontPropertiesTitle),i.hasOwnProperty("font")){var v=m.add(i,"font");v.__input.readOnly=!0,a.controllerNameAndTitle(v,l.fontStyle,l.fontStyleTitle)}if(i.hasOwnProperty("rect")){void 0===i.rect.displayRect&&(i.rect.displayRect=!1),a.controllerNameAndTitle(m.add(i.rect,"displayRect").onChange((function(t){f(),e.domElement.style.display=i.rect.displayRect?"block":"none"})),l.displayRect,l.displayRectTitle);const e=m.addFolder(l.displayRect);e.domElement.style.display=i.rect.displayRect?"block":"none";const t="borderThickness";i.rect.hasOwnProperty(t)&&a.controllerNameAndTitle(e.add(i.rect,t,1,30*i.rect.borderThickness,1).onChange((function(e){f()})),l.borderThickness);const o="borderColor";i.rect.hasOwnProperty(o)&&a.controllerNameAndTitle(e.addColor(i.rect,o).onChange((function(e){f()})),l.borderColor);const n="backgroundColor";i.rect.hasOwnProperty(n)&&a.controllerNameAndTitle(e.addColor(i.rect,n).onChange((function(e){f()})),l.backgroundColor);const r="borderRadius";i.rect.hasOwnProperty(r)&&a.controllerNameAndTitle(e.add(i.rect,r,0,100,1).onChange((function(e){f()})),l.borderRadius)}if(i.hasOwnProperty("fontColor")&&a.controllerNameAndTitle(m.addColor(i,"fontColor").onChange((function(e){f()})),l.fontColor),i.hasOwnProperty("center")){i.center=Jt.getCenter(i.center);const e=m.addFolder("center");a.folderNameAndTitle(e,l.anchor,l.anchorTitle),e.add(i.center,"x",0,1,.1).onChange((function(e){f()})),e.add(i.center,"y",0,1,.1).onChange((function(e){f()}))}const b="sizeAttenuation";i.hasOwnProperty(b)&&void 0!==i[b]&&a.controllerNameAndTitle(m.add(i,b).onChange((function(e){f()})),l.sizeAttenuation,l.sizeAttenuationTitle),m.userData={options:t,restore:function(e){function t(e,t,o){e.__controllers.forEach((function(e){if(e.property===t)e.setValue(o[t]);else{if("object"!=typeof o[t])return;Object.keys(o[t]).forEach((function(n){e.property===n&&e.setValue(o[t][n])}))}}))}p=!1,Object.keys(s).forEach((function(e){t(m,e,s),"object"==typeof s[e]&&Object.keys(s[e]).forEach((function(o){Object.keys(m.__folders).forEach((function(n){t(m.__folders[n],o,s[e])}))})),Object.keys(m.__folders).forEach((function(o){o===e&&Object.keys(s[o]).forEach((function(e){t(m.__folders[o],e,s[o])}))}))})),p=!0,f()}};const _={defaultF:m.userData.restore};return void 0===s&&console.error("SpriteTextGui: optionsDefault = "+s),a.controllerNameAndTitle(m.add(_,"defaultF"),l.defaultButton,l.defaultTitle),f(!0),m}
/**
   * @module AxesHelperGui
   * @description Adds <a href="../../AxesHelper/jsdoc/module-AxesHelper-AxesHelper.html" target="_blank">AxesHelper</a> settings folder into {@link https://github.com/anhr/dat.gui|dat.gui}.
   * @see {@link https://github.com/anhr/AxesHelper|AxesHelper}
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
  */
/**
   * @module OrbitControlsGui
   * @description [OrbitControls]{@link https://threejs.org/docs/index.html#examples/en/controls/OrbitControls} graphical user interface
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */
class ko{constructor(e,t){if(!e.boOptions)return void console.error("OrbitControlsGui: call options = new Options( options ) first");if(!(t=t||e.dat.gui)||!e.orbitControls||!1===e.dat.orbitControlsGui)return;const o=he.dat,n=e.orbitControls;e.orbitControlsGui=this,n.addEventListener("change",(function(){d&&d.setValue(n.target.x),p&&p.setValue(n.target.y),f&&f.setValue(n.target.z)}));const i={orbitControls:"Orbit Controls",defaultButton:"Default",defaultTitle:"Restore default Orbit controls settings.",target:"Target"},r=void 0===e.getLanguageCode?"en":e.getLanguageCode();switch(r){case"ru":i.defaultButton="Восстановить",i.defaultTitle="Восстановить настройки Orbit controls по умолчанию.";break;default:if(void 0===e.lang||e.lang.languageCode!=r)break;Object.keys(e.lang).forEach((function(t){void 0!==i[t]&&(i[t]=e.lang[t])}))}const a=t.addFolder(i.orbitControls),s=e.scales.x?a.addFolder(e.scales.x.name):void 0,l=e.scales.y?a.addFolder(e.scales.y.name):void 0,c=e.scales.z?a.addFolder(e.scales.z.name):void 0;function u(e,t){if(!e)return;function r(e){void 0===e&&(e=0),n.target[t]=e,n.update(),a.setValue(e)}e.add(new ye((function(e){r(n.target[t]+e)})));const a=o.controllerZeroStep(e,n.target,t,(function(e){r(e)}));return o.controllerNameAndTitle(a,i.target),o.controllerNameAndTitle(e.add({defaultF:function(e){r()}},"defaultF"),i.defaultButton,i.defaultTitle),a}const d=u(s,"x"),p=u(l,"y"),f=u(c,"z");o.controllerNameAndTitle(a.add({defaultF:function(e){n.reset(),d.setValue(n.target.x),p.setValue(n.target.y),f.setValue(n.target.z)}},"defaultF"),i.defaultButton,i.defaultTitle),this.setTarget=function(e){d&&d.setValue(e.x),p&&p.setValue(e.y),f&&f.setValue(e.z)}}}
/**
   * Modify of the dat object.
   * @see {@link https://github.com/dataarts/dat.gui} about dat.gui
   *
   * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */function zo(){}if(void 0!==zo){function qo(e,t,o){void 0===t&&console.warn("elNameAndTitle: name = "+t),e.innerHTML=t,void 0!==o&&(e.title=o)}zo.GUI=pe,void 0===zo.controllerNameAndTitle?zo.controllerNameAndTitle=function(e,t,o){qo(e.__li.querySelector(".property-name"),t,o)}:console.error("Duplicate dat.controllerNameAndTitle method."),void 0===zo.folderNameAndTitle?zo.folderNameAndTitle=function(e,t,o){qo(e.__ul.querySelector("li.title"),t,o)}:console.error("Duplicate dat.folderNameAndTitle method."),void 0===zo.controllerZeroStep?zo.controllerZeroStep=function(e,t,o,n){"number"!=typeof t[o]&&console.warn("typeof object[property] = "+typeof t[o]);var i=e.add(t,o),r=i.__input;return i.__input=document.createElement("input"),r.value=t[o],r.onchange=function(e){t[o]=parseFloat(r.value),void 0!==n&&n(t[o])},i.setValue=function(e,i){r.value=t[o]=e,i&&n&&n(t[o])},i}:console.error("Duplicate dat.controllerZeroStep method."),void 0===zo.controllerSetValue?zo.controllerSetValue=function(e,t){e.setValue(t),e.__li.querySelector("select").selectedIndex=t}:console.error("Duplicate dat.controllerSetValue method.")}
/**
   * @module functionsFolder
   * @description Adds the [Functions]{@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function} folder into [dat.gui]{@link https://github.com/anhr/dat.gui}.
   * 
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */class Do{constructor(e,t,o,n){if(!o.boOptions)return void console.error("functionsFolder: call options = new Options( options ) first");const i=he.dat,r=he.THREE,a=o.scales,s=this;var l=!1,c=!1;const u={functions:"Functions",defaultButton:"Default",defaultTitle:"Restore default functions."},d=void 0===o.getLanguageCode?"en":o.getLanguageCode();switch(d){case"ru":u.functions="Функции",u.defaultButton="Восстановить",u.defaultTitle="Восстановить функции.";break;default:if(void 0===o.lang||o.lang.languageCode!=d)break;Object.keys(o.lang).forEach((function(e){void 0!==u[e]&&(u[e]=o.lang[e])}))}n?(n.x=v(n.x),n.y=v(n.y),n.z=v(n.z)):n={x:"",y:"",z:""};const p=e.addFolder(u.functions),f={x:n.x,y:n.y,z:n.z,w:n.w},m={};function h(e){void 0!==n[e]&&(m[e]=p.add(n,e).onFinishChange((function(t){b(t,e,f)})),i.controllerNameAndTitle(m[e],g(e)))}function g(e){return a[e]&&a[e].name?a[e].name:e}h("x"),h("y"),h("z"),h("w");const y=p.add({defaultF:function(e){}},"defaultF");function v(e){if(void 0===e)return;if("object"==typeof e){if(e instanceof r.Color)return e.getStyle();if(Array.isArray(e))return JSON.stringify(e);e=e.func?e.func:e}const t=typeof e;switch(t){case"number":e=e.toString();case"string":return e;case"function":return e.toString().split(/return (.*)/)[1];default:return void console.error("functionsFolder.getFuncText(...): typeof func = "+t)}}function b(e,o,n){if(n[o]!==e||l)try{var i;l=!1,n[o]=e;const s=typeof e;switch(s){case"string":var a=parseFloat(e);if(a.toString()!==e){if(5===e.replace(/\s/g,"").split(/rgb\((\d+),(\d+),(\d+)\)/).length)i=new r.Color(e);else{var u;try{u=JSON.parse(e)}catch(e){}i=Array.isArray(u)?u:new Function("t","a","b","return "+e)}}else i=a;break;case"number":i=e;break;default:return void console.error("onFinishChange( "+e+" ): invalid type = "+s)}t(i,o,e),c=!1}catch(t){c||(alert("Axis: "+g(o)+'. Function: "'+e+'". '+t),c=!0),s.setFocus(o)}}i.controllerNameAndTitle(y,u.defaultButton,u.defaultTitle),this.setFunction=function(e){if(!(e=e||o.vector))return;const t={x:e?v(e.x):"",y:e?v(e.y):"",z:e?v(e.z):"",w:e?v(e.w):""},n={x:t.x,y:t.y,z:t.z,w:t.w};function i(o){void 0!==e[o]&&(m[o].__onFinishChange=function(e){b(e,o,n)},t[o]=v(e[o]),m[o].setValue(t[o]),n[o]=t[o])}e.vectorDefault||(e.vectorDefault={x:t.x,y:t.y,z:t.z,w:t.w}),i("x"),i("y");var r=!1;e.z&&(i("z"),r=!0),y.object.defaultF=function(t){function o(t){m[t]&&(m[t].setValue(e.vectorDefault[t]),m[t].__onFinishChange(e.vectorDefault[t]))}o("x"),o("y"),o("z"),o("w")},function(e,t){if(void 0!==e){"boolean"==typeof t&&(t=t?"block":"none");for(var o=e.domElement;"LI"!==o.tagName.toUpperCase();)o=o.parentElement;o.style.display=t}}(m.z,r),i("w")},this.setFunction(),this.displayFolder=function(e){p.domElement.style.display="boolean"==typeof e?e?"block":"none":e},this.setFocus=function(e){m[e].domElement.childNodes[0].focus(),l=!0},this.update=function(e){function t(t){m[t].getValue()!==e[t]&&m[t].setValue(e[t])}t("x"),t("y"),t("z"),t("w")}}}
/**
   * @module GuiSelectPoint
   *
   * @description A dat.gui based graphical user interface for select a point from the mesh.
   * 
   * @see {@link https://github.com/anhr/dat.gui|dat.gui}, {@link https://threejs.org/docs/index.html#api/en/objects/Mesh|three.js mesh}.
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
  */const No="none",Fo="block";class Mo{constructor(e,t={}){const o=this,n=he.THREE,i={};if(!e.boOptions)return void console.error("GuiSelectPoint: call options = new Options( options ) first");if(!1===e.dat.guiSelectPoint||!e.dat.gui)return this.add=function(e){},this.addMesh=function(e){},void(this.select=function(e){});const r=he.dat;var a;e.guiSelectPoint=o;const s=e.getLanguageCode,l={meshs:"Meshes",notSelected:"Not selected",select:"Select",position:"Position",rotation:"Rotation",points:"Points",displayVerticeID:"Point ID",displayVerticeIDTitle:"Display on the scene the point ID near to the point",cameraTarget:"Look",cameraTargetTitle:"Choose this point the camera is looking at.",point:"Point Local Position",pointTitle:"The position attribute of the selected point",trace:"Trace",traceTitle:"Display the trace of the point movement.",traceAllTitle:"Display the trace of the movement of all points of the mesh.",pointWorld:"Point World Position",pointWorldTitle:"The position of the selected point after scaling, moving and rotation of the mesh",mesh:"Mesh",scale:"Scale",color:"Сolor",opacity:"Opacity",opacityTitle:"Float in the range of 0.0 - 1.0 indicating how transparent the material is. A value of 0.0 indicates fully transparent, 1.0 is fully opaque.",defaultButton:"Default",defaultScaleTitle:"Restore default 3d object scale.",defaultPositionTitle:"Restore default 3d object position.",default3DObjectTitle:"Restore default settings of all 3d objects.",defaultRotationTitle:"Restore default 3d object rotation.",defaultLocalPositionTitle:"Restore default local position.",moveGroup:"Move Scene"};if("ru"===s())l.meshs="3D объекты",l.notSelected="Не выбран",l.select="Выбрать",l.position="Позиция",l.rotation="Вращение",l.points="Точки",l.displayVerticeID="Номера точек",l.displayVerticeIDTitle="На сцене возле каждой точки показать ее идентификатор",l.cameraTarget="Следить",l.cameraTargetTitle="Выберите эту точку, за которой следит камера.",l.point="Локальная позиция точки",l.pointTitle="Position attribute выбранной точки",l.trace="Трек",l.traceTitle="Показать трек перемещения точки.",l.traceAllTitle="Показать трек перемещения всех точек выбранного 3D объекта.",l.pointWorld="Абсолютная позиция точки",l.pointWorldTitle="Позиция выбранной точки после масштабирования, перемещения и вращения 3D объекта",l.mesh="3D объект",l.scale="Масштаб",l.color="Цвет",l.opacity="Непрозрачность",l.opacityTitle="Число в диапазоне 0,0 - 1,0, указывающее, насколько прозрачен материал. Значение 0.0 означает полностью прозрачный, 1.0 - полностью непрозрачный.",l.defaultButton="Восстановить",l.defaultScaleTitle="Восстановить масштаб 3D объекта по умолчанию.",l.defaultPositionTitle="Восстановить позицию 3D объекта по умолчанию.",l.default3DObjectTitle="Восстановить настройки всех 3D объектов по умолчанию.",l.defaultRotationTitle="Восстановить поворот 3D объекта по умолчанию.",l.defaultLocalPositionTitle="Восстановить локальную позицию точки по умолчанию.";var c,u,d,p,f,m,h,g,y,v,b,_,x,w,S,T,C,E,A,P,O,k,z,D,N=!1;const F=this,M=new n.Vector3,L=new n.Vector3,I=new n.Vector3;function R(e){if(p.domElement.style.display=e,u.domElement.style.display=e,O){const t=K();O.domElement.parentElement.parentElement.style.display=t&&t.userData.boFrustumPoints?"none":e}}function j(e){for(var t=e.domElement;"LI"!==t.tagName.toUpperCase();)t=t.parentElement;return t}function V(e,t){void 0!==e&&("boolean"==typeof t?t=t?"block":"none":void 0===t?t="none":"string"!=typeof t&&(t="block"),j(e).style.display=t)}function B(e){if(void 0!==e)return j(e).style.display!==No}e.frustumPoints&&(a=new e.frustumPoints.guiSelectPoint);const H=e=>e?e.domElement.querySelector("input"):void 0,G=(e,t)=>{const o=H(e);o&&(o.readOnly=t)},U=e=>{const t=H(e);if(t)return t.readOnly},X=e=>!!e.boSetValue||!!U(e)&&(e.getValue()!==e.initialValue&&void 0===e.boSetValue&&(e.boSetValue=!0,q(e,e.initialValue),e.boSetValue=void 0,e.initialValue=e.getValue()),!0);function W(t){if(void 0===t&&(t=o.getSelectedPointIndex()),-1===t)return;const n=m.__select.options[m.__select.options.selectedIndex].mesh,i=Ot(n,t);if(void 0!==e.axesHelper&&!1!==e.axesHelper&&void 0!==e.axesHelper&&e.axesHelper.exposePosition({object:n,index:t}),I.x&&I.x.setValue(i.x),I.y&&I.y.setValue(i.y),I.z&&I.z.setValue(i.z),n.userData.player&&n.userData.player.arrayFuncs){const e=n.userData.player.arrayFuncs[n.userData.myObject.guiPoints.seletedIndex(t)];if(e&&e.controllers){const e=n.userData.player.arrayFuncs[t].controllers;e.x&&e.x.controller&&(e.x.controller.value=i.x),e.y&&e.y.controller&&(e.y.controller.value=i.y),e.z&&e.z.controller&&(e.z.controller.value=i.z)}}}function q(e,t){if(!e)return;const o=H(e),n=o.readOnly;return o.readOnly=!1,e.object[e.property]=t,e.__onChange&&e.__onChange.call(e,t),e.initialValue=t,e.updateDisplay(),o.readOnly=n,e}var Y;function Z(t){const o=t.object.userData.player;var i="none";if(o&&o.arrayFuncs){const b=K();k.setFunction(o.arrayFuncs[b.userData.myObject.guiPoints.seletedIndex(t.index)]),i="block"}k.displayFolder(i),O&&(e.playerOptions.cameraTarget.changeTarget(t.object,t.index),O.updateDisplay());const r=F.getObjectLocalPosition(t);q(x,r.x),q(w,r.y),q(S,r.z);const a=t.object.userData.gui;a&&(t.index=a.hyperSphere.searchNearestEdgeVerticeId(t.index,t));const s=t.index;if(t.object.userData.gui){const _=t.object.userData.myObject.guiPoints;_.getVerticeId(s),a.setValues(s,_.timeAngles)}const l=F.getObjectPosition(t.object,t.index);var c,u;q(I.x,l.x),q(I.y,l.y),q(I.z,l.z),g.object.userData.player&&g.object.userData.player.arrayFuncs;const d=o&&o.arrayFuncs?o.arrayFuncs.intersection?o.arrayFuncs.intersection(t.index):o.arrayFuncs[t.index]:void 0,p=t.object.geometry.attributes;if(p.color){const C=e=>{const o="#"+e.getHexString();A.initialValue=o,A.userData={intersection:t},A.setValue(o)};if(p.position.itemSize<4)!0!==t.object.material.vertexColors&&t.object.material instanceof n.ShaderMaterial!=!0||(c=No,u=Fo,C((new n.Color).fromBufferAttribute(p.color,t.index)));else{function E(){return"object"==typeof d.w&&d.w instanceof n.Color==!1}const z=K(),D=z.userData.myObject?z.userData.myObject.verticeColor(s):void 0;var f=void 0===d||!p.color&&!p.ca?void 0:Array.isArray(d.w)||"function"==typeof d.w?fo.execFunc(d,"w",e.time,e):E()?fo.execFunc(d.w,"func",e.time,e):"string"==typeof d.w?fo.execFunc(d,"w",e.time,e):null!=D?D:d.w;Array.isArray(f)&&(f=new n.Color(f[0],f[1],f[2])),f instanceof n.Color?(c=No,u=Fo,void 0===t.object.userData.player.arrayFuncs?u=No:(C(f),P.userData={intersection:t})):(void 0===T||void 0===f?c=No:(0!=e.scales.w.isColor&&(Y||(Y={min:T.__min,max:T.__max}),E()?(T.min("undefined"!==d.w.min?d.w.min:Y.min),T.max("undefined"!==d.w.max?d.w.max:Y.max),"undefined"!==T.__min&&"undefined"!==T.__max&&T.step((T.__max-T.__min)/100)):(T.min(Y.min),T.max(Y.max))),q(T,f),c=Fo),u=No)}}else c=No,u=No;V(T,c),V(A,u);const m=K(),h=!0===t.object.userData.boFrustumPoints||!(!m.userData.gui||!m.userData.gui.isLocalPositionReadOnly),y=m.geometry.attributes.color,v=!!y&&(4===y.itemSize&&(m.userData.myObject&&m.userData.myObject.isOpacity||m.material.transparent&&m.material.vertexColors));V(P,v?Fo:No),v&&(4!=y.itemSize&&console.error("GuiSelectPoint.setPosition: Invalid mesh.geometry.attributes.color.itemSize = "+y.itemSize),P.initialValue=y.array[t.index*y.itemSize+3],P.setValue(P.initialValue)),F.setReadOnlyPosition(h),G(A,h),G(P,h),k.displayFolder(!h)}this.exposePosition=W,this.setReadOnlyPosition=function(e){G(x,e),G(w,e),G(S,e),G(T,e)},this.setAxisControl=function(e,t){if("w"===e)null!=t.min&&T.min(t.min),null!=t.max&&T.max(t.max),null!=t.step&&T.step(t.step);else console.error("GuiSelectPoint.setAxisControl. Invalid axis: "+e)},this.setAxisName=function(e,t){M[e].name(t),i.position[e].name=t;("x"===e?y:"y"===e?v:"z"===e?b:void 0).name(t);const o=L[e];o.name&&o.name(t)},this.setMesh=function(){N=!0,$(),ee(),te(),W(),N=!1},this.setPosition=function(e){for(var t=0;t<m.__select.length;t++){var o=m.__select[t];o.selected&&Object.is(o.mesh,e.object)&&Z(e)}},this.update=function(e=!1){const t=m.__select.options[m.__select.options.selectedIndex];if(!t)return;const o=t.mesh;if(!o)return;const i=this.getSelectedPointIndex();if(-1===i)return;const r=Ot(o,i);I.x&&I.x.setValue(r.x),I.y&&I.y.setValue(r.y),I.z&&I.z.setValue(r.z),T&&r instanceof n.Vector4&&T.setValue(r.w);const a=At(o,i);e&&(x&&(x.initialValue=a.x),w&&(w.initialValue=a.y),S&&(S.initialValue=a.z),T&&(T.initialValue=a.w)),x&&x.setValue(a.x),w&&w.setValue(a.y),S&&S.setValue(a.z),k.update(o.userData.player.arrayFuncs[i])},this.getMeshIndex=function(e){if(void 0===e)return e;var t;for(t=0;t<m.__select.options.length;t++){var o=m.__select.options[t];if(Object.is(o.mesh,e))return t}},this.setIndexMesh=function(e,t){void 0!==e&&(m.__select.options[e].mesh=t,this.selectPoint(-1))},this.selectPoint=function(e){_.__onChange(e),_.__select[e+1].selected=!0},this.removeMesh=function(e,t=!0){const o=this.getMeshIndex(e),n=m.__select.selectedIndex;void 0!==o&&(m.__select.remove(o),n===o&&(_.__onChange(-1),F.removePoints(),m.__onChange(-1)),m.__select.options.length<2&&t&&(c.domElement.style.display="none"))};const J=[];function K(){if(!m)return void console.error("GuiSelectPoint().getSelectedPointIndex().getMesh(): call GuiSelectPoint.add(); first.");return-1!==m.__select.options.selectedIndex?m.__select.options[m.__select.options.selectedIndex].mesh:void 0}function Q(){return void 0===K()}function $(){if(Q())return;const e=K();y&&y.setValue(e.scale.x),v&&v.setValue(e.scale.y),b&&b.setValue(e.scale.z)}function ee(){if(Q())return;const e=K();M.x&&M.x.setValue(e.position.x),M.y&&M.y.setValue(e.position.y),M.z&&M.z.setValue(e.position.z)}function te(){if(Q())return;const e=K(),t=(e,t)=>{(t<e.__min||t>e.__max)&&console.error("GuiSelectPoint.setRotationControllers(): Invalid angle = "+t+" range. Available range from "+e.__min+" to "+e.__max),e.setValue(t)};L.x&&t(L.x,e.rotation.x),L.y&&t(L.y,e.rotation.y),L.z&&t(L.z,e.rotation.z)}function oe(t,o,i){if(!t||!t.object.userData.player||void 0===t.object.userData.player.arrayFuncs)return;const r=t.object.userData.player.arrayFuncs;var a=t.index||0,s=r.intersection?r.intersection(a):r[a],l=void 0===s?void 0:s.line;if(void 0!==l&&l.visible(o),o&&void 0===s.line){s.line=new fo.traceLine(e);var c=t.object.geometry.attributes.color;if(void 0===c)c=new n.Color(16777215);else{var u=(new n.Vector3).fromArray(c.array,a*c.itemSize);c=new n.Color(u.x,u.y,u.z)}s.line.addPoint(i(),a,c)}}function ne(t){if(t.userData.boFrustumPoints)return;if(!e.dat.guiSelectPoint.boDisplayVerticeID){for(var o=t.children.length-1;o>=0;o--){const e=t.children[o];"Sprite"===e.type&&t.remove(e)}return}if(!t.geometry)return;let i=t.geometry.attributes.position;t.updateMatrixWorld();const r=t.geometry.drawRange,a=r.count===1/0?i.count:r.start+r.count;for(let e=r.start;e<a;e++){new Jt(e,(new n.Vector3).fromBufferAttribute(i,e),{group:t}).userData.pointID=e}}function ie(e,t){const o=e.geometry.userData.drawRange?e.geometry.userData.drawRange().count:null===e.geometry.index?e.geometry.drawRange.count+e.geometry.drawRange.start>e.geometry.attributes.position.count?e.geometry.attributes.position.count:e.geometry.drawRange.count+e.geometry.drawRange.start:e.geometry.attributes.position.count;e.userData.myObject.guiPoints.create(f,_,C,E,o,t)}function re(e){if(!(!e||e.userData.boFrustumPoints||e.userData.player&&!1===e.userData.player.boArrayFuncs)&&(e.userData.player||(e.userData.player={}),!e.userData.player.arrayFuncs&&e.geometry)){const o=e.geometry.attributes.position;e.userData.player.arrayFuncs=[];for(var t=0;t<o.count;t++){const i=(new n.Vector4).fromArray(e.geometry.attributes.position.array,t*o.itemSize);e.userData.player.arrayFuncs.push(i)}}}return this.addMesh=function(e){if(!e.parent)return void console.error("GuiSelectPoint.addMesh: Add mesh into scene first.");if(e.userData.myObject||(e.userData.myObject={verticeColor:()=>{},verticeOpacity:()=>{}}),e.userData.myObject.guiPoints||(e.userData.myObject.guiPoints={seletedIndex:e=>e,setControllers:e=>{},getPositionId:e=>e,getVerticeId:e=>e,create:(t,o,n,i,r)=>{for(var a=e.geometry.drawRange.start;a<r;a++){const t=document.createElement("option"),n=e.userData.player&&e.userData.player.arrayFuncs?e.userData.player.arrayFuncs[a].name:"";t.innerHTML=a+(void 0===n?"":" "+n),t.setAttribute("value",a),o.__select.appendChild(t)}},getValue:e=>e.__select.selectedOptions[0].index-1,onChangeAngle:(e,t,o)=>{}}),c||this.add(),c.domElement.style.display="block",!m){for(var t=0;t<J.length;t++)if(J[t].uuid===e.uuid)return void console.error("guiSelectPoint.addMesh: Duplicate mesh: "+e.name);return void J.push(e)}for(t=0;t<m.__select.options.length;t++){var o=m.__select.options[t];if(e.userData.boFrustumPoints&&void 0!==o.mesh&&o.mesh.userData.boFrustumPoints)return;if(void 0!==o.mesh&&o.mesh.uuid===e.uuid)return void console.error("guiSelectPoint.addMesh(...): Duplicate mesh.")}const i=document.createElement("option");i.innerHTML=m.__select.length+" "+(""===e.name?e.constructor.name:e.name),i.mesh=e,e.userData.default=e.userData.default||{scale:(new n.Vector3).copy(e.scale),position:e.position instanceof n.Vector3?(new n.Vector3).copy(e.position):e.position instanceof n.Vector4?(new n.Vector4).copy(e.position):void 0,rotation:(new n.Euler).copy(e.rotation)},m.__select.appendChild(i),ne(e)},this.getObjectLocalPosition=e=>At(e.object,e.index),this.getObjectPosition=(e,t)=>Ot(e,t),this.select=function(o){g=void 0;let n=o.index;if(void 0===n||isNaN(n)){const e=o.object.geometry.index;n=e.getX(o.indexNew),o.object.userData.myObject.guiPoints.verticeId=n,o.index=n}const i=o.object.userData.myObject;i.getPositionData||(i.getPositionData=e=>({verticeId:e,positionId:e*o.object.geometry.attributes.position.itemSize}));const s=this.getMeshIndex(o.object);if(s){if(!1===m.__select[s].selected)m.__select[s].selected=!0,m.__onChange(s-1,o);else if(i.guiPoints.setIntersection&&i.guiPoints.setIntersection(o),i.guiPoints.changeControllers&&i.guiPoints.changeControllers(),D){const t=K();D.object(o.event&&0===o.event.button?t:void 0,r,e)}this.selectPoint2=function(e){if(void 0!==e&&!Object.is(o.object,e))return;if(o.object.userData.boFrustumPoints)a.pointIndexes(o.object.userData.pointIndexes(n));else{const e=o.object.userData.myObject,t=e?e.guiPoints:void 0,i=t?t.verticeId:void 0,r=_.__select[(i||n)+1];r&&(r.selected=!0)}const i="block";R(i),g=o,t.setIntersection&&t.setIntersection(o),Z(o);const r=K(),s=r.userData.player.arrayFuncs,l=r.userData.player&&void 0!==r.userData.player.arrayFuncs&&"function"!=typeof g.object.userData.player.arrayFuncs&&null!=n?(s.intersection?s.intersection(n):s[n]).line:void 0;C&&C.setValue(void 0!==l&&l.isVisible()),d.domElement.parentElement.parentElement.style.display=g.object.userData.player&&void 0!==g.object.userData.player.arrayFuncs?i:"none"},this.selectPoint2(void 0)}},this.isSelectedMesh=function(e){return K()===e},this.getSelectedPointIndex=function(){if(void 0!==a&&a.isDisplay()&&e.frustumPoints&&e.frustumPoints.isDisplay()){var t=a.getSelectedIndex();return null===t?-1:t}if(void 0===_)return-1;const o=K();return o?o.userData.myObject.guiPoints.getValue(_):-1},this.updateScale=function(t){const o="none",n="block",r=e.scales[t].isAxis()?n:o,a=e.scales.x.isAxis(),s=e.scales.y.isAxis(),l=e.scales.z.isAxis();var c=0;switch(a&&c++,s&&c++,l&&c++,c){case 1:z&&(z.domElement.style.display=o);break;case 2:z.domElement.style.display=n,a&&L.x.domElement&&(L.x.domElement.parentElement.parentElement.style.display=o),s&&L.y.domElement&&(L.y.domElement.parentElement.parentElement.style.display=o),l&&L.z.domElement&&(L.z.domElement.parentElement.parentElement.style.display=o);break;default:return void console.error("GuiSelectPoint.updateScale: Invalid space dimension = "+c)}if(i.position[t]){var u,d;switch(i.position[t].domElement.style.display=r,I[t].domElement.parentElement.parentElement.style.display=r,t){case"x":u=x,d=y;break;case"y":u=w,d=v;break;case"z":u=S,d=b;break;default:return void console.error("GuiSelectPoint.updateScale: Invalid axis name: "+t)}u.domElement.parentElement.parentElement.style.display=r,d.domElement.parentElement.parentElement.style.display=r}else e.scales[t].isAxis()&&console.error("GuiSelectPoint.updateScale: Under constraction.")},this.add=function(o){if(!(o=o||e.dat.gui))return;var j,H,Y,Z;(c=o.addFolder(l.meshs)).domElement.style.display="none",m=c.add({Meshs:l.notSelected},"Meshs",{[l.notSelected]:-1}).onChange((function(t,o){t=parseInt(t),_.__onChange(-1),j&&j.userData.myObject.guiPoints.resetControllers&&j.userData.myObject.guiPoints.resetControllers(),j=K();const n="none",i="block";var s;if(u.fCustomPoint&&(u.removeFolder(u.fCustomPoint),delete u.fCustomPoint),j&&j.userData.gui&&(u.fCustomPoint=j.userData.gui.addControllers(u,{readOnlyEl:G,isReadOnlyController:X})),D&&D.object(j,r,-1===t),re(j),void 0===j)s=n,j=void 0,void 0!==e.axesHelper&&!1!==e.axesHelper&&e.axesHelper.exposePosition(Ot(K(),t));else{const t=void 0===j.userData.default?n:i;H.domElement.parentElement.parentElement.style.display=t,Y.domElement.parentElement.parentElement.style.display=t,Z&&(Z.domElement.parentElement.parentElement.style.display=t),s=i;var l=n,c=i;_.__onChange(-1),F.removePoints(),void 0!==j.userData.controllers?j.userData.controllers():(l=i,c=n,j.geometry&&j.geometry.attributes&&(ie(j,o),j.userData.myObject&&j.userData.myObject.guiPoints&&j.userData.myObject.guiPoints.pointsStyleDisplay&&(l=j.userData.myObject.guiPoints.pointsStyleDisplay))),V(_,l),E&&V(E,E.userData&&E.userData.display?E.userData.display:!!e.player&&l),void 0!==a&&a.display(c),$(),ee(),te(),pe=void 0}h.domElement.style.display=s,void 0!==j&&void 0!==j.userData.traceAll&&E.setValue(j.userData.traceAll)})),r.controllerNameAndTitle(m,l.select),(h=c.addFolder(l.mesh)).domElement.style.display="none",h.open();const Q=h.addFolder(l.scale);Q.add(new ge((function(t,o){const n=t.controller.getValue();j.scale.x=o(j.scale.x,n),j.scale.y=o(j.scale.y,n),j.scale.z=o(j.scale.z,n),j.needsUpdate=!0,$(),W(),e.frustumPoints&&e.frustumPoints.updateCloudPoint(j)}),{settings:{zoomMultiplier:1.1},getLanguageCode:s,newBool:!0}));const ae=new n.Vector3;function se(t,o){j.scale[t]=o,j.needsUpdate=!0,W(),e.frustumPoints&&e.frustumPoints.updateCloudPoint(j)}e.scales.x.isAxis()&&(y=r.controllerZeroStep(Q,ae,"x",(function(e){se("x",e)})),r.controllerNameAndTitle(y,e.scales.x.name)),e.scales.y.isAxis()&&(v=r.controllerZeroStep(Q,ae,"y",(function(e){se("y",e)})),r.controllerNameAndTitle(v,e.scales.y.name)),e.scales.z.isAxis()&&(b=r.controllerZeroStep(Q,ae,"z",(function(e){se("z",e)})),r.controllerNameAndTitle(b,e.scales.z.name)),H=Q.add({defaultF:function(e){j.scale.copy(j.userData.default.scale),j.needsUpdate=!0,$(),W()}},"defaultF"),r.controllerNameAndTitle(H,l.defaultButton,l.defaultScaleTitle);const le=h.addFolder(l.position);function ce(t){const o=e.scales[t];if(!o.isAxis())return;const a=o.name,l=le.addFolder(a);i.position=i.position||{},i.position[a]=l,l.add(new ye((function(o){j.position[t]+=o,j.needsUpdate=!0,ee(),W(),e.frustumPoints&&e.frustumPoints.updateCloudPoint(j)}),{getLanguageCode:s}));const c=new n.Vector3;M[t]=r.controllerZeroStep(l,c,t,(function(e){!function(e){j.position[t]=e,j.needsUpdate=!0,W()}(e)})),r.controllerNameAndTitle(M[t],a)}let ue;ce("x"),ce("y"),ce("z"),Y=le.add({defaultF:function(e){j.position.copy(j.userData.default.position),j.needsUpdate=!0,ee(),W()}},"defaultF"),r.controllerNameAndTitle(Y,l.defaultButton,l.defaultPositionTitle),function(){const t=e.scales.x.isAxis(),o=e.scales.y.isAxis();var i=0;if(t&&i++,o&&i++,e.scales.z.isAxis()&&i++,1!==i){switch(z=h.addFolder(l.rotation),i){case 2:a(t?o?"z":"y":"x");break;case 3:a("x"),a("y"),a("z");break;default:return void console.error("GuiSelectPoint.updateScale: Invalid space dimension = "+i)}Z=z.add({defaultF:function(e){j.rotation.copy(j.userData.default.rotation),j.needsUpdate=!0,te(),W()}},"defaultF"),r.controllerNameAndTitle(Z,l.defaultButton,l.defaultRotationTitle)}function a(t){const o=e.scales[t];L[t]=z.add(new n.Vector3,t,0,2*Math.PI,.01).onChange((function(o){const n=K();n.userData.boFrustumPoints||(n.rotation[t]=o,n.needsUpdate=!0),N||W(),void 0!==e.frustumPoints&&e.frustumPoints.updateCloudPoint(n)})),r.controllerNameAndTitle(L[t],o.name)}}(),f=h.addFolder(l.points),(_=f.add({Points:l.notSelected},"Points",{[l.notSelected]:-1})).onChange((function(t){if(t=parseInt(t),isNaN(t)){const e=this.__select[this.__select.selectedIndex].onchange;return void(e?e():console.error("GuiSelectPoint: cPoints.onChange. Under constraction"))}var o;let n=K();if(n&&n.userData.gui&&n.userData.gui.reset&&(ue=n),-1===t)o="none";else{o="block";const e=n.userData.myObject.bufferGeometry.userData,i=e.timeId;e.timeId=n.userData.myObject.guiPoints.timeId;const r=e.position[t];t=e.positionOffsetId(t),e.timeId=i;const a={object:n,index:t,point:r,nearestEdgeVerticeId:t},s=n.userData.myObject.guiPoints.setIntersectionProperties;s&&s(a),F.select(a)}!1!==e.axesHelper&&void 0!==e.axesHelper&&e.axesHelper.exposePosition(Ot(n,t)),R(o),n&&n.userData.gui&&n.userData.gui.reset||(n=ue),n&&n.userData.gui&&n.userData.gui.reset&&n.userData.gui.reset(t)})),_.__select[0].selected=!0,r.controllerNameAndTitle(_,l.select),void 0!==a&&a.create(f,s()),t.myThreejs&&(t.myThreejs.cFrustumPoints=a),e.dat.guiSelectPoint=e.dat.guiSelectPoint||{},e.dat.guiSelectPoint.boDisplayVerticeID=e.dat.guiSelectPoint.boDisplayVerticeID||!1;const de=c.add(e.dat.guiSelectPoint,"boDisplayVerticeID").onChange((function(e){for(var t=1;t<m.__select.options.length;t++){var o=m.__select.options[t];void 0!==o.mesh?ne(o.mesh):console.error("guiSelectPoint: cDisplayVerticeID.onChange. Invalud option.mesh")}}));if(r.controllerNameAndTitle(de,l.displayVerticeID,l.displayVerticeIDTitle),e.dat&&e.dat.guiSelectPoint&&e.dat.guiSelectPoint.point&&(D=e.dat.guiSelectPoint.point(e,r,h)),e.player){var pe;t.cameraTarget&&e.playerOptions.cameraTarget.init(t.cameraTarget,e);const o=e.playerOptions.cameraTarget.get(e);o&&(O=f.add(o,"boLook").onChange((function(i){const r=K();if(r.userData.boFrustumPoints)return void(i&&(console.warn("guiSelectPoint.cCameraTarget.onChange(...). The camera can not look at the frustum point."),O.setValue(!1)));if(!r.userData.player){r.userData.player={arrayFuncs:[]};for(var s=0;s<r.geometry.attributes.position.count;s++)r.userData.player.arrayFuncs.push((new n.Vector3).fromArray(r.geometry.attributes.position.array,s*r.geometry.attributes.position.itemSize))}const l=r.userData.boFrustumPoints?a.getSelectedIndex():_.__select.options.selectedIndex-1,c="function"==typeof r.userData.player.arrayFuncs?(new n.Vector3).fromArray(r.userData.player.arrayFuncs().attributes.position.array,3*l):void 0!==r.userData.player.arrayFuncs?r.userData.player.arrayFuncs[l]:(new n.Vector3).fromArray(r.geometry.attributes.position.array,3*l);for(s=0;s<m.__select.options.length;s++){const e=m.__select.options[s].mesh;if(!e||!e.userData.player||!e.userData.player.arrayFuncs)continue;const t=e.userData.player.arrayFuncs;for(var u=0;u<t.length;u++)t[u].cameraTarget&&(t[u].cameraTarget.boLook=!1)}if(c.cameraTarget&&(c.cameraTarget.boLook=i),e.player&&e.player.selectScene(),e.cameraGui&&e.cameraGui.look(i),i)c.cameraTarget||(void 0===o.boLook&&(fo.cameraTarget2.boLook=!1),pe||(pe={}),pe.target||(pe.target=new n.Vector3),e.orbitControls&&pe.target.copy(e.orbitControls.target),e.playerOptions.cameraTarget.changeTarget(r,l));else if(t.cameraTarget&&(t.cameraTarget.camera.userData.cameraTargetPoint=c.cameraTarget),e.orbitControls&&e.orbitControls.reset(),pe){if(getCameraTarget())return;fo.orbitControls&&fo.orbitControls.target.copy(pe.target),t.cameraTarget.camera.lookAt(pe.target),c.cameraTarget=void 0}})),r.controllerNameAndTitle(O,l.cameraTarget,l.cameraTargetTitle))}for(u=f.addFolder(l.point),r.folderNameAndTitle(u,l.point,l.pointTitle),p=f.addFolder(l.pointWorld),r.folderNameAndTitle(p,l.pointWorld,l.pointWorldTitle),R("none"),t.pointsControls&&t.pointsControls(f,V,K),e.traces||(e.traces={boTraces:!1,onChange:e=>{var t=K();t.userData.traceAll=e;for(var o=0;o<t.geometry.attributes.position.count;o++)oe({object:t,index:o},e,K);C.setValue(e)}}),E=f.add(e.traces,"boTraces").onChange((t=>{e.traces.onChange(t)})),r.controllerNameAndTitle(E,l.trace,l.traceAllTitle),V(E,e.player),r.controllerNameAndTitle(c.add({defaultF:function(t){for(var o=0;o<m.__select.options.length;o++){const e=m.__select.options[o].mesh;e&&(e.scale.copy(e.userData.default.scale),e.position.copy(e.userData.default.position),e.rotation.copy(e.userData.default.rotation),e.needsUpdate=!0)}$(),ee(),te(),W(),e.frustumPoints&&e.frustumPoints.onChangeControls()}},"defaultF"),l.defaultButton,l.default3DObjectTitle),function(){function o(t){var o,n;if("w"===t){function i(t){const o=g.object.geometry.attributes,i=g.index;o.position.itemSize<4?console.error("guiSelectPoint.addPointControllers().axesGui().controller.onChange(): attributes.position.itemSize = "+o.position.itemSize):(e.palette&&fo.setColorAttribute(o,i,e.palette.toColor(t,n.__min,n.__max)),0!=e.scales.w.isColor&&o.position.setW(i,t),e.frustumPoints&&e.frustumPoints.updateCloudPointItem(g.object,g.index))}if(e.scales.setW(),void 0!==(o=e.scales.w).min&&void 0!==o.max){if(n=u.add({value:o.min},"value",o.min,o.max,(o.max-o.min)/100).onChange((function(e){X(n)||i(e)})),0!=e.scales.w.isColor&&e.palette instanceof Vt.palette){n.domElement.querySelector(".slider-fg").style.height="40%";const a=n.domElement.querySelector(".slider");Vt.create(a,{palette:e.palette,style:{width:"65%"}})}}else n=u.add({value:0},"value").onChange((function(e){i(e)}))}else(o=void 0===e.axesHelper||!1===e.axesHelper?e.scales[t]:e.axesHelper.options?e.axesHelper.options.scales[t]:void 0).isAxis()&&(n=u.add({value:o.min},"value",o.min,o.max).onChange((function(o){const i=g.object;if(X(n))return;const r="x"===t?0:"y"===t?1:"z"===t?2:"w"===t?3:console.error("axisName:"+t);i.geometry.attributes.position.array[r+i.userData.myObject.getPositionData(g.index).positionId]=o,i.geometry.attributes.position.needsUpdate=!0,W(g.index),e.frustumPoints&&e.frustumPoints.updateCloudPointItem(i,g.index)})));return n&&r.controllerNameAndTitle(n,o.name),n}x=o("x"),w=o("y"),S=o("z"),T=o("w"),A=u.addColor({color:"#FFFFFF"},"color").onChange((function(e){if(!X(A)&&void 0!==A.userData){var t=A.userData.intersection;fo.setColorAttribute(t.object.geometry.attributes,t.index,e)}})),r.controllerNameAndTitle(A,e.scales.w?e.scales.w.name:l.color),P=u.add({opasity:1},"opasity",0,1,.01).onChange((function(e){if(X(P))return;const t=K();if(t.userData.myObject)return void t.userData.myObject.verticeOpacity(g.index,!0,e);if(!t.material.transparent)return void console.error("GuiSelectPoint: cOpacity.onChange. Invalid mesh.material.transparent = "+t.material.transparent);if(!t.material.vertexColors)return void console.error("GuiSelectPoint: cOpacity.onChange. Invalid mesh.material.vertexColors = "+t.material.vertexColors);const o=t.geometry.attributes.color;o.itemSize<4||(o.array[3+g.index*o.itemSize]=e,o.needsUpdate=!0)})),r.controllerNameAndTitle(P,l.opacity,l.opacityTitle),e.trace||(e.trace={onChange:e=>{oe(g,e,K)}});C=u.add({boTrace:!1},"boTrace").onChange((function(t){e.trace.onChange(t,_.__select.selectedIndex-1)})),r.controllerNameAndTitle(C,l.trace,l.traceTitle),V(C,e.player),t.pointControls&&t.pointControls(u,V,K,g);function i(t){const o=void 0===e.axesHelper||!1===e.axesHelper?e.scales[t]:e.axesHelper.options?e.axesHelper.options.scales[t]:void 0;if(!o.isAxis())return;const n=r.controllerZeroStep(p,{value:o.min},"value");return G(n,!0),r.controllerNameAndTitle(n,o.name),n}I.x=i("x"),I.y=i("y"),I.z=i("z"),d=u.add({defaultF:function(){const t=g.object.userData.player.arrayFuncs[g.index],o=e.time,i=(t,n)=>{t&&t.setValue("function"==typeof n?n(o,e.a,e.b):"string"==typeof n?fo.execFunc({w:n},"w",e.time,e):n)};if(i(x,t.x),i(w,t.y),i(S,void 0===t.z?0:t.z),B(P)&&P.setValue(P.initialValue),B(A)&&!U(A)&&A.setValue(A.initialValue),void 0!==t.w){if(void 0!==t.w.r)A.setValue("#"+new n.Color(t.w.r,t.w.g,t.w.b).getHexString());else{if("function"==typeof t.w)return void q(T,t.w(o));if(t.w.func)return void q(T,t.w.func(o))}if(parseFloat(t.w)===t.w)B(T)&&q(T,t.w);else{if("string"==typeof t.w)return void q(T,fo.execFunc(t,"w",e.time,e));console.error("Restore default local position: Invalid W axis.")}}else A.setValue(A.initialValue)}},"defaultF"),r.controllerNameAndTitle(d,l.defaultButton,l.defaultLocalPositionTitle),k=new Do(u,(function(t,o,i){const r=K(),a=_.__select.options.selectedIndex-1,s=r.userData.player.arrayFuncs[a];s[o]=t;for(var l,c=r.parent,u=0;c;){if(c.userData.t){u=c.userData.t;break}c=c.parent}switch(o){case"x":l=x;break;case"y":l=w;break;case"z":l=S;break;case"w":if(t instanceof n.Color)return void A.setValue("#"+t.getHexString());l=T;break;default:return void console.error("GuiSelectPoint new functionsFolder onFinishChange: axisName = "+o)}if(q(l,fo.execFunc(s,o,u,e)),s.controllers){const e=s.controllers[o];e&&e.func&&e.func.controller&&(e.func.controller.value=i)}}),e,{x:"",y:"",z:"",w:""})}();J.length>0;)this.addMesh(J[J.length-1]),J.pop()},this.removePoints=function(){_.domElement.querySelectorAll("select option").forEach((e=>e.remove()));const e=document.createElement("option");e.innerHTML=l.notSelected,e.setAttribute("value",-1),_.__select.appendChild(e)},this.updatePoints=function(){const t=e.dat.guiSelectPoint.boDisplayVerticeID,o=K();t&&(e.dat.guiSelectPoint.boDisplayVerticeID=!1,ne(o)),_.__onChange(-1),this.removePoints(),o.userData.player.arrayFuncs.length=0,delete o.userData.player.arrayFuncs,re(o),ie(o),t&&(e.dat.guiSelectPoint.boDisplayVerticeID=!0,ne(o)),o.userData.nd&&o.userData.nd.update()},this.getFrustumPoints=function(){return a},this}}
/**
   * @module MoveGroupGui
   *
   * @description Add MoveGroup folder into {@link https://github.com/anhr/dat.gui|dat.gui} for changing group's position, scale and rotation.
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
  */class Lo{constructor(e,t,o={}){if(!t.boOptions)return void console.error("MoveGroupGui: call options = new Options( options ) first");const n=o.folder||t.dat.gui;if(!n||!1===t.dat.moveScene)return;t.axesHelper&&t.axesHelper.options?t.scales=t.axesHelper.options.scales:t.scales=t.scales||{x:{},y:{},z:{}};const i=t.dat.cookie,r=he.dat,a="MoveGroup"+(t.cookieName?"_"+t.cookieName:""),s={scale:e.scale,position:e.position,rotation:e.rotation,x:{zoomMultiplier:1.2,offset:.1},y:{zoomMultiplier:1.2,offset:.1},z:{zoomMultiplier:1.2,offset:.1}},l=JSON.parse(JSON.stringify(s));function c(e){t.scales[e]&&(t.moveGroupGui=t.moveGroupGui||{scales:{}},t.moveGroupGui.scales[e]=t.moveGroupGui.scales[e]||{},t.moveGroupGui.scales[e].default=function(){const o=t.scalesControllers[e];o.scale.setValue(l.scale[e]),o.scaleController.setValue(l[e].zoomMultiplier),o.position.setValue(l.position[e]),o.positionController.setValue(l[e].offset),o.rotation.setValue(l.rotation["_"+e])})}Object.freeze(l),i.getObject(a,s,l),e.scale.copy(s.scale),e.position.copy(s.position),s.scale=e.scale,s.position=e.position,c("x"),c("y"),c("z");var u={moveGroup:"Move Group",scale:"Scale",position:"Position",rotation:"Rotation",defaultButton:"Default",defaultTitle:"Move group to default position."};switch(t.getLanguageCode()){case"ru":u.moveGroup="Переместить группу",u.scale="Масштаб",u.position="Позиция",u.rotation="Вращение",u.defaultButton="Восстановить",u.defaultTitle="Переместить группу в исходное состояние.";break;default:if(void 0===t.lang||t.lang.languageCode!=languageCode)break;Object.keys(t.lang).forEach((function(e){void 0!==u[e]&&(u[e]=t.lang[e])}))}function d(e,o,n){var i=t.scalesControllers[e].scale;i&&(i.setValue(o(i.getValue(),n)),f())}o.lang&&(u.moveGroup=o.lang.moveGroup||u.moveGroup);let p=n.addFolder(u.moveGroup);function f(){t.axesHelper&&t.axesHelper.updateAxes(),t.guiSelectPoint&&t.guiSelectPoint.update(),i.setObject(a,s)}function m(n,i,a){if(n.isAxis()){i.folder=p.addFolder(n.name),i.scaleController=i.folder.add(new ge((function(e,t){var o=e.controller.getValue();d(a,t,o)}),{settings:s[a],getLanguageCode:o.getLanguageCode})).onChange((function(e){s[a].zoomMultiplier=e,f()})),i.scale=r.controllerZeroStep(i.folder,e.scale,a,(function(e){f()})),r.controllerNameAndTitle(i.scale,u.scale);var l=new ye((function(e){var o,n;o=function(t,o){return t+=e},n=l.controller.getValue(),function(e,o,n){var i=t.scalesControllers[e].position;i&&(i.setValue(o(i.getValue(),n)),f())}(a,o,n)}),{settings:{},getLanguageCode:o.getLanguageCode});i.positionController=i.folder.add(l).onChange((function(e){s[a].offset=e,f()})),i.position=r.controllerZeroStep(i.folder,e.position,a,(function(e){f()})),r.controllerNameAndTitle(i.position,u.position),i.rotation=i.folder.add(e.rotation,a,0,2*Math.PI,1/360).onChange((function(e){f()})),r.controllerNameAndTitle(i.rotation,u.rotation),r.controllerNameAndTitle(i.folder.add({defaultF:function(e){t.moveGroupGui.scales[a].default()}},"defaultF"),u.defaultButton,u.defaultTitle)}}p.add(new ge((function(e,t){let o=e.controller.getValue();d("x",t,o),d("y",t,o),d("z",t,o)}),{settings:{zoomMultiplier:1.1},getLanguageCode:o.getLanguageCode})),t.scalesControllers={x:{},y:{},z:{},w:{}},t.scales&&(m(t.scales.x,t.scalesControllers.x,"x"),m(t.scales.y,t.scalesControllers.y,"y"),m(t.scales.z,t.scalesControllers.z,"z"));var h={defaultF:function(e){t.moveGroupGui.scales.x&&t.moveGroupGui.scales.x.default(),t.moveGroupGui.scales.y&&t.moveGroupGui.scales.y.default(),t.moveGroupGui.scales.z&&t.moveGroupGui.scales.z.default()}};r.controllerNameAndTitle(p.add(h,"defaultF"),u.defaultButton,u.defaultTitle)}}
/**
   * @module CameraGui
   * @description [Camera]{@link https://threejs.org/docs/index.html#api/en/cameras/PerspectiveCamera} graphical user interface.
   * 
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */class Io{constructor(e,t,o){if(!t.boOptions)return void console.error("CameraGui: call options = new Options( options ) first");if(!(o=o||t.dat.gui)||!1===t.dat.cameraGui)return;const n=he.dat;he.THREE,t.cameraGui=this,t.orbitControls&&t.orbitControls.addEventListener("change",(function(){m()}));const i={camera:"Camera",position:"Position",positionTitle:"Camera position",distanceToCamera:"Distance",distanceToCameraTitle:"Distance from the camera to the point at which the camera is looking",look:"Look",lookTitle:"Camera is look at a selected point during playing.",defaultButton:"Default",defaultTitle:"Restore default camera settings."};switch(t.getLanguageCode()){case"ru":i.camera="Камера",i.position="Позиция",i.positionTitle="Позиция камеры",i.distanceToCamera="Расстояние",i.distanceToCameraTitle="Расстояние между камерой и точкой, на которую она смотрит.",i.look="Следить",i.lookTitle="Камера следит за выбранной точкой во время проигрывания.",i.defaultButton="Восстановить",i.defaultTitle="Восстановить настройки камеры по умолчанию.";break;default:if(void 0===t.lang||t.lang.languageCode!=_languageCode)break;Object.keys(t.lang).forEach((function(e){void 0!==i[e]&&(i[e]=t.lang[e])}))}const r=o.addFolder(i.camera),a=r.addFolder(i.position),s={x:t.scales.x?n.controllerZeroStep(a,e.position,"x",(function(t){e.position.x=t})):void 0,y:t.scales.y?n.controllerZeroStep(a,e.position,"y",(function(t){e.position.y=t})):void 0,z:t.scales.z?n.controllerZeroStep(a,e.position,"z",(function(t){e.position.z=t})):void 0};var l,c,u,d;if(n.folderNameAndTitle(a,i.position,i.positionTitle),s.x&&n.controllerNameAndTitle(s.x,t.scales.x.name),s.y&&n.controllerNameAndTitle(s.y,t.scales.y.name),s.z&&n.controllerNameAndTitle(s.z,t.scales.z.name),t.player){t.playerOptions.cameraTarget.init({camera:e},t);const h=t.playerOptions.cameraTarget.get();d=r.add(h,"boLook").onChange((function(e){t.player&&(h.boMaual=!0,t.player.selectScene(),h.boMaual=!1),e||t.orbitControls&&t.orbitControls.reset()})),n.controllerNameAndTitle(d,i.look,i.lookTitle);const g=r.addFolder(i.distanceToCamera),y={x:fo.execFunc(h.distanceToCamera,"x",void 0,t),y:fo.execFunc(h.distanceToCamera,"y",void 0,t),z:fo.execFunc(h.distanceToCamera,"z",void 0,t)};function v(t,o){isNaN(o)||(e.userData.cameraTarget&&(e.userData.cameraTarget.distanceToCameraCur[t]=o),h.distanceToCameraCur[t]=o,h.setCameraPosition(),m())}l={x:n.controllerZeroStep(g,y,"x",(function(e){v("x",e)})),y:n.controllerZeroStep(g,y,"y",(function(e){v("y",e)})),z:n.controllerZeroStep(g,y,"z",(function(e){v("z",e)}))},c={x:y.x,y:y.y,z:y.z},n.folderNameAndTitle(g,i.distanceToCamera,i.distanceToCameraTitle),t.scales.x&&n.controllerNameAndTitle(l.x,t.scales.x.name),t.scales.y&&n.controllerNameAndTitle(l.y,t.scales.y.name),t.scales.z&&n.controllerNameAndTitle(l.z,t.scales.z.name),u=new Do(g,(function(o,n){const i=t.playerOptions.cameraTarget.get();i.distanceToCamera[n]=o;const r=fo.execFunc(i.distanceToCamera,n,t.time);l[n].setValue(r,!0),t.playerOptions.cameraTarget.init({camera:e},t)}),t,h.distanceToCamera)}const p={x:e.position.x,y:e.position.y,z:e.position.z},f=t.orbitControls?{x:t.orbitControls.target.x,y:t.orbitControls.target.y,z:t.orbitControls.target.z}:{x:0,y:0,z:0};function m(){const o=t.playerOptions.cameraTarget.get(t);if(s.x&&s.x.setValue(e.position.x),s.y&&s.y.setValue(e.position.y),s.z&&s.z.setValue(e.position.z),l){const e=o.getDistanceToCamera();l.x&&l.x.setValue(e.x),l.y&&l.y.setValue(e.y),l.z&&l.z.setValue(e.z)}u&&u.setFunction(o.distanceToCamera)}n.controllerNameAndTitle(r.add({defaultF:function(o){s.x.setValue(p.x),s.y.setValue(p.y),s.z.setValue(p.z),e.position.copy(p),e.lookAt(f),t.orbitControls&&(t.orbitControls.target.copy(f),t.orbitControls.update()),l&&(l.x.setValue(c.x),l.y.setValue(c.y),l.z.setValue(c.z))}},"defaultF"),i.defaultButton,i.defaultTitle),this.update=function(){m()},this.look=function(e=!0){d&&(d.object[d.property]=e,d.updateDisplay())}}}
/**
   * FolderPoint
   *
   * GUI for changing point settings.
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
  */class Ro{constructor(e,t,o,n={}){const i=he.dat;if(!o.boOptions)return void console.error("FolderPoint: call options = new Options( options ) first");const r=n.folder||o.dat.gui;if(!r||!1===o.dat.folderPoint)return;o.dat.folderPoint=this;const a={pointSettings:"Point",size:"Size",sizeTitle:'Size of the point with "ShaderMaterial" material',defaultButton:"Default",defaultPointTitle:"Restore point."};if("ru"===o.getLanguageCode())a.pointSettings="Точка",a.size="Размер",a.sizeTitle='Размер точки с материалом типа "ShaderMaterial"',a.defaultButton="Восстановить",a.defaultPointTitle="Восстановить точку";const s=n.defaultPoint||{};void 0===s.size&&(s.size=e.size);const l=n.PCOptions||{};void 0===l.min&&(l.min=.01),void 0===l.max&&(l.max=1),l.settings=l.settings||{},void 0===l.settings.offset&&(l.settings.offset=1),void 0===l.step&&(l.step=.01),l.getLanguageCode=l.getLanguageCode||n.getLanguageCode||o.getLanguageCode;var c=r.addFolder(a.pointSettings),u=c.addFolder(a.size);i.folderNameAndTitle(u,a.size,a.sizeTitle),this.display=function(e){c.domElement.style.display=e},u.add(new ye((function(o){t(e.size+o)}),l)),this.size=i.controllerZeroStep(u,e,"size",(function(e){t(e)})),i.controllerNameAndTitle(this.size,a.size,a.sizeTitle),i.controllerNameAndTitle(c.add({defaultF:function(e){t(s.size)}},"defaultF"),a.defaultButton,a.defaultPointTitle)}}
/**
   * frustumPoints
   * 
   * Array of points, statically fixed in front of the camera.
   * I use frustumPoints for displaying of the clouds around points.
   *
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
  */var jo={notHiddingFrustumPoints:!0};function Vo(e){return Math.exp(-.5*e*e/(.1*.1))}class Bo{constructor(e,t,o,n={}){const i=he.THREE;n.options=n.options||new ao;const r=n.options;if(!r.boOptions)return void console.error("FrustumPoints: call options = new Options( options ) first");if(!r.frustumPoints)return;this.gl=o.getContext("webgl"),this.getOptions=function(){return r};const a=r.frustumPoints;r.frustumPoints=this;const s=[];var l,c,u;s.getCloudsCount=function(){for(var e=0,t=0;t<s.length;t++){e+=s[t].length}return e},this.pushArrayCloud=function(e){var t;if(e.geometry&&(t=e,e=e.geometry),4!==e.attributes.position.itemSize)return void console.error("FrustumPoints.pushArrayCloud: Invalid geometry.attributes.position.itemSize = "+e.attributes.position.itemSize);const o=s.getCloudsCount(),n=[];s.push(n);for(var r=0;r<e.attributes.position.count;r++){const t=(new i.Vector4).fromArray(e.attributes.position.array,r*e.attributes.position.itemSize);n.push(t)}return t&&(t.userData.cloud={indexArray:o}),o},this.create=function(o){if(0===s.length)return;const d={},p=new i.Vector3,f=e.position.distanceTo(p),m=this,h=new i.Group;n.optionsShaderMaterial=n.optionsShaderMaterial||{},a.point=a.point||{},a.point.size=a.point.size||.01,a.display=void 0===a.display||a.display,a.info=void 0!==a.info&&a.info,a.stereo=a.stereo||{},a.stereo.hide=a.stereo.hide||0,a.stereo.opacity=a.stereo.opacity||.3,a.zCount=a.zCount||50,a.yCount=a.yCount||30,a.near=a.near||0,a.far=a.far||0,a.base=a.base||100,a.square=void 0!==a.square&&a.square;const g=r.dat.cookie,y=r.dat?r.dat.getCookieName("FrustumPoints"):"FrustumPoints";Object.freeze(a),g&&g.getObject(y,d,a),d.stereo&&(d.stereo.hide=a.stereo.hide,d.stereo.opacity=a.stereo.opacity);var v,b=function(){var e,t;this.create=function(o){e=o,r.scales.w||r.scales.setW();const n=r.scales.w.max,a=r.scales.w.min;e.paletteA={value:1/(n-a)},e.paletteB={value:-a/(n-a)},this.cloudPoints=new this.addUniforms(i.RGBAFormat,s.getCloudsCount(),"cloudPoints"),t=256;new this.addUniforms(i.LuminanceFormat,t,"distanceTable",{height:2,onReady:function(e,o,n){var i,r=0;var a=.5/(t-1);for(var s=0;s<t;s++){var l=Vo(r);r+=a,void 0!==i&&(Math.abs(i-l)>.035?a/=1.001:a*=1.001),i=l,n(s,l),n(s+t,r)}}})},this.addUniforms=function(t,o,n,r){r=r||{};const a=t===i.RGBAFormat?4:t===i.RGBFormat?3:t===i.LuminanceFormat?1:NaN,s=r.height||1,l=o*s,c=i.FloatType,u=c===i.FloatType?new Float32Array(a*l):new Uint8Array(a*l);return void 0!==this.addUniforms&&console.error('Please use "new this.addUniforms(...)"'),this.updateItem=function(e,t){var o,n,i,r;"number"==typeof t?o=t:void 0===t.x?(o=t.r,n=t.g,i=t.b,r=1):(o=t.x,n=t.y,i=t.z,isNaN(t.w)&&console.error("frustumPoints.create.cloud.addUniforms.updateItem: vector.w = "+t.w+". Probably you use THREE.Color for w coordinate of the point with cloud."),r=t.w);const s=void 0===n?1:void 0===i?2:void 0===r?3:4,l=e*a;s!==a&&console.error("frustumPoints.create.cloud.addUniforms.updateItem: vectorSize = "+s+" !== itemSize = "+a),u[l]=o,a>1&&(u[l+1]=n,a>2&&(u[l+2]=i,a>3&&(u[l+3]=r)))},void 0!==r.onReady&&r.onReady(u,a,this.updateItem),e[n]={value:new i.DataTexture(u,o,s,t,c)},e[n].value.needsUpdate=!0,a},this.editShaderText=function(e){for(var o=0,n=0;n<s.length;n++){o+=s[n].length}e.vertex=e.vertex.replace("%scloudPointsWidth",o+"."),e.vertex=e.vertex.replace("%distanceTableWidth",t+".")},this.updateMesh=function(e){if(void 0!==e.userData.cloud&&this.cloudPoints)for(var t=0;t<e.geometry.attributes.position.count;t++){const o=(new i.Vector4).fromArray(e.geometry.attributes.position.array,t*e.geometry.attributes.position.itemSize);this.cloudPoints.updateItem(e.userData.cloud.indexArray+t,Pt(e,o))}}};function _(o){void 0===u&&function(o){if(!d.display)return;const n=new i.CameraHelper(e);var s,p=0;function f(e){var t=n.pointMap[e],o=n.geometry.attributes.position;return(new i.Vector3).fromArray(o.array,t[0]*o.itemSize)}const h=f("n1"),g=f("n2"),y=f("n3"),_=f("f1"),x=f("f2"),S=f("f3");h.x=h.x*d.base/100,g.x=g.x*d.base/100,y.x=y.x*d.base/100,h.y=h.y*d.base/100,g.y=g.y*d.base/100,y.y=y.y*d.base/100,_.x=_.x*d.base/100,x.x=x.x*d.base/100,S.x=S.x*d.base/100,_.y=_.y*d.base/100,x.y=x.y*d.base/100,S.y=S.y*d.base/100,d.square&&(h.x/=e.aspect,g.x/=e.aspect,y.x/=e.aspect,_.x/=e.aspect,x.x/=e.aspect,S.x/=e.aspect);const T=h.x,C=g.x,E=y.x,A=h.y,P=g.y,O=y.y,k=h.z;h.x=h.x+(_.x-h.x)*d.near/100,g.x=g.x+(x.x-g.x)*d.near/100,y.x=y.x+(S.x-y.x)*d.near/100,h.y=h.y+(_.y-h.y)*d.near/100,g.y=g.y+(x.y-g.y)*d.near/100,y.y=y.y+(S.y-y.y)*d.near/100,h.z=g.z=y.z=h.z+(_.z-h.z)*d.near/100,_.x=_.x+(T-_.x)*d.far/100,x.x=x.x+(C-x.x)*d.far/100,S.x=S.x+(E-S.x)*d.far/100,_.y=_.y+(A-_.y)*d.far/100,x.y=x.y+(P-x.y)*d.far/100,S.y=S.y+(O-S.y)*d.far/100,_.z=x.z=S.z=_.z+(k-_.z)*d.far/100;const z=(new i.Vector3).copy(h),D=d.zCount,N=(_.z-h.z)/((D-1)*(D-1));var F=0;const M=d.yCount,L=M*(d.square?1:parseInt(e.aspect));var I=0;d.zCount=a.zCount,d.yCount=a.yCount;const R=parseInt(D*d.stereo.hide/100),j=R+D-1;function V(e){const t=(y.y-h.y)/(M-1),o=((S.y-_.y)/(M-1)-t)/((D-1)*(D-1))*e*e+t,n=parseInt(Math.sqrt(D)),r=o/(n+parseInt(Math.sqrt(D-n*n))),a=(g.x-h.x)/(L-1),l=((x.x-_.x)/(L-1)-a)/((D-1)*(D-1))*e*e+a,u=l/parseInt(Math.sqrt(D));z.y=-o*(M-1)/2,z.x=-l*(L-1)/2;for(var d=0;d<M;d++)for(var f=0;f<L;f++)if(e>=R){function m(t){c.push(0===f?0===d?{y:d,z:e}:{y:d}:f),s[p]=t.x,p++,s[p]=t.y,p++,s[p]=t.z,p++}m(new i.Vector3(z.x+l*f+u*F,z.y+o*d+r*I,z.z+N*e*e))}++F>=parseInt(Math.sqrt(D))&&(F=0,I++)}function B(e,t){if(!(e>t||(V(e),e>=t))){V(t);var o=parseInt((e+t)/2);o!==e&&(V(o),B(e+1,o-1),B(o+1,t-1))}}d.zCount=D,d.yCount=M,w(!0);const H=3;m.pointIndexes=function(e){if(void 0!==c){var t,o,n,i=c[e],r=e;return"object"==typeof i?(t=0,o=i.y,s(),n=i.z):(t=i,a(),o=i.y,s(),n=i.z),{x:t,y:o,z:n}}function a(){for(r--;r>=0&&"object"!=typeof c[r];)r--;i=c[r]}function s(){for(;r>=0&&void 0===i.z;)a()}console.error("_names = "+c)};const G=function(){if(document.currentScript&&""!==document.currentScript.src)return document.currentScript.src;const e=document.getElementsByTagName("script");return""!==e[e.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]},U=function(){const e=G();return e.substring(0,e.lastIndexOf("/"))};var X=U(),W=new i.Vector3(e.position.x,e.position.y,e.position.z),q=new i.Vector4(e.quaternion.x,e.quaternion.y,e.quaternion.z,e.quaternion.w);u=!1,new _o((function(){var e=new i.BufferGeometry;return s=new Float32Array((j-R+1)*L*M*H),p=0,c=null,c=[],B(R,j),e.setAttribute("position",new i.BufferAttribute(s,H)),e}),t,{options:r,pointsOptions:{name:"frustum points",shaderMaterial:d,boFrustumPoints:!0,position:e.position,scale:e.scale,rotation:e.rotation,opacity:!0,pointIndexes:function(e){return m.pointIndexes(e)},path:{vertex:X+"/frustumPoints/vertex.c"},pointName:function(e){var t=m.pointIndexes(e);return void 0===t?t:"x = "+t.x+", y = "+t.y+", z = "+(t.z+R)+", i = "+e},controllers:function(){l&&l.appendChild({xCount:L,yCount:M,zCount:D})},uniforms:function(t){return b.create(t),q.x=-q.x,q.y=-q.y,q.z=-q.z,W.applyQuaternion(q),t.cameraPositionDefault={value:W},t.cameraQuaternion={value:e.quaternion},new b.addUniforms(i.RGBAFormat,256,"palette",{onReady:function(e,t,o){r.scales.setW();const n=r.scales.w.min,i=r.scales.w.max,a=e.length/t;for(var s=0;s<a;s++)o(s,r.palette.toColor((i-n)*s/(a-1)+n,n,i))}}),b},onReady:function(e){(u=e).userData.isInfo=function(){return d.info},d.info&&r.raycaster&&r.raycaster.addParticle(u),d.display||w(),v=void 0===u?1:void 0===u.userData.shaderMaterial?d.point.opacity:u.userData.shaderMaterial.point.opacity,void 0!==o&&o(),m.update(),r.guiSelectPoint&&r.guiSelectPoint.addMesh(u)}}})}(o)}function x(){u&&(u.material.uniforms.cloudPoints.value.needsUpdate=!0)}function w(e){void 0!==u&&(!e&&r.guiSelectPoint&&r.guiSelectPoint.removeMesh(u),t.remove(u),o.renderLists.dispose(),Eo(u),u=void 0)}return b=new b,t.add(h),this.onChangeControls=function(){jo.notMoveFrustumPoints||m.update()},_(),this.update=function(t){_(t),function(){if(u){u.position.copy(e.position),u.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z);var t=e.position.distanceTo(p)/f;u.scale.x=t,u.scale.y=t,u.scale.z=t}}(),r.guiSelectPoint&&r.guiSelectPoint.setMesh();var o=new i.Vector4(e.quaternion.x,e.quaternion.y,e.quaternion.z,e.quaternion.w);u&&(u.material.uniforms.cameraPositionDefault.value.copy(e.position),o.x=-o.x,o.y=-o.y,o.z=-o.z,u.material.uniforms.cameraPositionDefault.value.applyQuaternion(o))},this.isDisplay=function(){return d.display},this.updateCloudPoints=function(){t.children.forEach((function(e){e.userData.cloud&&(4===e.geometry.attributes.position.itemSize?b.updateMesh(e):console.error("mesh.geometry.attributes.position.itemSize = "+e.geometry.attributes.position.itemSize))})),x()},this.updateCloudPoint=function(e){b.updateMesh(e),x()},this.updateCloudPointItem=function(e,t){void 0!==e.userData.cloud&&(4!==e.geometry.attributes.position.itemSize&&console.error("points.geometry.attributes.position.itemSize = "+e.geometry.attributes.position.itemSize),b.cloudPoints.updateItem(e.userData.cloud.indexArray+t,Pt(e,(new i.Vector4).fromArray(e.geometry.attributes.position.array,t*e.geometry.attributes.position.itemSize)),!0),x())},this.animate=function(){return!(!u||void 0===u.userData.shaderMaterial||v===u.userData.shaderMaterial.point.opacity)&&(v=u.userData.shaderMaterial.point.opacity,u.material.uniforms.opacity.value=u.userData.shaderMaterial.point.opacity,!0)},this.updateGuiSelectPoint=function(){const e=r.guiSelectPoint?r.guiSelectPoint.getMeshIndex(u):void 0;_(),e&&r.guiSelectPoint.setIndexMesh(e,u)},this.gui=function(e){const t=he.dat;if(!(e=e||r.dat.gui)||!1===r.dat.guiFrustumPoints)return;const o={frustumPoints:"Frustum Points",frustumPointsTitle:"A cloud of the fixed points in front of the camera for describe the properties of space.",display:"Display",displayTitle:"Display or hide Frustum Points.",info:"Information",infoTitle:"Display information about frustum point if user move mouse over or click this point.",stereo:"Stereo",stereoTitle:"Frustum Points setting for stereo mode of the canvas",hide:"Hide Nearby Points",hideTitle:"Hide the nearby to the camera points in percentage to all points for more comfortable visualisation.",opacity:"Opacity",opacityTitle:"Float in the range of 0.0 - 1.0 indicating how transparent the lines is. A value of 0.0 indicates fully transparent, 1.0 is fully opaque.",near:"Near Layer",nearTitle:"Shift of the frustum layer near to the camera in percents.",far:"Far Layer",farTitle:"Shift of the frustum layer far to the camera in percents.",base:"Scale",baseTitle:"Scale of the base of the frustum points in percents.",square:"Square Base",squareTitle:"Square base of the frustum points.",defaultButton:"Default",defaultTitle:"Restore default Frustum Points settings.",zCount:"Z Count",zCountTitle:"The count of layers of the frustum of the camera's field of view.",yCount:"Y Count",yCountTitle:"The count of vertical points for each z level of the\tfrustum of the camera's field of view."};switch(r.getLanguageCode()){case"ru":o.frustumPoints="Неподвижные точки",o.frustumPointsTitle="Облако точек перед камерой для описания свойств пространства",o.display="Показать",o.displayTitle="Показать или скрыть неподвижные точки.",o.info="Информация",o.infoTitle="Отображать информацию о неподвижной точке, если пользователь наведет курсор мыши или щелкнет эту точку.",o.stereo="Стерео",o.stereoTitle="Настройки неподвижных точек для стерео режима холста",o.hide="Близкие точки",o.hideTitle="Скрыть близкие к камере точки в процентах ко всем точкам для более удобной визуализации.",o.opacity="Непрозрачность",o.opacityTitle="Число в диапазоне 0.0 - 1.0, указывающее, насколько прозрачены линии. Значение 0.0 означает полностью прозрачный, 1.0 - полностью непрозрачный.",o.near="Ближний слой",o.nearTitle="Смещение ближайшего к камере слоя точек в процентах.",o.far="Дальний слой",o.farTitle="Смещение дальнего от камеры слоя точек в процентах.",o.base="Масштаб",o.baseTitle="Масштаб неподвижных точек в процентах.",o.square="Квадратное основание",o.squareTitle="Неподвиждые точки образуют пирамиду с квадратным основанием.",o.defaultButton="Восстановить",o.defaultTitle="Восстановить настройки неподвижных точек.",o.zCount="Z cлои",o.zCountTitle="Количество слоев усеченной пирамиды, образующей поле зрения камеры",o.yCount="Y точки",o.yCountTitle="Количество вертикальных точек в каждом слое усеченной пирамиды, образующей поле зрения камеры.";break;default:if(void 0===r.lang||r.lang.languageCode!=languageCode)break;Object.keys(r.lang).forEach((function(e){void 0!==o[e]&&(o[e]=r.lang[e])}))}function n(){g.setObject(y,d)}const i=e.addFolder(o.frustumPoints);function s(e){var t=e?"block":"none";v.display(t),T.__li.style.display=t,C.__li.style.display=t}t.folderNameAndTitle(i,o.frustumPoints,o.frustumPointsTitle);const l=i.add(d,"display").onChange((function(e){d.display?S():(r.raycaster&&r.raycaster.removeParticle(u),w()),s(d.display),n()}));t.controllerNameAndTitle(l,o.display,o.displayTitle);const c=r.raycaster?i.add(d,"info").onChange((function(e){void 0!==u?(d.info?r.raycaster&&r.raycaster.addParticle(u):(r.guiSelectPoint&&r.guiSelectPoint.selectPoint(-1),r.raycaster&&r.raycaster.removeParticle(u)),n()):n()})):void 0;c&&t.controllerNameAndTitle(c,o.info,o.infoTitle);const p=i.add(d,"near",0,100,1).onChange((function(e){S()}));t.controllerNameAndTitle(p,o.near,o.nearTitle);const f=i.add(d,"far",0,100,1).onChange((function(e){S()}));t.controllerNameAndTitle(f,o.far,o.farTitle);const m=i.add(d,"base",0,100,1).onChange((function(e){S()}));t.controllerNameAndTitle(m,o.base,o.baseTitle);const h=i.add(d,"square").onChange((function(e){S()}));t.controllerNameAndTitle(h,o.square,o.squareTitle);const v=new Ro(d.point,(function(e){void 0===e&&console.warn("under constraction"),e<0&&(e=0),u.material.uniforms.pointSize.value=e,v.size.setValue(e),d.point.size=e,n()}),new ao({dat:{gui:r.dat.gui}}),{folder:i,defaultPoint:{size:.01},PCOptions:{settings:{offset:.1},max:.1}});var b=!0,_=!0,x=this;function S(){if(!b||!_)return;_=!1;const e=r.guiSelectPoint?r.guiSelectPoint.getMeshIndex(u):void 0;r.raycaster&&r.raycaster.removeParticle(u),w(!0),x.update((function(){r.guiSelectPoint&&r.guiSelectPoint.setIndexMesh(e,u),n(),_=!0,u.userData.controllers()}))}const T=i.add(d,"zCount").min(3).step(1).onChange((function(e){S()}));t.controllerNameAndTitle(T,o.zCount,o.zCountTitle);const C=i.add(d,"yCount").min(3).step(1).onChange((function(e){S()}));t.controllerNameAndTitle(C,o.yCount,o.yCountTitle),t.controllerNameAndTitle(i.add({defaultF:function(e){b=!1,l.setValue(a.display),c&&c.setValue(a.info),p.setValue(a.near),f.setValue(a.far),m.setValue(a.base),h.setValue(a.square),v.size.setValue(a.point.size),T.setValue(a.zCount),C.setValue(a.yCount),b=!0,S(),n()}},"defaultF"),o.defaultButton,o.defaultTitle),s(d.display)},this},this.guiSelectPoint=function(){var e=null,t=null,o=null;l=this,this.create=function(n,i){const a=he.dat;function s(e){const t={notSelected:"Not selected"};if("ru"===i)t.notSelected="Не выбран";const o=n.add({Points:t.notSelected},"Points",{[t.notSelected]:-1}).onChange((function(e){const t=l.getSelectedIndex();null!==t?r.guiSelectPoint.select({object:u,index:t}):r.axesHelper&&r.axesHelper.exposePosition()}));return o.__select[0].selected=!0,a.controllerNameAndTitle(o,e),o}e=s("x"),t=s("y"),o=s("z")},this.appendChild=function(n){function i(e,t){e.domElement.querySelectorAll("select option").forEach((e=>{"-1"!=e.value&&e.remove()}));for(var o=0;o<t;o++){var n=document.createElement("option");n.innerHTML=o,e.__select.appendChild(n)}e.setValue(-1)}i(e,n.xCount),i(t,n.yCount),i(o,n.zCount)},this.pointIndexes=function(n){void 0!==n&&(parseInt(e.getValue())!==n.x&&e.setValue(n.x),parseInt(t.getValue())!==n.y&&t.setValue(n.y),parseInt(o.getValue())!==n.z&&o.setValue(n.z))},this.getSelectedIndex=function(){if(void 0===c)return console.warn("Сюда попадает во время отладки когда не задаю имени каждой точки или когда the cDisplay checkbox of the frustumPoints is not checked"),null;const n=parseInt(e.getValue()),i=parseInt(t.getValue()),r=parseInt(o.getValue());if(isNaN(n)||-1===n||isNaN(i)||-1===i||isNaN(r)||-1===r)return null;for(var a=0;a<c.length;a++){var s=c[a];if("object"==typeof s&&void 0!==s.z&&s.z===r)for(;a<c.length;a++)if("object"==typeof(s=c[a])&&s.y===i)for(;a<c.length;a++){if("object"==typeof(s=c[a])&&0===n&&s.y===i)return a;if(s===n)return a}}return console.error("FrustumPoints.selectPoint: not selected"),null},this.display=function(n){e.domElement.parentElement.parentElement.style.display=n,t.domElement.parentElement.parentElement.style.display=n,o.domElement.parentElement.parentElement.style.display=n},this.isDisplay=function(){return e.domElement.parentElement.parentElement.style.display===t.domElement.parentElement.parentElement.style.display&&e.domElement.parentElement.parentElement.style.display===o.domElement.parentElement.parentElement.style.display||console.error("cFrustumPointsF.isDisplay failed!"),"none"!==e.domElement.parentElement.parentElement.style.display}},this.gui=function(){console.warn("FrustumPoints.gui(): First, call FrustumPoints.pushArrayCloud(...) for push a points to the clouds array and call FrustumPoints.create(...).")},this.animate=function(){},this.updateGuiSelectPoint=function(){},this.isDisplay=function(){},this.onChangeControls=function(){},this.updateCloudPoints=function(){},this.updateCloudPoint=function(){},this.updateCloudPointItem=function(){}}}
/**
   * @module pointLight
   * @description A light that gets emitted from a single point in all directions.
   * @see [PointLight]{@link https://threejs.org/docs/index.html?q=pointLight#api/en/lights/PointLight}
   * 
   * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
   *
   * @copyright 2011 Data Arts Team, Google Creative Lab
   *
   * @license under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   */class Ho{constructor(e,t={}){const o=new ao(t.options);if(!1===o.pointLight)return this.add=function(){},void(this.controls=function(){});const n=he.dat,i=he.THREE,r={},a=2*o.scale,s=t.position||new i.Vector3,l=new i.PointLight(16777215,1);return l.position.copy(s),l.name="mathBoxLight",e.add(l),this.controls=function(t={}){const c=t.group||e,u=t.folder||o.dat.gui,d=t.folderName;if(void 0===u||!1===o.dat.pointLightGui)return;const p={light:"Light",displayLight:"Display",displayLightTitle:"Display or hide the light source.",defaultButton:"Default",restoreLightTitle:"Restore position of the light source"};switch(o.getLanguageCode()){case"ru":p.light="Свет",p.displayLight="Показать",p.displayLightTitle="Показать или скрыть источник света.",p.defaultButton="Восстановить",p.restoreLightTitle="Восстановить положение источника света";break;default:if(void 0===o.lang||o.lang.languageCode!=_languageCode)break;Object.keys(o.lang).forEach((function(e){void 0!==p[e]&&(p[e]=o.lang[e])}))}const f=o.scales,m=u.addFolder(d||p.light);var h;function g(e){const t=f[e];t&&(r[e]=m.add(l.position,e,t.min*a,t.max*a).onChange((function(t){if(void 0===h)return;const o=h.geometry.attributes.position.itemSize,n=(new i.Vector3).fromArray(h.geometry.attributes.position.array,0*o);n[e]=t,n.toArray(h.geometry.attributes.position.array,0*o),h.geometry.attributes.position.needsUpdate=!0})),n.controllerNameAndTitle(r[e],t.name))}n.controllerNameAndTitle(m.add({display:!1},"display").onChange((function(e){e?new _o(l.position,c,{pointsOptions:{onReady(e){h=e}}}):(c.remove(h),h=void 0)})),p.displayLight,p.displayLightTitle),g("x"),g("y"),g("z");var y={restore:function(){r.x.setValue(s.x),r.y.setValue(s.y),r.z.setValue(s.z)}};n.controllerNameAndTitle(m.add(y,"restore"),p.defaultButton,p.restoreLightTitle)},this}}
/**
  * @module MyThree
  * @description I use MyThree in my projects for displaying of my 3D objects in the canvas.
  * @copyright 2011 Data Arts Team, Google Creative Lab
  *
  * @license under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  */void 0!==zo&&(he.dat=zo);const Go=new function(){const e=[];this.push=function(t){e.push(t)},this.display=function(t,o){e.forEach((function(e){e.style.display=e!==t&&o?"none":"block"}))},Object.defineProperties(this,{length:{get:function(){return e.length}}})};var Uo=[];class Xo{constructor(e,t){t=t||{};const o=he.THREE;var n,i,r,a;if(Uo.push({createXDobjects:e,options:t}),Uo.length>1)return;var s=void 0===t.elContainer?document.getElementById("containerDSE"):"string"==typeof t.elContainer?document.getElementById(t.elContainer):t.elContainer;if(null===s&&("string"==typeof t.elContainer&&console.warn("The "+t.elContainer+" element was not detected."),s=document.createElement("div"),document.querySelector("body").appendChild(s)),Go.push(s),!s.querySelector("canvas")){s.innerHTML="";const e=document.createElement("div");e.className="container",e.appendChild(document.createElement("canvas")),s.appendChild(e),s=e}if(he.dat&&!1!==t.dat&&(t.dat=t.dat||{},t.dat.parent=s),t.title){const e=document.createElement("div");e.style.position="absolute",e.style.top="0px",e.style.color="white",e.style.padding="3px",e.innerHTML=t.title,s.appendChild(e)}(t=new ao(t)).saveMeshDefault=function(e){e.userData.default||(e.userData.default={}),e.userData.default.scale=new o.Vector3,e.userData.default.scale.copy(e.scale),e.userData.default.position=new o.Vector3,e.userData.default.position.copy(e.position),e.userData.default.rotation=new o.Euler,e.userData.default.rotation.copy(e.rotation)};const l={};var c,u,d,p,f,m,h;new o.Vector2,(a=s.querySelector("canvas"))||(a=document.createElement("canvas"),s.appendChild(a));const g=s.querySelector("img");function y(){(n=new o.PerspectiveCamera(t.camera.fov||70,t.camera.aspect||window.innerWidth/window.innerHeight,t.camera.near||.01,t.camera.far||10)).position.copy(t.camera.position),n.scale.copy(t.camera.scale),t.camera=n,t.point.sizePointsMaterial=100,t.cameraTarget&&(t.cameraTarget.camera=n,t.playerOptions.cameraTarget.init(t.cameraTarget,t)),(r=new o.Scene).background=new o.Color(0),r.fog=new o.Fog(0,250,1400),r.userData.optionsSpriteText={textHeight:.04},i=new o.Group,r.add(i);const p=new Bo(n,i,a,{options:t}).gl;(c=new o.WebGLRenderer({antialias:!0,canvas:a,context:p})).setSize(window.innerWidth,window.innerHeight),t.renderer=c,t.cursor=c.domElement.style.cursor,!1!==t.stereoEffect&&(t.stereoEffect=t.stereoEffect||{},t.stereoEffect.rememberSize=!0),new Qt(c,t),t.eventListeners=new ao.raycaster.EventListeners(n,c,{options:t,scene:r}),new Ho(r,{options:t,position:t.pointLight&&t.pointLight.pointLight1&&t.pointLight.pointLight1.position?t.pointLight.pointLight1.position:new o.Vector3(2*t.scale,2*t.scale,2*t.scale)});const f=new Ho(r,{options:t,position:t.pointLight&&t.pointLight.pointLight2&&t.pointLight.pointLight2.position?t.pointLight.pointLight2.position:new o.Vector3(-2*t.scale,-2*t.scale,-2*t.scale)});t.dat.gui&&("undefined"!=typeof WebGLDebugUtils&&t.dat.gui.add({loseContext:function(e){a.loseContext()}},"loseContext"),void 0!==t.dat.gui.__closeButton.click&&t.dat.gui.__closeButton.click()),new fo(i,{onSelectScene:function(e,o){return t.boPlayer=!0,void 0!==t.frustumPoints&&t.frustumPoints.updateCloudPoints(),void 0!==t.onSelectScene&&t.onSelectScene(e,o)},options:t,cameraTarget:{camera:n},onChangeScaleT:function(e){void 0!==t.player&&t.player.onChangeScale(e),i.children.forEach((function(e){void 0!==e.userData.player&&void 0!==e.userData.player.arrayFuncs&&"function"!=typeof e.userData.player.arrayFuncs&&e.userData.player.arrayFuncs.forEach((function(e){void 0!==e.line&&(e.line.remove(),e.line=new fo.traceLine(t))}))}))}}),t.player&&new t.player.PlayController,t.dat.gui&&((u=t.dat.gui.addFolder(Wo.settings)).id="fOptions",t.player&&t.player.gui(u)),u&&Oo(r,t,{folder:u,options:{textHeight:.05,fov:n.fov}}),t.stereoEffect&&t.stereoEffect.gui({folder:u,onChangeMode:function(e){switch(e){case Qt.spatialMultiplexsIndexs.Mono:case Qt.spatialMultiplexsIndexs.SbS:case Qt.spatialMultiplexsIndexs.TaB:break;default:return void console.error("myThreejs: Invalid spatialMultiplexIndex = "+e)}void 0!==t.frustumPoints&&t.frustumPoints.updateGuiSelectPoint()}}),d=function(){c.domElement.style.position,c.domElement.style.left,c.domElement.style.top,c.domElement.style.width,c.domElement.style.height;var e=new o.Vector2;return c.getSize(e),{onFullScreenToggle:function(e){Go.display(s.parentElement,!e)}}}(),c.setSize(void 0!==t.canvas&&void 0!==t.canvas.width?t.canvas.width:a.clientWidth,void 0!==t.canvas&&void 0!==t.canvas.height?t.canvas.height:a.clientHeight),new Co(c,{fullScreen:{fullScreen:t.canvas.fullScreen,camera:n,arrayContainersLength:function(){return Go.length},onFullScreenToggle:function(e){d.onFullScreenToggle(e),function e(n,i){setTimeout((function(){!function n(r){r.forEach((function(r){n(r.children),r instanceof o.Group?e(r,i):void 0!==r.userData.player&&void 0!==r.userData.player.arrayFuncs&&"function"!=typeof r.userData.player.arrayFuncs&&r.userData.player.arrayFuncs.forEach((function(e){e.controllers&&e.controllers.w&&e.controllers.w.position&&e.controllers.w.position.elSlider&&(e.controllers.w.position.elSlider.style.display=i?"block":"none"),void 0!==e.line&&(e.line.remove(),e.line=new fo.traceLine(t))}))}))}(n.children)}),0)}(r,e)}},options:t}),t.createOrbitControls(n,c,r),u&&(new Mo(t,{cameraTarget:{camera:n,orbitControls:t.orbitControls},pointsControls:function(e,t,o){},pointControls:function(e,t,o){}}),t.guiSelectPoint&&t.guiSelectPoint.add()),l.size=t.point.size;const h=t.dat?t.dat.getCookieName("Point"):"Point";if(t.dat&&t.dat.cookie.getObject(h,t.point,t.point),he.group=i,e&&e(i,t),new Ao(r,t),t.frustumPoints&&t.frustumPoints.create(c),t.player||fo.selectPlayScene(i,{options:t}),t.boPlayer=!1,i.children.forEach((function(e){t.saveMeshDefault(e)})),t.dat.gui){!function(e,t){if(!e.boOptions)return void console.error("AxesHelperGui: call options = new Options( options ) first");if(!(t=t||e.dat.gui)||!1===e.dat||!1===e.dat.axesHelperGui)return;if(!1===e.axesHelper)return;if(!e.axesHelper)return void console.error("AxesHelperGui: create AxesHelper instance first");const o=he.THREE,n=he.dat,i=JSON.parse(JSON.stringify(e.scales)),r=e.axesHelper.getGroup();i.posAxesIntersection=(new o.Vector3).copy(e.scales.posAxesIntersection),Object.freeze(i);const a={axesHelper:"Axes Helper",scales:"Scales",displayScales:"Display",displayScalesTitle:"Display or hide axes scales.",precision:"Precision",precisionTitle:"Formats a number to a specified length.",min:"Min",max:"Max",marks:"Marks",marksTitle:"Number of scale marks",axesIntersection:"Axes Intersection",defaultButton:"Default",defaultTitle:"Restore default Axes Helper settings.",defaultAxesIntersectionTitle:"Restore default axes intersection."};switch((e=e||{}).getLanguageCode()){case"ru":a.axesHelper="Оси координат",a.scales="Шкалы",a.displayScales="Показать",a.displayScalesTitle="Показать или скрыть шкалы осей координат.",a.precision="Точность",a.precisionTitle="Ограничить количество цифр в числе.",a.min="Минимум",a.max="Максимум",a.marks="Риски",a.marksTitle="Количество отметок на шкале",a.axesIntersection="Начало координат",a.defaultButton="Восстановить",a.defaultTitle="Восстановить настройки осей координат по умолчанию.",a.defaultAxesIntersectionTitle="Восстановить начало координат по умолчанию.";break;default:if(void 0===e.lang||e.lang.languageCode!=languageCode)break;Object.keys(e.lang).forEach((function(t){void 0!==a[t]&&(a[t]=e.lang[t])}))}const s=e.dat.cookie,l=e.dat.getCookieName("AxesHelper");function c(){s.setObject(l,e.scales)}s.getObject(l,e.scales,e.scales);const u=t.addFolder(a.axesHelper),d=u.addFolder(a.scales),p=d.add(e.scales,"display").onChange((function(e){r.children.forEach((function(t){t.children.forEach((function(t){t.visible=e}))})),x(),c()}));var f;n.controllerNameAndTitle(p,a.displayScales,a.displayScalesTitle),void 0!==e.scales.text.precision&&(f=d.add(e.scales.text,"precision",2,17,1).onChange((function(e){!function e(t){t.children.forEach((function(t){t instanceof o.Sprite?void 0!==t.userData.updatePrecision&&t.userData.updatePrecision():(t instanceof o.Group||t instanceof o.Line)&&e(t)}))}(r),c()})),n.controllerNameAndTitle(f,a.precision,a.precisionTitle));const m=void 0===Oo?void 0:Oo(r,{dat:{gui:e.dat.gui,cookieName:"AxesHelper_"+e.dat.getCookieName()}},{parentFolder:d}),h=u.addFolder(a.axesIntersection),g={x:{},y:{},z:{}};function y(t){const o=e.scales[t];if(!o.isAxis())return;const i=g[t];i.controller=h.add({value:e.scales.posAxesIntersection[t]},"value",o.min,o.max,(o.max-o.min)/100).onChange((function(o){e.scales.posAxesIntersection[t]=o,e.axesHelper.updateAxes(),c()})),n.controllerNameAndTitle(i.controller,o.name)}y("x"),y("y"),y("z");var v={defaultF:function(e){g.x.controller.setValue(i.posAxesIntersection.x),g.y.controller.setValue(i.posAxesIntersection.y),g.z.controller.setValue(i.posAxesIntersection.z)}};function b(t){const o=e.scales[t];if(void 0===o)return;const s=_[t],l=i[t];function d(){r.children.forEach((function(o){o.userData.axisName===t&&(r.remove(o),e.axesHelper.createAxis(t))}))}function p(){d(),c()}function f(e,t){var n=e.controller.getValue();o.min=t(o.min,n),s.min.setValue(o.min),o.max=t(o.max,n),s.max.setValue(o.max),p()}Object.freeze(l),s.updateAxis=d,s.onchangeWindowRange=p,s.folder=u.addFolder(o.name),s.scaleController=s.folder.add(new ge(f,{settings:o,getLanguageCode:e.getLanguageCode})).onChange((function(e){o.zoomMultiplier=e,c()}));var m=new ye((function(e){f(m,(function(t,o){return t+e}))}),{settings:o,getLanguageCode:e.getLanguageCode});s.positionController=s.folder.add(m).onChange((function(e){o.offset=e,c()})),s.min=n.controllerZeroStep(s.folder,o,"min",(function(e){p()})),n.controllerNameAndTitle(s.min,a.min),s.max=n.controllerZeroStep(s.folder,o,"max",(function(e){p()})),n.controllerNameAndTitle(s.max,a.max),void 0!==o.marks&&(s.marks=n.controllerZeroStep(s.folder,o,"marks",(function(e){p()})),n.controllerNameAndTitle(s.marks,void 0===o.marksName?a.marks:o.marksName,void 0===o.marksTitle?a.marksTitle:o.marksTitle)),s.defaultButton=s.folder.add({defaultF:function(e){o.min=l.min,s.min.setValue(o.min),o.max=l.max,s.max.setValue(o.max),o.zoomMultiplier=l.zoomMultiplier,s.scaleController.setValue(o.zoomMultiplier),o.offset=l.offset,s.positionController.setValue(o.offset),void 0!==l.marks&&(o.marks=l.marks,s.marks.setValue(o.marks)),p()}},"defaultF"),n.controllerNameAndTitle(s.defaultButton,a.defaultButton,a.defaultTitle)}n.controllerNameAndTitle(h.add(v,"defaultF"),a.defaultButton,a.defaultAxesIntersectionTitle),u.add(new ge((function(t,o){!function(t,o){function n(e,n){void 0!==e&&(e.min=o(e.min,t),n.min.setValue(e.min),e.max=o(e.max,t),n.max.setValue(e.max),n.onchangeWindowRange())}n(e.scales.x,_.x),n(e.scales.y,_.y),n(e.scales.z,_.z)}(t.controller.getValue(),o)}),{settings:{zoomMultiplier:1.1},getLanguageCode:e.getLanguageCode})).onChange((function(e){console.warn("ScaleController.onChange")}));const _={x:{},y:{},z:{}};function x(){var t=e.scales.display?"block":"none";void 0!==m&&(m.domElement.style.display=t),void 0!==f&&(f.domElement.parentElement.parentElement.style.display=t)}b("x"),b("y"),b("z"),v={defaultF:function(e){function t(e){_[e].defaultButton&&_[e].defaultButton.object.defaultF()}p.setValue(i.display),void 0!==f&&f.setValue(i.text.precision),m.userData.restore(),t("x"),t("y"),t("z")}},n.controllerNameAndTitle(u.add(v,"defaultF"),a.defaultButton,a.defaultTitle),x(),_.x.updateAxis&&_.x.updateAxis(),_.y.updateAxis&&_.y.updateAxis(),_.z.updateAxis&&_.z.updateAxis()}(t,u),new Lo(i,t,{folder:u}),!1!==t.orbitControls&&new ko(t,u),new Io(n,t,u),f.controls({group:i,folder:u,folderName:Wo.light+" 2"});const e=new Ro(t.point,(function(o){void 0===o&&(o=t.point.size),o<0&&(o=0),i.children.forEach((function(e){"Points"!==e.type||e.userData.boFrustumPoints||(void 0===e.material.uniforms?e.material.size=o/t.point.sizePointsMaterial:e.material.uniforms.pointSize.value=o)})),e.size.setValue(o),t.point.size=o,t.dat.cookie.setObject(h,t.point)}),t,{folder:u,defaultPoint:l});t.frustumPoints&&t.frustumPoints.gui(u),t.restoreSceneController(n,r)}if(void 0!==t.stats)try{m=new Stats,s.appendChild(m.dom)}catch(e){console.error(e+". Please import Stats from '../../../three.js/dev/examples/jsm/libs/stats.module.js';")}window.addEventListener("resize",v,!1)}function v(){var e;(t.canvasMenu?t.canvasMenu.isFullScreen():!t.canvas||!1!==t.canvas.fullScreen)?e=new o.Vector2(window.innerWidth,window.innerHeight):(e=new o.Vector2,c.getSize(e)),n.aspect=e.x/e.y,n.updateProjectionMatrix(),c.setSize(e.x,e.y),void 0!==t.frustumPoints&&t.frustumPoints.update()}function b(){void 0!==m&&m.begin(),h=requestAnimationFrame(b),function(){t.stereoEffect&&t.stereoEffect.render?t.stereoEffect.render(r,n):c.render(r,n);void 0===p&&(p=new o.Vector3);void 0===f&&(f=t.point.size);(!p.equals(n.position)||f!=t.point.size||void 0!==t.frustumPoints&&t.frustumPoints.animate())&&(p.copy(n.position),f=t.point.size,i.children.forEach((function(e){if(e instanceof o.Points!=!1)if(void 0!==e.geometry.attributes.size){void 0!==t.point.opacity&&(e.material.uniforms.opacity.value=t.point.opacity);var i=myPoints.getGlobalScale(e),r=new o.Vector3(n.position.x/i.x,n.position.y/i.y,n.position.z/i.z);i=(i.x+i.y+i.z)/3;for(var a=0;a<e.geometry.attributes.position.count;a++){var s=Ot(e,a),l=new o.Vector3(s.x,s.y,s.z).distanceTo(r),c=1;e.geometry.attributes.size.setX(a,Math.tan(void 0!==e.userData.shaderMaterial.point&&void 0!==e.userData.shaderMaterial.point.size?e.userData.shaderMaterial.point.size:t.point.size)*l*i*c),e.geometry.attributes.size.needsUpdate=!0}}else e.material.size=f/t.point.sizePointsMaterial})))}(),void 0!==m&&m.end()}g&&s.removeChild(g),"undefined"!=typeof WebGLDebugUtils&&(a=WebGLDebugUtils.makeLostContextSimulatingCanvas(a)),a.addEventListener("webglcontextlost",(function(e){e.preventDefault(),void 0!==h?window.cancelAnimationFrame(h):console.error("myThreejs.create.onloadScripts: requestId = "+h),clearThree(r),d.onFullScreenToggle(!0),alert(Wo.webglcontextlost)}),!1),a.addEventListener("webglcontextrestored",(function(){console.warn("webglcontextrestored"),y(),b()}),!1),y(),b(),this.setSize=function(e,t){if("object"==typeof e&&(t=e.height,e=e.width),void 0!==e)c.setSize(e,t);else{const e={set:function(e,t){c.setSize(e,t)}};c.getSize(e)}},Uo.shift();var _=Uo.shift();void 0!==_&&this.create(_.createXDobjects,_.options)}}Xo.release="v1.3";const Wo={defaultButton:"Default",settings:"Settings",webglcontextlost:"The user agent has detected that the drawing buffer associated with a WebGLRenderingContext object has been lost.",light:"Light",opacity:"Opacity"};if("ru"===Yt())Wo.defaultButton="Восстановить",Wo.name="Имя",Wo.settings="Настройки",Wo.webglcontextlost="Пользовательский агент обнаружил, что буфер рисунка, связанный с объектом WebGLRenderingContext, потерян.",Wo.light="Свет",Wo.opacity="Непрозрачность";return Xo.MyPoints=_o,Xo.StereoEffect={spatialMultiplexsIndexs:Qt.spatialMultiplexsIndexs},Xo.ColorPicker=Vt,Xo.getWorldPosition=Pt,Xo.limitAngles=function(e){function t(t){for(;e[t]>2*Math.PI;)e[t]-=2*Math.PI}t("x"),t("y"),t("z")},Xo.Player=fo,Xo.three=he,Xo.Options=ao,window.__myThree__=window.__myThree__||{},window.__myThree__.boMyThree&&console.error("myThree: duplicate myThree. Please use one instance of the myThree class."),window.__myThree__.boMyThree=!0,Xo}));
