/**
 * ColorPicker - pure JavaScript color picker.
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.ColorPicker={})}(this,function(e){"use strict";
/**
 * node.js version of the synchronous download of the file.
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function o(t){if(this.loadXMLDoc=function(){var e;if(window.XMLHttpRequest){if(!(e=new XMLHttpRequest))throw"new XMLHttpRequest() failed!"}else{if(!window.ActiveXObject)throw"myRequest.loadXMLDoc(...) failed!";if(!(e=this.NewActiveXObject()))throw"NewActiveXObject() failed!"}return e},this.NewActiveXObject=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}return a('This browser does not support XMLHttpRequest. Probably, your security settings do not allow Web sites to use ActiveX controls installed on your computer. Refresh your Web page to find out the current status of your Web page or enable the "Initialize and script ActiveX controls not marked as safe" and "Run Active X controls and plug-ins" of the Security settings of the Internet zone of your browser.'),null},this.XMLHttpRequestStart=function(e,t){this.XMLHttpRequestStop(),this.req.onreadystatechange=e,"onerror"in this.req&&(this.req.onerror=function(e){a("XMLHttpRequest error. url: "+this.url)}),this.XMLHttpRequestReStart(t)},this.getUrl=function(){return void 0!==this.url&&null!=this.url||(this.url="XMLHttpRequest.xml"),this.url+(this.params||"")},this.XMLHttpRequestReStart=function(e){try{void 0===e&&(e=!0),this.req.open("GET",this.getUrl(),e),e&&("timeout"in this.req&&(this.req.timeout=9e4),"ontimeout"in this.req?this.req.ontimeout=function(){a("XMLHttpRequest timeout")}:(clearTimeout(this.timeout_id_SendReq),this.timeout_id_SendReq=setTimeout(function(){a("XMLHttpRequest timeout 2")},9e4))),this.req.send(null)}catch(e){a(e.message+" url: "+this.url)}},this.XMLHttpRequestStop=function(){null!=this.req&&this.req.abort()},this.ProcessReqChange=function(e){var t=this.req;switch(t.readyState){case 4:if("unknown"==typeof t.status)return consoleError('typeof XMLHttpRequest status == "unknown"'),!0;if(200==t.status)return clearTimeout(this.timeout_id_SendReq),e(this);a("Invalid XMLHttpRequest status : "+t.status+" url: "+this.url);break;case 1:case 2:case 3:break;case 0:default:throw"processReqChange(); req.readyState = "+t.readyState}return!0},this.processStatus200Error=function(){var e=this.GetElementText("error",!0);return!!e&&(a(e),!0)},this.GetElementText=function(e,t){var r=this.req;if(!r.responseXML)return 1!=t&&a("GetXMLElementText(xmlhttp, "+e+"); xmlhttp.responseXML is null.\nxmlhttp.responseText:\n"+r.responseText),null;var n=r.responseXML.getElementsByTagName(e);if(0==n.length)return 1!=t&&a('GetXMLElementText(xmlhttp, "'+e+'"); element.length == '+n.length),"";for(var o="",i=0;i<n.length;i++)if(void 0===n[i].textContent){if(void 0===n[i].text)return a("GetXMLElementText(xmlhttp, "+e+"); element["+i+"].text) == undefined"),"";""!=o&&(o+=" "),o+=n[i].text}else o+=n[i].textContent;return o},t.data)this.req=t.data.req,this.url=t.data.url,this.params=t.data.params;else try{this.req=this.loadXMLDoc()}catch(e){var r=void 0===e.message?e:e.message;return void a("Your browser is too old and is not compatible with our site.\n\n"+window.navigator.appName+" "+window.navigator.appVersion+"\n\n"+r)}function a(e){console.error(e),t.onerror(e)}this.req||consoleError("Invalid myRequest.req: "+this.req)}function a(t,r){(r=r||{}).onload=r.onload||function(){},r.onerror=r.onerror||function(){};var n,e=new o(r);return e.url=t,e.XMLHttpRequestStart(function(){e.ProcessReqChange(function(e){e.processStatus200Error()||(n=e.req.responseText,r.onload(n,t))})},!1),n}
/**
 * node.js version of the load JavaScript file
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * Thanks to:
 *http://javascript.ru/forum/events/21439-dinamicheskaya-zagruzka-skriptov.html
 *https://learn.javascript.ru/onload-onerror
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function s(e,t){if(t.tag=t.tag||{},"string"==typeof t.tag){if("style"!==t.tag)return void console.error("Invalid options.tag: "+t.tag);t.tag={name:"style",attribute:{name:"rel",value:"stylesheet"}}}t.tag.name=t.tag.name||"script";var r=document.createElement(t.tag.name);t.tag.attribute=t.tag.attribute||{},t.tag.attribute.name=t.tag.attribute.name||"type",t.tag.attribute.value=t.tag.attribute.value||"text/javascript",r.setAttribute(t.tag.attribute.name,t.tag.attribute.value),e(r),t.appendTo.appendChild(r)}function c(e,t){for(var r=e.querySelectorAll("script"),n=0;n<r.length;n++)if(r[n].id===t)return 1}var t,r={sync:function(t,r){if((r=r||{}).onload=r.onload||function(){},r.onerror=r.onerror||function(){},r.appendTo=r.appendTo||document.getElementsByTagName("head")[0],c(r.appendTo,t))r.onload();else if(t instanceof Array){for(var n,o={appendTo:r.appendTo,tag:r.tag,onload:function(e,t){console.log("loadScript.sync.onload: "+t)},onerror:function(e){r.onerror(e),n=e}},e=0;e<t.length;e++){var i=t[e];if(s(function(e){e.setAttribute("id",i),e.innerHTML=a(i,o)},o),void 0!==n)break}void 0===n&&r.onload()}else s(function(e){e.setAttribute("id",t),e.innerHTML=a(t,r)},r)},async:function(e,n){var o;function i(t){function r(){e instanceof Array&&o<e.length-1?i(e[++o]):n.onload()}c(n.appendTo,t,n.onload)?r():s(function(e){e.setAttribute("id",t),e.readyState&&!e.onload?e.onreadystatechange=function(){"complete"==e.readyState&&void 0!==n.onload&&n.onload(),"loaded"==e.readyState&&(setTimeout(n.onload,0),this.onreadystatechange=null)}:(e.onload=function(){console.log("loadScript.async.onload() "+t),void 0!==n.onload&&r()},e.onerror=function(e){var t='loadScript: "'+this.src+'" failed';void 0!==n.onerror&&n.onerror(t,e),console.error(t)}),e.src=t},n)}(n=n||{}).appendTo=n.appendTo||document.getElementsByTagName("head")[0],n.onload=n.onload||function(){},e instanceof Array?i(e[o=0]):i(e)}},n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=(t=function(){if(document.currentScript&&""!==document.currentScript.src)return document.currentScript.src;var e=document.getElementsByTagName("script");return""!==e[e.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]}()).substring(0,t.lastIndexOf("/"));r.sync(i+"/colorpicker.css",{tag:"style"});var v=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",l="http://www.w3.org/2000/svg",y=0,u={BGRW:0,monochrome:1,bidirectional:2,rainbow:3};function g(e,t,r){for(var n in e=document.createElementNS(l,e),t)e.setAttribute(n,t[n]);"[object Array]"!=Object.prototype.toString.call(r)&&(r=[r]);for(var o=0,i=r[0]&&r.length||0;o<i;o++)e.appendChild(r[o]);return e}var d,h=!1;function m(p){function e(e,t,r,n){return{percent:e,r:t,g:r,b:n}}if((p=p||{}).duplicate||!h){void 0===p.palette&&(p.palette=u.BGRW);var f=[new e(0,0,0,255),new e(33,0,255,0),new e(66,255,255,0),new e(100,255,255,255)];switch(n(p.palette)){case"number":switch(p.palette){case u.BGRW:break;case u.monochrome:f=[new e(0,0,0,0),new e(100,255,255,255)];break;case u.bidirectional:f=[new e(0,255,48,48),new e(50,48,48,48),new e(100,48,255,48)];break;case u.rainbow:f=[new e(0,255,50,50),new e(16,252,245,40),new e(32,40,252,40),new e(50,40,252,248),new e(66,39,46,249),new e(82,255,40,251),new e(100,255,50,50)];break;default:console.error("ColorPicker.create.Palette: invalid options.palette = "+p.palette)}break;case"object":if(Array.isArray(p.palette)){f=p.palette;break}default:var t="invalid options.palette = "+p.palette;console.error("ColorPicker.create.Palette: "+t),p.onError(t)}this.getPalette=function(){var t=[];return f.forEach(function(e){t.unshift(g("stop",{offset:100-e.percent+"%","stop-color":"#"+("0"+Number(e.r).toString(16)).slice(-2).toUpperCase()+("0"+Number(e.g).toString(16)).slice(-2).toUpperCase()+("0"+Number(e.b).toString(16)).slice(-2).toUpperCase(),"stop-opacity":"1"}))}),t},this.hsv2rgb=function(e,t,r){var o=parseFloat(e);void 0!==t&&void 0!==r&&(o=100/(r-t)*(o-t));var n,i,a=f[f.length-1];100!==a.percent&&(n={},Object.keys(a).forEach(function(e){n[e]=a[e]}),n.percent=100,f.push(n));for(var s=0;s<f.length;s++){var c=f[s];if(void 0===i&&(i=c),o>=i.percent&&o<=c.percent){var l=function(e,t,r,n){r-=e;return 0==r?t:Math.round(t+(n-t)/r*(o-e))},u=l(i.percent,i.r,c.percent,c.r),d=l(i.percent,i.g,c.percent,c.g),l=l(i.percent,i.b,c.percent,c.b);return{r:u,g:d,b:l,hex:"#"+(16777216|l|d<<8|u<<16).toString(16).slice(1),percent:o}}i=c}void 0!==p.onError&&p.onError("Invalid color value of the ColorPicker: "+e)},this.toColor=function(e,t,r){if(void 0!==d){if(e instanceof d.Color)return e;r=this.hsv2rgb(e,t,r);return void 0===r&&(r={r:255,g:255,b:255}),new d.Color("rgb("+r.r+", "+r.g+", "+r.b+")")}console.error("Call ColorPicker.palette.setTHREE(THREE) first.")},h=!0}else console.warn("Palette: duplicate palette")}m.setTHREE=function(e){d?Object.is(d,e)||console.error("Palette.setTHREE: duplicate THREE. Please use one instance of the THREE library."):d=e},e.paletteIndexes=u,e.create=function(e,o){function i(){return"horizontal"===o.orientation}if((o=o||{}).orientation=o.orientation||"horizontal",void 0===o.direction&&(o.direction=!0),o.style=o.style||{},o.style.width=o.style.width||(i()?200:30),o.style.height=o.style.height||(i()?30:200),o.onError=o.onError||function(){},e instanceof HTMLElement!=!0){if("string"!=typeof e)return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e);if(null===(e=document.getElementById(e)))return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e)}for(var t in e.classList.add("slider-wrapper"),o.style)e.style[t]=o.style[t];var n,r,a,s,c,l=o.palette instanceof m?o.palette:new m(o);function u(){return"string"==typeof o.style.height?parseInt(o.style.height):o.style.height}function d(){return f.clientWidth}function p(e,t){var r;void 0!==n?void 0!==(r=l.hsv2rgb(e))?(e=r.percent,void 0===t&&(t=i()?d()*e/100:u()-u()*(o.direction?e:100-e)/100),function(e){if(void 0===n)return;i()?e<0||e>d()?console.error("ColorPicker.positionIndicators: Invalid position = "+e):(n.style.top="0px",n.style.left=(o.direction?e:d()-e)-n.offsetWidth/2+"px"):e<0||e>u()?console.error("ColorPicker.positionIndicators: Invalid position = "+e):(n.style.left="0px",n.style.top=e-n.offsetHeight/2+"px")}(t),void 0!==o.sliderIndicator.callback&&o.sliderIndicator.callback(r)):console.error("ColorPicker.setValue: invalud c = "+r):console.error("Set value of this instance of the ColorPicker is impossible because options.sliderIndicator is not defined.")}if(void 0!==o.sliderIndicator&&((n=document.createElement("div")).className="slider-indicator",i()?n.style.width="10px":n.style.height="10px",e.appendChild(n),n.style.pointerEvents="none"),"SVG"==v){try{var f=g("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:i()?"100%":o.style.width,height:o.style.height},[g("defs",{},g("linearGradient",{id:"gradient-hsv-"+y,x1:i()&&o.direction?"100%":"0%",y1:i()||o.direction?"0%":"100%",x2:i()&&!o.direction?"100%":"0%",y2:!i()&&o.direction?"100%":"0%"},l.getPalette())),g("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv-"+y+")"})]);void 0!==n&&(f.style.cursor=i()?"e-resize":"s-resize",n.style.cursor=f.style.cursor)}catch(e){console.error("Create SVG element failed! "+e.message)}e.appendChild(f),e.style.height=u()+"px",void 0!==n&&(i()?n.style.height=parseInt(o.style.height)-2+"px":n.style.width=parseInt(o.style.width)-2+"px",o.sliderIndicator.value=o.sliderIndicator.value||0,p(o.sliderIndicator.value)),y++}else console.error("Under constraction");function h(e){var t,r,n;e.x=parseInt(e.x),e.y=parseInt(e.y),i()?(t=e.x,r=d()-1,t>=d()&&(t=r),n=100*t/r,o.direction||(n=100-n,t=r-t)):(t=e.y,r=u()-1,t>=u()&&(t=r),n=100*(1-t/r),o.direction||(n=100-n)),p(n,t)}return void 0!==n&&(r=function(){return function(e){c||h(function(e){if(window.event&&void 0!==window.event.contentOverflow)return{x:window.event.offsetX,y:window.event.offsetY};if(void 0!==e.offsetX&&void 0!==e.offsetY)return{x:e.offsetX,y:e.offsetY};var t=e.target.parentNode.parentNode;return{x:e.layerX-t.offsetLeft,y:e.layerY-t.offsetTop}}(e=e||window.event))}},c=!(s=function(e,o){var t=f;a(t,"touchstart",function(e){}),a(t,"touchmove",function(e){e.preventDefault();var t=e.srcElement.getBoundingClientRect(),r=e.touches[0].clientX-t.left,t=e.touches[0].clientY-t.top;r<0&&(r=0),t<0&&(t=0),h({x:r,y:t})}),a(t,"touchend",function(e){}),a(t,"mousedown",function(e){var r="mouseup",n="mousemove";a(window,r,function e(){function t(e,t,r){null!==e&&(e.detachEvent?e.detachEvent("on"+t,r):e.removeEventListener&&e.removeEventListener(t,r,!1))}t(window,r,e),t(window,n,o)}),a(window,n,o)}),a(t,"mouseout",function(e){c=!0}),a(t,"mouseover",function(e){c=!1})}),(a=function(e,t,r){null!==e&&(e.attachEvent?e.attachEvent("on"+t,r):e.addEventListener&&e.addEventListener(t,r,!1))})(f,"click",r()),s(0,r())),{setValue:p}},e.Palette=m,Object.defineProperty(e,"__esModule",{value:!0})});
