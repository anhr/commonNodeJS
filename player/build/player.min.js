/**
 * @module Player
 * @description 3D objects animation.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.player={})}(this,function(e){"use strict";var x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},b=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t};function t(e,t){var n=e.__state.conversionName.toString(),o=Math.round(e.r),i=Math.round(e.g),r=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===n?"rgb("+o+","+i+","+r+")":"CSS_RGBA"===n?"rgba("+o+","+i+","+r+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+o+","+i+","+r+"]":"RGBA_ARRAY"===n?"["+o+","+i+","+r+","+a+"]":"RGB_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var n,a=Array.prototype.forEach,i=Array.prototype.slice,h={BREAK:{},extend:function(n){return this.each(i.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(t[e])||(n[e]=t[e])}.bind(this))},this),n},defaults:function(n){return this.each(i.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(n[e])&&(n[e]=t[e])}.bind(this))},this),n},compose:function(){var n=i.call(arguments);return function(){for(var e=i.call(arguments),t=n.length-1;0<=t;t--)e=[n[t].apply(this,e)];return e[0]}},each:function(e,t,n){if(e)if(a&&e.forEach&&e.forEach===a)e.forEach(t,n);else if(e.length===e.length+0){for(var o=void 0,o=0,i=e.length;o<i;o++)if(o in e&&t.call(n,e[o],o)===this.BREAK)return}else for(var r in e)if(t.call(n,e[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(o,i,r){var a=void 0;return function(){var e=this,t=arguments;var n=r||!a;clearTimeout(a),a=setTimeout(function(){a=null,r||o.apply(e,t)},i),n&&o.apply(e,t)}},toArray:function(e){return e.toArray?e.toArray():i.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:(n=function(e){return isNaN(e)},r.toString=function(){return n.toString()},r),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}};function r(e){return n.apply(this,arguments)}var l,c=[{litmus:h.isString,conversions:{THREE_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:t},SIX_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:t},CSS_RGB:{read:function(e){e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:t},CSS_RGBA:{read:function(e){e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:t}}},{litmus:h.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:h.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:h.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(h.isNumber(e.r)&&h.isNumber(e.g)&&h.isNumber(e.b)&&h.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(h.isNumber(e.r)&&h.isNumber(e.g)&&h.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(h.isNumber(e.h)&&h.isNumber(e.s)&&h.isNumber(e.v)&&h.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(h.isNumber(e.h)&&h.isNumber(e.s)&&h.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],u=void 0,d=void 0,p=function(e){d=!1;var n=1<arguments.length?h.toArray(arguments):e;return h.each(c,function(e){if(e.litmus(n))return h.each(e.conversions,function(e,t){if(u=e.read(n),!1===d&&!1!==u)return(d=u).conversionName=t,u.conversion=e,h.BREAK}),h.BREAK}),d},f={hsv_to_rgb:function(e,t,n){var o=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),r=n*(1-t),e=n*(1-i*t),t=n*(1-(1-i)*t),o=[[n,t,r],[e,n,r],[r,n,t],[r,e,n],[t,r,n],[n,r,e]][o];return{r:255*o[0],g:255*o[1],b:255*o[2]}},rgb_to_hsv:function(e,t,n){var o=Math.min(e,t,n),i=Math.max(e,t,n),r=i-o,o=void 0;return 0===i?{h:NaN,s:0,v:0}:(o=e===i?(t-n)/r:t===i?2+(n-e)/r:4+(e-t)/r,(o/=6)<0&&(o+=1),{h:360*o,s:r/i,v:i/255})},rgb_to_hex:function(e,t,n){e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t);return e=this.hex_with_component(e,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(l=8*t)|e&~(255<<l)}},m="function"==typeof Symbol&&"symbol"===x(Symbol.iterator)?function(e){return void 0===e?"undefined":x(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":x(e)},_=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},g=function(e,t,n){return t&&w(e.prototype,t),n&&w(e,n),e};function w(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function E(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0!==o){if("value"in o)return o.value;o=o.get;return void 0!==o?o.call(n):void 0}if(e=Object.getPrototypeOf(e),null!==e)return E(e,t,n)}var C=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":x(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},O=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":x(t))&&"function"!=typeof t?e:t},T=(g(k,[{key:"toString",value:function(){return t(this)}},{key:"toHexString",value:function(){return t(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),k);function k(){if(_(this,k),this.__state=p.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}function A(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||T.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(T.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function P(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||T.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(T.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}T.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=f.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");h.extend(e.__state,f.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},T.recalculateHSV=function(e){var t=f.rgb_to_hsv(e.r,e.g,e.b);h.extend(e.__state,{s:t.s,v:t.v}),h.isNaN(t.h)?h.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},T.COMPONENTS=["r","g","b","h","s","v","hex","a"],A(T.prototype,"r",2),A(T.prototype,"g",1),A(T.prototype,"b",0),P(T.prototype,"h"),P(T.prototype,"s"),P(T.prototype,"v"),Object.defineProperty(T.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(T.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=f.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var L=(g(R,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),R);function R(e,t){_(this,R),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}var M={};h.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){h.each(e,function(e){M[e]=t})});var N=/(\d+(\.\d+)?)px/;function j(e){if("0"===e||h.isUndefined(e))return 0;e=e.match(N);return h.isNull(e)?0:parseFloat(e[1])}var H={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){h.isUndefined(t)&&(t=!0),h.isUndefined(n)&&(n=!0),e.style.position="absolute",t&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,o){var i=n||{},n=M[t];if(!n)throw new Error("Event type "+t+" not supported.");var r=document.createEvent(n);switch(n){case"MouseEvents":var a=i.x||i.clientX||0,s=i.y||i.clientY||0;r.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,a,s,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":s=r.initKeyboardEvent||r.initKeyEvent;h.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),s(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:r.initEvent(t,i.bubbles||!1,i.cancelable||!0)}h.defaults(r,o),e.dispatchEvent(r)},bind:function(e,t,n,o){o=o||!1;return e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on"+t,n),H},unbind:function(e,t,n,o){o=o||!1;return e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on"+t,n),H},addClass:function(e,t){var n;return void 0===e.className?e.className=t:e.className===t||-1===(n=e.className.split(/ +/)).indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")),H},removeClass:function(e,t){var n;return t?e.className===t?e.removeAttribute("class"):-1!==(t=(n=e.className.split(/ +/)).indexOf(t))&&(n.splice(t,1),e.className=n.join(" ")):e.className=void 0,H},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){e=getComputedStyle(e);return j(e["border-left-width"])+j(e["border-right-width"])+j(e["padding-left"])+j(e["padding-right"])+j(e.width)},getHeight:function(e){e=getComputedStyle(e);return j(e["border-top-width"])+j(e["border-bottom-width"])+j(e["padding-top"])+j(e["padding-bottom"])+j(e.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)for(;n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent,t;);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},D=(C(z,L),g(z,[{key:"setValue",value:function(e){e=E(z.prototype.__proto__||Object.getPrototypeOf(z.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),E(z.prototype.__proto__||Object.getPrototypeOf(z.prototype),"updateDisplay",this).call(this)}}]),z);function z(e,t){_(this,z);var t=O(this,(z.__proto__||Object.getPrototypeOf(z)).call(this,e,t)),n=t;return t.__prev=t.getValue(),t.__checkbox=document.createElement("input"),t.__checkbox.setAttribute("type","checkbox"),H.bind(t.__checkbox,"change",function(){n.setValue(!n.__prev)},!1),t.domElement.appendChild(t.__checkbox),t.updateDisplay(),t}var B=(C(V,L),g(V,[{key:"setValue",value:function(e){e=E(V.prototype.__proto__||Object.getPrototypeOf(V.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e}},{key:"updateDisplay",value:function(){return H.isActive(this.__select)?this:(this.__select.value=this.getValue(),E(V.prototype.__proto__||Object.getPrototypeOf(V.prototype),"updateDisplay",this).call(this))}}]),V);function V(e,t,n){_(this,V);var o,t=O(this,(V.__proto__||Object.getPrototypeOf(V)).call(this,e,t)),n=n,i=t;return t.__select=document.createElement("select"),h.isArray(n)&&(o={},h.each(n,function(e){o[e]=e}),n=o),h.each(n,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),i.__select.appendChild(n)}),t.updateDisplay(),H.bind(t.__select,"change",function(){var e=this.options[this.selectedIndex].value;i.setValue(e)}),t.domElement.appendChild(t.__select),t}var F=(C(I,L),g(I,[{key:"updateDisplay",value:function(){return H.isActive(this.__input)||(this.__input.value=this.getValue()),E(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"updateDisplay",this).call(this)}}]),I);function I(e,t){_(this,I);var t=O(this,(I.__proto__||Object.getPrototypeOf(I)).call(this,e,t)),n=t;function o(){n.setValue(n.__input.value)}return t.__input=document.createElement("input"),t.__input.setAttribute("type","text"),H.bind(t.__input,"keyup",o),H.bind(t.__input,"change",o),H.bind(t.__input,"blur",function(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}),H.bind(t.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),t.updateDisplay(),t.domElement.appendChild(t.__input),t}function G(e){e=e.toString();return-1<e.indexOf(".")?e.length-e.indexOf(".")-1:0}var X=(C(U,L),g(U,[{key:"setValue",value:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),E(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"setValue",this).call(this,e)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=G(e),this}}]),U);function U(e,t,n){_(this,U);t=O(this,(U.__proto__||Object.getPrototypeOf(U)).call(this,e,t)),n=n||{};return t.__min=n.min,t.__max=n.max,t.__step=n.step,h.isUndefined(t.__step)?0===t.initialValue?t.__impliedStep=1:t.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(t.initialValue))/Math.LN10))/10:t.__impliedStep=t.__step,t.__precision=G(t.__impliedStep),t}var Y=(C(W,X),g(W,[{key:"updateDisplay",value:function(){var e,t;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),t=this.__precision,t=Math.pow(10,t),Math.round(e*t)/t),E(W.prototype.__proto__||Object.getPrototypeOf(W.prototype),"updateDisplay",this).call(this)}}]),W);function W(e,t,n){_(this,W);n=O(this,(W.__proto__||Object.getPrototypeOf(W)).call(this,e,t,n));n.__truncationSuspended=!1;var o=n,i=void 0;function r(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function a(e){var t=i-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),i=e.clientY}function s(){H.unbind(window,"mousemove",a),H.unbind(window,"mouseup",s),r()}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),H.bind(n.__input,"change",function(){var e=parseFloat(o.__input.value);h.isNaN(e)||o.setValue(e)}),H.bind(n.__input,"blur",function(){r()}),H.bind(n.__input,"mousedown",function(e){H.bind(window,"mousemove",a),H.bind(window,"mouseup",s),i=e.clientY}),H.bind(n.__input,"keydown",function(e){13===e.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,r())}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}function q(e,t,n,o,i){return o+(e-t)/(n-t)*(i-o)}var K=(C(J,X),g(J,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",E(J.prototype.__proto__||Object.getPrototypeOf(J.prototype),"updateDisplay",this).call(this)}}]),J);function J(e,t,n,o,i){_(this,J);var i=O(this,(J.__proto__||Object.getPrototypeOf(J)).call(this,e,t,{min:n,max:o,step:i})),r=i;function a(e){e.preventDefault();var t=r.__background.getBoundingClientRect();return r.setValue(q(e.clientX,t.left,t.right,r.__min,r.__max)),!1}function s(){H.unbind(window,"mousemove",a),H.unbind(window,"mouseup",s),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function l(e){var t=e.touches[0].clientX,e=r.__background.getBoundingClientRect();r.setValue(q(t,e.left,e.right,r.__min,r.__max))}function c(){H.unbind(window,"touchmove",l),H.unbind(window,"touchend",c),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}return i.__background=document.createElement("div"),i.__foreground=document.createElement("div"),H.bind(i.__background,"mousedown",function(e){document.activeElement.blur(),H.bind(window,"mousemove",a),H.bind(window,"mouseup",s),a(e)}),H.bind(i.__background,"touchstart",function(e){if(1!==e.touches.length)return;H.bind(window,"touchmove",l),H.bind(window,"touchend",c),l(e)}),H.addClass(i.__background,"slider"),H.addClass(i.__foreground,"slider-fg"),i.updateDisplay(),i.__background.appendChild(i.__foreground),i.domElement.appendChild(i.__background),i}var Z=(C(Q,L),g(Q,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),Q);function Q(e,t,n){_(this,Q);var t=O(this,(Q.__proto__||Object.getPrototypeOf(Q)).call(this,e,t)),o=t;return t.__button=document.createElement("div"),t.__button.innerHTML=void 0===n?"Fire":n,H.bind(t.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),H.addClass(t.__button,"button"),t.domElement.appendChild(t.__button),t}var $=(C(ee,L),g(ee,[{key:"updateDisplay",value:function(){var t,n=p(this.getValue());!1!==n&&(t=!1,h.each(T.COMPONENTS,function(e){if(!h.isUndefined(n[e])&&!h.isUndefined(this.__color.__state[e])&&n[e]!==this.__color.__state[e])return t=!0,{}},this),t&&h.extend(this.__color.__state,n)),h.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var e=this.__color.v<.5||.5<this.__color.s?255:0,o=255-e;h.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+e+","+e+","+e+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,ne(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),h.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+e+","+e+","+e+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]),ee);function ee(e,t){_(this,ee);var n=O(this,(ee.__proto__||Object.getPrototypeOf(ee)).call(this,e,t));n.__color=new T(n.getValue()),n.__temp=new T(0);var o=n;n.domElement=document.createElement("div"),H.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",H.bind(n.__input,"keydown",function(e){13===e.keyCode&&l.call(this)}),H.bind(n.__input,"blur",l),H.bind(n.__selector,"mousedown",function(){H.addClass(this,"drag").bind(window,"mouseup",function(){H.removeClass(o.__selector,"drag")})}),H.bind(n.__selector,"touchstart",function(){H.addClass(this,"drag").bind(window,"touchend",function(){H.removeClass(o.__selector,"drag")})});e=document.createElement("div");function i(e){u(e),H.bind(window,"mousemove",u),H.bind(window,"touchmove",u),H.bind(window,"mouseup",a),H.bind(window,"touchend",a)}function r(e){d(e),H.bind(window,"mousemove",d),H.bind(window,"touchmove",d),H.bind(window,"mouseup",s),H.bind(window,"touchend",s)}function a(){H.unbind(window,"mousemove",u),H.unbind(window,"touchmove",u),H.unbind(window,"mouseup",a),H.unbind(window,"touchend",a),c()}function s(){H.unbind(window,"mousemove",d),H.unbind(window,"touchmove",d),H.unbind(window,"mouseup",s),H.unbind(window,"touchend",s),c()}function l(){var e=p(this.value);!1!==e?(o.__color.__state=e,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function c(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function u(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,e=n.clientX,n=n.clientY,e=(e-t.left)/(t.right-t.left),t=1-(n-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),1<e?e=1:e<0&&(e=0),o.__color.v=t,o.__color.s=e,o.setValue(o.__color.toOriginal()),!1}function d(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__hue_field.getBoundingClientRect(),t=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),o.__color.h=360*t,o.setValue(o.__color.toOriginal()),!1}return h.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),h.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),h.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),h.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),h.extend(e.style,{width:"100%",height:"100%",background:"none"}),ne(e,"top","rgba(0,0,0,0)","#000"),h.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(t=n.__hue_field).style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",h.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),H.bind(n.__saturation_field,"mousedown",i),H.bind(n.__saturation_field,"touchstart",i),H.bind(n.__field_knob,"mousedown",i),H.bind(n.__field_knob,"touchstart",i),H.bind(n.__hue_field,"mousedown",r),H.bind(n.__hue_field,"touchstart",r),n.__saturation_field.appendChild(e),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}var te=["-moz-","-o-","-webkit-","-ms-",""];function ne(t,n,o,i){t.style.background="",h.each(te,function(e){t.style.cssText+="background: "+e+"linear-gradient("+n+", "+o+" 0%, "+i+" 100%); "})}var oe=function(e,t,n,o,i){var r=e[t];return h.isArray(n)||h.isObject(n)?new B(e,t,n):h.isNumber(r)?h.isNumber(n)&&h.isNumber(o)?h.isNumber(i)?new K(e,t,n,o,i):new K(e,t,n,o):h.isNumber(i)?new Y(e,t,{min:n,max:o,step:i}):new Y(e,t,{min:n,max:o}):h.isString(r)?new F(e,t):h.isFunction(r)?new Z(e,t,""):h.isBoolean(r)?new D(e,t):null},ie=(C(re,L),g(re,[{key:"controller",set:function(e){this._controller=e},get:function(){return this._controller}}]),re);function re(e,t){_(this,re);var n=O(this,(re.__proto__||Object.getPrototypeOf(re)).call(this,e,t));return n.arguments={object:e,property:t,opts:Array.prototype.slice.call(arguments,2)},e.property&&(n.property=e.property(n)),n}C=function(e,t){var t=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e;var o=t.getElementsByTagName("head")[0];try{o.appendChild(n)}catch(e){}};var ae=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},se=(g(le,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),h.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",H.unbind(t.domElement,"webkitTransitionEnd",e),H.unbind(t.domElement,"transitionend",e),H.unbind(t.domElement,"oTransitionEnd",e)}var t=this;H.bind(this.domElement,"webkitTransitionEnd",e),H.bind(this.domElement,"transitionend",e),H.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-H.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-H.getHeight(this.domElement)/2+"px"}}]),le);function le(){_(this,le),this.backgroundElement=document.createElement("div"),h.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),H.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),h.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;H.bind(this.backgroundElement,"click",function(){e.hide()})}C(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var ce="Default",ue=function(){try{return!!window.localStorage}catch(e){return!1}}(),de=void 0,pe=!0,fe=void 0,he=!1,me=[],_e=function t(e){var n=this,o=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),H.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],o=h.defaults(o,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),o=h.defaults(o,{resizable:o.autoPlace,hideable:o.autoPlace}),h.isUndefined(o.load)?o.load={preset:ce}:o.preset&&(o.load.preset=o.preset),h.isUndefined(o.parent)&&o.hideable&&me.push(this),o.resizable=h.isUndefined(o.parent)&&o.resizable,o.autoPlace&&h.isUndefined(o.scrollable)&&(o.scrollable=!0);var i,r,a,s,l=ue&&"true"===localStorage.getItem(xe(0,"isLocal")),c=void 0,u=void 0;function d(e){return e.preventDefault(),r.width+=a-e.clientX,r.onResize(),a=e.clientX,!1}function p(){H.removeClass(r.__closeButton,_e.CLASS_DRAG),H.unbind(window,"mousemove",d),H.unbind(window,"mouseup",p)}function f(e){return e.preventDefault(),a=e.clientX,H.addClass(r.__closeButton,_e.CLASS_DRAG),H.bind(window,"mousemove",d),H.bind(window,"mouseup",p),!1}Object.defineProperties(this,{parent:{get:function(){return o.parent}},scrollable:{get:function(){return o.scrollable}},autoPlace:{get:function(){return o.autoPlace}},closeOnTop:{get:function(){return o.closeOnTop}},preset:{get:function(){return(n.parent?n.getRoot():o.load).preset},set:function(e){n.parent?n.getRoot().preset=e:o.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return o.width},set:function(e){o.width=e,Se(n,e)}},name:{get:function(){return o.name},set:function(e){o.name=e,u&&(u.innerHTML=o.name)}},closed:{get:function(){return o.closed},set:function(e){o.closed=e,o.closed?H.addClass(n.__ul,t.CLASS_CLOSED):H.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return o.load}},useLocalStorage:{get:function(){return l},set:function(e){ue&&((l=e)?H.bind(window,"unload",c):H.unbind(window,"unload",c),localStorage.setItem(xe(0,"isLocal"),e))}}}),h.isUndefined(o.parent)?(this.closed=o.closed||!1,H.addClass(this.domElement,t.CLASS_MAIN),H.makeSelectable(this.domElement,!1),ue&&l&&(n.useLocalStorage=!0,(i=localStorage.getItem(xe(0,"gui")))&&(o.load=JSON.parse(i))),this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,H.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),o.closeOnTop?(H.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(H.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),H.bind(this.__closeButton,"click",function(){n.closed=!n.closed})):(void 0===o.closed&&(o.closed=!0),i=document.createTextNode(o.name),H.addClass(i,"controller-name"),u=ge(n,i),H.addClass(this.__ul,t.CLASS_CLOSED),H.addClass(u,"title"),H.bind(u,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1}),o.closed||(this.closed=!1)),o.autoPlace&&(h.isUndefined(o.parent)&&(pe&&(fe=document.createElement("div"),H.addClass(fe,"dg"),H.addClass(fe,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(fe),pe=!1),fe.appendChild(this.domElement),H.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||Se(n,o.width)),this.__resizeHandler=function(){n.onResizeDebounced()},H.bind(window,"resize",this.__resizeHandler),H.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),H.bind(this.__ul,"transitionend",this.__resizeHandler),H.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),o.resizable&&(a=void 0,(r=this).__resize_handle=document.createElement("div"),h.extend(r.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),H.bind(r.__resize_handle,"mousedown",f),H.bind(r.__closeButton,"mousedown",f),r.domElement.insertBefore(r.__resize_handle,r.domElement.firstElementChild)),c=function(){ue&&"true"===localStorage.getItem(xe(0,"isLocal"))&&localStorage.setItem(xe(0,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=c,o.parent||((s=n.getRoot()).width+=1,h.defer(function(){--s.width}))};function ge(e,t,n){var o=document.createElement("li");return t&&o.appendChild(t),n?e.__ul.insertBefore(o,n):e.__ul.appendChild(o),e.onResize(),o}function be(e){H.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&H.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function ve(e,t){e=e.__preset_select[e.__preset_select.selectedIndex];e.innerHTML=t?e.value+"*":e.value}function ye(e,t){var n=e.getRoot(),o=n.__rememberedObjects.indexOf(t.object);if(-1!==o){var i=n.__rememberedObjectIndecesToControllers[o];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[o]=i),i[t.property]=t,n.load&&n.load.remembered){i=n.load.remembered,n=void 0;if(i[e.preset])n=i[e.preset];else{if(!i[ce])return;n=i[ce]}n[o]&&void 0!==n[o][t.property]&&(o=n[o][t.property],t.initialValue=o,t.setValue(o))}}}function we(e,t,n,o){var i;if(t.arguments&&(t=(i=t).arguments.object,n=i.arguments.property,o={factoryArgs:i.arguments.opts}),void 0===i&&void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var r=void 0;null===(r=o.color?new $(t,n):void 0!==i&&"string"==typeof i.property?i:(l=[t,n].concat(o.factoryArgs),oe.apply(e,l)))?r=i:void 0!==i&&(i.controller=r),o.before instanceof L&&(o.before=o.before.__li),ye(e,r),H.addClass(r.domElement,"c");var a=document.createElement("span");if(H.addClass(a,"property-name"),void 0!==i&&"object"===m(i.property))for(var s in i.property)a.appendChild(i.property[s]);else a.innerHTML=r.property;var l=document.createElement("div");l.appendChild(a),l.appendChild(r.domElement);var c,u,d,p,o=ge(e,l,o.before);return H.addClass(o,_e.CLASS_CONTROLLER_ROW),r instanceof $?H.addClass(o,"color"):H.addClass(o,m(r.getValue())),c=e,u=o,(d=r).__li=u,d.__gui=c,h.extend(d,{options:function(e){if(1<arguments.length){var t=d.__li.nextElementSibling;return d.remove(),we(c,d.object,d.property,{before:t,factoryArgs:[h.toArray(arguments)]})}if(h.isArray(e)||h.isObject(e)){t=d.__li.nextElementSibling;return d.remove(),we(c,d.object,d.property,{before:t,factoryArgs:[e]})}},name:function(e){return d.__li.firstElementChild.firstElementChild.innerHTML=e,d},listen:function(){return d.__gui.listen(d),d},remove:function(){return d.__gui.remove(d),d}}),d instanceof K?(p=new Y(d.object,d.property,{min:d.__min,max:d.__max,step:d.__step}),h.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=d[e],n=p[e];d[e]=p[e]=function(){var e=Array.prototype.slice.call(arguments);return n.apply(p,e),t.apply(d,e)}}),H.addClass(u,"has-slider"),d.domElement.insertBefore(p.domElement,d.domElement.firstElementChild)):d instanceof Y?(o=function(e){if(h.isNumber(d.__min)&&h.isNumber(d.__max)){var t=d.__li.firstElementChild.firstElementChild.innerHTML,n=-1<d.__gui.__listening.indexOf(d);d.remove();var o=we(c,d.object,d.property,{before:d.__li.nextElementSibling,factoryArgs:[d.__min,d.__max,d.__step]});return o.name(t),n&&o.listen(),o}return e},d.min=h.compose(o,d.min),d.max=h.compose(o,d.max)):d instanceof D?(H.bind(u,"click",function(){H.fakeEvent(d.__checkbox,"click")}),H.bind(d.__checkbox,"click",function(e){e.stopPropagation()})):d instanceof Z?(H.bind(u,"click",function(){H.fakeEvent(d.__button,"click")}),H.bind(u,"mouseover",function(){H.addClass(d.__button,"hover")}),H.bind(u,"mouseout",function(){H.removeClass(d.__button,"hover")})):d instanceof $&&(H.addClass(u,"color"),d.updateDisplay=h.compose(function(e){return u.style.borderLeftColor=d.__color.toString(),e},d.updateDisplay),d.updateDisplay()),d.setValue=h.compose(function(e){return c.getRoot().__preset_select&&d.isModified()&&ve(c.getRoot(),!0),e},d.setValue),e.__controllers.push(r),r}function xe(e,t){return document.location.href+"."+t}function Ee(e,t,n){var o=document.createElement("option");o.innerHTML=t,o.value=t,e.__preset_select.appendChild(o),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function Ce(e,t){t.style.display=e.useLocalStorage?"block":"none"}function Se(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function Oe(i,r){var a={};return h.each(i.__rememberedObjects,function(e,t){var n={},o=i.__rememberedObjectIndecesToControllers[t];h.each(o,function(e,t){n[t]=r?e.initialValue:e.getValue()}),a[t]=n}),a}_e.toggleHide=function(){he=!he,h.each(me,function(e){e.domElement.style.display=he?"none":""})},_e.CLASS_AUTO_PLACE="a",_e.CLASS_AUTO_PLACE_CONTAINER="ac",_e.CLASS_MAIN="main",_e.CLASS_CONTROLLER_ROW="cr",_e.CLASS_TOO_TALL="taller-than-window",_e.CLASS_CLOSED="closed",_e.CLASS_CLOSE_BUTTON="close-button",_e.CLASS_CLOSE_TOP="close-top",_e.CLASS_CLOSE_BOTTOM="close-bottom",_e.CLASS_DRAG="drag",_e.DEFAULT_WIDTH=245,_e.TEXT_CLOSED="Close Controls",_e.TEXT_OPEN="Open Controls",_e._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||_e.toggleHide()},H.bind(window,"keydown",_e._keydownHandler,!1),h.extend(_e.prototype,{add:function(e,t){return we(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return we(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;h.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&fe.removeChild(this.domElement);var t=this;h.each(this.__folders,function(e){t.removeFolder(e)}),H.unbind(window,"keydown",_e._keydownHandler,!1),be(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);t=new _e(t);this.__folders[e]=t;e=ge(this,t.domElement);return H.addClass(e,"folder"),t},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],be(t);var e=this;h.each(t.__folders,function(e){t.removeFolder(e)}),h.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e,t,n=this.getRoot();n.scrollable&&(e=H.getOffset(n.__ul).top,t=0,h.each(n.__ul.childNodes,function(e){n.autoPlace&&e===n.__save_row||(t+=H.getHeight(e))}),window.innerHeight-e-20<t?(H.addClass(n.domElement,_e.CLASS_TOO_TALL),n.__ul.style.height=window.innerHeight-e-20+"px"):(H.removeClass(n.domElement,_e.CLASS_TOO_TALL),n.__ul.style.height="auto")),n.__resize_handle&&h.defer(function(){n.__resize_handle.style.height=n.__ul.offsetHeight+"px"}),n.__closeButton&&(n.__closeButton.style.width=n.width+"px")},onResizeDebounced:h.debounce(function(){this.onResize()},50),remember:function(){if(h.isUndefined(de)&&((de=new se).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;h.each(Array.prototype.slice.call(arguments),function(e){0===t.__rememberedObjects.length&&function(n){var e=n.__save_row=document.createElement("li");H.addClass(n.domElement,"has-save"),n.__ul.insertBefore(e,n.__ul.firstChild),H.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",H.addClass(t,"button gears");var o=document.createElement("span");o.innerHTML="Save",H.addClass(o,"button"),H.addClass(o,"save");var i=document.createElement("span");i.innerHTML="New",H.addClass(i,"button"),H.addClass(i,"save-as");var r=document.createElement("span");r.innerHTML="Revert",H.addClass(r,"button"),H.addClass(r,"revert");var a=n.__preset_select=document.createElement("select");n.load&&n.load.remembered?h.each(n.load.remembered,function(e,t){Ee(n,t,t===n.preset)}):Ee(n,ce,!1);{var s;H.bind(a,"change",function(){for(var e=0;e<n.__preset_select.length;e++)n.__preset_select[e].innerHTML=n.__preset_select[e].value;n.preset=this.value}),e.appendChild(a),e.appendChild(t),e.appendChild(o),e.appendChild(i),e.appendChild(r),ue&&(s=document.getElementById("dg-local-explain"),e=document.getElementById("dg-local-storage"),document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(xe(0,"isLocal"))&&e.setAttribute("checked","checked"),Ce(n,s),H.bind(e,"change",function(){n.useLocalStorage=!n.useLocalStorage,Ce(n,s)}))}var l=document.getElementById("dg-new-constructor");H.bind(l,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||de.hide()}),H.bind(t,"click",function(){l.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),de.show(),l.focus(),l.select()}),H.bind(o,"click",function(){n.save()}),H.bind(i,"click",function(){var e=prompt("Enter a new preset name.");e&&n.saveAs(e)}),H.bind(r,"click",function(){n.revert()})}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&Se(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var n=this.load;return n.closed=this.closed,0<this.__rememberedObjects.length&&(n.preset=this.preset,n.remembered||(n.remembered={}),n.remembered[this.preset]=Oe(this)),n.folders={},h.each(this.__folders,function(e,t){n.folders[t]=e.getSaveObject()}),n},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Oe(this),ve(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[ce]=Oe(this,!0)),this.load.remembered[e]=Oe(this),this.preset=e,Ee(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(t){h.each(this.__controllers,function(e){this.getRoot().load.remembered?ye(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),h.each(this.__folders,function(e){e.revert(e)}),t||ve(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&ae.call(window,function(){e(t)});h.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){h.each(this.__controllers,function(e){e.updateDisplay()}),h.each(this.__folders,function(e){e.updateDisplay()})}});var Te,ke,C={Controller:L,BooleanController:D,OptionController:B,StringController:F,NumberController:X,NumberControllerBox:Y,NumberControllerSlider:K,FunctionController:Z,ColorController:$,CustomController:ie},Ae={addButton:function(e,t){t=t||{};var n=document.createElement("span");return n.innerHTML=e,void 0!==t.title&&(n.title=t.title),void 0!==t.onclick&&(n.style.cursor="pointer",n.onclick=t.onclick),void 0!==t.onwheel&&(e=function(e){e=(e=e||window.event).deltaY||e.detail||e.wheelDelta;t.onwheel(e)},n.style.cursor="n-resize",n.addEventListener?"onwheel"in document?n.addEventListener("wheel",e):"onmousewheel"in document?n.addEventListener("mousewheel",e):n.addEventListener("MozMousePixelScroll",e):n.attachEvent("onmousewheel",e)),n.style.margin="0px 2px",n}},X=(b(Pe,[{key:"THREE",set:function(e){Te?Object.is(e,Te)||console.error("three: duplicate THREE. Please use one instance of the THREE library."):Te=e},get:function(){return void 0===Te&&console.error("three: invalid _THREE = "+Te+". Call three.THREE = THREE first."),Te}},{key:"dat",set:function(e){ke?Object.is(e,ke)||console.error("three: duplicate dat. Please use one instance of the dat library."):ke=e},get:function(){return ke}}]),Pe);
/**
* custom controller, allow to user to change a value step by step.
*
* @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
*
* @copyright 2011 Data Arts Team, Google Creative Lab
*
* @license under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*/function Pe(){S(this,Pe)}window.__myThree__=window.__myThree__||{},window.__myThree__.three?_t=window.__myThree__.three:((_t=new X).isThree=function(){return Te},window.__myThree__.three=_t);var Le=_t,Re=(v(Me,C.CustomController),Me);
/**
 * @module ScaleController
 * @description is dat.GUI graphical user interface controller for control of the scale of threejs 3D object
 *
 * @see {@link https://threejs.org/} about threejs
 * @see {@link https://github.com/dataarts/dat.gui} about dat.GUI
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function Me(r,a){S(this,Me),(a=a||{}).settings=a.settings||{},a.settings.zoomMultiplier=a.settings.zoomMultiplier||1.1;var e=y(this,(Me.__proto__||Object.getPrototypeOf(Me)).call(this,{multiplier:a.settings.zoomMultiplier,property:function(e){var t={zoom:"Zoom",in:"in",out:"out",wheelZoom:"Scroll the mouse wheel to zoom"},n=void 0===a.getLanguageCode?"en":a.getLanguageCode();switch(n){case"ru":t.zoom="",t.in="",t.out="",t.wheelZoom="     ";break;default:if(void 0===a.lang||a.lang.languageCode!=n)break;Object.keys(a.lang).forEach(function(e){void 0!==t[e]&&(t[e]=a.lang[e])})}var o={},i=Ae.addButton;return o.zoomLabel=i(t.zoom,{title:t.wheelZoom,onwheel:function(n){r(e,function(e,t){return 0<n?e*=t:e/=t,e})}}),o.in=i("",{title:t.in,onclick:function(){r(e,function(e,t){return e*=t})}}),o.out=i("",{title:t.out,onclick:function(){r(e,function(e,t){return e/=t})}}),o}},"multiplier",1.1,10,.1));return void 0===e.property&&console.error("init() returns "+e.property),e}
/**
 * PositionController is dat.GUI graphical user interface controller for control of the position of threejs 3D object
 *
 * @see {@link https://threejs.org/} about threejs
 * @see {@link https://github.com/dataarts/dat.gui} about dat.GUI
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
var Ne=(v(je,C.CustomController),je);function je(r,a){S(this,je),(a=a||{}).settings=a.settings||{};var e=a.settings;a.min=a.min||.1,a.max=a.max||10,e.offset=e.offset||.1,a.step=a.step||.1;e=y(this,(je.__proto__||Object.getPrototypeOf(je)).call(this,{offset:e.offset,property:function(n){var t={offset:"Offset",add:"add",subtract:"subtract",wheelPosition:"Scroll the mouse wheel to change the position"},e=void 0===a.getLanguageCode?"en":a.getLanguageCode();switch(e){case"ru":t.offset="",t.add="",t.subtract="",t.wheelPosition="     ";break;default:if(void 0===a.lang||a.lang.languageCode!=e)break;Object.keys(a.lang).forEach(function(e){void 0!==t[e]&&(t[e]=a.lang[e])})}var o={},i=Ae.addButton;return o.Label=i(t.offset,{title:t.wheelPosition,onwheel:function(e){var t=n.controller.getValue();r(0<e?t:-t)}}),o.in=i("",{title:t.add,onclick:function(){r(n.controller.getValue())}}),o.out=i("",{title:t.subtract,onclick:function(){r(-n.controller.getValue())}}),o}},"offset",a.min,a.max,a.step));return void 0===e.property&&console.error("init() returns "+e.property),e}function He(e,t){var n=e.__state.conversionName.toString(),o=Math.round(e.r),i=Math.round(e.g),r=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===n?"rgb("+o+","+i+","+r+")":"CSS_RGBA"===n?"rgba("+o+","+i+","+r+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+o+","+i+","+r+"]":"RGBA_ARRAY"===n?"["+o+","+i+","+r+","+a+"]":"RGB_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var De,ze=Array.prototype.forEach,Be=Array.prototype.slice,Ve={BREAK:{},extend:function(n){return this.each(Be.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(t[e])||(n[e]=t[e])}.bind(this))},this),n},defaults:function(n){return this.each(Be.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(n[e])&&(n[e]=t[e])}.bind(this))},this),n},compose:function(){var n=Be.call(arguments);return function(){for(var e=Be.call(arguments),t=n.length-1;0<=t;t--)e=[n[t].apply(this,e)];return e[0]}},each:function(e,t,n){if(e)if(ze&&e.forEach&&e.forEach===ze)e.forEach(t,n);else if(e.length===e.length+0){for(var o=void 0,o=0,i=e.length;o<i;o++)if(o in e&&t.call(n,e[o],o)===this.BREAK)return}else for(var r in e)if(t.call(n,e[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(o,i,r){var a=void 0;return function(){var e=this,t=arguments;var n=r||!a;clearTimeout(a),a=setTimeout(function(){a=null,r||o.apply(e,t)},i),n&&o.apply(e,t)}},toArray:function(e){return e.toArray?e.toArray():Be.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:(De=function(e){return isNaN(e)},Fe.toString=function(){return De.toString()},Fe),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}};function Fe(e){return De.apply(this,arguments)}var Ie,Ge=[{litmus:Ve.isString,conversions:{THREE_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:He},SIX_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:He},CSS_RGB:{read:function(e){e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:He},CSS_RGBA:{read:function(e){e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:He}}},{litmus:Ve.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:Ve.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:Ve.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(Ve.isNumber(e.r)&&Ve.isNumber(e.g)&&Ve.isNumber(e.b)&&Ve.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(Ve.isNumber(e.r)&&Ve.isNumber(e.g)&&Ve.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(Ve.isNumber(e.h)&&Ve.isNumber(e.s)&&Ve.isNumber(e.v)&&Ve.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(Ve.isNumber(e.h)&&Ve.isNumber(e.s)&&Ve.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Xe=void 0,Ue=void 0,Ye=function(e){Ue=!1;var n=1<arguments.length?Ve.toArray(arguments):e;return Ve.each(Ge,function(e){if(e.litmus(n))return Ve.each(e.conversions,function(e,t){if(Xe=e.read(n),!1===Ue&&!1!==Xe)return(Ue=Xe).conversionName=t,Xe.conversion=e,Ve.BREAK}),Ve.BREAK}),Ue},We={hsv_to_rgb:function(e,t,n){var o=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),r=n*(1-t),e=n*(1-i*t),t=n*(1-(1-i)*t),o=[[n,t,r],[e,n,r],[r,n,t],[r,e,n],[t,r,n],[n,r,e]][o];return{r:255*o[0],g:255*o[1],b:255*o[2]}},rgb_to_hsv:function(e,t,n){var o=Math.min(e,t,n),i=Math.max(e,t,n),r=i-o,o=void 0;return 0===i?{h:NaN,s:0,v:0}:(o=e===i?(t-n)/r:t===i?2+(n-e)/r:4+(e-t)/r,(o/=6)<0&&(o+=1),{h:360*o,s:r/i,v:i/255})},rgb_to_hex:function(e,t,n){e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t);return e=this.hex_with_component(e,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(Ie=8*t)|e&~(255<<Ie)}},qe="function"==typeof Symbol&&"symbol"===x(Symbol.iterator)?function(e){return void 0===e?"undefined":x(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":x(e)},Ke=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ie=function(e,t,n){return t&&Je(e.prototype,t),n&&Je(e,n),e};function Je(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ze(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0!==o){if("value"in o)return o.value;o=o.get;return void 0!==o?o.call(n):void 0}if(e=Object.getPrototypeOf(e),null!==e)return Ze(e,t,n)}var X=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":x(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Qe=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":x(t))&&"function"!=typeof t?e:t},$e=(ie(et,[{key:"toString",value:function(){return He(this)}},{key:"toHexString",value:function(){return He(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),et);function et(){if(Ke(this,et),this.__state=Ye.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}function tt(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||$e.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&($e.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function nt(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||$e.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&($e.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}$e.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=We.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");Ve.extend(e.__state,We.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},$e.recalculateHSV=function(e){var t=We.rgb_to_hsv(e.r,e.g,e.b);Ve.extend(e.__state,{s:t.s,v:t.v}),Ve.isNaN(t.h)?Ve.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},$e.COMPONENTS=["r","g","b","h","s","v","hex","a"],tt($e.prototype,"r",2),tt($e.prototype,"g",1),tt($e.prototype,"b",0),nt($e.prototype,"h"),nt($e.prototype,"s"),nt($e.prototype,"v"),Object.defineProperty($e.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty($e.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=We.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var ot=(ie(it,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),it);function it(e,t){Ke(this,it),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}var rt={};Ve.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){Ve.each(e,function(e){rt[e]=t})});var at=/(\d+(\.\d+)?)px/;function st(e){if("0"===e||Ve.isUndefined(e))return 0;e=e.match(at);return Ve.isNull(e)?0:parseFloat(e[1])}var lt={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){Ve.isUndefined(t)&&(t=!0),Ve.isUndefined(n)&&(n=!0),e.style.position="absolute",t&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,o){var i=n||{},n=rt[t];if(!n)throw new Error("Event type "+t+" not supported.");var r=document.createEvent(n);switch(n){case"MouseEvents":var a=i.x||i.clientX||0,s=i.y||i.clientY||0;r.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,a,s,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":s=r.initKeyboardEvent||r.initKeyEvent;Ve.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),s(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:r.initEvent(t,i.bubbles||!1,i.cancelable||!0)}Ve.defaults(r,o),e.dispatchEvent(r)},bind:function(e,t,n,o){o=o||!1;return e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on"+t,n),lt},unbind:function(e,t,n,o){o=o||!1;return e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on"+t,n),lt},addClass:function(e,t){var n;return void 0===e.className?e.className=t:e.className===t||-1===(n=e.className.split(/ +/)).indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")),lt},removeClass:function(e,t){var n;return t?e.className===t?e.removeAttribute("class"):-1!==(t=(n=e.className.split(/ +/)).indexOf(t))&&(n.splice(t,1),e.className=n.join(" ")):e.className=void 0,lt},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){e=getComputedStyle(e);return st(e["border-left-width"])+st(e["border-right-width"])+st(e["padding-left"])+st(e["padding-right"])+st(e.width)},getHeight:function(e){e=getComputedStyle(e);return st(e["border-top-width"])+st(e["border-bottom-width"])+st(e["padding-top"])+st(e["padding-bottom"])+st(e.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)for(;n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent,t;);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},ct=(X(ut,ot),ie(ut,[{key:"setValue",value:function(e){e=Ze(ut.prototype.__proto__||Object.getPrototypeOf(ut.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Ze(ut.prototype.__proto__||Object.getPrototypeOf(ut.prototype),"updateDisplay",this).call(this)}}]),ut);function ut(e,t){Ke(this,ut);var t=Qe(this,(ut.__proto__||Object.getPrototypeOf(ut)).call(this,e,t)),n=t;return t.__prev=t.getValue(),t.__checkbox=document.createElement("input"),t.__checkbox.setAttribute("type","checkbox"),lt.bind(t.__checkbox,"change",function(){n.setValue(!n.__prev)},!1),t.domElement.appendChild(t.__checkbox),t.updateDisplay(),t}var dt=(X(pt,ot),ie(pt,[{key:"setValue",value:function(e){e=Ze(pt.prototype.__proto__||Object.getPrototypeOf(pt.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e}},{key:"updateDisplay",value:function(){return lt.isActive(this.__select)?this:(this.__select.value=this.getValue(),Ze(pt.prototype.__proto__||Object.getPrototypeOf(pt.prototype),"updateDisplay",this).call(this))}}]),pt);function pt(e,t,n){Ke(this,pt);var o,t=Qe(this,(pt.__proto__||Object.getPrototypeOf(pt)).call(this,e,t)),n=n,i=t;return t.__select=document.createElement("select"),Ve.isArray(n)&&(o={},Ve.each(n,function(e){o[e]=e}),n=o),Ve.each(n,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),i.__select.appendChild(n)}),t.updateDisplay(),lt.bind(t.__select,"change",function(){var e=this.options[this.selectedIndex].value;i.setValue(e)}),t.domElement.appendChild(t.__select),t}var ft=(X(ht,ot),ie(ht,[{key:"updateDisplay",value:function(){return lt.isActive(this.__input)||(this.__input.value=this.getValue()),Ze(ht.prototype.__proto__||Object.getPrototypeOf(ht.prototype),"updateDisplay",this).call(this)}}]),ht);function ht(e,t){Ke(this,ht);var t=Qe(this,(ht.__proto__||Object.getPrototypeOf(ht)).call(this,e,t)),n=t;function o(){n.setValue(n.__input.value)}return t.__input=document.createElement("input"),t.__input.setAttribute("type","text"),lt.bind(t.__input,"keyup",o),lt.bind(t.__input,"change",o),lt.bind(t.__input,"blur",function(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}),lt.bind(t.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),t.updateDisplay(),t.domElement.appendChild(t.__input),t}function mt(e){e=e.toString();return-1<e.indexOf(".")?e.length-e.indexOf(".")-1:0}var _t=(X(gt,ot),ie(gt,[{key:"setValue",value:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),Ze(gt.prototype.__proto__||Object.getPrototypeOf(gt.prototype),"setValue",this).call(this,e)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=mt(e),this}}]),gt);function gt(e,t,n){Ke(this,gt);t=Qe(this,(gt.__proto__||Object.getPrototypeOf(gt)).call(this,e,t)),n=n||{};return t.__min=n.min,t.__max=n.max,t.__step=n.step,Ve.isUndefined(t.__step)?0===t.initialValue?t.__impliedStep=1:t.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(t.initialValue))/Math.LN10))/10:t.__impliedStep=t.__step,t.__precision=mt(t.__impliedStep),t}var bt=(X(vt,_t),ie(vt,[{key:"updateDisplay",value:function(){var e,t;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),t=this.__precision,t=Math.pow(10,t),Math.round(e*t)/t),Ze(vt.prototype.__proto__||Object.getPrototypeOf(vt.prototype),"updateDisplay",this).call(this)}}]),vt);function vt(e,t,n){Ke(this,vt);n=Qe(this,(vt.__proto__||Object.getPrototypeOf(vt)).call(this,e,t,n));n.__truncationSuspended=!1;var o=n,i=void 0;function r(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function a(e){var t=i-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),i=e.clientY}function s(){lt.unbind(window,"mousemove",a),lt.unbind(window,"mouseup",s),r()}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),lt.bind(n.__input,"change",function(){var e=parseFloat(o.__input.value);Ve.isNaN(e)||o.setValue(e)}),lt.bind(n.__input,"blur",function(){r()}),lt.bind(n.__input,"mousedown",function(e){lt.bind(window,"mousemove",a),lt.bind(window,"mouseup",s),i=e.clientY}),lt.bind(n.__input,"keydown",function(e){13===e.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,r())}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}function yt(e,t,n,o,i){return o+(e-t)/(n-t)*(i-o)}var wt=(X(xt,_t),ie(xt,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",Ze(xt.prototype.__proto__||Object.getPrototypeOf(xt.prototype),"updateDisplay",this).call(this)}}]),xt);function xt(e,t,n,o,i){Ke(this,xt);var i=Qe(this,(xt.__proto__||Object.getPrototypeOf(xt)).call(this,e,t,{min:n,max:o,step:i})),r=i;function a(e){e.preventDefault();var t=r.__background.getBoundingClientRect();return r.setValue(yt(e.clientX,t.left,t.right,r.__min,r.__max)),!1}function s(){lt.unbind(window,"mousemove",a),lt.unbind(window,"mouseup",s),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function l(e){var t=e.touches[0].clientX,e=r.__background.getBoundingClientRect();r.setValue(yt(t,e.left,e.right,r.__min,r.__max))}function c(){lt.unbind(window,"touchmove",l),lt.unbind(window,"touchend",c),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}return i.__background=document.createElement("div"),i.__foreground=document.createElement("div"),lt.bind(i.__background,"mousedown",function(e){document.activeElement.blur(),lt.bind(window,"mousemove",a),lt.bind(window,"mouseup",s),a(e)}),lt.bind(i.__background,"touchstart",function(e){if(1!==e.touches.length)return;lt.bind(window,"touchmove",l),lt.bind(window,"touchend",c),l(e)}),lt.addClass(i.__background,"slider"),lt.addClass(i.__foreground,"slider-fg"),i.updateDisplay(),i.__background.appendChild(i.__foreground),i.domElement.appendChild(i.__background),i}var Et=(X(Ct,ot),ie(Ct,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),Ct);function Ct(e,t,n){Ke(this,Ct);var t=Qe(this,(Ct.__proto__||Object.getPrototypeOf(Ct)).call(this,e,t)),o=t;return t.__button=document.createElement("div"),t.__button.innerHTML=void 0===n?"Fire":n,lt.bind(t.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),lt.addClass(t.__button,"button"),t.domElement.appendChild(t.__button),t}var St=(X(Ot,ot),ie(Ot,[{key:"updateDisplay",value:function(){var t,n=Ye(this.getValue());!1!==n&&(t=!1,Ve.each($e.COMPONENTS,function(e){if(!Ve.isUndefined(n[e])&&!Ve.isUndefined(this.__color.__state[e])&&n[e]!==this.__color.__state[e])return t=!0,{}},this),t&&Ve.extend(this.__color.__state,n)),Ve.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var e=this.__color.v<.5||.5<this.__color.s?255:0,o=255-e;Ve.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+e+","+e+","+e+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,kt(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Ve.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+e+","+e+","+e+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]),Ot);function Ot(e,t){Ke(this,Ot);var n=Qe(this,(Ot.__proto__||Object.getPrototypeOf(Ot)).call(this,e,t));n.__color=new $e(n.getValue()),n.__temp=new $e(0);var o=n;n.domElement=document.createElement("div"),lt.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",lt.bind(n.__input,"keydown",function(e){13===e.keyCode&&l.call(this)}),lt.bind(n.__input,"blur",l),lt.bind(n.__selector,"mousedown",function(){lt.addClass(this,"drag").bind(window,"mouseup",function(){lt.removeClass(o.__selector,"drag")})}),lt.bind(n.__selector,"touchstart",function(){lt.addClass(this,"drag").bind(window,"touchend",function(){lt.removeClass(o.__selector,"drag")})});e=document.createElement("div");function i(e){u(e),lt.bind(window,"mousemove",u),lt.bind(window,"touchmove",u),lt.bind(window,"mouseup",a),lt.bind(window,"touchend",a)}function r(e){d(e),lt.bind(window,"mousemove",d),lt.bind(window,"touchmove",d),lt.bind(window,"mouseup",s),lt.bind(window,"touchend",s)}function a(){lt.unbind(window,"mousemove",u),lt.unbind(window,"touchmove",u),lt.unbind(window,"mouseup",a),lt.unbind(window,"touchend",a),c()}function s(){lt.unbind(window,"mousemove",d),lt.unbind(window,"touchmove",d),lt.unbind(window,"mouseup",s),lt.unbind(window,"touchend",s),c()}function l(){var e=Ye(this.value);!1!==e?(o.__color.__state=e,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function c(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function u(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,e=n.clientX,n=n.clientY,e=(e-t.left)/(t.right-t.left),t=1-(n-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),1<e?e=1:e<0&&(e=0),o.__color.v=t,o.__color.s=e,o.setValue(o.__color.toOriginal()),!1}function d(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__hue_field.getBoundingClientRect(),t=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),o.__color.h=360*t,o.setValue(o.__color.toOriginal()),!1}return Ve.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Ve.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Ve.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Ve.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Ve.extend(e.style,{width:"100%",height:"100%",background:"none"}),kt(e,"top","rgba(0,0,0,0)","#000"),Ve.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(t=n.__hue_field).style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",Ve.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),lt.bind(n.__saturation_field,"mousedown",i),lt.bind(n.__saturation_field,"touchstart",i),lt.bind(n.__field_knob,"mousedown",i),lt.bind(n.__field_knob,"touchstart",i),lt.bind(n.__hue_field,"mousedown",r),lt.bind(n.__hue_field,"touchstart",r),n.__saturation_field.appendChild(e),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}var Tt=["-moz-","-o-","-webkit-","-ms-",""];function kt(t,n,o,i){t.style.background="",Ve.each(Tt,function(e){t.style.cssText+="background: "+e+"linear-gradient("+n+", "+o+" 0%, "+i+" 100%); "})}var At=function(e,t,n,o,i){var r=e[t];return Ve.isArray(n)||Ve.isObject(n)?new dt(e,t,n):Ve.isNumber(r)?Ve.isNumber(n)&&Ve.isNumber(o)?Ve.isNumber(i)?new wt(e,t,n,o,i):new wt(e,t,n,o):Ve.isNumber(i)?new bt(e,t,{min:n,max:o,step:i}):new bt(e,t,{min:n,max:o}):Ve.isString(r)?new ft(e,t):Ve.isFunction(r)?new Et(e,t,""):Ve.isBoolean(r)?new ct(e,t):null},C=(X(Pt,ot),ie(Pt,[{key:"controller",set:function(e){this._controller=e},get:function(){return this._controller}}]),Pt);function Pt(e,t){Ke(this,Pt);var n=Qe(this,(Pt.__proto__||Object.getPrototypeOf(Pt)).call(this,e,t));return n.arguments={object:e,property:t,opts:Array.prototype.slice.call(arguments,2)},e.property&&(n.property=e.property(n)),n}X=function(e,t){var t=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e;var o=t.getElementsByTagName("head")[0];try{o.appendChild(n)}catch(e){}};var Lt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},Rt=(ie(Mt,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Ve.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",lt.unbind(t.domElement,"webkitTransitionEnd",e),lt.unbind(t.domElement,"transitionend",e),lt.unbind(t.domElement,"oTransitionEnd",e)}var t=this;lt.bind(this.domElement,"webkitTransitionEnd",e),lt.bind(this.domElement,"transitionend",e),lt.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-lt.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-lt.getHeight(this.domElement)/2+"px"}}]),Mt);function Mt(){Ke(this,Mt),this.backgroundElement=document.createElement("div"),Ve.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),lt.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Ve.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;lt.bind(this.backgroundElement,"click",function(){e.hide()})}X(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var Nt="Default",jt=function(){try{return!!window.localStorage}catch(e){return!1}}(),Ht=void 0,Dt=!0,zt=void 0,Bt=!1,Vt=[],Ft=function t(e){var n=this,o=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),lt.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],o=Ve.defaults(o,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),o=Ve.defaults(o,{resizable:o.autoPlace,hideable:o.autoPlace}),Ve.isUndefined(o.load)?o.load={preset:Nt}:o.preset&&(o.load.preset=o.preset),Ve.isUndefined(o.parent)&&o.hideable&&Vt.push(this),o.resizable=Ve.isUndefined(o.parent)&&o.resizable,o.autoPlace&&Ve.isUndefined(o.scrollable)&&(o.scrollable=!0);var i,r,a,s,l=jt&&"true"===localStorage.getItem(Wt(0,"isLocal")),c=void 0,u=void 0;function d(e){return e.preventDefault(),r.width+=a-e.clientX,r.onResize(),a=e.clientX,!1}function p(){lt.removeClass(r.__closeButton,Ft.CLASS_DRAG),lt.unbind(window,"mousemove",d),lt.unbind(window,"mouseup",p)}function f(e){return e.preventDefault(),a=e.clientX,lt.addClass(r.__closeButton,Ft.CLASS_DRAG),lt.bind(window,"mousemove",d),lt.bind(window,"mouseup",p),!1}Object.defineProperties(this,{parent:{get:function(){return o.parent}},scrollable:{get:function(){return o.scrollable}},autoPlace:{get:function(){return o.autoPlace}},closeOnTop:{get:function(){return o.closeOnTop}},preset:{get:function(){return(n.parent?n.getRoot():o.load).preset},set:function(e){n.parent?n.getRoot().preset=e:o.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return o.width},set:function(e){o.width=e,Jt(n,e)}},name:{get:function(){return o.name},set:function(e){o.name=e,u&&(u.innerHTML=o.name)}},closed:{get:function(){return o.closed},set:function(e){o.closed=e,o.closed?lt.addClass(n.__ul,t.CLASS_CLOSED):lt.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return o.load}},useLocalStorage:{get:function(){return l},set:function(e){jt&&((l=e)?lt.bind(window,"unload",c):lt.unbind(window,"unload",c),localStorage.setItem(Wt(0,"isLocal"),e))}}}),Ve.isUndefined(o.parent)?(this.closed=o.closed||!1,lt.addClass(this.domElement,t.CLASS_MAIN),lt.makeSelectable(this.domElement,!1),jt&&l&&(n.useLocalStorage=!0,(i=localStorage.getItem(Wt(0,"gui")))&&(o.load=JSON.parse(i))),this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,lt.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),o.closeOnTop?(lt.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(lt.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),lt.bind(this.__closeButton,"click",function(){n.closed=!n.closed})):(void 0===o.closed&&(o.closed=!0),i=document.createTextNode(o.name),lt.addClass(i,"controller-name"),u=It(n,i),lt.addClass(this.__ul,t.CLASS_CLOSED),lt.addClass(u,"title"),lt.bind(u,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1}),o.closed||(this.closed=!1)),o.autoPlace&&(Ve.isUndefined(o.parent)&&(Dt&&(zt=document.createElement("div"),lt.addClass(zt,"dg"),lt.addClass(zt,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(zt),Dt=!1),zt.appendChild(this.domElement),lt.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||Jt(n,o.width)),this.__resizeHandler=function(){n.onResizeDebounced()},lt.bind(window,"resize",this.__resizeHandler),lt.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),lt.bind(this.__ul,"transitionend",this.__resizeHandler),lt.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),o.resizable&&(a=void 0,(r=this).__resize_handle=document.createElement("div"),Ve.extend(r.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),lt.bind(r.__resize_handle,"mousedown",f),lt.bind(r.__closeButton,"mousedown",f),r.domElement.insertBefore(r.__resize_handle,r.domElement.firstElementChild)),c=function(){jt&&"true"===localStorage.getItem(Wt(0,"isLocal"))&&localStorage.setItem(Wt(0,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=c,o.parent||((s=n.getRoot()).width+=1,Ve.defer(function(){--s.width}))};function It(e,t,n){var o=document.createElement("li");return t&&o.appendChild(t),n?e.__ul.insertBefore(o,n):e.__ul.appendChild(o),e.onResize(),o}function Gt(e){lt.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&lt.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function Xt(e,t){e=e.__preset_select[e.__preset_select.selectedIndex];e.innerHTML=t?e.value+"*":e.value}function Ut(e,t){var n=e.getRoot(),o=n.__rememberedObjects.indexOf(t.object);if(-1!==o){var i=n.__rememberedObjectIndecesToControllers[o];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[o]=i),i[t.property]=t,n.load&&n.load.remembered){i=n.load.remembered,n=void 0;if(i[e.preset])n=i[e.preset];else{if(!i[Nt])return;n=i[Nt]}n[o]&&void 0!==n[o][t.property]&&(o=n[o][t.property],t.initialValue=o,t.setValue(o))}}}function Yt(e,t,n,o){var i;if(t.arguments&&(t=(i=t).arguments.object,n=i.arguments.property,o={factoryArgs:i.arguments.opts}),void 0===i&&void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var r=void 0;null===(r=o.color?new St(t,n):void 0!==i&&"string"==typeof i.property?i:(l=[t,n].concat(o.factoryArgs),At.apply(e,l)))?r=i:void 0!==i&&(i.controller=r),o.before instanceof ot&&(o.before=o.before.__li),Ut(e,r),lt.addClass(r.domElement,"c");var a=document.createElement("span");if(lt.addClass(a,"property-name"),void 0!==i&&"object"===qe(i.property))for(var s in i.property)a.appendChild(i.property[s]);else a.innerHTML=r.property;var l=document.createElement("div");l.appendChild(a),l.appendChild(r.domElement);var c,u,d,p,o=It(e,l,o.before);return lt.addClass(o,Ft.CLASS_CONTROLLER_ROW),r instanceof St?lt.addClass(o,"color"):lt.addClass(o,qe(r.getValue())),c=e,u=o,(d=r).__li=u,d.__gui=c,Ve.extend(d,{options:function(e){if(1<arguments.length){var t=d.__li.nextElementSibling;return d.remove(),Yt(c,d.object,d.property,{before:t,factoryArgs:[Ve.toArray(arguments)]})}if(Ve.isArray(e)||Ve.isObject(e)){t=d.__li.nextElementSibling;return d.remove(),Yt(c,d.object,d.property,{before:t,factoryArgs:[e]})}},name:function(e){return d.__li.firstElementChild.firstElementChild.innerHTML=e,d},listen:function(){return d.__gui.listen(d),d},remove:function(){return d.__gui.remove(d),d}}),d instanceof wt?(p=new bt(d.object,d.property,{min:d.__min,max:d.__max,step:d.__step}),Ve.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=d[e],n=p[e];d[e]=p[e]=function(){var e=Array.prototype.slice.call(arguments);return n.apply(p,e),t.apply(d,e)}}),lt.addClass(u,"has-slider"),d.domElement.insertBefore(p.domElement,d.domElement.firstElementChild)):d instanceof bt?(o=function(e){if(Ve.isNumber(d.__min)&&Ve.isNumber(d.__max)){var t=d.__li.firstElementChild.firstElementChild.innerHTML,n=-1<d.__gui.__listening.indexOf(d);d.remove();var o=Yt(c,d.object,d.property,{before:d.__li.nextElementSibling,factoryArgs:[d.__min,d.__max,d.__step]});return o.name(t),n&&o.listen(),o}return e},d.min=Ve.compose(o,d.min),d.max=Ve.compose(o,d.max)):d instanceof ct?(lt.bind(u,"click",function(){lt.fakeEvent(d.__checkbox,"click")}),lt.bind(d.__checkbox,"click",function(e){e.stopPropagation()})):d instanceof Et?(lt.bind(u,"click",function(){lt.fakeEvent(d.__button,"click")}),lt.bind(u,"mouseover",function(){lt.addClass(d.__button,"hover")}),lt.bind(u,"mouseout",function(){lt.removeClass(d.__button,"hover")})):d instanceof St&&(lt.addClass(u,"color"),d.updateDisplay=Ve.compose(function(e){return u.style.borderLeftColor=d.__color.toString(),e},d.updateDisplay),d.updateDisplay()),d.setValue=Ve.compose(function(e){return c.getRoot().__preset_select&&d.isModified()&&Xt(c.getRoot(),!0),e},d.setValue),e.__controllers.push(r),r}function Wt(e,t){return document.location.href+"."+t}function qt(e,t,n){var o=document.createElement("option");o.innerHTML=t,o.value=t,e.__preset_select.appendChild(o),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function Kt(e,t){t.style.display=e.useLocalStorage?"block":"none"}function Jt(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function Zt(i,r){var a={};return Ve.each(i.__rememberedObjects,function(e,t){var n={},o=i.__rememberedObjectIndecesToControllers[t];Ve.each(o,function(e,t){n[t]=r?e.initialValue:e.getValue()}),a[t]=n}),a}Ft.toggleHide=function(){Bt=!Bt,Ve.each(Vt,function(e){e.domElement.style.display=Bt?"none":""})},Ft.CLASS_AUTO_PLACE="a",Ft.CLASS_AUTO_PLACE_CONTAINER="ac",Ft.CLASS_MAIN="main",Ft.CLASS_CONTROLLER_ROW="cr",Ft.CLASS_TOO_TALL="taller-than-window",Ft.CLASS_CLOSED="closed",Ft.CLASS_CLOSE_BUTTON="close-button",Ft.CLASS_CLOSE_TOP="close-top",Ft.CLASS_CLOSE_BOTTOM="close-bottom",Ft.CLASS_DRAG="drag",Ft.DEFAULT_WIDTH=245,Ft.TEXT_CLOSED="Close Controls",Ft.TEXT_OPEN="Open Controls",Ft._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||Ft.toggleHide()},lt.bind(window,"keydown",Ft._keydownHandler,!1),Ve.extend(Ft.prototype,{add:function(e,t){return Yt(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return Yt(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;Ve.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&zt.removeChild(this.domElement);var t=this;Ve.each(this.__folders,function(e){t.removeFolder(e)}),lt.unbind(window,"keydown",Ft._keydownHandler,!1),Gt(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);t=new Ft(t);this.__folders[e]=t;e=It(this,t.domElement);return lt.addClass(e,"folder"),t},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Gt(t);var e=this;Ve.each(t.__folders,function(e){t.removeFolder(e)}),Ve.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e,t,n=this.getRoot();n.scrollable&&(e=lt.getOffset(n.__ul).top,t=0,Ve.each(n.__ul.childNodes,function(e){n.autoPlace&&e===n.__save_row||(t+=lt.getHeight(e))}),window.innerHeight-e-20<t?(lt.addClass(n.domElement,Ft.CLASS_TOO_TALL),n.__ul.style.height=window.innerHeight-e-20+"px"):(lt.removeClass(n.domElement,Ft.CLASS_TOO_TALL),n.__ul.style.height="auto")),n.__resize_handle&&Ve.defer(function(){n.__resize_handle.style.height=n.__ul.offsetHeight+"px"}),n.__closeButton&&(n.__closeButton.style.width=n.width+"px")},onResizeDebounced:Ve.debounce(function(){this.onResize()},50),remember:function(){if(Ve.isUndefined(Ht)&&((Ht=new Rt).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;Ve.each(Array.prototype.slice.call(arguments),function(e){0===t.__rememberedObjects.length&&function(n){var e=n.__save_row=document.createElement("li");lt.addClass(n.domElement,"has-save"),n.__ul.insertBefore(e,n.__ul.firstChild),lt.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",lt.addClass(t,"button gears");var o=document.createElement("span");o.innerHTML="Save",lt.addClass(o,"button"),lt.addClass(o,"save");var i=document.createElement("span");i.innerHTML="New",lt.addClass(i,"button"),lt.addClass(i,"save-as");var r=document.createElement("span");r.innerHTML="Revert",lt.addClass(r,"button"),lt.addClass(r,"revert");var a=n.__preset_select=document.createElement("select");n.load&&n.load.remembered?Ve.each(n.load.remembered,function(e,t){qt(n,t,t===n.preset)}):qt(n,Nt,!1);{var s;lt.bind(a,"change",function(){for(var e=0;e<n.__preset_select.length;e++)n.__preset_select[e].innerHTML=n.__preset_select[e].value;n.preset=this.value}),e.appendChild(a),e.appendChild(t),e.appendChild(o),e.appendChild(i),e.appendChild(r),jt&&(s=document.getElementById("dg-local-explain"),e=document.getElementById("dg-local-storage"),document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(Wt(0,"isLocal"))&&e.setAttribute("checked","checked"),Kt(n,s),lt.bind(e,"change",function(){n.useLocalStorage=!n.useLocalStorage,Kt(n,s)}))}var l=document.getElementById("dg-new-constructor");lt.bind(l,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Ht.hide()}),lt.bind(t,"click",function(){l.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),Ht.show(),l.focus(),l.select()}),lt.bind(o,"click",function(){n.save()}),lt.bind(i,"click",function(){var e=prompt("Enter a new preset name.");e&&n.saveAs(e)}),lt.bind(r,"click",function(){n.revert()})}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&Jt(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var n=this.load;return n.closed=this.closed,0<this.__rememberedObjects.length&&(n.preset=this.preset,n.remembered||(n.remembered={}),n.remembered[this.preset]=Zt(this)),n.folders={},Ve.each(this.__folders,function(e,t){n.folders[t]=e.getSaveObject()}),n},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Zt(this),Xt(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Nt]=Zt(this,!0)),this.load.remembered[e]=Zt(this),this.preset=e,qt(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(t){Ve.each(this.__controllers,function(e){this.getRoot().load.remembered?Ut(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),Ve.each(this.__folders,function(e){e.revert(e)}),t||Xt(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&Lt.call(window,function(){e(t)});Ve.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){Ve.each(this.__controllers,function(e){e.updateDisplay()}),Ve.each(this.__folders,function(e){e.updateDisplay()})}});var Qt={Controller:ot,BooleanController:ct,OptionController:dt,StringController:ft,NumberController:_t,NumberControllerBox:bt,NumberControllerSlider:wt,FunctionController:Et,ColorController:St,CustomController:C};
/**
 * get position functions library
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function $t(e,t){var n,o,i,r,a=Le.THREE,s=t.clone();for(;n=e,o=s,r=i=void 0,i=new a.Vector3,r=new a.Vector3,(i=o.clone()).multiply(n.scale),r.copy(i),r.applyEuler(n.rotation),i.x=r.x,i.y=r.y,i.z=r.z,i.add(n.position),s=i,e=e.parent,e&&e.parent;);return s}function en(e,t){var n;if(-1!==t)return void 0===t?e.position:$t(e,(n=e,e=t,t=Le.THREE,n=n.geometry.attributes.position,(t=4<=n.itemSize?new t.Vector4(0,0,0,0):new t.Vector3).fromArray(n.array,e*n.itemSize),t))}X={isWebGLAvailable:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},isWebGL2Available:function(){try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},getWebGLErrorMessage:function(){return this.getErrorMessage(1)},getWebGL2ErrorMessage:function(){return this.getErrorMessage(2)},getErrorMessage:function(e){var t={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext},n='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>',o=document.createElement("div");return o.id="webglmessage",o.style.fontFamily="monospace",o.style.fontSize="13px",o.style.fontWeight="normal",o.style.textAlign="center",o.style.background="#fff",o.style.color="#000",o.style.padding="1.5em",o.style.width="400px",o.style.margin="5em auto 0",n=(n=t[e]?n.replace("$0","graphics card"):n.replace("$0","browser")).replace("$1",{1:"WebGL",2:"WebGL 2"}[e]),o.innerHTML=n,o}};
/**
* node.js version of the synchronous download of the file.
* @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
*
* @copyright 2011 Data Arts Team, Google Creative Lab
*
* @license under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*/function tn(t){if(this.loadXMLDoc=function(){var e;if(window.XMLHttpRequest){if(!(e=new XMLHttpRequest))throw"new XMLHttpRequest() failed!"}else{if(!window.ActiveXObject)throw"myRequest.loadXMLDoc(...) failed!";if(!(e=this.NewActiveXObject()))throw"NewActiveXObject() failed!"}return e},this.NewActiveXObject=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}return a('This browser does not support XMLHttpRequest. Probably, your security settings do not allow Web sites to use ActiveX controls installed on your computer. Refresh your Web page to find out the current status of your Web page or enable the "Initialize and script ActiveX controls not marked as safe" and "Run Active X controls and plug-ins" of the Security settings of the Internet zone of your browser.'),null},this.XMLHttpRequestStart=function(e,t){this.XMLHttpRequestStop(),this.req.onreadystatechange=e,"onerror"in this.req&&(this.req.onerror=function(e){a("XMLHttpRequest error. url: "+this.url)}),this.XMLHttpRequestReStart(t)},this.getUrl=function(){return void 0!==this.url&&null!=this.url||(this.url="XMLHttpRequest.xml"),this.url+(this.params||"")},this.XMLHttpRequestReStart=function(e){try{void 0===e&&(e=!0),this.req.open("GET",this.getUrl(),e),e&&("timeout"in this.req&&(this.req.timeout=9e4),"ontimeout"in this.req?this.req.ontimeout=function(){a("XMLHttpRequest timeout")}:(clearTimeout(this.timeout_id_SendReq),this.timeout_id_SendReq=setTimeout(function(){a("XMLHttpRequest timeout 2")},9e4))),this.req.send(null)}catch(e){a(e.message+" url: "+this.url)}},this.XMLHttpRequestStop=function(){null!=this.req&&this.req.abort()},this.ProcessReqChange=function(e){var t=this.req;switch(t.readyState){case 4:if("unknown"==typeof t.status)return consoleError('typeof XMLHttpRequest status == "unknown"'),!0;if(200==t.status)return clearTimeout(this.timeout_id_SendReq),e(this);a("Invalid XMLHttpRequest status : "+t.status+" url: "+this.url);break;case 1:case 2:case 3:break;case 0:default:throw"processReqChange(); req.readyState = "+t.readyState}return!0},this.processStatus200Error=function(){var e=this.GetElementText("error",!0);return!!e&&(a(e),!0)},this.GetElementText=function(e,t){var n=this.req;if(!n.responseXML)return 1!=t&&a("GetXMLElementText(xmlhttp, "+e+"); xmlhttp.responseXML is null.\nxmlhttp.responseText:\n"+n.responseText),null;var o=n.responseXML.getElementsByTagName(e);if(0==o.length)return 1!=t&&a('GetXMLElementText(xmlhttp, "'+e+'"); element.length == '+o.length),"";for(var i="",r=0;r<o.length;r++)if(void 0===o[r].textContent){if(void 0===o[r].text)return a("GetXMLElementText(xmlhttp, "+e+"); element["+r+"].text) == undefined"),"";""!=i&&(i+=" "),i+=o[r].text}else i+=o[r].textContent;return i},t.data)this.req=t.data.req,this.url=t.data.url,this.params=t.data.params;else try{this.req=this.loadXMLDoc()}catch(e){var n=void 0===e.message?e:e.message;return void a("Your browser is too old and is not compatible with our site.\n\n"+window.navigator.appName+" "+window.navigator.appVersion+"\n\n"+n)}function a(e){console.error(e),t.onerror(e)}this.req||consoleError("Invalid myRequest.req: "+this.req)}function nn(t,n){(n=n||{}).onload=n.onload||function(){},n.onerror=n.onerror||function(){};var o,e=new tn(n);return e.url=t,e.XMLHttpRequestStart(function(){e.ProcessReqChange(function(e){e.processStatus200Error()||(o=e.req.responseText,n.onload(o,t))})},!1),o}
/**
 * node.js version of the load JavaScript file
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * Thanks to:
 *http://javascript.ru/forum/events/21439-dinamicheskaya-zagruzka-skriptov.html
 *https://learn.javascript.ru/onload-onerror
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function on(e,t){if(t.tag=t.tag||{},"string"==typeof t.tag){if("style"!==t.tag)return void console.error("Invalid options.tag: "+t.tag);t.tag={name:"style",attribute:{name:"rel",value:"stylesheet"}}}t.tag.name=t.tag.name||"script";var n=document.createElement(t.tag.name);t.tag.attribute=t.tag.attribute||{},t.tag.attribute.name=t.tag.attribute.name||"type",t.tag.attribute.value=t.tag.attribute.value||"text/javascript",n.setAttribute(t.tag.attribute.name,t.tag.attribute.value),e(n),t.appendTo.appendChild(n)}function rn(e,t){for(var n=e.querySelectorAll("script"),o=0;o<n.length;o++)if(n[o].id===t)return 1}var an,_t={sync:function(t,n){if((n=n||{}).onload=n.onload||function(){},n.onerror=n.onerror||function(){},n.appendTo=n.appendTo||document.getElementsByTagName("head")[0],rn(n.appendTo,t))n.onload();else if(t instanceof Array){for(var o,i={appendTo:n.appendTo,tag:n.tag,onload:function(e,t){console.log("loadScript.sync.onload: "+t)},onerror:function(e){n.onerror(e),o=e}},e=0;e<t.length;e++){var r=t[e];if(on(function(e){e.setAttribute("id",r),e.innerHTML=nn(r,i)},i),void 0!==o)break}void 0===o&&n.onload()}else on(function(e){e.setAttribute("id",t),e.innerHTML=nn(t,n)},n)},async:function(e,o){var i;function r(t){function n(){e instanceof Array&&i<e.length-1?r(e[++i]):o.onload()}rn(o.appendTo,t,o.onload)?n():on(function(e){e.setAttribute("id",t),e.readyState&&!e.onload?e.onreadystatechange=function(){"complete"==e.readyState&&void 0!==o.onload&&o.onload(),"loaded"==e.readyState&&(setTimeout(o.onload,0),this.onreadystatechange=null)}:(e.onload=function(){console.log("loadScript.async.onload() "+t),void 0!==o.onload&&n()},e.onerror=function(e){var t='loadScript: "'+this.src+'" failed';void 0!==o.onerror&&o.onerror(t,e),console.error(t)}),e.src=t},o)}(o=o||{}).appendTo=o.appendTo||document.getElementsByTagName("head")[0],o.onload=o.onload||function(){},e instanceof Array?r(e[i=0]):r(e)}},C=(an=function(){if(document.currentScript&&""!==document.currentScript.src)return document.currentScript.src;var e=document.getElementsByTagName("script");return""!==e[e.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]}()).substring(0,an.lastIndexOf("/"));
/**
 * @module ColorPicker
 * @description Pure JavaScript color picker.
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * Thanks to https://github.com/DavidDurman/FlexiColorPicker
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 */_t.sync(C+"/colorpicker.css",{tag:"style"});function sn(e,t){Le.THREE.EventDispatcher;var o,i,r,a,s,l,n=Le.THREE.MOUSE,c=Le.THREE.Quaternion,u=Le.THREE.Spherical,d=Le.THREE.TOUCH,p=Le.THREE.Vector2,f=Le.THREE.Vector3;void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new f,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:n.ROTATE,MIDDLE:n.DOLLY,RIGHT:n.PAN},this.touches={ONE:d.ROTATE,TWO:d.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return w.phi},this.getAzimuthalAngle=function(){return w.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",ie),this._domElementKeyEvents=e},this.saveState=function(){h.target0.copy(h.target),h.position0.copy(h.object.position),h.zoom0=h.object.zoom},this.reset=function(){h.target.copy(h.target0),h.object.position.copy(h.position0),h.object.zoom=h.zoom0,h.object.updateProjectionMatrix(),h.dispatchEvent(m),h.update(),v=b.NONE},this.update=(o=new f,i=(new c).setFromUnitVectors(e.up,new f(0,1,0)),r=i.clone().invert(),a=new f,s=new c,l=2*Math.PI,function(){var e=h.object.position;o.copy(e).sub(h.target),o.applyQuaternion(i),w.setFromVector3(o),h.autoRotate&&v===b.NONE&&H(2*Math.PI/60/60*h.autoRotateSpeed),h.enableDamping?(w.theta+=x.theta*h.dampingFactor,w.phi+=x.phi*h.dampingFactor):(w.theta+=x.theta,w.phi+=x.phi);var t=h.minAzimuthAngle,n=h.maxAzimuthAngle;return isFinite(t)&&isFinite(n)&&(t<-Math.PI?t+=l:t>Math.PI&&(t-=l),n<-Math.PI?n+=l:n>Math.PI&&(n-=l),w.theta=t<=n?Math.max(t,Math.min(n,w.theta)):w.theta>(t+n)/2?Math.max(t,w.theta):Math.min(n,w.theta)),w.phi=Math.max(h.minPolarAngle,Math.min(h.maxPolarAngle,w.phi)),w.makeSafe(),w.radius*=E,w.radius=Math.max(h.minDistance,Math.min(h.maxDistance,w.radius)),!0===h.enableDamping?h.target.addScaledVector(C,h.dampingFactor):h.target.add(C),o.setFromSpherical(w),o.applyQuaternion(r),e.copy(h.target).add(o),h.object.lookAt(h.target),!0===h.enableDamping?(x.theta*=1-h.dampingFactor,x.phi*=1-h.dampingFactor,C.multiplyScalar(1-h.dampingFactor)):(x.set(0,0,0),C.set(0,0,0)),E=1,!!(S||a.distanceToSquared(h.object.position)>y||8*(1-s.dot(h.object.quaternion))>y)&&(h.dispatchEvent(m),a.copy(h.object.position),s.copy(h.object.quaternion),!(S=!1))}),this.dispose=function(){h.domElement.removeEventListener("contextmenu",le),h.domElement.removeEventListener("pointerdown",ee),h.domElement.removeEventListener("wheel",oe),h.domElement.removeEventListener("touchstart",re),h.domElement.removeEventListener("touchend",se),h.domElement.removeEventListener("touchmove",ae),h.domElement.ownerDocument.removeEventListener("pointermove",te),h.domElement.ownerDocument.removeEventListener("pointerup",ne),null!==h._domElementKeyEvents&&h._domElementKeyEvents.removeEventListener("keydown",ie)};var h=this,m={type:"change"},_={type:"start"},g={type:"end"},b={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},v=b.NONE,y=1e-6,w=new u,x=new u,E=1,C=new f,S=!1,O=new p,T=new p,k=new p,A=new p,P=new p,L=new p,R=new p,M=new p,N=new p;function j(){return Math.pow(.95,h.zoomSpeed)}function H(e){x.theta-=e}function D(e){x.phi-=e}var z,B,V,F=(z=new f,function(e,t){z.setFromMatrixColumn(t,0),z.multiplyScalar(-e),C.add(z)}),I=(B=new f,function(e,t){!0===h.screenSpacePanning?B.setFromMatrixColumn(t,1):(B.setFromMatrixColumn(t,0),B.crossVectors(h.object.up,B)),B.multiplyScalar(e),C.add(B)}),G=(V=new f,function(e,t){var n,o=h.domElement;h.object.isPerspectiveCamera?(n=h.object.position,V.copy(n).sub(h.target),n=V.length(),n*=Math.tan(h.object.fov/2*Math.PI/180),F(2*e*n/o.clientHeight,h.object.matrix),I(2*t*n/o.clientHeight,h.object.matrix)):h.object.isOrthographicCamera?(F(e*(h.object.right-h.object.left)/h.object.zoom/o.clientWidth,h.object.matrix),I(t*(h.object.top-h.object.bottom)/h.object.zoom/o.clientHeight,h.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),h.enablePan=!1)});function X(e){h.object.isPerspectiveCamera?E/=e:h.object.isOrthographicCamera?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom*e)),h.object.updateProjectionMatrix(),S=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),h.enableZoom=!1)}function U(e){h.object.isPerspectiveCamera?E*=e:h.object.isOrthographicCamera?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom/e)),h.object.updateProjectionMatrix(),S=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),h.enableZoom=!1)}function Y(e){O.set(e.clientX,e.clientY)}function W(e){A.set(e.clientX,e.clientY)}function q(e){var t;1==e.touches.length?O.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),e=.5*(e.touches[0].pageY+e.touches[1].pageY),O.set(t,e))}function K(e){var t;1==e.touches.length?A.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),e=.5*(e.touches[0].pageY+e.touches[1].pageY),A.set(t,e))}function J(e){var t=e.touches[0].pageX-e.touches[1].pageX,e=e.touches[0].pageY-e.touches[1].pageY,e=Math.sqrt(t*t+e*e);R.set(0,e)}function Z(e){var t;1==e.touches.length?T.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY),T.set(t,n)),k.subVectors(T,O).multiplyScalar(h.rotateSpeed);var n=h.domElement;H(2*Math.PI*k.x/n.clientHeight),D(2*Math.PI*k.y/n.clientHeight),O.copy(T)}function Q(e){var t;1==e.touches.length?P.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),e=.5*(e.touches[0].pageY+e.touches[1].pageY),P.set(t,e)),L.subVectors(P,A).multiplyScalar(h.panSpeed),G(L.x,L.y),A.copy(P)}function $(e){var t=e.touches[0].pageX-e.touches[1].pageX,e=e.touches[0].pageY-e.touches[1].pageY,e=Math.sqrt(t*t+e*e);M.set(0,e),N.set(0,Math.pow(M.y/R.y,h.zoomSpeed)),X(N.y),R.copy(M)}function ee(e){if(!1!==h.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){var t;switch(e.preventDefault(),(h.domElement.focus?h.domElement:window).focus(),e.button){case 0:t=h.mouseButtons.LEFT;break;case 1:t=h.mouseButtons.MIDDLE;break;case 2:t=h.mouseButtons.RIGHT;break;default:t=-1}switch(t){case n.DOLLY:if(!1===h.enableZoom)return;!function(e){R.set(e.clientX,e.clientY)}(e),v=b.DOLLY;break;case n.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===h.enablePan)return;W(e),v=b.PAN}else{if(!1===h.enableRotate)return;Y(e),v=b.ROTATE}break;case n.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===h.enableRotate)return;Y(e),v=b.ROTATE}else{if(!1===h.enablePan)return;W(e),v=b.PAN}break;default:v=b.NONE}v!==b.NONE&&(h.domElement.ownerDocument.addEventListener("pointermove",te),h.domElement.ownerDocument.addEventListener("pointerup",ne),h.dispatchEvent(_))}(e)}}function te(e){if(!1!==h.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===h.enabled)return;switch(e.preventDefault(),v){case b.ROTATE:if(!1===h.enableRotate)return;!function(e){T.set(e.clientX,e.clientY),k.subVectors(T,O).multiplyScalar(h.rotateSpeed),e=h.domElement,H(2*Math.PI*k.x/e.clientHeight),D(2*Math.PI*k.y/e.clientHeight),O.copy(T),h.update()}(e);break;case b.DOLLY:if(!1===h.enableZoom)return;!function(e){M.set(e.clientX,e.clientY),N.subVectors(M,R),0<N.y?X(j()):N.y<0&&U(j()),R.copy(M),h.update()}(e);break;case b.PAN:if(!1===h.enablePan)return;!function(e){P.set(e.clientX,e.clientY),L.subVectors(P,A).multiplyScalar(h.panSpeed),G(L.x,L.y),A.copy(P),h.update()}(e)}}(e)}}function ne(e){switch(e.pointerType){case"mouse":case"pen":!function(){if(h.domElement.ownerDocument.removeEventListener("pointermove",te),h.domElement.ownerDocument.removeEventListener("pointerup",ne),!1===h.enabled)return;h.dispatchEvent(g),v=b.NONE}()}}function oe(e){!1===h.enabled||!1===h.enableZoom||v!==b.NONE&&v!==b.ROTATE||(e.preventDefault(),e.stopPropagation(),h.dispatchEvent(_),(e=e).deltaY<0?U(j()):0<e.deltaY&&X(j()),h.update(),h.dispatchEvent(g))}function ie(e){!1!==h.enabled&&!1!==h.enablePan&&function(e){var t=!1;switch(e.keyCode){case h.keys.UP:G(0,h.keyPanSpeed),t=!0;break;case h.keys.BOTTOM:G(0,-h.keyPanSpeed),t=!0;break;case h.keys.LEFT:G(h.keyPanSpeed,0),t=!0;break;case h.keys.RIGHT:G(-h.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),h.update())}(e)}function re(e){if(!1!==h.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(h.touches.ONE){case d.ROTATE:if(!1===h.enableRotate)return;q(e),v=b.TOUCH_ROTATE;break;case d.PAN:if(!1===h.enablePan)return;K(e),v=b.TOUCH_PAN;break;default:v=b.NONE}break;case 2:switch(h.touches.TWO){case d.DOLLY_PAN:if(!1===h.enableZoom&&!1===h.enablePan)return;t=e,h.enableZoom&&J(t),h.enablePan&&K(t),v=b.TOUCH_DOLLY_PAN;break;case d.DOLLY_ROTATE:if(!1===h.enableZoom&&!1===h.enableRotate)return;t=e,h.enableZoom&&J(t),h.enableRotate&&q(t),v=b.TOUCH_DOLLY_ROTATE;break;default:v=b.NONE}break;default:v=b.NONE}var t;v!==b.NONE&&h.dispatchEvent(_)}}function ae(e){var t;if(!1!==h.enabled)switch(e.preventDefault(),e.stopPropagation(),v){case b.TOUCH_ROTATE:if(!1===h.enableRotate)return;Z(e),h.update();break;case b.TOUCH_PAN:if(!1===h.enablePan)return;Q(e),h.update();break;case b.TOUCH_DOLLY_PAN:if(!1===h.enableZoom&&!1===h.enablePan)return;t=e,h.enableZoom&&$(t),h.enablePan&&Q(t),h.update();break;case b.TOUCH_DOLLY_ROTATE:if(!1===h.enableZoom&&!1===h.enableRotate)return;t=e,h.enableZoom&&$(t),h.enableRotate&&Z(t),h.update();break;default:v=b.NONE}}function se(e){!1!==h.enabled&&(h.dispatchEvent(g),v=b.NONE)}function le(e){!1!==h.enabled&&e.preventDefault()}h.domElement.addEventListener("contextmenu",le),h.domElement.addEventListener("pointerdown",ee),h.domElement.addEventListener("wheel",oe),h.domElement.addEventListener("touchstart",re),h.domElement.addEventListener("touchend",se),h.domElement.addEventListener("touchmove",ae),this.update()}function ln(e,t){sn.call(this,e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=MOUSE.PAN,this.mouseButtons.RIGHT=MOUSE.ROTATE,this.touches.ONE=TOUCH.PAN,this.touches.TWO=TOUCH.DOLLY_ROTATE}var cn=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",un=0,dn=new function e(){S(this,e);var n=this;function m(e,t,n){for(var o in e=document.createElementNS("http://www.w3.org/2000/svg",e),t)e.setAttribute(o,t[o]);"[object Array]"!=Object.prototype.toString.call(n)&&(n=[n]);for(var i=0,r=n[0]&&n.length||0;i<r;i++)e.appendChild(n[i]);return e}this.paletteIndexes={BGYW:0,monochrome:1,bidirectional:2,rainbow:3},this.create=function(e,i){function r(){return"horizontal"===i.orientation}if((i=i||{}).orientation=i.orientation||"horizontal",void 0===i.direction&&(i.direction=!0),i.style=i.style||{},i.style.width=i.style.width||(r()?200:30),i.style.height=i.style.height||(r()?30:200),i.onError=i.onError||function(){},e instanceof HTMLElement!=!0){if("string"!=typeof e)return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e);if(null===(e=document.getElementById(e)))return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e)}for(var t in e.classList.add("slider-wrapper"),i.style)e.style[t]=i.style[t];var o,n,a,s,l,c=i.palette instanceof this.palette?i.palette:new this.palette(i);function u(){return"string"==typeof i.style.height?parseInt(i.style.height):i.style.height}function d(){return f.clientWidth}function p(e,t){var n;void 0!==o?void 0!==(n=c.hsv2rgb(e))?(e=n.percent,void 0===t&&(t=r()?d()*e/100:u()-u()*(i.direction?e:100-e)/100),function(e){if(void 0===o)return;r()?e<0||e>d()?console.error("ColorPicker.positionIndicators: Invalid position = "+e):(o.style.top="0px",o.style.left=(i.direction?e:d()-e)-o.offsetWidth/2+"px"):e<0||e>u()?console.error("ColorPicker.positionIndicators: Invalid position = "+e):(o.style.left="0px",o.style.top=e-o.offsetHeight/2+"px")}(t),void 0!==i.sliderIndicator.callback&&i.sliderIndicator.callback(n)):console.error("ColorPicker.setValue: invalud c = "+n):console.error("Set value of this instance of the ColorPicker is impossible because options.sliderIndicator is not defined.")}if(void 0!==i.sliderIndicator&&((o=document.createElement("div")).className="slider-indicator",r()?o.style.width="10px":o.style.height="10px",e.appendChild(o),o.style.pointerEvents="none"),"SVG"==cn){try{var f=m("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:r()?"100%":i.style.width,height:i.style.height},[m("defs",{},m("linearGradient",{id:"gradient-hsv-"+un,x1:r()&&i.direction?"100%":"0%",y1:r()||i.direction?"0%":"100%",x2:r()&&!i.direction?"100%":"0%",y2:!r()&&i.direction?"100%":"0%"},c.getPalette())),m("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv-"+un+")"})]);void 0!==o&&(f.style.cursor=r()?"e-resize":"s-resize",o.style.cursor=f.style.cursor)}catch(e){console.error("Create SVG element failed! "+e.message)}e.appendChild(f),e.style.height=u()+"px",void 0!==o&&(r()?o.style.height=parseInt(i.style.height)-2+"px":o.style.width=parseInt(i.style.width)-2+"px",i.sliderIndicator.value=i.sliderIndicator.value||0,p(i.sliderIndicator.value)),un++}else console.error("Under constraction");function h(e){var t,n,o;e.x=parseInt(e.x),e.y=parseInt(e.y),r()?(t=e.x,n=d()-1,t>=d()&&(t=n),o=100*t/n,i.direction||(o=100-o,t=n-t)):(t=e.y,n=u()-1,t>=u()&&(t=n),o=100*(1-t/n),i.direction||(o=100-o)),p(o,t)}return void 0!==o&&(n=function(){return function(e){l||h(function(e){if(window.event&&void 0!==window.event.contentOverflow)return{x:window.event.offsetX,y:window.event.offsetY};if(void 0!==e.offsetX&&void 0!==e.offsetY)return{x:e.offsetX,y:e.offsetY};var t=e.target.parentNode.parentNode;return{x:e.layerX-t.offsetLeft,y:e.layerY-t.offsetTop}}(e=e||window.event))}},l=!(s=function(e,i){var t=f;a(t,"touchstart",function(e){}),a(t,"touchmove",function(e){e.preventDefault();var t=e.srcElement.getBoundingClientRect(),n=e.touches[0].clientX-t.left,t=e.touches[0].clientY-t.top;n<0&&(n=0),t<0&&(t=0),h({x:n,y:t})}),a(t,"touchend",function(e){}),a(t,"mousedown",function(e){var n="mouseup",o="mousemove";a(window,n,function e(){function t(e,t,n){null!==e&&(e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener&&e.removeEventListener(t,n,!1))}t(window,n,e),t(window,o,i)}),a(window,o,i)}),a(t,"mouseout",function(e){l=!0}),a(t,"mouseover",function(e){l=!1})}),(a=function(e,t,n){null!==e&&(e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,!1))})(f,"click",n()),s(0,n())),{setValue:p}},this.palette=function(p){function e(e,t,n,o){return{percent:e,r:t,g:n,b:o}}void 0===(p=p||{}).palette&&(p.palette=n.paletteIndexes.BGYW),this.getPaletteIndex=function(){return p.palette};var f=[new e(0,0,0,255),new e(33,0,255,0),new e(66,255,255,0),new e(100,255,255,255)];switch(x(p.palette)){case"number":switch(p.palette){case n.paletteIndexes.BGYW:break;case n.paletteIndexes.monochrome:f=[new e(0,0,0,0),new e(100,255,255,255)];break;case n.paletteIndexes.bidirectional:f=[new e(0,255,48,48),new e(50,48,48,48),new e(100,48,255,48)];break;case n.paletteIndexes.rainbow:f=[new e(0,255,50,50),new e(16,252,245,40),new e(32,40,252,40),new e(50,40,252,248),new e(66,39,46,249),new e(82,255,40,251),new e(100,255,50,50)];break;default:console.error("ColorPicker.create.Palette: invalid options.palette = "+p.palette)}break;case"object":if(Array.isArray(p.palette)){f=p.palette;break}default:var t="invalid options.palette = "+p.palette;console.error("ColorPicker.create.Palette: "+t),p.onError(t)}this.getPalette=function(){var t=[];return f.forEach(function(e){t.unshift(m("stop",{offset:100-e.percent+"%","stop-color":"#"+("0"+Number(e.r).toString(16)).slice(-2).toUpperCase()+("0"+Number(e.g).toString(16)).slice(-2).toUpperCase()+("0"+Number(e.b).toString(16)).slice(-2).toUpperCase(),"stop-opacity":"1"}))}),t},this.hsv2rgb=function(e,t,n){var i=parseFloat(e);void 0!==t&&void 0!==n&&(i=100/(n-t)*(i-t));var o,r,a=f[f.length-1];100!==a.percent&&(o={},Object.keys(a).forEach(function(e){o[e]=a[e]}),o.percent=100,f.push(o));for(var s=0;s<f.length;s++){var l=f[s];if(void 0===r&&(r=l),i>=r.percent&&i<=l.percent){var c=function(e,t,n,o){n-=e;return 0==n?t:Math.round(t+(o-t)/n*(i-e))},u=c(r.percent,r.r,l.percent,l.r),d=c(r.percent,r.g,l.percent,l.g),c=c(r.percent,r.b,l.percent,l.b);return{r:u,g:d,b:c,hex:"#"+(16777216|c|d<<8|u<<16).toString(16).slice(1),percent:i}}r=l}void 0!==p.onError&&p.onError("Invalid color value of the ColorPicker: "+e)},this.toColor=function(e,t,n){var o=Le.THREE;if(e instanceof o.Color)return e;n=this.hsv2rgb(e,t,n);return void 0===n&&(n={r:255,g:255,b:255}),new o.Color("rgb("+n.r+", "+n.g+", "+n.b+")")}}};
/**
 * @module cookie
 * @description node.js version of the cookie.
 * Cookies let you store user information in web pages.
 * @see {@link https://www.w3schools.com/js/js_cookies.asp}
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
function pn(){return navigator.cookieEnabled}function fn(e,t,n){pn()?(t=t.toString(),void 0===n&&(n=new Date).setTime(n.getTime()+31536e6),document.cookie=e+"="+t+("undefined"==typeof settings?"":settings)+"; expires="+n.toGMTString(),""===document.cookie&&console.error("document.cookie is empty")):_n()}function hn(e,t){if(pn()){e=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return e?unescape(e[2]):void 0===t?"":t}_n()}function mn(e,t){return JSON.parse(hn(e,JSON.stringify(t)))}function _n(){console.error("navigator.cookieEnabled = "+navigator.cookieEnabled)}function gn(e){this.get=function(e){return e},this.set=function(){},this.getObject=function(e,n,o){o&&Object.keys(o).forEach(function(e){var t=o[e];void 0!==t&&"function"!=typeof t&&(n[e]=JSON.parse(JSON.stringify(t)))})},this.copyObject=function(e,t){return JSON.parse(JSON.stringify(t))},this.setObject=function(){},this.isTrue=function(e){return e}}
/**
* node.js version of the cookie.
*
* @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
*
* @copyright 2011 Data Arts Team, Google Creative Lab
*
* @license under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*/var bn={set:fn,setObject:function(e,t){fn(e,JSON.stringify(t))},get:hn,getObject:function(e,t,n){(new gn).getObject(e,t,mn(e,n))},copyObject:mn,defaultCookie:gn};
/**
 * @module Localization.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function vn(){return(navigator?void 0!==navigator.languages&&"unknown"!=typeof navigator.languages&&0<navigator.languages.length?navigator.languages[0]:navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage||(console.error("getLocale() failed!"),""):(console.error("getLocale() failed! !navigator"),"")).toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/)[1]}
/**
 * @module CreateFullScreenSettings
 * @description creates functions for resize of the canvas to fullscreen and restore to default size.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function yn(n,o,i,r){var a,t,s,l=!1;r.fullScreen=r.fullScreen||{},r.canvasMenu&&(a=r.canvasMenu),r.stereoEffect&&(t=r.stereoEffect),o.setSize(o.domElement.width,o.domElement.height),this.isFullScreen=function(){return l},this.setStereoEffect=function(e){t=e},this.setFullScreen=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=new n.Vector2;o.getSize(t),(l=e)?void 0!==s&&(o.setSize(s.sizeOriginal.x,s.sizeOriginal.y),o.domElement.style.position=s.position,o.domElement.style.left=s.left,o.domElement.style.top=s.top,o.domElement.style.width=s.width,o.domElement.style.height=s.height):(void 0===s&&(s={sizeOriginal:new n.Vector2,position:o.domElement.style.position,left:o.domElement.style.left,top:o.domElement.style.top,width:o.domElement.style.width,height:o.domElement.style.height},o.getSize(s.sizeOriginal)),o.setSize(window.innerWidth,window.innerHeight),o.domElement.style.position="fixed",o.domElement.style.left=0,o.domElement.style.top=0,o.domElement.style.width="100%",o.domElement.style.height="100%"),void 0!==r.fullScreen.onFullScreenToggle&&r.fullScreen.onFullScreenToggle(l),i.aspect=t.x/t.y,i.updateProjectionMatrix(),l=!l,a&&a.setFullScreenButton&&a.setFullScreenButton(l),yn.RendererSetSize(o,r.canvasMenu)},this.onclick=function(){return void 0!==t&&parseInt(t.settings.spatialMultiplex)!==En.spatialMultiplexsIndexs.Mono&&(t.settings.spatialMultiplex=En.spatialMultiplexsIndexs.Mono),this.setFullScreen(l),l}}
/**
 * @module SpriteText
 * @description A sprite based text component. Text that always faces towards the camera.
 * @see {@link https://threejs.org/docs/index.html#api/en/objects/Sprite|THREE.Sprite}
 *
 * @author Andrej Hristoliubov. {@link https://anhr.github.io/AboutMe/|AboutMe}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/
function wn(E,C){var S=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e=Le.THREE;C=C||new e.Vector3(0,0,0);var O=new e.Sprite(new e.SpriteMaterial({map:new e.Texture,sizeAttenuation:void 0!==S.sizeAttenuation&&S.sizeAttenuation})),T=document.createElement("canvas");O.material.map.minFilter=e.LinearFilter;var k=T.getContext("2d");return S.name&&(O.name=S.name),O.userData.update=function(){var e={};O.parent?xn(O.parent,e):S.group&&xn(S.group,e);var t=S.textHeight||e.textHeight||.04,n=S.fov||e.fov,o=S.sizeAttenuation||e.sizeAttenuation||!1,i=S.rotation||e.rotation||0,r=S.fontFace||e.fontFace||"Arial",a=S.bold||e.bold||!1,s=S.italic||e.italic||!1,l=S.fontProperties||e.fontProperties||"",c=S.rect||e.rect||{},u=S.fontColor||e.fontColor||"rgba(255, 255, 255, 1)",e=wn.getCenter(S.center||e.center,C);void 0!==n&&(t=n*t/50),c.displayRect=c.displayRect||!1;var d=c.borderThickness||5,r=l+(a?"bold ":"")+(s?"italic ":"")+"90px "+r;k.font=r;var p,f,h,m,_,g,b,v=0,y=1;if("string"==typeof E?(y=0,(p=E.split(/\r\n|\r|\n/)).forEach(function(e){e=k.measureText(e).width;v<e&&(v=e),y+=1})):v=k.measureText(E).width,v+=2*d,T.width=v,T.height=90*y+2*d,k.font=r,c.displayRect&&(k.fillStyle=c.backgroundColor||"rgba(0, 0, 0, 1)",k.strokeStyle=c.borderColor||u,k.lineWidth=d,f=k,m=h=d/2,_=T.width-d,g=T.height-d,b=void 0===c.borderRadius?0:c.borderRadius,f.beginPath(),f.moveTo(h+b,m),f.lineTo(h+_-b,m),f.quadraticCurveTo(h+_,m,h+_,m+b),f.lineTo(h+_,m+g-b),f.quadraticCurveTo(h+_,m+g,h+_-b,m+g),f.lineTo(h+b,m+g),f.quadraticCurveTo(h,m+g,h,m+g-b),f.lineTo(h,m+b),f.quadraticCurveTo(h,m,h+b,m),f.closePath(),f.fill(),f.stroke()),k.fillStyle=u,k.textBaseline="bottom",1<y)for(var w=0;w<p.length;w++){var x=p[w];k.fillText(x,d,T.height-90*(p.length-w-1)-d)}else k.fillText(E,d,T.height-d);O.material.map.image=T,O.material.map.needsUpdate=!0;t*=y;O.scale.set(t*T.width/T.height,t),O.position.copy(C),O.center=e,O.material.sizeAttenuation=o,O.material.rotation=i,O.material.needsUpdate=!0},O.userData.update(),O.userData.updateText=function(e){E=e;e={};xn(O.parent,e),O.userData.update(e)},S.group&&S.group.add(O),O.userData.optionsSpriteText=S,O}function xn(t,n){for(t.userData.optionsSpriteText&&Object.keys(t.userData.optionsSpriteText).forEach(function(e){void 0===n[e]&&(n[e]=t.userData.optionsSpriteText[e])});t.parent;)xn(t=t.parent,n)}yn.RendererSetSize=function(r,a){r.setSizeOld||(r.setSizeOld=r.setSize,r.setSize=function(e,t,n){r.setSizeOld(e,t,n);var o=r.domElement,i=o.parentElement;setTimeout(function(){i.style.height=o.style.height,i.style.width=o.style.width,i.style.left=o.style.left,i.style.top=o.style.top,i.style.position=o.style.position,a&&a.setSize(e,t)},0)})},wn.getCenter=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=Le.THREE,o=e.canvas||void 0;var i,r,a,s=e.canvas?(i=o.width/2,r=o.height/2,(a=(new n.Vector3).copy(t)).project(e.camera),a.x=a.x*i+i,a.y=-a.y*r+r,a):void 0;return e instanceof n.Vector2||"object"===(void 0===e?"undefined":x(e))&&void 0!==e.x&&void 0!==e.y?e:s?new n.Vector2(s.x<o.width/2?0:1,s.y<o.height/2?1:0):new n.Vector2(0,1)},wn.updateSpriteTextGroup=function(e){var t=Le.THREE;e.children.forEach(function(e){e instanceof t.Sprite&&void 0!==e.userData.update&&e.userData.update(),wn.updateSpriteTextGroup(e)})};
/**
 * @module StereoEffect
 * @description Uses dual PerspectiveCameras for Parallax Barrier effects.
 * @see About {@link https://en.wikipedia.org/wiki/Parallax_barrier|Parallax barrier}.
 *
 * @author {@link https://anhr.github.io/AboutMe/|Andrej Hristoliubov}
 * @author {@link http://alteredqualia.com/|alteredq}
 * @author {@link http://mrdoob.com/|mrdoob}
 * @author {@link http://aleksandarrodic.com/|arodic}
 * @author {@link http://fonserbc.github.io/|fonserbc}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/
var En=function e(_){var g,b,v,y,w,x,E=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Tn;function C(t){t=t||{};var n={stereoEffects:"Stereo effects",spatialMultiplexName:"Spatial  multiplex",spatialMultiplexTitle:"Choose a way to do spatial multiplex.",spatialMultiplexs:{Mono:Cn.Mono,"Side by side":Cn.SbS,"Top and bottom":Cn.TaB},eyeSeparationName:"Eye separation",eyeSeparationTitle:"The distance between left and right cameras.",focus:"Focus",focusTitle:"Object distance.",zeroParallaxName:"Zero parallax",zeroParallaxTitle:"Distance to objects with zero parallax.",defaultButton:"Default",defaultTitle:"Restore default stereo effects settings."},e=void 0===t.getLanguageCode?"en":t.getLanguageCode();switch(e){case"ru":n.stereoEffects=" ",n.spatialMultiplexName="",n.spatialMultiplexTitle="    .",n.spatialMultiplexs={"":Cn.Mono," ":Cn.SbS," ":Cn.TaB},n.eyeSeparationName=" ",n.eyeSeparationTitle="     .",n.focus="",n.focusTitle="  .",n.zeroParallaxName=" 0",n.zeroParallaxTitle="     .",n.defaultButton="",n.defaultTitle="     .";break;default:if(void 0===t.lang||t.lang._languageCode!=e)break;Object.keys(t.lang).forEach(function(e){void 0!==n[e]&&(n[e]=t.lang[e])})}return n}S(this,e),_?(E.boOptions||(E=new Tn(E)),!1!==E.stereoEffect&&(E.dat.gui&&(E.dat.mouseenter=!1),g=Le.THREE,Sn(),E.stereoEffect=E.stereoEffect||{},b=E.stereoEffect,this.settings=b,(this.options=E).stereoEffect=this,void 0===b.spatialMultiplex&&(b.spatialMultiplex=Cn.Mono),b.stereo=new g.StereoCamera,b.stereo.aspect=b.stereoAspect||1,void 0===b.far&&(b.far=(new g.PerspectiveCamera).focus),b.focus=void 0===b.camera?(new g.PerspectiveCamera).focus:(new g.Vector3).distanceTo(b.camera.position),b.zeroParallax=0,b.eyeSep=b.eyeSep||(new g.StereoCamera).eyeSep/10*b.far,void 0!==b.camera&&(b.camera.focus=b.focus),this.setEyeSeparation=function(e){b.stereo.eyeSep=e},this.setEyeSeparation(b.eyeSep),this.getRendererSize=function(){return Tn.raycaster.EventListeners.getRendererSize(_,b.elParent)},this.render=function(e,t){var n=parseInt(b.spatialMultiplex);b.rememberSize&&!v&&(v=w&&w.getFullScreenSettings?w.getFullScreenSettings(this):new yn(g,_,t,{canvasMenu:w,stereoEffect:this})),e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld();var o=new g.Vector2;_.getSize(o),_.autoClear&&_.clear(),_.setScissorTest(!0);var i=b.zeroParallax;function r(e){return v&&y!==n&&(y=n,e.setControllerSpatialMultiplex?e.setControllerSpatialMultiplex(n):e.setSpatialMultiplex&&e.setSpatialMultiplex(n),1)}function a(e,t){r(t)&&v.setFullScreen(e)}switch(n){case Cn.Mono:return _.setScissor(0,0,o.width,o.height),_.setViewport(0,0,o.width,o.height),_.render(e,t),_.setScissorTest(!1),void r(this);case Cn.SbS:var s=o.width/2,l=0+i,c=0,u=s,d=o.height,p=s-i,f=0,h=s,m=o.height;a(!1,this);break;case Cn.TaB:l=0+i,c=0,u=o.width,d=o.height/2,p=0-i,f=o.height/2,h=o.width,m=o.height/2,a(!1,this);break;default:console.error('THREE.StereoEffect.render: Invalid "Spatial  multiplex" parameter: '+n)}b.stereo.update(t),_.setScissor(l,c,u,d),_.setViewport(l,c,u,d),_.render(e,b.stereo.cameraL),_.setScissor(p,f,h,m),_.setViewport(p,f,h,m),_.render(e,b.stereo.cameraR),_.setScissorTest(!1)},this.gui=function(){var e,t,n,o,i,r,a,s,l,c,u,d,p=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},f=p.folder||E.dat.gui;function h(e){e=e==Cn.Mono?"none":"block";a.domElement.style.display=e,void 0!==l&&(l.__li.style.display=e),u.__li.style.display=e,c.__li.style.display=e}function m(e){var t;d&&(t={},Object.keys(o).forEach(function(e){t[e]=b[e]}),E.dat.cookie.setObject(e,t))}f&&!1!==E.dat.stereoEffectsGui&&(e=p.dat||Le.dat,void 0===p&&(p={}),p.scale=p.scale||1,t=E.dat.getCookieName("StereoEffect"),n=C({getLanguageCode:E.getLanguageCode,lang:E.lang}),o={spatialMultiplex:b.spatialMultiplex,eyeSep:(new g.StereoCamera).eyeSep/10*b.far,focus:b.focus,zeroParallax:0},Object.freeze(o),E.dat.cookie.getObject(t,b,o),b.spatialMultiplex=parseInt(b.spatialMultiplex),this.setSpatialMultiplex&&this.setSpatialMultiplex(b.spatialMultiplex),i=f.addFolder(n.stereoEffects),r=i.add(b,"spatialMultiplex",n.spatialMultiplexs).onChange(function(e){h(e=parseInt(e)),m(t),p.onChangeMode&&p.onChangeMode(e),x&&x.select(e)}),e.controllerNameAndTitle(r,n.spatialMultiplexName,n.spatialMultiplexTitle),this.setControllerSpatialMultiplex=function(e){d=!1,r.setValue(e),d=!0},a=i.addFolder(n.eyeSeparationName),e.folderNameAndTitle(a,n.eyeSeparationName,n.eyeSeparationTitle),a.add(new Ne(function(e){b.eyeSep+=e,s.setValue(b.eyeSep)},{settings:{offset:.01},min:1e-4,max:.01,step:1e-4})),s=e.controllerZeroStep(a,b.stereo,"eyeSep",function(e){b.eyeSep=e,m(t)}),e.controllerNameAndTitle(s,n.eyeSeparationName,n.eyeSeparationTitle),void 0!==b.camera&&(b.camera.focus=b.focus),b.camera&&(l=i.add(b.camera,"focus",o.focus/10,2*o.focus,o.focus/1e3).onChange(function(e){b.focus=e,m(t)}),e.controllerNameAndTitle(l,n.focus,n.focusTitle)),f=(60-400/9)*p.scale+400/9,c=i.add(b,"zeroParallax",-f,f).onChange(function(e){b.zeroParallax=e,m(t)}),e.controllerNameAndTitle(c,n.zeroParallaxName,n.zeroParallaxTitle),u=i.add({defaultF:function(){b.stereo.eyeSep=o.eyeSep,s.setValue(b.stereo.eyeSep),b.camera&&(b.camera.focus=o.focus,l.setValue(b.camera.focus)),b.zeroParallax=o.zeroParallax,c.setValue(b.zeroParallax)}},"defaultF"),e.controllerNameAndTitle(u,n.defaultButton,n.defaultTitle),h(b.spatialMultiplex),d=!0)},this.createCanvasMenuItem=function(e,t){w=e;var n=C({getLanguageCode:(t=t||{}).getLanguageCode,lang:t.lang}),t=Object.keys(n.spatialMultiplexs);x={name:"",title:n.stereoEffects,id:"menuButtonStereoEffects",drop:"up",items:[{name:t[Cn.Mono],id:"menuButtonStereoEffectsMono",radio:!0,checked:b.spatialMultiplex===Cn.Mono,spatialMultiplex:Cn.Mono,onclick:function(){b.spatialMultiplex=Cn.Mono}},{name:t[Cn.SbS],id:"menuButtonStereoEffectsSbS",radio:!0,checked:b.spatialMultiplex===Cn.SbS,spatialMultiplex:Cn.SbS,onclick:function(){b.spatialMultiplex=Cn.SbS}},{name:t[Cn.TaB],id:"menuButtonStereoEffectsTaB",radio:!0,checked:b.spatialMultiplex===Cn.TaB,spatialMultiplex:Cn.TaB,onclick:function(){b.spatialMultiplex=Cn.TaB}}],select:function(t){x.items.forEach(function(e){e.spatialMultiplex===t&&(e.checked||e.elName.onclick({target:e.elName}))})}},this.setSpatialMultiplex=function(e){x.select(e)},e.menu.push(x)})):console.error("StereoEffect: renderer = "+_)};En.spatialMultiplexsIndexs={Mono:0,SbS:1,TaB:2},Object.freeze(En.spatialMultiplexsIndexs);var Cn=En.spatialMultiplexsIndexs;function Sn(){var h=Le.THREE;(new h.Raycaster).setStereoEffect||Object.assign(h.Raycaster.prototype,{setStereoEffect:function(n){(n=n||{}).raycasterEvents=void 0===n.raycasterEvents||n.raycasterEvents;var t,o=n.camera,i=n.renderer;n.raycasterEvents&&(t=new h.Vector2,window.addEventListener("mousemove",function(e){t.x=e.clientX/window.innerWidth*2-1,t.y=2*-(e.clientY/window.innerHeight)+1,c.setFromCamera(t,o),c.stereo.onDocumentMouseMove(e)},!1),window.addEventListener("pointerdown",function(e){c.stereo.onDocumentMouseDown(e)},!1));var r,a,s,l=void 0!==n.stereoEffect?n.stereoEffect:"undefined"!=typeof effect?effect:new En(i,{stereoEffect:{spatialMultiplex:Cn.Mono,far:o?o.far:void 0,camera:o,stereoAspect:1}}),c=this,u=new h.Vector2,d=new h.Vector2;var p=void 0;function f(e){if(void 0!==s){if(e=e||n,parseInt(l.settings.spatialMultiplex)!==Cn.Mono){e=s;return s=u,c.setFromCamera(u,o),t()||(s=d,c.setFromCamera(d,o),t()),void(s=e)}c.setFromCamera(s,o),t()}function t(){var e;return void 0!==r&&(a=Array.isArray(r)?c.intersectObjects(r):c.intersectObject(r)),0<a.length?(e=a[0])&&e.object.userData.raycaster&&e.object.userData.raycaster.onIntersection&&(e.object.userData.raycaster.onIntersection(e,s),p=e.object):p&&(p.userData.raycaster.onIntersectionOut(),p=void 0),0<a.length}}this.stereo={onDocumentMouseMove:function(e){void 0!==r&&(e.preventDefault(),void 0===s&&(s=new h.Vector2),function(){function e(e,t){u.copy(s),d.copy(s);u[e]+=.5,u[e]*=2,d[e]-=.5,d[e]*=2;e=new h.Vector2;i.getSize(e);t=l.settings.zeroParallax/e.x*t;u.x-=t,d.x+=t}switch(l.getRendererSize().getMousePosition(s,event),parseInt(l.settings.spatialMultiplex)){case Cn.Mono:return;case Cn.SbS:e("x",4);break;case Cn.TaB:e("y",2);break;default:console.error("THREE.Raycaster.setStereoEffect.getMousePosition: Invalid effect.settings.spatialMultiplex = "+effect.settings.spatialMultiplex)}}(),f())},onDocumentMouseDown:function(){var e;l.options.dat.mouseenter||a&&0<a.length&&(!a[0].object.userData.raycaster||(e=a[0]).object.userData.raycaster.onMouseDown&&e.object.userData.raycaster.onMouseDown(e))},isAddedToParticles:function(e){return!!r&&r.includes(e)},addParticle:function(e){void 0===r&&(r=[]),this.isAddedToParticles(e)?console.error('Duplicate particle "'+e.name+'"'):r.push(e)},addParticles:function(e){var t;if(void 0!==r)return Array.isArray(r)||(t=r,(r=[]).push(t)),void r.push(e);r=e},removeParticle:function(e){for(var t=0;t<r.length;t++)if(Object.is(e,r[t])){r.splice(t,1);break}},removeParticles:function(){r=void 0},getPosition:function(e){var t=e.object.geometry.attributes.position,n=4<=t.itemSize?new h.Vector4(0,0,0,0):new h.Vector3;return void 0!==e.index?(n.fromArray(t.array,e.index*t.itemSize),n.multiply(e.object.scale),n.add(e.object.position)):n=e.object.position,n}}}})}En.assign=Sn;var On={mesh:"Mesh",pointName:"Point Name",color:"olor",opacity:"Opacity"};"ru"===vn()&&(On.mesh="3D ",On.pointName=" ",On.color="",On.opacity=""),
/**
 * options of the canvas
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
!(En.getTextIntersection=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=Tn.findSpriteTextIntersection(t.spriteOptions.group);if(n)return n;var o=Le.THREE,i=en(e.object,e.index),r=t.scales||{},a=void 0!==e.index&&void 0!==e.object.userData.player&&void 0!==e.object.userData.player.arrayFuncs,s=a?e.object.userData.player.arrayFuncs:void 0,l=void 0===s||"function"==typeof s?void 0:s[e.index],c=a&&l?l.name:void 0,n=a&&void 0!==l?Array.isArray(l.w)?Player.execFunc(l,"w",group.userData.t,t):l.w:void 0,l=!r.x&&!r.y&&!r.z;return t.spriteOptions.name=Tn.findSpriteTextIntersection.spriteTextIntersectionName,new wn((""===e.object.name?"":On.mesh+": "+e.object.name)+(void 0===c?"":"\n"+On.pointName+": "+c)+(l||r.x?"\n"+(r.x&&r.x.name?r.x.name:"X")+": "+i.x:"")+(l||r.y?"\n"+(r.y&&r.y.name?r.y.name:"Y")+": "+i.y:"")+(l||r.z?"\n"+(r.z&&r.z.name?r.z.name:"Z")+": "+i.z:"")+(a&&(s[e.index]instanceof o.Vector4||s[e.index]instanceof o.Vector3||"function"==typeof s)?n instanceof o.Color?"\n"+On.color+": "+new o.Color(n.r,n.g,n.b).getHexString():void 0!==i.w?"\n"+(r.w&&r.w.name?r.w.name:"W")+": "+i.w:"":"")+(void 0===e.object.geometry.attributes.ca||e.object.geometry.attributes.ca.itemSize<4?"":"\n"+On.opacity+": "+(new o.Vector4).fromArray(e.object.geometry.attributes.ca.array,e.index*e.object.geometry.attributes.ca.itemSize).w),i,t.spriteOptions)})===X.isWebGLAvailable()&&(document.body.appendChild(X.getWebGLErrorMessage()),alert(X.getWebGLErrorMessage().innerHTML));var Tn=function e(r){var t;S(this,e);var o=this;if((r=r||{}).boOptions)return r;void 0===r.a&&(r.a=1),void 0===r.b&&(r.b=0),this.setW=function(e){(e=e||r).scales=e.scales||{},e.scales.w=e.scales.w||{};var t=e.scales.w;t.name=t.name||"w",e.palette||this.setPalette(e),t.min=void 0===t.min?0:t.min,t.max=void 0===t.max?(new Le.THREE.Vector4).w:t.max},r.scales=r.scales||{};var n,i=!r.scales.x&&!r.scales.y&&!r.scales.z;function a(e){i&&(r.scales[e]=r.scales[e]||{}),r.scales[e]&&(r.scales[e].name=r.scales[e].name||e,r.scales[e].min=void 0===r.scales[e].min?-1:r.scales[e].min,r.scales[e].max=void 0===r.scales[e].max?1:r.scales[e].max)}for(n in a("x"),a("y"),a("z"),r.scales.setW=function(){o.setW()},r.point=r.point||{},r.point.size=r.point.size||5,r.point.sizePointsMaterial=r.point.sizePointsMaterial||100,this.setPalette=function(){r.palette||(r.palette=new dn.palette)},this.createOrbitControls=function(e,t,n){!1!==r.orbitControls&&((sn.prototype=Object.create(Le.THREE.EventDispatcher.prototype)).constructor=sn,(ln.prototype=Object.create(Le.THREE.EventDispatcher.prototype)).constructor=ln,o.orbitControls=new sn(e,t.domElement),o.orbitControls.target.set(2*n.position.x,2*n.position.y,2*n.position.z),o.orbitControls.saveState(),o.orbitControls.update())},this.restoreSceneController=function(e,t){var n,o,i;Le.dat&&(n={defaultButton:"Default",defaultTitle:"Reset player and restore camera position."},"ru"===this.getLanguageCode()&&(n.defaultButton="",n.defaultTitle="    ."),o=(new Le.THREE.Vector3).copy(t.position),i=(new Le.THREE.Vector3).copy(e.position),Le.dat.controllerNameAndTitle(r.dat.gui.add({defaultF:function(){r.player&&r.player.setTime(r.playerOptions.min),e.position.copy(i),t.position.copy(o),!1!==r.orbitControls&&(r.orbitControls.target=new Le.THREE.Vector3,r.orbitControls.object.position.copy(e.position),r.orbitControls.update())}},"defaultF"),n.defaultButton,n.defaultTitle))},Object.defineProperties(this,(s(t={playerOptions:{get:function(){r.playerOptions=r.playerOptions||{};var e,t=r.playerOptions;return t.min=t.min||0,t.max===1/0&&(t.max=null),null!==t.max?(void 0===t.max&&(t.max=1),t.marks=t.marks||10):t.marks=null,null===t.max?t.dt=t.dt||.1:t.dt=(t.max-t.min)/(t.marks-1),t.repeat=t.repeat||!1,t.interval=t.interval||1,t.zoomMultiplier=t.zoomMultiplier||1.1,t.offset=t.offset||.1,t.name=t.name||"",t.cameraTarget||(e=new kn.cameraTarget,Object.defineProperties(t,{cameraTarget:{get:function(){return e}}})),r.playerOptions},set:function(e){r.playerOptions=e}},a:{get:function(){return r.a}},b:{get:function(){return r.b}},dat:{get:function(){function n(t){if(S(this,n),(t=t||{}).boDat)return t;for(var e in Object.defineProperties(this,{boDat:{get:function(){return!0}},dat:{get:function(){return console.warn("get dat depreacated. Use three.dat = dat."),Le.dat},set:function(e){console.warn("Set dat depreacated. Use three.dat = dat."),e.dat&&e.dat.constructor.name===e.constructor.name&&"Object"!==e.dat.constructor.name&&console.error("duplicate dat."),e.dat=e}},cookieName:{get:function(){return t.cookieName}},gui:{get:function(){return!t.gui&&Le.dat&&(t.gui=new Le.dat.GUI),t.gui}},cookie:{get:function(){return t.cookie},set:function(e){t.cookie=e}},guiSelectPoint:{get:function(){return t.guiSelectPoint},set:function(e){t.guiSelectPoint=e}},cameraGui:{get:function(){return t.cameraGui},set:function(e){t.cameraGui=e}}}),t)void 0===this[e]&&console.error("Dat: dat."+e+" key is hidden")}var t,o;return r.dat=new n(r.dat),r.dat.gui&&(t=r.dat.gui.domElement.className,o=0,r.dat.gui.domElement.parentElement.childNodes.forEach(function(e){e.className===t&&o++}),1<o&&console.error("Options: duplicate dat.GUI"),r.dat.gui.domElement.addEventListener("mouseenter",function(e){r.dat.mouseenter=!0}),r.dat.gui.domElement.addEventListener("mouseleave",function(e){r.dat.mouseenter=!1})),!1===r.dat.cookie?r.dat.cookie=new bn.defaultCookie:void 0===r.dat.cookie&&(r.dat.cookie=bn),r.dat.getCookieName=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=r.dat.cookieName||(r.elContainer?"object"===x(r.elContainer)?r.elContainer.id:"string"==typeof r.elContainer?r.elContainer:"":"");return e+(""!==e&&""!==t?"_":"")+t},r.dat},set:function(e){r.dat=e}},getLanguageCode:{get:function(){return"string"==typeof r.getLanguageCode?function(){return r.getLanguageCode}:r.getLanguageCode||vn}},scales:{get:function(){return r.scales},set:function(e){r.scales=e}},palette:{get:function(){if(void 0!==r.palette)switch(x(r.palette)){case"number":r.palette=new dn.palette({palette:r.palette});break;case"boolean":r.palette&&(r.palette=new dn.palette);break;default:r.palette instanceof dn.palette==!1&&console.error("MyThree: invalid typeof options.palette: "+x(r.palette))}return r.palette}},boOptions:{get:function(){return!0}},point:{get:function(){return r.point}},spriteText:{get:function(){return r.spriteText||{}}},raycaster:{get:function(){if(r.raycaster)return r.raycaster},set:function(e){r.raycaster=e}},camera:{get:function(){return r.camera=r.camera||{},r.camera.position||(r.camera.position=new Le.THREE.Vector3(.4,.4,2)),r.camera.scale||(r.camera.scale=new Le.THREE.Vector3(1,1,1)),r.camera},set:function(e){r.camera=e}},cameraTarget:{get:function(){return r.cameraTarget}},elContainer:{get:function(){return r.elContainer}},canvasMenu:{get:function(){return r.canvasMenu},set:function(e){r.canvasMenu&&!0!==r.canvasMenu&&!1!==r.canvasMenu&&console.warn("Duplicate canvasMenu"),r.canvasMenu=e}},canvas:{get:function(){return r.canvas}},frustumPoints:{get:function(){return r.frustumPoints},set:function(e){r.frustumPoints&&r.frustumPoints.constructor.name===e.constructor.name&&"Object"!==r.frustumPoints.constructor.name&&console.error("duplicate frustumPoints."),r.frustumPoints=e}},stereoEffect:{get:function(){return r.stereoEffect},set:function(e){r.stereoEffect&&r.stereoEffect.constructor.name===e.constructor.name&&"Object"!==r.stereoEffect.constructor.name&&console.error("duplicate stereoEffect."),r.stereoEffect=e}},player:{get:function(){return r.player},set:function(e){r.player&&console.error("duplicate player."),r.player=e}},time:{get:function(){return r.player?r.player.getTime():0}},axesHelper:{get:function(){return r.axesHelper},set:function(e){r.axesHelper&&console.error("duplicate axesHelper."),r.axesHelper=e}}},"canvasMenu",{get:function(){return r.canvasMenu},set:function(e){r.canvasMenu&&console.error("duplicate canvasMenu."),r.canvasMenu=e}}),s(t,"orbitControls",{get:function(){return r.orbitControls},set:function(e){r.orbitControls&&r.orbitControls.constructor.name===e.constructor.name&&"Object"!==r.orbitControls.constructor.name&&console.error("duplicate orbitControls."),r.orbitControls=e}}),s(t,"scale",{get:function(){return 1}}),s(t,"pointLight",{get:function(){return r.pointLight}}),s(t,"cameraTarget",{get:function(){return r.cameraTarget}}),s(t,"eventListeners",{get:function(){return r.eventListeners||{addParticle:function(){}}},set:function(e){r.eventListeners&&console.error("duplicate eventListeners."),r.eventListeners=e}}),t)),r)void 0===this[n]&&console.error("Options: options."+n+" key is hidden");this.playerOptions.cameraTarget.init(this.cameraTarget,this,!1)};Tn.findSpriteTextIntersection=function(e){var t;return e.children.forEach(function(e){"Sprite"===e.type&&e.name===Tn.findSpriteTextIntersection.spriteTextIntersectionName&&(t=e)}),t},Tn.findSpriteTextIntersection.spriteTextIntersectionName="spriteTextIntersection";X=function e(){var l;function u(o,i){var r,a,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};S(this,u);var t=Le.THREE,s=new t.Vector2,l=[],c=new t.Raycaster,n=e.options||{};c.params.Points.threshold=void 0!==e.threshold?e.threshold:.03,c.setStereoEffect&&c.setStereoEffect({renderer:i,camera:o,stereoEffect:n.stereoEffect,raycasterEvents:!1}),window.addEventListener("mousemove",function(e){var t,n;void 0===c.stereo?(Tn.raycaster.EventListeners.getRendererSize(i).getMousePosition(s,e),c.setFromCamera(s,o),(r=c.intersectObjects(l))&&(0===r.length?a&&(a.userData.raycaster.onIntersectionOut(),a=void 0):((n=(t=r[0]).object).userData.raycaster.onIntersection(t),a=n))):c.stereo.onDocumentMouseMove(e)},!1),window.addEventListener("pointerdown",function(e){var t;void 0!==c&&(void 0===c.stereo?r&&0<r.length&&((t=r[0]).object.userData.raycaster&&(t.object.userData.raycaster.onMouseDown(t),n&&n.guiSelectPoint&&n.guiSelectPoint.select(t))):c.stereo.onDocumentMouseDown(e))},!1),this.addParticle=function(e){var t;e.userData.boFrustumPoints||(c.stereo?c.stereo.addParticle(e):(t=e,l.includes(t)?console.error('Duplicate particle "'+e.name+'"'):l.push(e)))}}S(this,e),this.onIntersection=function(e,t,n,o,i,r){var a,s;void 0!==e.object.userData.isInfo&&!e.object.userData.isInfo()||(void 0===(a=Tn.findSpriteTextIntersection(n))?((s=t.spriteText.rect?JSON.parse(JSON.stringify(t.spriteText.rect)):{}).displayRect=!0,s.backgroundColor="rgba(0, 0, 0, 1)",(a=En.getTextIntersection(e,{scales:t.scales,spriteOptions:{textHeight:t.spriteText.textHeight,fontColor:t.spriteText.fontColor,rect:s,group:n,center:{camera:o,canvas:i}}})).scale.divide(n.scale),n.add(a),void 0===l&&(l=r.domElement.style.cursor),r.domElement.style.cursor="pointer"):a.position.copy(e.point))},this.onIntersectionOut=function(e,t){var n=!1;do{var o=Tn.findSpriteTextIntersection(e)}while(void 0!==o&&(e.remove(o),n&&console.error("Duplicate spriteTextIntersection"),n=!0),void 0!==o);t.domElement.style.cursor=l},this.onMouseDown=function(e,t){void 0!==e.object.userData.isInfo&&!e.object.userData.isInfo()||(t.guiSelectPoint?t.guiSelectPoint.select(e):t.axesHelper&&t.axesHelper.exposePosition(e))},this.EventListeners=(b(u,null,[{key:"getRendererSize",value:function(e,t){(t=t||e.domElement).style.position,t.style.left,t.style.top,t.style.width,t.style.height;var t=t.getBoundingClientRect(),n=Math.round(t.left),o=Math.round(t.top),i=new Le.THREE.Vector2;return e.getSize(i),{getMousePosition:function(e,t){e.x=t.clientX/i.x*2-1-n/i.x*2,e.y=2*-(t.clientY/i.y)+1+o/i.y*2}}}}]),u)};Tn.raycaster=new X;
/**
 * @module Player
 * @description 3D objects animation.
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
var kn=function n(o){var f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};S(this,n),Ln(),!f.options&&f.frustumPoints&&(f.options=f.frustumPoints.getOptions()),f.options=f.options||new Tn;var i,r,a,s,l,u,c,h=f.options;function t(e){e=e||0;var t=r.getTime();n.selectPlayScene(o,{t:t,index:e,options:f.options}),r.setIndex(e,(""===h.playerOptions.name?"":h.playerOptions.name+": ")+t),f.onSelectScene&&f.onSelectScene(e,t),h.frustumPoints&&h.frustumPoints.updateCloudPoints()}function e(){h.player.controllers.forEach(function(e){e.onRenamePlayButtons&&e.onRenamePlayButtons(a)})}function d(){a=!1,e(),s=void 0}function p(){if(i++,null!==h.playerOptions.max&&i>=h.playerOptions.marks){if(!h.playerOptions.repeat)return i=h.playerOptions.marks-1,void d();i=0}(-1===i||i===h.playerOptions.marks&&null!==h.playerOptions.max)&&(i=0),t(i)}function m(e){"ru"===e()&&(u.prevSymbolTitle=" ",u.playTitle="",u.nextSymbolTitle=" ",u.pauseTitle="",u.repeatOn=" ",u.repeatOff="  ",u.controllerTitle=" .",u.stereoEffects=" ",u.mono="",u.sideBySide=" ",u.topAndBottom=" ")}function _(e){S(this,_);var i,r,a=h.player,t=h.getLanguageCode;if(!(e=e||h.dat.gui)||!1===h.dat.playController){var n=y(this,(_.__proto__||Object.getPrototypeOf(_)).call(this,{}));return y(n)}function s(e,t,n){var o=document.createElement("span");return o.innerHTML=e,o.title=t,o.style.cursor="pointer",o.style.margin="0px 2px",o.onclick=n,o}m(t);var l="rgb(255,255,255)",c="rgb(128,128,128)",n=y(this,(_.__proto__||Object.getPrototypeOf(_)).call(this,{playRate:1,property:function(){var e,t,n,o={};return i=function(e,t){o.buttonPlay.innerHTML=e,o.buttonPlay.title=t},o.buttonPrev=s(u.prevSymbol,u.prevSymbolTitle,a.prev),o.buttonPlay=s(u.playSymbol,u.playTitle,a.play3DObject),null!==a.getSettings().options.playerOptions.max&&(r=e=function(e){var t,n=e?(t=u.repeatOff,l):(t=u.repeatOn,c);o.buttonRepeat.title!==t&&(o.buttonRepeat.title=t,o.buttonRepeat.style.color=n,a.onChangeRepeat(e))},n=a.getSettings().repeat?(t=u.repeatOff,l):(t=u.repeatOn,c),o.buttonRepeat=s(u.repeat,t,function(){e(o.buttonRepeat.title===u.repeatOn)}),o.buttonRepeat.style.color=n),o.buttonNext=s(u.nextSymbol,u.nextSymbolTitle,a.next),o}},"playRate"));return(a.PlayController=n).lang=u,n.onRenamePlayButtons=function(e){var t,e=e?(t=u.pause,u.pauseTitle):(t=u.playSymbol,u.playTitle);i(t,e,!0)},n.onChangeRepeat=function(){r(a.getSettings().options.playerOptions.repeat)},a.pushController(n),n.setValue=function(e){this._controller.domElement.childNodes[0].value=e},e.add(n).__truncationSuspended=!0,y(n)}function g(){if(c)return c.querySelector("#sliderPosition")}h.boOptions?!1!==h.player&&(h.boPlayer=h.boPlayer||!1,h.player?console.error("Player: duplicate player."):(h.player=this,f.cameraTarget=f.cameraTarget||{},setTimeout(function(){t()},0),i=0,(r=this).getTime=function(){var e=h.playerOptions,t=e.min+i*e.dt;return isNaN(t)&&console.error("Player.getTime(): t = "+t),null!==e.max&&t>e.max&&console.error("Player.getTime(): t = "+t+" playerOptions.max = "+e.max),t<e.min&&null!==e.max&&console.error("Player.getTime(): t = "+t+" playerOptions.min = "+e.min),t},this.setTime=function(e){this.selectScene(parseInt((e-h.playerOptions.min)/h.playerOptions.dt))},this.selectScene=function(e){if(void 0!==e)for(e=parseInt(e),null!==h.playerOptions.max&&(e>=h.playerOptions.marks?e=0:e<0&&(e=h.playerOptions.marks-1),i>h.playerOptions.marks&&(i=h.playerOptions.marks));i!==e;)i<e?i++:i--,t(i);else t(i)},this.next=function(){r.selectScene(i+1)},this.prev=function(){r.selectScene(i-1)},this.pushController=function(e){void 0!==e.object&&void 0!==e.object.playRate&&(e.object.playRate=h.playerOptions.min),this.controllers.push(e)},a=!(this.controllers=[]),this.play3DObject=function(){a?d():(a=!0,null!==h.playerOptions.max&&i>=h.playerOptions.marks-1&&(i=0),p(),e(),window.requestAnimationFrame(function e(t){if(a?window.requestAnimationFrame(e):s=void 0,void 0===s&&(l=(s=t)+1e3/h.playerOptions.interval),!isNaN(l)&&l!==1/0||(console.error("Player.animate: timeNext = "+l),a=!1),!(t<l)){for(;l<t;)l+=1e3/h.playerOptions.interval;p()}}))},this.repeat=function(){h.playerOptions.repeat=!h.playerOptions.repeat,this.onChangeRepeat(h.playerOptions.repeat)},this.getSettings=function(){return f},this.getSelectSceneIndex=function(){return i},this.onChangeRepeat=function(e){h.playerOptions.repeat=e,this.controllers.forEach(function(e){e.onChangeRepeat&&e.onChangeRepeat()})},u={prevSymbol:"",prevSymbolTitle:"Go to previous animation scene",nextSymbol:"",nextSymbolTitle:"Go to next animation scene",playSymbol:"",playTitle:"Play",pause:"",pauseTitle:"Pause",repeat:"",repeatOn:"Turn repeat on",repeatOff:"Turn repeat off",controllerTitle:"Current time.",stereoEffects:"Stereo effects",mono:"Mono",sideBySide:"Side by side",topAndBottom:"Top and bottom"},this.localization=function(){return m(0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return"en"}),u},this.PlayController=(v(_,Qt.CustomController),b(_,[{key:"controller",set:function(e){this._controller=e,this._controller.onChange(function(e){h.player.setTime(e)}),this._controller.domElement.title=this.lang.controllerTitle},get:function(){return this._controller}}]),_),this.gui=function(e){var i,r,t,n,a,o=h.dat.cookie,s=h.dat.getCookieName("Player"),l=h.getLanguageCode,c=Le.dat;function u(){null===h.playerOptions.max?h.playerOptions.dt=h.playerOptions.dt||.1:h.playerOptions.dt=(h.playerOptions.max-h.playerOptions.min)/(h.playerOptions.marks-1)}function d(){u(),o.setObject(s,h.playerOptions),f.onChangeScaleT&&f.onChangeScaleT(h.playerOptions)}function p(){null!==h.playerOptions.max&&(h.playerOptions.max=h.playerOptions.min+h.playerOptions.dt*(h.playerOptions.marks-1))}(e=e||h.dat.gui)&&!1!==h.dat.playerGui&&(p(),i=JSON.parse(JSON.stringify(h.playerOptions)),r=function(t){var e={player:"Player",playerTitle:"3D objects animation.",min:"Min",max:"Max",dt:"Step",dtTitle:"Time between frames",marks:"Frames",marksTitle:"Player frames count",interval:"Rate",intervalTitle:"Rate of changing of animation scenes per second.",time:"Time",defaultButton:"Default",defaultTitle:"Restore default player settings."},n=void 0===(t=t||{}).getLanguageCode?"en":t.getLanguageCode();switch(n){case"ru":e.player="",e.playerTitle=" 3D .",e.min="",e.max="",e.dt="",e.dtTitle="  ",e.marks="",e.marksTitle="  ",e.interval="",e.intervalTitle="    .",e.time="",e.defaultButton="",e.defaultTitle="    .";break;default:if(void 0===t.lang||t.lang._languageCode!=n)break;Object.keys(t.lang).forEach(function(e){void 0!==_lang[e]&&(_lang[e]=t.lang[e])})}return e}({getLanguageCode:l}),Object.freeze(i),t=h.playerOptions.max,n=h.playerOptions.marks,o.getObject(s,h.playerOptions,h.playerOptions),null!==t&&t!==1/0&&null!==h.playerOptions.max||(h.playerOptions.max=t,h.playerOptions.marks=n),a=e.addFolder(r.player),c.folderNameAndTitle(a,r.player,r.playerTitle),function(){var n=h.playerOptions,o={};function e(e,t){e=e.controller.getValue();n.min=t(n.min,e),o.min.setValue(n.min),n.max&&(n.max=t(n.max,e),u(),o.max.setValue(n.max)),d()}o.folder=a.addFolder(""!==n.name?n.name:r.time),o.scaleController=o.folder.add(new Re(e,{settings:f.options.playerOptions,getLanguageCode:l})).onChange(function(e){n.zoomMultiplier=e,d()});var t=new Ne(function(n){e(t,function(e,t){return e+=n})},{settings:f.options.playerOptions,getLanguageCode:l});o.positionController=o.folder.add(t).onChange(function(e){n.offset=e,d()}),o.min=c.controllerZeroStep(o.folder,n,"min",function(e){d()}),c.controllerNameAndTitle(o.min,r.min),p(),null!==n.max?(o.max=c.controllerZeroStep(o.folder,n,"max",function(e){d()}),c.controllerNameAndTitle(o.max,r.max)):(o.dt=c.controllerZeroStep(o.folder,n,"dt",function(e){d()}),c.controllerNameAndTitle(o.dt,r.dt,r.dtTitle)),n.marks&&(o.marks=o.folder.add(n,"marks").onChange(function(e){n.marks=parseInt(n.marks),d();var t=g();t&&(t.max=h.playerOptions.marks-1)}),c.controllerNameAndTitle(o.marks,void 0===n.marksName?r.marks:n.marksName,(void 0===n.marksTitle?r:n).marksTitle)),o.interval=o.folder.add(f.options.playerOptions,"interval",1,25,1).onChange(function(e){d()}),c.controllerNameAndTitle(o.interval,r.interval,r.intervalTitle),c.controllerNameAndTitle(o.folder.add({defaultF:function(){n.zoomMultiplier=i.zoomMultiplier,o.scaleController.setValue(n.zoomMultiplier),n.offset=i.offset,o.positionController.setValue(n.offset),n.min=i.min,o.min.setValue(n.min),o.max&&(n.max=i.max,u(),o.max.setValue(n.max)),o.dt&&(n.dt=i.dt,o.dt.setValue(n.dt)),i.marks&&(n.marks=i.marks,o.marks&&o.marks.setValue(n.marks)),n.interval=i.interval,o.interval.setValue(n.interval),d()}},"defaultF"),r.defaultButton,r.defaultTitle)}())},this.createCanvasMenuItem=function(o){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return"en"},t=this,n=(c=o).menu,i=t.localization(e);n.push({name:i.prevSymbol,title:i.prevSymbolTitle,onclick:function(){t.prev()}}),n.push({name:a?i.pause:i.playSymbol,title:a?i.pauseTitle:i.playTitle,id:"menuButtonPlay",onclick:function(){t.play3DObject()}}),null!==h.playerOptions.max&&n.push({name:i.repeat,title:this.getSettings().repeat?i.repeatOff:i.repeatOn,id:"menuButtonRepeat",onclick:function(){t.repeat()}}),n.push({name:i.nextSymbol,title:i.nextSymbolTitle,onclick:function(){t.next()}}),this.controllers.push({onRenamePlayButtons:function(e){var t,n=e?(t=i.pause,i.pauseTitle):(t=i.playSymbol,i.playTitle),e=o.querySelector("#menuButtonPlay");e.innerHTML=t,e.title=n},onChangeRepeat:function(){o.querySelector("#menuButtonRepeat").title=h.playerOptions.repeat?i.repeatOff:i.repeatOn}})},this.addSlider=function(){null!==h.playerOptions.max&&c.menu.push({name:'<input type="range" min="0" max="'+(h.playerOptions.marks-1)+'" value="0" class="slider" id="sliderPosition">',style:"float: right;"})},this.addSliderEvents=function(){var t,n,o=g();return o&&(o.onchange=function(e){n.selectScene(parseInt(o.value))},o.oninput=function(e){n.selectScene(parseInt(o.value))},n=this,o.addEventListener("pointerdown",function(e){t=!0}),o.addEventListener("pointerup",function(e){t=!1}),o.addEventListener("mousemove",function(e){t&&n.selectScene((h.playerOptions.marks-1)*e.offsetX/o.clientWidth)})),o},this.setIndex=function(e,t){"object"===x(this.PlayController)&&this.PlayController.setValue(this.getTime());var n=g();n&&(n.value=e,n.title=t)},this.onChangeScale=function(e){g().max=e.marks-1,this.selectScene(0)})):console.error("Player: call options = new Options( options ) first")};kn.cameraTarget=function e(){S(this,e);var i,o={boLook:!1},t={boLook:o.boLook,getDistanceToCamera:function(){return void 0!==this.distanceToCameraCur?this.distanceToCameraCur:this.distanceToCamera}};o.rotation={};var r,a=(t.rotation={},!1),n=!1;function s(e){Ln(),e=e||o,t.boMaual||(void 0!==e.boLook?t.boLook=e.boLook:t.boLook=o.boLook),t.camera=e.camera||o.camera,t.distanceToCamera=e.distanceToCamera||o.distanceToCamera||t.distanceToCamera||(new An.Vector3).copy(o.camera.position),e.rotation||(e.rotation={}),void 0!==e.rotation.angle?t.rotation.angle=e.rotation.angle:t.rotation.angle=o.rotation.angle||0,t.rotation.axis=e.rotation.axis||o.rotation.axis||new An.Vector3(0,1,0)}this.get=function(e){if(e||i?i&&e&&!Object.is(i,e)&&console.error("Player.cameraTarget.get: options is ambiguous"):console.error("Player.cameraTarget.get: options = "+e),i=i||e,t.camera||n||!i.player||(o.camera=i.player.getSettings().cameraTarget.camera,o.camera&&s(),n=!0),t.camera)return t},this.init=function(e,t){var n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];if(e){if(t||i?i&&t&&!Object.is(i,t)&&console.error("Player.cameraTarget.init: options is ambiguous"):console.error("Player.cameraTarget.init: options = "+t),i=i||t,!1!==e.bodefault){if(a)return;void 0!==e.boLook&&(o.boLook=e.boLook,r=e.boLook)}else{if(!0!==e.boLook)return;a&&console.warn("playerCameraTarget().init(...): duplicate target point"),a=!0,void 0===r&&(o.boLook=!0)}o.camera=o.camera||e.camera||(i.player?i.player.getSettings().cameraTarget.camera:void 0),o.camera||!n?(o.distanceToCamera=o.distanceToCamera||e.distanceToCamera,e.rotation=e.rotation||{},o.rotation.angle=o.rotation.angle||e.rotation.angle,o.rotation.axis=o.rotation.axis||e.rotation.axis,s(e)):console.error("playerCameraTarget().init(...): cameraTargetDefault.camera = "+o.camera)}},this.changeTarget=function(e,t){Ln();var n=i.playerOptions.cameraTarget.get(),o=e.userData.player&&"function"!=typeof e.userData.player.arrayFuncs?e.userData.player.arrayFuncs[t]:{};o.cameraTarget||(o.cameraTarget={boLook:!1}),s(o.cameraTarget),n&&n.boLook?(e=$t(e,(new An.Vector3).fromArray(e.geometry.attributes.position.array,t*e.geometry.attributes.position.itemSize)),n.target=e):delete n.target},this.setCameraTarget=function(n){Ln();var e,t,o,i=n.playerOptions.cameraTarget.get(n),r=(i=i||i||{}).camera;r&&(i.distanceToCamera||(i.distanceToCamera=(new An.Vector3).copy(r.position)),i.distanceToCameraCur||(i.distanceToCameraCur=new An.Vector3),e=n.time,t=i.distanceToCamera,o=(new An.Vector3).copy(i.distanceToCameraCur),i.distanceToCameraCur.set(kn.execFunc(t,"x",e,n),kn.execFunc(t,"y",e,n),kn.execFunc(t,"z",e,n)),i.setCameraPosition||(i.setCameraPosition=function(){var e=i.target;if(i.boLook&&(e||!i.distanceToCameraCur.equals(o))){o.copy(i.distanceToCameraCur);var t=n.time;if(r.position.copy(i.distanceToCameraCur),r.position.applyAxisAngle(i.rotation.axis,kn.execFunc(i.rotation,"angle",t,n)),!e){if(!kn.orbitControls)return;e=kn.orbitControls.target}r.position.add(e),r.lookAt(e),n.orbitControls&&(n.orbitControls.target.equals(e)||(n.orbitControls.target.copy(e),n.orbitControlsGui&&n.orbitControlsGui.setTarget(e)),n.orbitControls._listeners&&n.orbitControls._listeners.change[0]())}}),n.cameraGui&&n.cameraGui.update())}},kn.execFunc=function(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=e[t],r=o.a,a=o.b,s=void 0===i?"undefined":x(i);switch(void 0===n&&(n=o.playerOptions?o.playerOptions.min:0),s){case"undefined":return;case"string":i=new Function("t","a","b","return "+i);case"function":try{var l=i(n,r,a);if(void 0===l)throw"function returns "+l;return l}catch(e){throw console.error(e),e}case"number":return i;case"object":if(Array.isArray(i)){var c=function(e){return"function"==typeof u[e]?u[e](n,u,a):u[e]instanceof An.Color?u[e]:void 0};if(0===i.length)return void console.error('Player.execFunc: funcs["'+t+'"] array is empty');for(var u=i,d=i.length-1,p=null===o.playerOptions.max?1/0:o.playerOptions.max,f=o.playerOptions.min,h=(p-f)/d,m=f,_=p,g=0,b=d,v=0;v<i.length;v++)h*v+f<n&&(m=h*(g=v)+f,_=h*(b=v+1)+f);if("number"!=typeof u[g]){if("w"===t)return c(g);if("object"!==x(u[g]))return void console.error('Player.execFunc: funcs["'+t+'"] array item '+g+" typeof = "+x(u[g])+" is not number");for(v=0;v<i.length;v++){if(v===i.length-1)return u[v].v;if(b=(g=v)+1,m=u[g].t,_=u[b].t,m<=n&&n<_){var y=(u[b].v-u[g].v)/(_-m),w=u[g].v-y*m;return y*n+w}}return void console.error("Player.execFunc: value is not detected")}if(b>=i.length&&(b=g),"number"!=typeof u[b]){if("w"===t)return c(b);if("object"!==x(u[b]))return void console.error('Player.execFunc: funcs["'+t+'"] array item '+b+" typeof = "+x(u[b])+" is not number")}y=(u[b]-u[g])/(_-m),w=u[g]-y*m;return(isNaN(y)||isNaN(w))&&console.error("Player.execFunc: invalid x = "+y+" or y = "+w),y*n+w}return i.func?i.func instanceof Function?i.func(n,r,a):i.func:("w"!==t&&console.error('Player.execFunc: funcs["'+t+'"] object is not array'),i);default:console.error('Player.execFunc: Invalud typeof funcs["'+t+'"]: '+s)}},kn.selectMeshPlayScene=function(f){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};Ln();var t,h=e.t,m=e.options||{dat:!1};void 0===h&&(h=m.playerOptions.min),m.scales.setW(),!f.userData.player||m&&m.boPlayer&&f.userData.boFrustumPoints||(f.geometry&&(delete f.geometry.boundingSphere,f.geometry.boundingSphere=null),f.userData.player.selectPlayScene&&(t=function(e){for(;f.rotation[e]<0;)f.rotation[e]+=2*Math.PI;for(;f.rotation[e]>2*Math.PI;)f.rotation[e]-=2*Math.PI},f.userData.player.selectPlayScene(h),t("x"),t("y"),t("z")),function(n,i){if(f.geometry){var r,a,s=f.geometry.attributes,l=f.userData.player.arrayFuncs;if(void 0!==l){void 0===h&&console.error("setPosition: t = "+h),m&&void 0!==m.scales.w?(r=m.scales.w.min,a=m.scales.w.max):r=(a=d)-1;for(var c,u,d,p=0;p<l.length;p++)!function(){function e(e,t){e=kn.execFunc(c,e,h,m);void 0!==e&&(s.position[t](p,e),u=!0)}c=l[p],u=!1,e("x","setX"),e("y","setY"),e("z","setZ");var o=void 0;function t(){if(f.userData.player.palette)o=f.userData.player.palette.toColor(d,r,a);else{if(!m.palette){var e=255,t=255,n=255;return o=new An.Color("rgb("+e+", "+t+", "+n+")")}o=m.palette.toColor(d,r,a)}}"function"==typeof c.w?(d=c.w(h,n,i),a=m.scales.w?(r=m.scales.w.min,m.scales.w.max):(console.warn("Player.selectMeshPlayScene:     "),r=0,100),4<=s.position.itemSize&&s.position.setW(p,d),u=!0,t()):"object"===x(c.w)?c.w instanceof An.Color?o=c.w:(d=kn.execFunc(c,"w",h,m),void 0!==c.w.min&&(r=c.w.min),void 0!==c.w.max&&(a=c.w.max),t()):"number"==typeof c.w&&m.palette&&(o=m.palette.toColor(c.w,r,a)),o&&(!f.material instanceof An.ShaderMaterial&&f.material.vertexColors!==An.VertexColors&&console.error("Player.selectMeshPlayScene: Please set the vertexColors parameter of the THREE.PointsMaterial of your points to THREE.VertexColors. Example: vertexColors: THREE.VertexColors"),!kn.setColorAttribute(s,p,o)&&c instanceof An.Vector4&&(f.geometry.setAttribute("color",new An.Float32BufferAttribute(kn.getColors(l,{positions:f.geometry.attributes.position,options:m}),4)),kn.setColorAttribute(s,p,o)||console.error('Player.selectMeshPlayScene: the color attribute is not exists. Please use THREE.Vector3 instead THREE.Vector4 in the arrayFuncs or add "color" attribute'))),u&&(s.position.needsUpdate=!0),c.line&&c.line.addPoint&&c.line.addPoint(f,p,o),c.cameraTarget&&!0===c.cameraTarget.boLook&&m.playerOptions.cameraTarget.changeTarget(f,p)}()}}}(m?m.a:1,m?m.b:0),t="Player.selectMeshPlayScene: invalid mesh.scale.",f.scale.x<=0&&console.error(t+"x = "+f.scale.x),f.scale.y<=0&&console.error(t+"y = "+f.scale.y),f.scale.z<=0&&console.error(t+"z = "+f.scale.z),m&&m.guiSelectPoint&&(m.guiSelectPoint.setMesh(),-1!==(t=m.guiSelectPoint.getSelectedPointIndex())&&m.guiSelectPoint.isSelectedMesh(f)&&m.guiSelectPoint.setPosition({object:f,index:t})))},kn.setColorAttribute=function(e,t,n){"string"==typeof n&&(n=new An.Color(n));e=e.color||e.ca;return void 0!==e&&(e.setX(t,n.r),e.setY(t,n.g),e.setZ(t,n.b),e.needsUpdate=!0)},kn.getPoints=function(t,n){Ln(),Array.isArray(t)||(t=[t]),void 0===(n=n||{}).t&&(n.t=n.options&&n.options.player?n.options.player.getSettings().options.playerOptions.min:0);var o=n.options||new Tn,e={palette:o.palette};o.setW(e);for(var i=e.scales.w.max,r=0;r<t.length;r++){var a=t[r];Array.isArray(a)?t[r]=new An.Vector4(void 0===a[0]?0:a[0],void 0===a[1]?0:a[1],void 0===a[2]?0:a[2],void 0===a[3]?i:a[3]):"object"===(void 0===a?"undefined":x(a))&&a instanceof An.Vector2==!1&&a instanceof An.Vector3==!1&&a instanceof An.Vector4==!1&&(void 0===a.vector?t[r]=new An.Vector4(void 0===a.x?0:a.x,void 0===a.y?0:a.y,void 0===a.z?0:a.z,void 0===a.w?0:a.w):a.vector instanceof An.Vector2==!0||a.vector instanceof An.Vector3==!0||a.vector instanceof An.Vector4==!0?a.vector instanceof An.Vector2==!0&&(t[r].vector=new An.Vector3(void 0===a.vector.x?0:a.vector.x,void 0===a.vector.y?0:a.vector.y,void 0===a.vector.z?0:a.vector.z)):4===a.vector.length?t[r].vector=new An.Vector4(void 0===a.vector[0]?0:a.vector[0],void 0===a.vector[1]?0:a.vector[1],void 0===a.vector[2]?0:a.vector[2],void 0===a.vector[3]?0:a.vector[3]):3===a.vector.length?t[r].vector=new An.Vector3(void 0===a.vector[0]?0:a.vector[0],void 0===a.vector[1]?0:a.vector[1],void 0===a.vector[2]?0:a.vector[2]):console.error("Player.getPoints(...) falied! item.vector.length = "+a.vector.length))}for(var s=[],r=0;r<t.length;r++){var l=function(e){return"number"==typeof c&&(c=new An.Vector4(c,0,0,0)),c instanceof An.Vector2||c instanceof An.Vector3||c instanceof An.Vector4?kn.execFunc(c,e,n.t,o):void 0!==c.vector?(void 0!==c.name&&(c.vector.name=c.name),c.trace&&o.player&&(c.vector.line=new kn.traceLine(o)),c.cameraTarget&&(c.vector.cameraTarget=c.cameraTarget,delete c.cameraTarget),t[r]=c.vector,c=c.vector,kn.execFunc(c,e,n.t,o)):void console.error("Player.getAxis().getPoints(): funcs.vector = "+c.vector)},c=t[r],l=c.vector instanceof An.Vector3==!0?new An.Vector3(l("x"),l("y"),l("z")):new An.Vector4(l("x"),l("y"),l("z"),l("w"));c.cameraTarget&&(c.cameraTarget.bodefault=!1,void 0===c.cameraTarget.boLook&&(c.cameraTarget.boLook=!0),o.playerOptions.cameraTarget.init(c.cameraTarget,o)),s.push(l)}return s};var An,Pn=!0;function Ln(){Le.isThree()?(An=Le.THREE,Object.assign(An.BufferGeometry.prototype,{setFromPoints:function(e,t){t=t||3;for(var n=[],o=0,i=e.length;o<i;o++){var r=e[o];n.push(r.x,r.y,r.z||0),4<=t&&n.push(r.w||0)}return this.setAttribute("position",new An.Float32BufferAttribute(n,t)),this}}),Object.assign(An.Vector4.prototype,{multiply:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,void 0!==e.w&&(this.w*=e.w),this}}),Object.assign(An.Vector4.prototype,{add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,void 0!==e.w&&(this.w+=e.w),this)}}),Object.assign(An.Points.prototype,{raycast:function(e,t){var n=new An.Matrix4,l=new An.Ray,o=new An.Sphere,i=new An.Vector3;function r(e,t,n,o,i,r,a){var s=l.distanceSqToPoint(e);s<n&&(n=new An.Vector3,l.closestPointToPoint(e,n),n.applyMatrix4(o),(o=i.ray.origin.distanceTo(n))<i.near||o>i.far||r.push({distance:o,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:a}))}var a=this.geometry,s=this.matrixWorld,c=e.params.Points.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),o.copy(a.boundingSphere),o.applyMatrix4(s),o.radius+=c,!1!==e.ray.intersectsSphere(o)){n.copy(s).invert(),l.copy(e.ray).applyMatrix4(n);var n=c/((this.scale.x+this.scale.y+this.scale.z)/3),u=n*n;if(a.isBufferGeometry){var c=a.index,n=a.attributes,d=n.position.array,p=n.position.itemSize;if(null!==c)for(var f=c.array,h=0,m=f.length;h<m;h++){var _=f[h];i.fromArray(d,_*p),r(i,_,u,s,e,t,this)}else for(var g=0,b=d.length/p;g<b;g++)i.fromArray(d,g*p),r(i,g,u,s,e,t,this)}else for(var v=a.vertices,y=0,w=v.length;y<w;y++)r(v[y],y,u,s,e,t,this)}}})):console.warn("Player: can not assign. Set THREE first.")}kn.getColors=function(e,o){if(Ln(),Array.isArray(e)||(e=[e]),(o=o||{}).options=o.options||{},void 0!==o.positions&&Array.isArray(e)&&e.length!==o.positions.count)return console.error("getColors failed! arrayFuncs.length: "+e.length+" != positions.count: "+o.positions.count),o.colors;var t=Array.isArray(e)?e.length:o.positions.count;o.colors=o.colors||[],o.options.palette||o.options.setPalette();for(var i=0;i<t;i++){var n,r,a,s,l,c,u=Array.isArray(e)?e[i]:void 0;u instanceof An.Vector4||o.positions&&4===o.positions.itemSize?(s=r=void 0,a=u.w,u.w instanceof Object&&u.w.func?(u.w.max&&(s=u.w.max),u.w.min&&(r=u.w.min),a=u.w.func):(o.options.setW(),r=o.options.scales.w.min,s=o.options.scales.w.max),a instanceof Function&&!o.options.player&&Pn&&(Pn=!1),s=o.options.palette.toColor(void 0===u?(new An.Vector4).fromBufferAttribute(o.positions,i).w:a instanceof Function?a(o.options.playerOptions?o.options.playerOptions.min:0):a,r,s),o.colors.push(s.r,s.g,s.b)):o.colors instanceof An.Float32BufferAttribute?n=new An.Vector3(1,1,1):o.colors.push(1,1,1),void 0!==o.opacity?(l=0,c=getStandardNormalDistribution(0),group.children.forEach(function(e){if(e.userData.cloud)for(var t=0;t<e.geometry.attributes.position.count;t++){var n=getObjectPosition(e,t);l+=getStandardNormalDistribution(5*$t(camera,(new An.Vector3).fromBufferAttribute(o.positions,i)).distanceTo(n))/c}}),void 0!==debug.opacity&&(l=debug.opacity),o.colors instanceof An.Float32BufferAttribute?o.colors.setXYZW(i,n.x,n.y,n.z,l):o.colors.push(l)):o.colors.push(1)}return o.colors},kn.traceLine=function e(c){var u;S(this,e);var d=[];Ln(),c.player&&(this.isVisible=function(){return!!c.player&&(u?u.visible:0!==d.length&&d[0].visible)},this.visible=function(t){if(!c.player)return!1;u?u.visible=t:d.forEach(function(e){e.visible=t})},this.addPoint=function(e,t,n){var o=e.geometry.attributes.position,i=4<=o.itemSize?new An.Vector4(0,0,0,0):new An.Vector3;i.fromArray(o.array,t*o.itemSize);var r=c.player?c.player.getSelectSceneIndex():0;if(null===c.playerOptions.max){if((r=Math.abs(r))<d.length-1){for(;r<d.length-1;)e.remove(d[d.length-1]),d.pop();return}var a=new An.BufferGeometry,s=new Float32Array(6);a.setAttribute("position",new An.BufferAttribute(s,3));s=new Float32Array(6);a.setAttribute("color",new An.Float32BufferAttribute(s,3));s=new An.Line(a,new An.LineBasicMaterial({vertexColors:An.VertexColors}));e.add(s),d[0]&&(s.visible=d[0].visible),i=(new An.Vector3).copy(i);a=s.geometry.attributes.position.itemSize;return i.toArray(s.geometry.attributes.position.array,+a),(0===d.length?i:(new An.Vector3).fromArray(d[d.length-1].geometry.attributes.position.array,+a)).toArray(s.geometry.attributes.position.array,0*a),s.geometry.attributes.position.needsUpdate=!0,void 0===n&&(n=new An.Color(1,1,1)),kn.setColorAttribute(s.geometry.attributes,0,0===d.length?n:(new An.Color).fromArray(d[d.length-1].geometry.attributes.color.array,+a)),kn.setColorAttribute(s.geometry.attributes,1,n),void d.push(s)}if(void 0===u){a=new An.BufferGeometry;if(null!==c.playerOptions.max)if(c.playerOptions&&c.playerOptions.marks)l=c.playerOptions.marks;else{if(!c.player||!c.player.marks)return void console.error("Player.traceLine: MAX_POINTS = "+l+". Create Player first or remove all trace = true from all items of the arrayFuncs");l=c.player.marks}else l=r+1;s=new Float32Array(3*l);a.setAttribute("position",new An.BufferAttribute(s,3));var l=new Float32Array(3*l);a.setAttribute("color",new An.Float32BufferAttribute(l,3)),a.setDrawRange(r,r),(u=new An.Line(a,new An.LineBasicMaterial({vertexColors:An.VertexColors}))).visible=!0,e.add(u)}u.geometry&&(delete u.geometry.boundingSphere,u.geometry.boundingSphere=null),(i=(new An.Vector3).copy(i)).toArray(u.geometry.attributes.position.array,r*u.geometry.attributes.position.itemSize),u.geometry.attributes.position.needsUpdate=!0,void 0===n&&(n=new An.Color(1,1,1)),kn.setColorAttribute(u.geometry.attributes,r,n);i=u.geometry.drawRange.start,n=r+1-i;r<i&&(n=i+u.geometry.drawRange.count-(i=r)),u.geometry.setDrawRange(i,n)},this.remove=function(){void 0!==u&&(u.geometry.dispose(),u.material.dispose(),u.parent.remove(u))})},kn.getItemSize=function(e){Ln();for(var t=0;t<e.length;t++)if(e[t]instanceof An.Vector4)return 4;return 3},kn.selectPlayScene=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=void 0!==t.t?t.t:0,o=void 0!==t.index?t.index:void 0,i=t.options||new Tn;e.userData.t=n,kn.selectMeshPlayScene(e,{t:n,options:i}),e.children.forEach(function(e){kn.selectMeshPlayScene(e,{t:n,options:i})}),i.playerOptions.cameraTarget.setCameraTarget(i);e=i.playerOptions.cameraTarget.get();e&&e.setCameraPosition&&e.setCameraPosition(void 0===o)},kn.assign=function(){Ln()},e.default=kn,Object.defineProperty(e,"__esModule",{value:!0})});
