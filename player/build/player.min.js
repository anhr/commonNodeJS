/**
 * @module Player
 * @description 3D objects animation.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.player={})}(this,function(e){"use strict";var x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},b=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var v=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t};function t(e,t){var n=e.__state.conversionName.toString(),o=Math.round(e.r),r=Math.round(e.g),i=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===n?"rgb("+o+","+r+","+i+")":"CSS_RGBA"===n?"rgba("+o+","+r+","+i+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+o+","+r+","+i+"]":"RGBA_ARRAY"===n?"["+o+","+r+","+i+","+a+"]":"RGB_OBJ"===n?"{r:"+o+",g:"+r+",b:"+i+"}":"RGBA_OBJ"===n?"{r:"+o+",g:"+r+",b:"+i+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var n,s=Array.prototype.forEach,r=Array.prototype.slice,h={BREAK:{},extend:function(n){return this.each(r.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(t[e])||(n[e]=t[e])}.bind(this))},this),n},defaults:function(n){return this.each(r.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(n[e])&&(n[e]=t[e])}.bind(this))},this),n},compose:function(){var n=r.call(arguments);return function(){for(var e=r.call(arguments),t=n.length-1;0<=t;t--)e=[n[t].apply(this,e)];return e[0]}},each:function(e,t,n){if(e)if(s&&e.forEach&&e.forEach===s)e.forEach(t,n);else if(e.length===e.length+0){for(var o=void 0,o=0,r=e.length;o<r;o++)if(o in e&&t.call(n,e[o],o)===this.BREAK)return}else for(var i in e)if(t.call(n,e[i],i)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(o,r,i){var a=void 0;return function(){var e=this,t=arguments;var n=i||!a;clearTimeout(a),a=setTimeout(function(){a=null,i||o.apply(e,t)},r),n&&o.apply(e,t)}},toArray:function(e){return e.toArray?e.toArray():r.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:(n=function(e){return isNaN(e)},i.toString=function(){return n.toString()},i),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}};function i(e){return n.apply(this,arguments)}var l,c=[{litmus:h.isString,conversions:{THREE_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:t},SIX_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:t},CSS_RGB:{read:function(e){e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:t},CSS_RGBA:{read:function(e){e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:t}}},{litmus:h.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:h.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:h.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(h.isNumber(e.r)&&h.isNumber(e.g)&&h.isNumber(e.b)&&h.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(h.isNumber(e.r)&&h.isNumber(e.g)&&h.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(h.isNumber(e.h)&&h.isNumber(e.s)&&h.isNumber(e.v)&&h.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(h.isNumber(e.h)&&h.isNumber(e.s)&&h.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],u=void 0,d=void 0,p=function(e){d=!1;var n=1<arguments.length?h.toArray(arguments):e;return h.each(c,function(e){if(e.litmus(n))return h.each(e.conversions,function(e,t){if(u=e.read(n),!1===d&&!1!==u)return(d=u).conversionName=t,u.conversion=e,h.BREAK}),h.BREAK}),d},f={hsv_to_rgb:function(e,t,n){var o=Math.floor(e/60)%6,r=e/60-Math.floor(e/60),i=n*(1-t),e=n*(1-r*t),t=n*(1-(1-r)*t),o=[[n,t,i],[e,n,i],[i,n,t],[i,e,n],[t,i,n],[n,i,e]][o];return{r:255*o[0],g:255*o[1],b:255*o[2]}},rgb_to_hsv:function(e,t,n){var o=Math.min(e,t,n),r=Math.max(e,t,n),i=r-o,o=void 0;return 0===r?{h:NaN,s:0,v:0}:(o=e===r?(t-n)/i:t===r?2+(n-e)/i:4+(e-t)/i,(o/=6)<0&&(o+=1),{h:360*o,s:i/r,v:r/255})},rgb_to_hex:function(e,t,n){e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t);return e=this.hex_with_component(e,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(l=8*t)|e&~(255<<l)}},m="function"==typeof Symbol&&"symbol"===x(Symbol.iterator)?function(e){return void 0===e?"undefined":x(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":x(e)},g=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},_=function(e,t,n){return t&&w(e.prototype,t),n&&w(e,n),e};function w(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function E(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0!==o){if("value"in o)return o.value;o=o.get;return void 0!==o?o.call(n):void 0}if(e=Object.getPrototypeOf(e),null!==e)return E(e,t,n)}var C=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":x(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},T=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":x(t))&&"function"!=typeof t?e:t},O=(_(k,[{key:"toString",value:function(){return t(this)}},{key:"toHexString",value:function(){return t(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),k);function k(){if(g(this,k),this.__state=p.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}function A(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||O.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(O.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function P(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||O.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(O.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}O.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=f.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");h.extend(e.__state,f.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},O.recalculateHSV=function(e){var t=f.rgb_to_hsv(e.r,e.g,e.b);h.extend(e.__state,{s:t.s,v:t.v}),h.isNaN(t.h)?h.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},O.COMPONENTS=["r","g","b","h","s","v","hex","a"],A(O.prototype,"r",2),A(O.prototype,"g",1),A(O.prototype,"b",0),P(O.prototype,"h"),P(O.prototype,"s"),P(O.prototype,"v"),Object.defineProperty(O.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(O.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=f.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var L=(_(R,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),R);function R(e,t){g(this,R),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}var N={};h.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){h.each(e,function(e){N[e]=t})});var M=/(\d+(\.\d+)?)px/;function j(e){if("0"===e||h.isUndefined(e))return 0;e=e.match(M);return h.isNull(e)?0:parseFloat(e[1])}var H={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){h.isUndefined(t)&&(t=!0),h.isUndefined(n)&&(n=!0),e.style.position="absolute",t&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,o){var r=n||{},n=N[t];if(!n)throw new Error("Event type "+t+" not supported.");var i=document.createEvent(n);switch(n){case"MouseEvents":var a=r.x||r.clientX||0,s=r.y||r.clientY||0;i.initMouseEvent(t,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,a,s,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":s=i.initKeyboardEvent||i.initKeyEvent;h.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),s(t,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:i.initEvent(t,r.bubbles||!1,r.cancelable||!0)}h.defaults(i,o),e.dispatchEvent(i)},bind:function(e,t,n,o){o=o||!1;return e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on"+t,n),H},unbind:function(e,t,n,o){o=o||!1;return e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on"+t,n),H},addClass:function(e,t){var n;return void 0===e.className?e.className=t:e.className===t||-1===(n=e.className.split(/ +/)).indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")),H},removeClass:function(e,t){var n;return t?e.className===t?e.removeAttribute("class"):-1!==(t=(n=e.className.split(/ +/)).indexOf(t))&&(n.splice(t,1),e.className=n.join(" ")):e.className=void 0,H},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){e=getComputedStyle(e);return j(e["border-left-width"])+j(e["border-right-width"])+j(e["padding-left"])+j(e["padding-right"])+j(e.width)},getHeight:function(e){e=getComputedStyle(e);return j(e["border-top-width"])+j(e["border-bottom-width"])+j(e["padding-top"])+j(e["padding-bottom"])+j(e.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)for(;n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent,t;);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},B=(C(z,L),_(z,[{key:"setValue",value:function(e){e=E(z.prototype.__proto__||Object.getPrototypeOf(z.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),E(z.prototype.__proto__||Object.getPrototypeOf(z.prototype),"updateDisplay",this).call(this)}}]),z);function z(e,t){g(this,z);var t=T(this,(z.__proto__||Object.getPrototypeOf(z)).call(this,e,t)),n=t;return t.__prev=t.getValue(),t.__checkbox=document.createElement("input"),t.__checkbox.setAttribute("type","checkbox"),H.bind(t.__checkbox,"change",function(){n.setValue(!n.__prev)},!1),t.domElement.appendChild(t.__checkbox),t.updateDisplay(),t}var D=(C(I,L),_(I,[{key:"setValue",value:function(e){e=E(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e}},{key:"updateDisplay",value:function(){return H.isActive(this.__select)?this:(this.__select.value=this.getValue(),E(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"updateDisplay",this).call(this))}}]),I);function I(e,t,n){g(this,I);var o,t=T(this,(I.__proto__||Object.getPrototypeOf(I)).call(this,e,t)),n=n,r=t;return t.__select=document.createElement("select"),h.isArray(n)&&(o={},h.each(n,function(e){o[e]=e}),n=o),h.each(n,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),r.__select.appendChild(n)}),t.updateDisplay(),H.bind(t.__select,"change",function(){var e=this.options[this.selectedIndex].value;r.setValue(e)}),t.domElement.appendChild(t.__select),t}var V=(C(F,L),_(F,[{key:"updateDisplay",value:function(){return H.isActive(this.__input)||(this.__input.value=this.getValue()),E(F.prototype.__proto__||Object.getPrototypeOf(F.prototype),"updateDisplay",this).call(this)}}]),F);function F(e,t){g(this,F);var t=T(this,(F.__proto__||Object.getPrototypeOf(F)).call(this,e,t)),n=t;function o(){n.setValue(n.__input.value)}return t.__input=document.createElement("input"),t.__input.setAttribute("type","text"),H.bind(t.__input,"keyup",o),H.bind(t.__input,"change",o),H.bind(t.__input,"blur",function(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}),H.bind(t.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),t.updateDisplay(),t.domElement.appendChild(t.__input),t}function G(e){e=e.toString();return-1<e.indexOf(".")?e.length-e.indexOf(".")-1:0}var X=(C(U,L),_(U,[{key:"setValue",value:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),E(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"setValue",this).call(this,e)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=G(e),this}}]),U);function U(e,t,n){g(this,U);t=T(this,(U.__proto__||Object.getPrototypeOf(U)).call(this,e,t)),n=n||{};return t.__min=n.min,t.__max=n.max,t.__step=n.step,h.isUndefined(t.__step)?0===t.initialValue?t.__impliedStep=1:t.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(t.initialValue))/Math.LN10))/10:t.__impliedStep=t.__step,t.__precision=G(t.__impliedStep),t}var W=(C(Y,X),_(Y,[{key:"updateDisplay",value:function(){var e,t;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),t=this.__precision,t=Math.pow(10,t),Math.round(e*t)/t),E(Y.prototype.__proto__||Object.getPrototypeOf(Y.prototype),"updateDisplay",this).call(this)}}]),Y);function Y(e,t,n){g(this,Y);n=T(this,(Y.__proto__||Object.getPrototypeOf(Y)).call(this,e,t,n));n.__truncationSuspended=!1;var o=n,r=void 0;function i(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function a(e){var t=r-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),r=e.clientY}function s(){H.unbind(window,"mousemove",a),H.unbind(window,"mouseup",s),i()}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),H.bind(n.__input,"change",function(){var e=parseFloat(o.__input.value);h.isNaN(e)||o.setValue(e)}),H.bind(n.__input,"blur",function(){i()}),H.bind(n.__input,"mousedown",function(e){H.bind(window,"mousemove",a),H.bind(window,"mouseup",s),r=e.clientY}),H.bind(n.__input,"keydown",function(e){13===e.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,i())}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}function q(e,t,n,o,r){return o+(e-t)/(n-t)*(r-o)}var Z=(C(K,X),_(K,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",E(K.prototype.__proto__||Object.getPrototypeOf(K.prototype),"updateDisplay",this).call(this)}}]),K);function K(e,t,n,o,r){g(this,K);var r=T(this,(K.__proto__||Object.getPrototypeOf(K)).call(this,e,t,{min:n,max:o,step:r})),i=r;function a(e){e.preventDefault();var t=i.__background.getBoundingClientRect();return i.setValue(q(e.clientX,t.left,t.right,i.__min,i.__max)),!1}function s(){H.unbind(window,"mousemove",a),H.unbind(window,"mouseup",s),i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}function l(e){var t=e.touches[0].clientX,e=i.__background.getBoundingClientRect();i.setValue(q(t,e.left,e.right,i.__min,i.__max))}function c(){H.unbind(window,"touchmove",l),H.unbind(window,"touchend",c),i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}return r.__background=document.createElement("div"),r.__foreground=document.createElement("div"),H.bind(r.__background,"mousedown",function(e){document.activeElement.blur(),H.bind(window,"mousemove",a),H.bind(window,"mouseup",s),a(e)}),H.bind(r.__background,"touchstart",function(e){if(1!==e.touches.length)return;H.bind(window,"touchmove",l),H.bind(window,"touchend",c),l(e)}),H.addClass(r.__background,"slider"),H.addClass(r.__foreground,"slider-fg"),r.updateDisplay(),r.__background.appendChild(r.__foreground),r.domElement.appendChild(r.__background),r}var J=(C(Q,L),_(Q,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),Q);function Q(e,t,n){g(this,Q);var t=T(this,(Q.__proto__||Object.getPrototypeOf(Q)).call(this,e,t)),o=t;return t.__button=document.createElement("div"),t.__button.innerHTML=void 0===n?"Fire":n,H.bind(t.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),H.addClass(t.__button,"button"),t.domElement.appendChild(t.__button),t}var $=(C(ee,L),_(ee,[{key:"updateDisplay",value:function(){var t,n=p(this.getValue());!1!==n&&(t=!1,h.each(O.COMPONENTS,function(e){if(!h.isUndefined(n[e])&&!h.isUndefined(this.__color.__state[e])&&n[e]!==this.__color.__state[e])return t=!0,{}},this),t&&h.extend(this.__color.__state,n)),h.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var e=this.__color.v<.5||.5<this.__color.s?255:0,o=255-e;h.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+e+","+e+","+e+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,ne(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),h.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+e+","+e+","+e+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]),ee);function ee(e,t){g(this,ee);var n=T(this,(ee.__proto__||Object.getPrototypeOf(ee)).call(this,e,t));n.__color=new O(n.getValue()),n.__temp=new O(0);var o=n;n.domElement=document.createElement("div"),H.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",H.bind(n.__input,"keydown",function(e){13===e.keyCode&&l.call(this)}),H.bind(n.__input,"blur",l),H.bind(n.__selector,"mousedown",function(){H.addClass(this,"drag").bind(window,"mouseup",function(){H.removeClass(o.__selector,"drag")})}),H.bind(n.__selector,"touchstart",function(){H.addClass(this,"drag").bind(window,"touchend",function(){H.removeClass(o.__selector,"drag")})});e=document.createElement("div");function r(e){u(e),H.bind(window,"mousemove",u),H.bind(window,"touchmove",u),H.bind(window,"mouseup",a),H.bind(window,"touchend",a)}function i(e){d(e),H.bind(window,"mousemove",d),H.bind(window,"touchmove",d),H.bind(window,"mouseup",s),H.bind(window,"touchend",s)}function a(){H.unbind(window,"mousemove",u),H.unbind(window,"touchmove",u),H.unbind(window,"mouseup",a),H.unbind(window,"touchend",a),c()}function s(){H.unbind(window,"mousemove",d),H.unbind(window,"touchmove",d),H.unbind(window,"mouseup",s),H.unbind(window,"touchend",s),c()}function l(){var e=p(this.value);!1!==e?(o.__color.__state=e,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function c(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function u(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,e=n.clientX,n=n.clientY,e=(e-t.left)/(t.right-t.left),t=1-(n-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),1<e?e=1:e<0&&(e=0),o.__color.v=t,o.__color.s=e,o.setValue(o.__color.toOriginal()),!1}function d(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__hue_field.getBoundingClientRect(),t=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),o.__color.h=360*t,o.setValue(o.__color.toOriginal()),!1}return h.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),h.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),h.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),h.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),h.extend(e.style,{width:"100%",height:"100%",background:"none"}),ne(e,"top","rgba(0,0,0,0)","#000"),h.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(t=n.__hue_field).style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",h.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),H.bind(n.__saturation_field,"mousedown",r),H.bind(n.__saturation_field,"touchstart",r),H.bind(n.__field_knob,"mousedown",r),H.bind(n.__field_knob,"touchstart",r),H.bind(n.__hue_field,"mousedown",i),H.bind(n.__hue_field,"touchstart",i),n.__saturation_field.appendChild(e),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}var te=["-moz-","-o-","-webkit-","-ms-",""];function ne(t,n,o,r){t.style.background="",h.each(te,function(e){t.style.cssText+="background: "+e+"linear-gradient("+n+", "+o+" 0%, "+r+" 100%); "})}var oe=function(e,t,n,o,r){var i=e[t];return h.isArray(n)||h.isObject(n)?new D(e,t,n):h.isNumber(i)?h.isNumber(n)&&h.isNumber(o)?h.isNumber(r)?new Z(e,t,n,o,r):new Z(e,t,n,o):h.isNumber(r)?new W(e,t,{min:n,max:o,step:r}):new W(e,t,{min:n,max:o}):h.isString(i)?new V(e,t):h.isFunction(i)?new J(e,t,""):h.isBoolean(i)?new B(e,t):null},re=(C(ie,L),_(ie,[{key:"controller",set:function(e){this._controller=e},get:function(){return this._controller}}]),ie);function ie(e,t){g(this,ie);var n=T(this,(ie.__proto__||Object.getPrototypeOf(ie)).call(this,e,t));return n.arguments={object:e,property:t,opts:Array.prototype.slice.call(arguments,2)},e.property&&(n.property=e.property(n)),n}C=function(e,t){var t=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e;var o=t.getElementsByTagName("head")[0];try{o.appendChild(n)}catch(e){}};var ae=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},se=(_(le,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),h.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",H.unbind(t.domElement,"webkitTransitionEnd",e),H.unbind(t.domElement,"transitionend",e),H.unbind(t.domElement,"oTransitionEnd",e)}var t=this;H.bind(this.domElement,"webkitTransitionEnd",e),H.bind(this.domElement,"transitionend",e),H.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-H.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-H.getHeight(this.domElement)/2+"px"}}]),le);function le(){g(this,le),this.backgroundElement=document.createElement("div"),h.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),H.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),h.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;H.bind(this.backgroundElement,"click",function(){e.hide()})}C(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var ce="Default",ue=function(){try{return!!window.localStorage}catch(e){return!1}}(),de=void 0,pe=!0,fe=void 0,he=!1,me=[],ge=function t(e){var n=this,o=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),H.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],o=h.defaults(o,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),o=h.defaults(o,{resizable:o.autoPlace,hideable:o.autoPlace}),h.isUndefined(o.load)?o.load={preset:ce}:o.preset&&(o.load.preset=o.preset),h.isUndefined(o.parent)&&o.hideable&&me.push(this),o.resizable=h.isUndefined(o.parent)&&o.resizable,o.autoPlace&&h.isUndefined(o.scrollable)&&(o.scrollable=!0);var r,i,a,s,l=ue&&"true"===localStorage.getItem(xe(0,"isLocal")),c=void 0,u=void 0;function d(e){return e.preventDefault(),i.width+=a-e.clientX,i.onResize(),a=e.clientX,!1}function p(){H.removeClass(i.__closeButton,ge.CLASS_DRAG),H.unbind(window,"mousemove",d),H.unbind(window,"mouseup",p)}function f(e){return e.preventDefault(),a=e.clientX,H.addClass(i.__closeButton,ge.CLASS_DRAG),H.bind(window,"mousemove",d),H.bind(window,"mouseup",p),!1}Object.defineProperties(this,{parent:{get:function(){return o.parent}},scrollable:{get:function(){return o.scrollable}},autoPlace:{get:function(){return o.autoPlace}},closeOnTop:{get:function(){return o.closeOnTop}},preset:{get:function(){return(n.parent?n.getRoot():o.load).preset},set:function(e){n.parent?n.getRoot().preset=e:o.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return o.width},set:function(e){o.width=e,Se(n,e)}},name:{get:function(){return o.name},set:function(e){o.name=e,u&&(u.innerHTML=o.name)}},closed:{get:function(){return o.closed},set:function(e){o.closed=e,o.closed?H.addClass(n.__ul,t.CLASS_CLOSED):H.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return o.load}},useLocalStorage:{get:function(){return l},set:function(e){ue&&((l=e)?H.bind(window,"unload",c):H.unbind(window,"unload",c),localStorage.setItem(xe(0,"isLocal"),e))}}}),h.isUndefined(o.parent)?(this.closed=o.closed||!1,H.addClass(this.domElement,t.CLASS_MAIN),H.makeSelectable(this.domElement,!1),ue&&l&&(n.useLocalStorage=!0,(r=localStorage.getItem(xe(0,"gui")))&&(o.load=JSON.parse(r))),this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,H.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),o.closeOnTop?(H.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(H.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),H.bind(this.__closeButton,"click",function(){n.closed=!n.closed})):(void 0===o.closed&&(o.closed=!0),r=document.createTextNode(o.name),H.addClass(r,"controller-name"),u=_e(n,r),H.addClass(this.__ul,t.CLASS_CLOSED),H.addClass(u,"title"),H.bind(u,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1}),o.closed||(this.closed=!1)),o.autoPlace&&(h.isUndefined(o.parent)&&(pe&&(fe=document.createElement("div"),H.addClass(fe,"dg"),H.addClass(fe,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(fe),pe=!1),fe.appendChild(this.domElement),H.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||Se(n,o.width)),this.__resizeHandler=function(){n.onResizeDebounced()},H.bind(window,"resize",this.__resizeHandler),H.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),H.bind(this.__ul,"transitionend",this.__resizeHandler),H.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),o.resizable&&(a=void 0,(i=this).__resize_handle=document.createElement("div"),h.extend(i.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),H.bind(i.__resize_handle,"mousedown",f),H.bind(i.__closeButton,"mousedown",f),i.domElement.insertBefore(i.__resize_handle,i.domElement.firstElementChild)),c=function(){ue&&"true"===localStorage.getItem(xe(0,"isLocal"))&&localStorage.setItem(xe(0,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=c,o.parent||((s=n.getRoot()).width+=1,h.defer(function(){--s.width}))};function _e(e,t,n){var o=document.createElement("li");return t&&o.appendChild(t),n?e.__ul.insertBefore(o,n):e.__ul.appendChild(o),e.onResize(),o}function be(e){H.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&H.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function ye(e,t){e=e.__preset_select[e.__preset_select.selectedIndex];e.innerHTML=t?e.value+"*":e.value}function ve(e,t){var n=e.getRoot(),o=n.__rememberedObjects.indexOf(t.object);if(-1!==o){var r=n.__rememberedObjectIndecesToControllers[o];if(void 0===r&&(r={},n.__rememberedObjectIndecesToControllers[o]=r),r[t.property]=t,n.load&&n.load.remembered){r=n.load.remembered,n=void 0;if(r[e.preset])n=r[e.preset];else{if(!r[ce])return;n=r[ce]}n[o]&&void 0!==n[o][t.property]&&(o=n[o][t.property],t.initialValue=o,t.setValue(o))}}}function we(e,t,n,o){var r;if(t.arguments&&(t=(r=t).arguments.object,n=r.arguments.property,o={factoryArgs:r.arguments.opts}),void 0===r&&void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var i=void 0;null===(i=o.color?new $(t,n):void 0!==r&&"string"==typeof r.property?r:(l=[t,n].concat(o.factoryArgs),oe.apply(e,l)))?i=r:void 0!==r&&(r.controller=i),o.before instanceof L&&(o.before=o.before.__li),ve(e,i),H.addClass(i.domElement,"c");var a=document.createElement("span");if(H.addClass(a,"property-name"),void 0!==r&&"object"===m(r.property))for(var s in r.property)a.appendChild(r.property[s]);else a.innerHTML=i.property;var l=document.createElement("div");l.appendChild(a),l.appendChild(i.domElement);var c,u,d,p,o=_e(e,l,o.before);return H.addClass(o,ge.CLASS_CONTROLLER_ROW),i instanceof $?H.addClass(o,"color"):H.addClass(o,m(i.getValue())),c=e,u=o,(d=i).__li=u,d.__gui=c,h.extend(d,{options:function(e){if(1<arguments.length){var t=d.__li.nextElementSibling;return d.remove(),we(c,d.object,d.property,{before:t,factoryArgs:[h.toArray(arguments)]})}if(h.isArray(e)||h.isObject(e)){t=d.__li.nextElementSibling;return d.remove(),we(c,d.object,d.property,{before:t,factoryArgs:[e]})}},name:function(e){return d.__li.firstElementChild.firstElementChild.innerHTML=e,d},listen:function(){return d.__gui.listen(d),d},remove:function(){return d.__gui.remove(d),d}}),d instanceof Z?(p=new W(d.object,d.property,{min:d.__min,max:d.__max,step:d.__step}),h.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=d[e],n=p[e];d[e]=p[e]=function(){var e=Array.prototype.slice.call(arguments);return n.apply(p,e),t.apply(d,e)}}),H.addClass(u,"has-slider"),d.domElement.insertBefore(p.domElement,d.domElement.firstElementChild)):d instanceof W?(o=function(e){if(h.isNumber(d.__min)&&h.isNumber(d.__max)){var t=d.__li.firstElementChild.firstElementChild.innerHTML,n=-1<d.__gui.__listening.indexOf(d);d.remove();var o=we(c,d.object,d.property,{before:d.__li.nextElementSibling,factoryArgs:[d.__min,d.__max,d.__step]});return o.name(t),n&&o.listen(),o}return e},d.min=h.compose(o,d.min),d.max=h.compose(o,d.max)):d instanceof B?(H.bind(u,"click",function(){H.fakeEvent(d.__checkbox,"click")}),H.bind(d.__checkbox,"click",function(e){e.stopPropagation()})):d instanceof J?(H.bind(u,"click",function(){H.fakeEvent(d.__button,"click")}),H.bind(u,"mouseover",function(){H.addClass(d.__button,"hover")}),H.bind(u,"mouseout",function(){H.removeClass(d.__button,"hover")})):d instanceof $&&(H.addClass(u,"color"),d.updateDisplay=h.compose(function(e){return u.style.borderLeftColor=d.__color.toString(),e},d.updateDisplay),d.updateDisplay()),d.setValue=h.compose(function(e){return c.getRoot().__preset_select&&d.isModified()&&ye(c.getRoot(),!0),e},d.setValue),e.__controllers.push(i),i}function xe(e,t){return document.location.href+"."+t}function Ee(e,t,n){var o=document.createElement("option");o.innerHTML=t,o.value=t,e.__preset_select.appendChild(o),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function Ce(e,t){t.style.display=e.useLocalStorage?"block":"none"}function Se(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function Te(r,i){var a={};return h.each(r.__rememberedObjects,function(e,t){var n={},o=r.__rememberedObjectIndecesToControllers[t];h.each(o,function(e,t){n[t]=i?e.initialValue:e.getValue()}),a[t]=n}),a}ge.toggleHide=function(){he=!he,h.each(me,function(e){e.domElement.style.display=he?"none":""})},ge.CLASS_AUTO_PLACE="a",ge.CLASS_AUTO_PLACE_CONTAINER="ac",ge.CLASS_MAIN="main",ge.CLASS_CONTROLLER_ROW="cr",ge.CLASS_TOO_TALL="taller-than-window",ge.CLASS_CLOSED="closed",ge.CLASS_CLOSE_BUTTON="close-button",ge.CLASS_CLOSE_TOP="close-top",ge.CLASS_CLOSE_BOTTOM="close-bottom",ge.CLASS_DRAG="drag",ge.DEFAULT_WIDTH=245,ge.TEXT_CLOSED="Close Controls",ge.TEXT_OPEN="Open Controls",ge._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||ge.toggleHide()},H.bind(window,"keydown",ge._keydownHandler,!1),h.extend(ge.prototype,{add:function(e,t){return we(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return we(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;h.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&fe.removeChild(this.domElement);var t=this;h.each(this.__folders,function(e){t.removeFolder(e)}),H.unbind(window,"keydown",ge._keydownHandler,!1),be(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);t=new ge(t);this.__folders[e]=t;e=_e(this,t.domElement);return H.addClass(e,"folder"),t},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],be(t);var e=this;h.each(t.__folders,function(e){t.removeFolder(e)}),h.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e,t,n=this.getRoot();n.scrollable&&(e=H.getOffset(n.__ul).top,t=0,h.each(n.__ul.childNodes,function(e){n.autoPlace&&e===n.__save_row||(t+=H.getHeight(e))}),window.innerHeight-e-20<t?(H.addClass(n.domElement,ge.CLASS_TOO_TALL),n.__ul.style.height=window.innerHeight-e-20+"px"):(H.removeClass(n.domElement,ge.CLASS_TOO_TALL),n.__ul.style.height="auto")),n.__resize_handle&&h.defer(function(){n.__resize_handle.style.height=n.__ul.offsetHeight+"px"}),n.__closeButton&&(n.__closeButton.style.width=n.width+"px")},onResizeDebounced:h.debounce(function(){this.onResize()},50),remember:function(){if(h.isUndefined(de)&&((de=new se).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;h.each(Array.prototype.slice.call(arguments),function(e){0===t.__rememberedObjects.length&&function(n){var e=n.__save_row=document.createElement("li");H.addClass(n.domElement,"has-save"),n.__ul.insertBefore(e,n.__ul.firstChild),H.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",H.addClass(t,"button gears");var o=document.createElement("span");o.innerHTML="Save",H.addClass(o,"button"),H.addClass(o,"save");var r=document.createElement("span");r.innerHTML="New",H.addClass(r,"button"),H.addClass(r,"save-as");var i=document.createElement("span");i.innerHTML="Revert",H.addClass(i,"button"),H.addClass(i,"revert");var a=n.__preset_select=document.createElement("select");n.load&&n.load.remembered?h.each(n.load.remembered,function(e,t){Ee(n,t,t===n.preset)}):Ee(n,ce,!1);{var s;H.bind(a,"change",function(){for(var e=0;e<n.__preset_select.length;e++)n.__preset_select[e].innerHTML=n.__preset_select[e].value;n.preset=this.value}),e.appendChild(a),e.appendChild(t),e.appendChild(o),e.appendChild(r),e.appendChild(i),ue&&(s=document.getElementById("dg-local-explain"),e=document.getElementById("dg-local-storage"),document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(xe(0,"isLocal"))&&e.setAttribute("checked","checked"),Ce(n,s),H.bind(e,"change",function(){n.useLocalStorage=!n.useLocalStorage,Ce(n,s)}))}var l=document.getElementById("dg-new-constructor");H.bind(l,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||de.hide()}),H.bind(t,"click",function(){l.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),de.show(),l.focus(),l.select()}),H.bind(o,"click",function(){n.save()}),H.bind(r,"click",function(){var e=prompt("Enter a new preset name.");e&&n.saveAs(e)}),H.bind(i,"click",function(){n.revert()})}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&Se(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var n=this.load;return n.closed=this.closed,0<this.__rememberedObjects.length&&(n.preset=this.preset,n.remembered||(n.remembered={}),n.remembered[this.preset]=Te(this)),n.folders={},h.each(this.__folders,function(e,t){n.folders[t]=e.getSaveObject()}),n},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Te(this),ye(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[ce]=Te(this,!0)),this.load.remembered[e]=Te(this),this.preset=e,Ee(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(t){h.each(this.__controllers,function(e){this.getRoot().load.remembered?ve(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),h.each(this.__folders,function(e){e.revert(e)}),t||ye(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&ae.call(window,function(){e(t)});h.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){h.each(this.__controllers,function(e){e.updateDisplay()}),h.each(this.__folders,function(e){e.updateDisplay()})}});var Oe,ke,C={Controller:L,BooleanController:B,OptionController:D,StringController:V,NumberController:X,NumberControllerBox:W,NumberControllerSlider:Z,FunctionController:J,ColorController:$,CustomController:re},Ae={addButton:function(e,t){t=t||{};var n=document.createElement("span");return n.innerHTML=e,void 0!==t.title&&(n.title=t.title),void 0!==t.onclick&&(n.style.cursor="pointer",n.onclick=t.onclick),void 0!==t.onwheel&&(e=function(e){e=(e=e||window.event).deltaY||e.detail||e.wheelDelta;t.onwheel(e)},n.style.cursor="n-resize",n.addEventListener?"onwheel"in document?n.addEventListener("wheel",e):"onmousewheel"in document?n.addEventListener("mousewheel",e):n.addEventListener("MozMousePixelScroll",e):n.attachEvent("onmousewheel",e)),n.style.margin="0px 2px",n}},X=(b(Pe,[{key:"THREE",set:function(e){Oe?Object.is(e,Oe)||console.error("three: duplicate THREE. Please use one instance of the THREE library."):Oe=e},get:function(){return void 0===Oe&&console.error("three: invalid _THREE = "+Oe+". Call three.THREE = THREE first."),Oe}},{key:"dat",set:function(e){ke?Object.is(e,ke)||console.error("three: duplicate dat. Please use one instance of the dat library."):ke=e},get:function(){return ke}}]),Pe);
/**
* custom controller, allow to user to change a value step by step.
*
* @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
*
* @copyright 2011 Data Arts Team, Google Creative Lab
*
* @license under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*/function Pe(){S(this,Pe)}window.__myThree__=window.__myThree__||{},window.__myThree__.three?gt=window.__myThree__.three:((gt=new X).isThree=function(){return Oe},window.__myThree__.three=gt);var Le=gt,Re=(y(Ne,C.CustomController),Ne);
/**
 * @module ScaleController
 * @description is dat.GUI graphical user interface controller for control of the scale of threejs 3D object
 *
 * @see {@link https://threejs.org/} about threejs
 * @see {@link https://github.com/dataarts/dat.gui} about dat.GUI
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function Ne(i,a){S(this,Ne),(a=a||{}).settings=a.settings||{},a.settings.zoomMultiplier=a.settings.zoomMultiplier||1.1;var e=v(this,(Ne.__proto__||Object.getPrototypeOf(Ne)).call(this,{multiplier:a.settings.zoomMultiplier,property:function(e){var t={zoom:"Zoom",in:"in",out:"out",wheelZoom:"Scroll the mouse wheel to zoom"},n=void 0===a.getLanguageCode?"en":a.getLanguageCode();switch(n){case"ru":t.zoom="",t.in="",t.out="",t.wheelZoom="     ";break;default:if(void 0===a.lang||a.lang.languageCode!=n)break;Object.keys(a.lang).forEach(function(e){void 0!==t[e]&&(t[e]=a.lang[e])})}var o={},r=Ae.addButton;return o.zoomLabel=r(t.zoom,{title:t.wheelZoom,onwheel:function(n){i(e,function(e,t){return 0<n?e*=t:e/=t,e})}}),o.in=r("",{title:t.in,onclick:function(){i(e,function(e,t){return e*=t})}}),o.out=r("",{title:t.out,onclick:function(){i(e,function(e,t){return e/=t})}}),o}},"multiplier",1.1,10,.1));return void 0===e.property&&console.error("init() returns "+e.property),e}
/**
 * PositionController is dat.GUI graphical user interface controller for control of the position of threejs 3D object
 *
 * @see {@link https://threejs.org/} about threejs
 * @see {@link https://github.com/dataarts/dat.gui} about dat.GUI
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
var Me=(y(je,C.CustomController),je);function je(i,a){S(this,je),(a=a||{}).settings=a.settings||{};var e=a.settings;a.min=a.min||.1,a.max=a.max||10,e.offset=e.offset||.1,a.step=a.step||.1;e=v(this,(je.__proto__||Object.getPrototypeOf(je)).call(this,{offset:e.offset,property:function(n){var t={offset:"Offset",add:"add",subtract:"subtract",wheelPosition:"Scroll the mouse wheel to change the position"},e=void 0===a.getLanguageCode?"en":a.getLanguageCode();switch(e){case"ru":t.offset="",t.add="",t.subtract="",t.wheelPosition="     ";break;default:if(void 0===a.lang||a.lang.languageCode!=e)break;Object.keys(a.lang).forEach(function(e){void 0!==t[e]&&(t[e]=a.lang[e])})}var o={},r=Ae.addButton;return o.Label=r(t.offset,{title:t.wheelPosition,onwheel:function(e){var t=n.controller.getValue();i(0<e?t:-t)}}),o.in=r("",{title:t.add,onclick:function(){i(n.controller.getValue())}}),o.out=r("",{title:t.subtract,onclick:function(){i(-n.controller.getValue())}}),o}},"offset",a.min,a.max,a.step));return void 0===e.property&&console.error("init() returns "+e.property),e}function He(e,t){var n=e.__state.conversionName.toString(),o=Math.round(e.r),r=Math.round(e.g),i=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===n?"rgb("+o+","+r+","+i+")":"CSS_RGBA"===n?"rgba("+o+","+r+","+i+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+o+","+r+","+i+"]":"RGBA_ARRAY"===n?"["+o+","+r+","+i+","+a+"]":"RGB_OBJ"===n?"{r:"+o+",g:"+r+",b:"+i+"}":"RGBA_OBJ"===n?"{r:"+o+",g:"+r+",b:"+i+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var Be,ze=Array.prototype.forEach,De=Array.prototype.slice,Ie={BREAK:{},extend:function(n){return this.each(De.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(t[e])||(n[e]=t[e])}.bind(this))},this),n},defaults:function(n){return this.each(De.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(n[e])&&(n[e]=t[e])}.bind(this))},this),n},compose:function(){var n=De.call(arguments);return function(){for(var e=De.call(arguments),t=n.length-1;0<=t;t--)e=[n[t].apply(this,e)];return e[0]}},each:function(e,t,n){if(e)if(ze&&e.forEach&&e.forEach===ze)e.forEach(t,n);else if(e.length===e.length+0){for(var o=void 0,o=0,r=e.length;o<r;o++)if(o in e&&t.call(n,e[o],o)===this.BREAK)return}else for(var i in e)if(t.call(n,e[i],i)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(o,r,i){var a=void 0;return function(){var e=this,t=arguments;var n=i||!a;clearTimeout(a),a=setTimeout(function(){a=null,i||o.apply(e,t)},r),n&&o.apply(e,t)}},toArray:function(e){return e.toArray?e.toArray():De.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:(Be=function(e){return isNaN(e)},Ve.toString=function(){return Be.toString()},Ve),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}};function Ve(e){return Be.apply(this,arguments)}var Fe,Ge=[{litmus:Ie.isString,conversions:{THREE_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:He},SIX_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:He},CSS_RGB:{read:function(e){e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:He},CSS_RGBA:{read:function(e){e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:He}}},{litmus:Ie.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:Ie.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:Ie.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(Ie.isNumber(e.r)&&Ie.isNumber(e.g)&&Ie.isNumber(e.b)&&Ie.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(Ie.isNumber(e.r)&&Ie.isNumber(e.g)&&Ie.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(Ie.isNumber(e.h)&&Ie.isNumber(e.s)&&Ie.isNumber(e.v)&&Ie.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(Ie.isNumber(e.h)&&Ie.isNumber(e.s)&&Ie.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Xe=void 0,Ue=void 0,We=function(e){Ue=!1;var n=1<arguments.length?Ie.toArray(arguments):e;return Ie.each(Ge,function(e){if(e.litmus(n))return Ie.each(e.conversions,function(e,t){if(Xe=e.read(n),!1===Ue&&!1!==Xe)return(Ue=Xe).conversionName=t,Xe.conversion=e,Ie.BREAK}),Ie.BREAK}),Ue},Ye={hsv_to_rgb:function(e,t,n){var o=Math.floor(e/60)%6,r=e/60-Math.floor(e/60),i=n*(1-t),e=n*(1-r*t),t=n*(1-(1-r)*t),o=[[n,t,i],[e,n,i],[i,n,t],[i,e,n],[t,i,n],[n,i,e]][o];return{r:255*o[0],g:255*o[1],b:255*o[2]}},rgb_to_hsv:function(e,t,n){var o=Math.min(e,t,n),r=Math.max(e,t,n),i=r-o,o=void 0;return 0===r?{h:NaN,s:0,v:0}:(o=e===r?(t-n)/i:t===r?2+(n-e)/i:4+(e-t)/i,(o/=6)<0&&(o+=1),{h:360*o,s:i/r,v:r/255})},rgb_to_hex:function(e,t,n){e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t);return e=this.hex_with_component(e,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(Fe=8*t)|e&~(255<<Fe)}},qe="function"==typeof Symbol&&"symbol"===x(Symbol.iterator)?function(e){return void 0===e?"undefined":x(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":x(e)},Ze=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},re=function(e,t,n){return t&&Ke(e.prototype,t),n&&Ke(e,n),e};function Ke(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Je(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0!==o){if("value"in o)return o.value;o=o.get;return void 0!==o?o.call(n):void 0}if(e=Object.getPrototypeOf(e),null!==e)return Je(e,t,n)}var X=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":x(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Qe=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":x(t))&&"function"!=typeof t?e:t},$e=(re(et,[{key:"toString",value:function(){return He(this)}},{key:"toHexString",value:function(){return He(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),et);function et(){if(Ze(this,et),this.__state=We.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}function tt(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||$e.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&($e.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function nt(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||$e.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&($e.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}$e.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=Ye.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");Ie.extend(e.__state,Ye.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},$e.recalculateHSV=function(e){var t=Ye.rgb_to_hsv(e.r,e.g,e.b);Ie.extend(e.__state,{s:t.s,v:t.v}),Ie.isNaN(t.h)?Ie.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},$e.COMPONENTS=["r","g","b","h","s","v","hex","a"],tt($e.prototype,"r",2),tt($e.prototype,"g",1),tt($e.prototype,"b",0),nt($e.prototype,"h"),nt($e.prototype,"s"),nt($e.prototype,"v"),Object.defineProperty($e.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty($e.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=Ye.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var ot=(re(rt,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),rt);function rt(e,t){Ze(this,rt),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}var it={};Ie.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){Ie.each(e,function(e){it[e]=t})});var at=/(\d+(\.\d+)?)px/;function st(e){if("0"===e||Ie.isUndefined(e))return 0;e=e.match(at);return Ie.isNull(e)?0:parseFloat(e[1])}var lt={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){Ie.isUndefined(t)&&(t=!0),Ie.isUndefined(n)&&(n=!0),e.style.position="absolute",t&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,o){var r=n||{},n=it[t];if(!n)throw new Error("Event type "+t+" not supported.");var i=document.createEvent(n);switch(n){case"MouseEvents":var a=r.x||r.clientX||0,s=r.y||r.clientY||0;i.initMouseEvent(t,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,a,s,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":s=i.initKeyboardEvent||i.initKeyEvent;Ie.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),s(t,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:i.initEvent(t,r.bubbles||!1,r.cancelable||!0)}Ie.defaults(i,o),e.dispatchEvent(i)},bind:function(e,t,n,o){o=o||!1;return e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on"+t,n),lt},unbind:function(e,t,n,o){o=o||!1;return e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on"+t,n),lt},addClass:function(e,t){var n;return void 0===e.className?e.className=t:e.className===t||-1===(n=e.className.split(/ +/)).indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")),lt},removeClass:function(e,t){var n;return t?e.className===t?e.removeAttribute("class"):-1!==(t=(n=e.className.split(/ +/)).indexOf(t))&&(n.splice(t,1),e.className=n.join(" ")):e.className=void 0,lt},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){e=getComputedStyle(e);return st(e["border-left-width"])+st(e["border-right-width"])+st(e["padding-left"])+st(e["padding-right"])+st(e.width)},getHeight:function(e){e=getComputedStyle(e);return st(e["border-top-width"])+st(e["border-bottom-width"])+st(e["padding-top"])+st(e["padding-bottom"])+st(e.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)for(;n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent,t;);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},ct=(X(ut,ot),re(ut,[{key:"setValue",value:function(e){e=Je(ut.prototype.__proto__||Object.getPrototypeOf(ut.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Je(ut.prototype.__proto__||Object.getPrototypeOf(ut.prototype),"updateDisplay",this).call(this)}}]),ut);function ut(e,t){Ze(this,ut);var t=Qe(this,(ut.__proto__||Object.getPrototypeOf(ut)).call(this,e,t)),n=t;return t.__prev=t.getValue(),t.__checkbox=document.createElement("input"),t.__checkbox.setAttribute("type","checkbox"),lt.bind(t.__checkbox,"change",function(){n.setValue(!n.__prev)},!1),t.domElement.appendChild(t.__checkbox),t.updateDisplay(),t}var dt=(X(pt,ot),re(pt,[{key:"setValue",value:function(e){e=Je(pt.prototype.__proto__||Object.getPrototypeOf(pt.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e}},{key:"updateDisplay",value:function(){return lt.isActive(this.__select)?this:(this.__select.value=this.getValue(),Je(pt.prototype.__proto__||Object.getPrototypeOf(pt.prototype),"updateDisplay",this).call(this))}}]),pt);function pt(e,t,n){Ze(this,pt);var o,t=Qe(this,(pt.__proto__||Object.getPrototypeOf(pt)).call(this,e,t)),n=n,r=t;return t.__select=document.createElement("select"),Ie.isArray(n)&&(o={},Ie.each(n,function(e){o[e]=e}),n=o),Ie.each(n,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),r.__select.appendChild(n)}),t.updateDisplay(),lt.bind(t.__select,"change",function(){var e=this.options[this.selectedIndex].value;r.setValue(e)}),t.domElement.appendChild(t.__select),t}var ft=(X(ht,ot),re(ht,[{key:"updateDisplay",value:function(){return lt.isActive(this.__input)||(this.__input.value=this.getValue()),Je(ht.prototype.__proto__||Object.getPrototypeOf(ht.prototype),"updateDisplay",this).call(this)}}]),ht);function ht(e,t){Ze(this,ht);var t=Qe(this,(ht.__proto__||Object.getPrototypeOf(ht)).call(this,e,t)),n=t;function o(){n.setValue(n.__input.value)}return t.__input=document.createElement("input"),t.__input.setAttribute("type","text"),lt.bind(t.__input,"keyup",o),lt.bind(t.__input,"change",o),lt.bind(t.__input,"blur",function(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}),lt.bind(t.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),t.updateDisplay(),t.domElement.appendChild(t.__input),t}function mt(e){e=e.toString();return-1<e.indexOf(".")?e.length-e.indexOf(".")-1:0}var gt=(X(_t,ot),re(_t,[{key:"setValue",value:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),Je(_t.prototype.__proto__||Object.getPrototypeOf(_t.prototype),"setValue",this).call(this,e)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=mt(e),this}}]),_t);function _t(e,t,n){Ze(this,_t);t=Qe(this,(_t.__proto__||Object.getPrototypeOf(_t)).call(this,e,t)),n=n||{};return t.__min=n.min,t.__max=n.max,t.__step=n.step,Ie.isUndefined(t.__step)?0===t.initialValue?t.__impliedStep=1:t.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(t.initialValue))/Math.LN10))/10:t.__impliedStep=t.__step,t.__precision=mt(t.__impliedStep),t}var bt=(X(yt,gt),re(yt,[{key:"updateDisplay",value:function(){var e,t;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),t=this.__precision,t=Math.pow(10,t),Math.round(e*t)/t),Je(yt.prototype.__proto__||Object.getPrototypeOf(yt.prototype),"updateDisplay",this).call(this)}}]),yt);function yt(e,t,n){Ze(this,yt);n=Qe(this,(yt.__proto__||Object.getPrototypeOf(yt)).call(this,e,t,n));n.__truncationSuspended=!1;var o=n,r=void 0;function i(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function a(e){var t=r-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),r=e.clientY}function s(){lt.unbind(window,"mousemove",a),lt.unbind(window,"mouseup",s),i()}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),lt.bind(n.__input,"change",function(){var e=parseFloat(o.__input.value);Ie.isNaN(e)||o.setValue(e)}),lt.bind(n.__input,"blur",function(){i()}),lt.bind(n.__input,"mousedown",function(e){lt.bind(window,"mousemove",a),lt.bind(window,"mouseup",s),r=e.clientY}),lt.bind(n.__input,"keydown",function(e){13===e.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,i())}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}function vt(e,t,n,o,r){return o+(e-t)/(n-t)*(r-o)}var wt=(X(xt,gt),re(xt,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",Je(xt.prototype.__proto__||Object.getPrototypeOf(xt.prototype),"updateDisplay",this).call(this)}}]),xt);function xt(e,t,n,o,r){Ze(this,xt);var r=Qe(this,(xt.__proto__||Object.getPrototypeOf(xt)).call(this,e,t,{min:n,max:o,step:r})),i=r;function a(e){e.preventDefault();var t=i.__background.getBoundingClientRect();return i.setValue(vt(e.clientX,t.left,t.right,i.__min,i.__max)),!1}function s(){lt.unbind(window,"mousemove",a),lt.unbind(window,"mouseup",s),i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}function l(e){var t=e.touches[0].clientX,e=i.__background.getBoundingClientRect();i.setValue(vt(t,e.left,e.right,i.__min,i.__max))}function c(){lt.unbind(window,"touchmove",l),lt.unbind(window,"touchend",c),i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}return r.__background=document.createElement("div"),r.__foreground=document.createElement("div"),lt.bind(r.__background,"mousedown",function(e){document.activeElement.blur(),lt.bind(window,"mousemove",a),lt.bind(window,"mouseup",s),a(e)}),lt.bind(r.__background,"touchstart",function(e){if(1!==e.touches.length)return;lt.bind(window,"touchmove",l),lt.bind(window,"touchend",c),l(e)}),lt.addClass(r.__background,"slider"),lt.addClass(r.__foreground,"slider-fg"),r.updateDisplay(),r.__background.appendChild(r.__foreground),r.domElement.appendChild(r.__background),r}var Et=(X(Ct,ot),re(Ct,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),Ct);function Ct(e,t,n){Ze(this,Ct);var t=Qe(this,(Ct.__proto__||Object.getPrototypeOf(Ct)).call(this,e,t)),o=t;return t.__button=document.createElement("div"),t.__button.innerHTML=void 0===n?"Fire":n,lt.bind(t.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),lt.addClass(t.__button,"button"),t.domElement.appendChild(t.__button),t}var St=(X(Tt,ot),re(Tt,[{key:"updateDisplay",value:function(){var t,n=We(this.getValue());!1!==n&&(t=!1,Ie.each($e.COMPONENTS,function(e){if(!Ie.isUndefined(n[e])&&!Ie.isUndefined(this.__color.__state[e])&&n[e]!==this.__color.__state[e])return t=!0,{}},this),t&&Ie.extend(this.__color.__state,n)),Ie.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var e=this.__color.v<.5||.5<this.__color.s?255:0,o=255-e;Ie.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+e+","+e+","+e+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,kt(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Ie.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+e+","+e+","+e+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]),Tt);function Tt(e,t){Ze(this,Tt);var n=Qe(this,(Tt.__proto__||Object.getPrototypeOf(Tt)).call(this,e,t));n.__color=new $e(n.getValue()),n.__temp=new $e(0);var o=n;n.domElement=document.createElement("div"),lt.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",lt.bind(n.__input,"keydown",function(e){13===e.keyCode&&l.call(this)}),lt.bind(n.__input,"blur",l),lt.bind(n.__selector,"mousedown",function(){lt.addClass(this,"drag").bind(window,"mouseup",function(){lt.removeClass(o.__selector,"drag")})}),lt.bind(n.__selector,"touchstart",function(){lt.addClass(this,"drag").bind(window,"touchend",function(){lt.removeClass(o.__selector,"drag")})});e=document.createElement("div");function r(e){u(e),lt.bind(window,"mousemove",u),lt.bind(window,"touchmove",u),lt.bind(window,"mouseup",a),lt.bind(window,"touchend",a)}function i(e){d(e),lt.bind(window,"mousemove",d),lt.bind(window,"touchmove",d),lt.bind(window,"mouseup",s),lt.bind(window,"touchend",s)}function a(){lt.unbind(window,"mousemove",u),lt.unbind(window,"touchmove",u),lt.unbind(window,"mouseup",a),lt.unbind(window,"touchend",a),c()}function s(){lt.unbind(window,"mousemove",d),lt.unbind(window,"touchmove",d),lt.unbind(window,"mouseup",s),lt.unbind(window,"touchend",s),c()}function l(){var e=We(this.value);!1!==e?(o.__color.__state=e,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function c(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function u(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,e=n.clientX,n=n.clientY,e=(e-t.left)/(t.right-t.left),t=1-(n-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),1<e?e=1:e<0&&(e=0),o.__color.v=t,o.__color.s=e,o.setValue(o.__color.toOriginal()),!1}function d(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__hue_field.getBoundingClientRect(),t=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),o.__color.h=360*t,o.setValue(o.__color.toOriginal()),!1}return Ie.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Ie.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Ie.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Ie.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Ie.extend(e.style,{width:"100%",height:"100%",background:"none"}),kt(e,"top","rgba(0,0,0,0)","#000"),Ie.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(t=n.__hue_field).style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",Ie.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),lt.bind(n.__saturation_field,"mousedown",r),lt.bind(n.__saturation_field,"touchstart",r),lt.bind(n.__field_knob,"mousedown",r),lt.bind(n.__field_knob,"touchstart",r),lt.bind(n.__hue_field,"mousedown",i),lt.bind(n.__hue_field,"touchstart",i),n.__saturation_field.appendChild(e),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}var Ot=["-moz-","-o-","-webkit-","-ms-",""];function kt(t,n,o,r){t.style.background="",Ie.each(Ot,function(e){t.style.cssText+="background: "+e+"linear-gradient("+n+", "+o+" 0%, "+r+" 100%); "})}var At=function(e,t,n,o,r){var i=e[t];return Ie.isArray(n)||Ie.isObject(n)?new dt(e,t,n):Ie.isNumber(i)?Ie.isNumber(n)&&Ie.isNumber(o)?Ie.isNumber(r)?new wt(e,t,n,o,r):new wt(e,t,n,o):Ie.isNumber(r)?new bt(e,t,{min:n,max:o,step:r}):new bt(e,t,{min:n,max:o}):Ie.isString(i)?new ft(e,t):Ie.isFunction(i)?new Et(e,t,""):Ie.isBoolean(i)?new ct(e,t):null},C=(X(Pt,ot),re(Pt,[{key:"controller",set:function(e){this._controller=e},get:function(){return this._controller}}]),Pt);function Pt(e,t){Ze(this,Pt);var n=Qe(this,(Pt.__proto__||Object.getPrototypeOf(Pt)).call(this,e,t));return n.arguments={object:e,property:t,opts:Array.prototype.slice.call(arguments,2)},e.property&&(n.property=e.property(n)),n}X=function(e,t){var t=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e;var o=t.getElementsByTagName("head")[0];try{o.appendChild(n)}catch(e){}};var Lt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},Rt=(re(Nt,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Ie.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",lt.unbind(t.domElement,"webkitTransitionEnd",e),lt.unbind(t.domElement,"transitionend",e),lt.unbind(t.domElement,"oTransitionEnd",e)}var t=this;lt.bind(this.domElement,"webkitTransitionEnd",e),lt.bind(this.domElement,"transitionend",e),lt.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-lt.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-lt.getHeight(this.domElement)/2+"px"}}]),Nt);function Nt(){Ze(this,Nt),this.backgroundElement=document.createElement("div"),Ie.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),lt.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Ie.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;lt.bind(this.backgroundElement,"click",function(){e.hide()})}X(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var Mt="Default",jt=function(){try{return!!window.localStorage}catch(e){return!1}}(),Ht=void 0,Bt=!0,zt=void 0,Dt=!1,It=[],Vt=function t(e){var n=this,o=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),lt.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],o=Ie.defaults(o,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),o=Ie.defaults(o,{resizable:o.autoPlace,hideable:o.autoPlace}),Ie.isUndefined(o.load)?o.load={preset:Mt}:o.preset&&(o.load.preset=o.preset),Ie.isUndefined(o.parent)&&o.hideable&&It.push(this),o.resizable=Ie.isUndefined(o.parent)&&o.resizable,o.autoPlace&&Ie.isUndefined(o.scrollable)&&(o.scrollable=!0);var r,i,a,s,l=jt&&"true"===localStorage.getItem(Yt(0,"isLocal")),c=void 0,u=void 0;function d(e){return e.preventDefault(),i.width+=a-e.clientX,i.onResize(),a=e.clientX,!1}function p(){lt.removeClass(i.__closeButton,Vt.CLASS_DRAG),lt.unbind(window,"mousemove",d),lt.unbind(window,"mouseup",p)}function f(e){return e.preventDefault(),a=e.clientX,lt.addClass(i.__closeButton,Vt.CLASS_DRAG),lt.bind(window,"mousemove",d),lt.bind(window,"mouseup",p),!1}Object.defineProperties(this,{parent:{get:function(){return o.parent}},scrollable:{get:function(){return o.scrollable}},autoPlace:{get:function(){return o.autoPlace}},closeOnTop:{get:function(){return o.closeOnTop}},preset:{get:function(){return(n.parent?n.getRoot():o.load).preset},set:function(e){n.parent?n.getRoot().preset=e:o.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return o.width},set:function(e){o.width=e,Kt(n,e)}},name:{get:function(){return o.name},set:function(e){o.name=e,u&&(u.innerHTML=o.name)}},closed:{get:function(){return o.closed},set:function(e){o.closed=e,o.closed?lt.addClass(n.__ul,t.CLASS_CLOSED):lt.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return o.load}},useLocalStorage:{get:function(){return l},set:function(e){jt&&((l=e)?lt.bind(window,"unload",c):lt.unbind(window,"unload",c),localStorage.setItem(Yt(0,"isLocal"),e))}}}),Ie.isUndefined(o.parent)?(this.closed=o.closed||!1,lt.addClass(this.domElement,t.CLASS_MAIN),lt.makeSelectable(this.domElement,!1),jt&&l&&(n.useLocalStorage=!0,(r=localStorage.getItem(Yt(0,"gui")))&&(o.load=JSON.parse(r))),this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,lt.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),o.closeOnTop?(lt.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(lt.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),lt.bind(this.__closeButton,"click",function(){n.closed=!n.closed})):(void 0===o.closed&&(o.closed=!0),r=document.createTextNode(o.name),lt.addClass(r,"controller-name"),u=Ft(n,r),lt.addClass(this.__ul,t.CLASS_CLOSED),lt.addClass(u,"title"),lt.bind(u,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1}),o.closed||(this.closed=!1)),o.autoPlace&&(Ie.isUndefined(o.parent)&&(Bt&&(zt=document.createElement("div"),lt.addClass(zt,"dg"),lt.addClass(zt,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(zt),Bt=!1),zt.appendChild(this.domElement),lt.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||Kt(n,o.width)),this.__resizeHandler=function(){n.onResizeDebounced()},lt.bind(window,"resize",this.__resizeHandler),lt.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),lt.bind(this.__ul,"transitionend",this.__resizeHandler),lt.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),o.resizable&&(a=void 0,(i=this).__resize_handle=document.createElement("div"),Ie.extend(i.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),lt.bind(i.__resize_handle,"mousedown",f),lt.bind(i.__closeButton,"mousedown",f),i.domElement.insertBefore(i.__resize_handle,i.domElement.firstElementChild)),c=function(){jt&&"true"===localStorage.getItem(Yt(0,"isLocal"))&&localStorage.setItem(Yt(0,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=c,o.parent||((s=n.getRoot()).width+=1,Ie.defer(function(){--s.width}))};function Ft(e,t,n){var o=document.createElement("li");return t&&o.appendChild(t),n?e.__ul.insertBefore(o,n):e.__ul.appendChild(o),e.onResize(),o}function Gt(e){lt.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&lt.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function Xt(e,t){e=e.__preset_select[e.__preset_select.selectedIndex];e.innerHTML=t?e.value+"*":e.value}function Ut(e,t){var n=e.getRoot(),o=n.__rememberedObjects.indexOf(t.object);if(-1!==o){var r=n.__rememberedObjectIndecesToControllers[o];if(void 0===r&&(r={},n.__rememberedObjectIndecesToControllers[o]=r),r[t.property]=t,n.load&&n.load.remembered){r=n.load.remembered,n=void 0;if(r[e.preset])n=r[e.preset];else{if(!r[Mt])return;n=r[Mt]}n[o]&&void 0!==n[o][t.property]&&(o=n[o][t.property],t.initialValue=o,t.setValue(o))}}}function Wt(e,t,n,o){var r;if(t.arguments&&(t=(r=t).arguments.object,n=r.arguments.property,o={factoryArgs:r.arguments.opts}),void 0===r&&void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var i=void 0;null===(i=o.color?new St(t,n):void 0!==r&&"string"==typeof r.property?r:(l=[t,n].concat(o.factoryArgs),At.apply(e,l)))?i=r:void 0!==r&&(r.controller=i),o.before instanceof ot&&(o.before=o.before.__li),Ut(e,i),lt.addClass(i.domElement,"c");var a=document.createElement("span");if(lt.addClass(a,"property-name"),void 0!==r&&"object"===qe(r.property))for(var s in r.property)a.appendChild(r.property[s]);else a.innerHTML=i.property;var l=document.createElement("div");l.appendChild(a),l.appendChild(i.domElement);var c,u,d,p,o=Ft(e,l,o.before);return lt.addClass(o,Vt.CLASS_CONTROLLER_ROW),i instanceof St?lt.addClass(o,"color"):lt.addClass(o,qe(i.getValue())),c=e,u=o,(d=i).__li=u,d.__gui=c,Ie.extend(d,{options:function(e){if(1<arguments.length){var t=d.__li.nextElementSibling;return d.remove(),Wt(c,d.object,d.property,{before:t,factoryArgs:[Ie.toArray(arguments)]})}if(Ie.isArray(e)||Ie.isObject(e)){t=d.__li.nextElementSibling;return d.remove(),Wt(c,d.object,d.property,{before:t,factoryArgs:[e]})}},name:function(e){return d.__li.firstElementChild.firstElementChild.innerHTML=e,d},listen:function(){return d.__gui.listen(d),d},remove:function(){return d.__gui.remove(d),d}}),d instanceof wt?(p=new bt(d.object,d.property,{min:d.__min,max:d.__max,step:d.__step}),Ie.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=d[e],n=p[e];d[e]=p[e]=function(){var e=Array.prototype.slice.call(arguments);return n.apply(p,e),t.apply(d,e)}}),lt.addClass(u,"has-slider"),d.domElement.insertBefore(p.domElement,d.domElement.firstElementChild)):d instanceof bt?(o=function(e){if(Ie.isNumber(d.__min)&&Ie.isNumber(d.__max)){var t=d.__li.firstElementChild.firstElementChild.innerHTML,n=-1<d.__gui.__listening.indexOf(d);d.remove();var o=Wt(c,d.object,d.property,{before:d.__li.nextElementSibling,factoryArgs:[d.__min,d.__max,d.__step]});return o.name(t),n&&o.listen(),o}return e},d.min=Ie.compose(o,d.min),d.max=Ie.compose(o,d.max)):d instanceof ct?(lt.bind(u,"click",function(){lt.fakeEvent(d.__checkbox,"click")}),lt.bind(d.__checkbox,"click",function(e){e.stopPropagation()})):d instanceof Et?(lt.bind(u,"click",function(){lt.fakeEvent(d.__button,"click")}),lt.bind(u,"mouseover",function(){lt.addClass(d.__button,"hover")}),lt.bind(u,"mouseout",function(){lt.removeClass(d.__button,"hover")})):d instanceof St&&(lt.addClass(u,"color"),d.updateDisplay=Ie.compose(function(e){return u.style.borderLeftColor=d.__color.toString(),e},d.updateDisplay),d.updateDisplay()),d.setValue=Ie.compose(function(e){return c.getRoot().__preset_select&&d.isModified()&&Xt(c.getRoot(),!0),e},d.setValue),e.__controllers.push(i),i}function Yt(e,t){return document.location.href+"."+t}function qt(e,t,n){var o=document.createElement("option");o.innerHTML=t,o.value=t,e.__preset_select.appendChild(o),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function Zt(e,t){t.style.display=e.useLocalStorage?"block":"none"}function Kt(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function Jt(r,i){var a={};return Ie.each(r.__rememberedObjects,function(e,t){var n={},o=r.__rememberedObjectIndecesToControllers[t];Ie.each(o,function(e,t){n[t]=i?e.initialValue:e.getValue()}),a[t]=n}),a}Vt.toggleHide=function(){Dt=!Dt,Ie.each(It,function(e){e.domElement.style.display=Dt?"none":""})},Vt.CLASS_AUTO_PLACE="a",Vt.CLASS_AUTO_PLACE_CONTAINER="ac",Vt.CLASS_MAIN="main",Vt.CLASS_CONTROLLER_ROW="cr",Vt.CLASS_TOO_TALL="taller-than-window",Vt.CLASS_CLOSED="closed",Vt.CLASS_CLOSE_BUTTON="close-button",Vt.CLASS_CLOSE_TOP="close-top",Vt.CLASS_CLOSE_BOTTOM="close-bottom",Vt.CLASS_DRAG="drag",Vt.DEFAULT_WIDTH=245,Vt.TEXT_CLOSED="Close Controls",Vt.TEXT_OPEN="Open Controls",Vt._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||Vt.toggleHide()},lt.bind(window,"keydown",Vt._keydownHandler,!1),Ie.extend(Vt.prototype,{add:function(e,t){return Wt(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return Wt(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;Ie.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&zt.removeChild(this.domElement);var t=this;Ie.each(this.__folders,function(e){t.removeFolder(e)}),lt.unbind(window,"keydown",Vt._keydownHandler,!1),Gt(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);t=new Vt(t);this.__folders[e]=t;e=Ft(this,t.domElement);return lt.addClass(e,"folder"),t},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Gt(t);var e=this;Ie.each(t.__folders,function(e){t.removeFolder(e)}),Ie.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e,t,n=this.getRoot();n.scrollable&&(e=lt.getOffset(n.__ul).top,t=0,Ie.each(n.__ul.childNodes,function(e){n.autoPlace&&e===n.__save_row||(t+=lt.getHeight(e))}),window.innerHeight-e-20<t?(lt.addClass(n.domElement,Vt.CLASS_TOO_TALL),n.__ul.style.height=window.innerHeight-e-20+"px"):(lt.removeClass(n.domElement,Vt.CLASS_TOO_TALL),n.__ul.style.height="auto")),n.__resize_handle&&Ie.defer(function(){n.__resize_handle.style.height=n.__ul.offsetHeight+"px"}),n.__closeButton&&(n.__closeButton.style.width=n.width+"px")},onResizeDebounced:Ie.debounce(function(){this.onResize()},50),remember:function(){if(Ie.isUndefined(Ht)&&((Ht=new Rt).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;Ie.each(Array.prototype.slice.call(arguments),function(e){0===t.__rememberedObjects.length&&function(n){var e=n.__save_row=document.createElement("li");lt.addClass(n.domElement,"has-save"),n.__ul.insertBefore(e,n.__ul.firstChild),lt.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",lt.addClass(t,"button gears");var o=document.createElement("span");o.innerHTML="Save",lt.addClass(o,"button"),lt.addClass(o,"save");var r=document.createElement("span");r.innerHTML="New",lt.addClass(r,"button"),lt.addClass(r,"save-as");var i=document.createElement("span");i.innerHTML="Revert",lt.addClass(i,"button"),lt.addClass(i,"revert");var a=n.__preset_select=document.createElement("select");n.load&&n.load.remembered?Ie.each(n.load.remembered,function(e,t){qt(n,t,t===n.preset)}):qt(n,Mt,!1);{var s;lt.bind(a,"change",function(){for(var e=0;e<n.__preset_select.length;e++)n.__preset_select[e].innerHTML=n.__preset_select[e].value;n.preset=this.value}),e.appendChild(a),e.appendChild(t),e.appendChild(o),e.appendChild(r),e.appendChild(i),jt&&(s=document.getElementById("dg-local-explain"),e=document.getElementById("dg-local-storage"),document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(Yt(0,"isLocal"))&&e.setAttribute("checked","checked"),Zt(n,s),lt.bind(e,"change",function(){n.useLocalStorage=!n.useLocalStorage,Zt(n,s)}))}var l=document.getElementById("dg-new-constructor");lt.bind(l,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Ht.hide()}),lt.bind(t,"click",function(){l.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),Ht.show(),l.focus(),l.select()}),lt.bind(o,"click",function(){n.save()}),lt.bind(r,"click",function(){var e=prompt("Enter a new preset name.");e&&n.saveAs(e)}),lt.bind(i,"click",function(){n.revert()})}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&Kt(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var n=this.load;return n.closed=this.closed,0<this.__rememberedObjects.length&&(n.preset=this.preset,n.remembered||(n.remembered={}),n.remembered[this.preset]=Jt(this)),n.folders={},Ie.each(this.__folders,function(e,t){n.folders[t]=e.getSaveObject()}),n},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Jt(this),Xt(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Mt]=Jt(this,!0)),this.load.remembered[e]=Jt(this),this.preset=e,qt(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(t){Ie.each(this.__controllers,function(e){this.getRoot().load.remembered?Ut(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),Ie.each(this.__folders,function(e){e.revert(e)}),t||Xt(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&Lt.call(window,function(){e(t)});Ie.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){Ie.each(this.__controllers,function(e){e.updateDisplay()}),Ie.each(this.__folders,function(e){e.updateDisplay()})}});var Qt={Controller:ot,BooleanController:ct,OptionController:dt,StringController:ft,NumberController:gt,NumberControllerBox:bt,NumberControllerSlider:wt,FunctionController:Et,ColorController:St,CustomController:C};
/**
 * get position functions library
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function $t(e,t){var n=Le.THREE,e=e.geometry.attributes.position,n=4<=e.itemSize?new n.Vector4(0,0,0,0):new n.Vector3;return n.fromArray(e.array,t*e.itemSize),n}function en(e,t){var n,o,r,i,a=Le.THREE,s=t.clone();for(;n=e,o=s,i=r=void 0,r=new a.Vector3,i=new a.Vector3,(r=o.clone()).multiply(n.scale),i.copy(r),i.applyEuler(n.rotation),r.x=i.x,r.y=i.y,r.z=i.z,r.add(n.position),s=r,e=e.parent,e&&e.parent;);return s}function tn(e,t){if(-1!==t)return void 0===t?e.position:en(e,$t(e,t))}X={isWebGLAvailable:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},isWebGL2Available:function(){try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},getWebGLErrorMessage:function(){return this.getErrorMessage(1)},getWebGL2ErrorMessage:function(){return this.getErrorMessage(2)},getErrorMessage:function(e){var t={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext},n='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>',o=document.createElement("div");return o.id="webglmessage",o.style.fontFamily="monospace",o.style.fontSize="13px",o.style.fontWeight="normal",o.style.textAlign="center",o.style.background="#fff",o.style.color="#000",o.style.padding="1.5em",o.style.width="400px",o.style.margin="5em auto 0",n=(n=t[e]?n.replace("$0","graphics card"):n.replace("$0","browser")).replace("$1",{1:"WebGL",2:"WebGL 2"}[e]),o.innerHTML=n,o}};
/**
* node.js version of the synchronous download of the file.
* @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
*
* @copyright 2011 Data Arts Team, Google Creative Lab
*
* @license under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*/function nn(t){if(this.loadXMLDoc=function(){var e;if(window.XMLHttpRequest){if(!(e=new XMLHttpRequest))throw"new XMLHttpRequest() failed!"}else{if(!window.ActiveXObject)throw"myRequest.loadXMLDoc(...) failed!";if(!(e=this.NewActiveXObject()))throw"NewActiveXObject() failed!"}return e},this.NewActiveXObject=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}return a('This browser does not support XMLHttpRequest. Probably, your security settings do not allow Web sites to use ActiveX controls installed on your computer. Refresh your Web page to find out the current status of your Web page or enable the "Initialize and script ActiveX controls not marked as safe" and "Run Active X controls and plug-ins" of the Security settings of the Internet zone of your browser.'),null},this.XMLHttpRequestStart=function(e,t){this.XMLHttpRequestStop(),this.req.onreadystatechange=e,"onerror"in this.req&&(this.req.onerror=function(e){a("XMLHttpRequest error. url: "+this.url)}),this.XMLHttpRequestReStart(t)},this.getUrl=function(){return void 0!==this.url&&null!=this.url||(this.url="XMLHttpRequest.xml"),this.url+(this.params||"")},this.XMLHttpRequestReStart=function(e){try{void 0===e&&(e=!0),this.req.open("GET",this.getUrl(),e),e&&("timeout"in this.req&&(this.req.timeout=9e4),"ontimeout"in this.req?this.req.ontimeout=function(){a("XMLHttpRequest timeout")}:(clearTimeout(this.timeout_id_SendReq),this.timeout_id_SendReq=setTimeout(function(){a("XMLHttpRequest timeout 2")},9e4))),this.req.send(null)}catch(e){a(e.message+" url: "+this.url)}},this.XMLHttpRequestStop=function(){null!=this.req&&this.req.abort()},this.ProcessReqChange=function(e){var t=this.req;switch(t.readyState){case 4:if("unknown"==typeof t.status)return consoleError('typeof XMLHttpRequest status == "unknown"'),!0;if(200==t.status)return clearTimeout(this.timeout_id_SendReq),e(this);a("Invalid XMLHttpRequest status : "+t.status+" url: "+this.url);break;case 1:case 2:case 3:break;case 0:default:throw"processReqChange(); req.readyState = "+t.readyState}return!0},this.processStatus200Error=function(){var e=this.GetElementText("error",!0);return!!e&&(a(e),!0)},this.GetElementText=function(e,t){var n=this.req;if(!n.responseXML)return 1!=t&&a("GetXMLElementText(xmlhttp, "+e+"); xmlhttp.responseXML is null.\nxmlhttp.responseText:\n"+n.responseText),null;var o=n.responseXML.getElementsByTagName(e);if(0==o.length)return 1!=t&&a('GetXMLElementText(xmlhttp, "'+e+'"); element.length == '+o.length),"";for(var r="",i=0;i<o.length;i++)if(void 0===o[i].textContent){if(void 0===o[i].text)return a("GetXMLElementText(xmlhttp, "+e+"); element["+i+"].text) == undefined"),"";""!=r&&(r+=" "),r+=o[i].text}else r+=o[i].textContent;return r},t.data)this.req=t.data.req,this.url=t.data.url,this.params=t.data.params;else try{this.req=this.loadXMLDoc()}catch(e){var n=void 0===e.message?e:e.message;return void a("Your browser is too old and is not compatible with our site.\n\n"+window.navigator.appName+" "+window.navigator.appVersion+"\n\n"+n)}function a(e){console.error(e),t.onerror(e)}this.req||consoleError("Invalid myRequest.req: "+this.req)}function on(t,n){(n=n||{}).onload=n.onload||function(){},n.onerror=n.onerror||function(){};var o,e=new nn(n);return e.url=t,e.XMLHttpRequestStart(function(){e.ProcessReqChange(function(e){e.processStatus200Error()||(o=e.req.responseText,n.onload(o,t))})},!1),o}
/**
 * node.js version of the load JavaScript file
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * Thanks to:
 *http://javascript.ru/forum/events/21439-dinamicheskaya-zagruzka-skriptov.html
 *https://learn.javascript.ru/onload-onerror
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function rn(e,t){if(t.tag=t.tag||{},"string"==typeof t.tag){if("style"!==t.tag)return void console.error("Invalid options.tag: "+t.tag);t.tag={name:"style",attribute:{name:"rel",value:"stylesheet"}}}t.tag.name=t.tag.name||"script";var n=document.createElement(t.tag.name);t.tag.attribute=t.tag.attribute||{},t.tag.attribute.name=t.tag.attribute.name||"type",t.tag.attribute.value=t.tag.attribute.value||"text/javascript",n.setAttribute(t.tag.attribute.name,t.tag.attribute.value),e(n),t.appendTo.appendChild(n)}function an(e,t){for(var n=e.querySelectorAll("script"),o=0;o<n.length;o++)if(n[o].id===t)return 1}var sn,gt={sync:function(t,n){if((n=n||{}).onload=n.onload||function(){},n.onerror=n.onerror||function(){},n.appendTo=n.appendTo||document.getElementsByTagName("head")[0],an(n.appendTo,t))n.onload();else if(t instanceof Array){for(var o,r={appendTo:n.appendTo,tag:n.tag,onload:function(e,t){console.log("loadScript.sync.onload: "+t)},onerror:function(e){n.onerror(e),o=e}},e=0;e<t.length;e++){var i=t[e];if(rn(function(e){e.setAttribute("id",i),e.innerHTML=on(i,r)},r),void 0!==o)break}void 0===o&&n.onload()}else rn(function(e){e.setAttribute("id",t),e.innerHTML=on(t,n)},n)},async:function(e,o){var r;function i(t){function n(){e instanceof Array&&r<e.length-1?i(e[++r]):o.onload()}an(o.appendTo,t,o.onload)?n():rn(function(e){e.setAttribute("id",t),e.readyState&&!e.onload?e.onreadystatechange=function(){"complete"==e.readyState&&void 0!==o.onload&&o.onload(),"loaded"==e.readyState&&(setTimeout(o.onload,0),this.onreadystatechange=null)}:(e.onload=function(){console.log("loadScript.async.onload() "+t),void 0!==o.onload&&n()},e.onerror=function(e){var t='loadScript: "'+this.src+'" failed';void 0!==o.onerror&&o.onerror(t,e),console.error(t)}),e.src=t},o)}(o=o||{}).appendTo=o.appendTo||document.getElementsByTagName("head")[0],o.onload=o.onload||function(){},e instanceof Array?i(e[r=0]):i(e)}},C=(sn=function(){if(document.currentScript&&""!==document.currentScript.src)return document.currentScript.src;var e=document.getElementsByTagName("script");return""!==e[e.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]}()).substring(0,sn.lastIndexOf("/"));
/**
 * @module ColorPicker
 * @description Pure JavaScript color picker.
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * Thanks to https://github.com/DavidDurman/FlexiColorPicker
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 */gt.sync(C+"/colorpicker.css",{tag:"style"});function ln(e,t){Le.THREE.EventDispatcher;var o,r,i,a,s,l,n=Le.THREE.MOUSE,c=Le.THREE.Quaternion,u=Le.THREE.Spherical,d=Le.THREE.TOUCH,p=Le.THREE.Vector2,f=Le.THREE.Vector3;void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new f,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:n.ROTATE,MIDDLE:n.DOLLY,RIGHT:n.PAN},this.touches={ONE:d.ROTATE,TWO:d.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return w.phi},this.getAzimuthalAngle=function(){return w.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",re),this._domElementKeyEvents=e},this.saveState=function(){h.target0.copy(h.target),h.position0.copy(h.object.position),h.zoom0=h.object.zoom},this.reset=function(){h.target.copy(h.target0),h.object.position.copy(h.position0),h.object.zoom=h.zoom0,h.object.updateProjectionMatrix(),h.dispatchEvent(m),h.update(),y=b.NONE},this.update=(o=new f,r=(new c).setFromUnitVectors(e.up,new f(0,1,0)),i=r.clone().invert(),a=new f,s=new c,l=2*Math.PI,function(){var e=h.object.position;o.copy(e).sub(h.target),o.applyQuaternion(r),w.setFromVector3(o),h.autoRotate&&y===b.NONE&&H(2*Math.PI/60/60*h.autoRotateSpeed),h.enableDamping?(w.theta+=x.theta*h.dampingFactor,w.phi+=x.phi*h.dampingFactor):(w.theta+=x.theta,w.phi+=x.phi);var t=h.minAzimuthAngle,n=h.maxAzimuthAngle;return isFinite(t)&&isFinite(n)&&(t<-Math.PI?t+=l:t>Math.PI&&(t-=l),n<-Math.PI?n+=l:n>Math.PI&&(n-=l),w.theta=t<=n?Math.max(t,Math.min(n,w.theta)):w.theta>(t+n)/2?Math.max(t,w.theta):Math.min(n,w.theta)),w.phi=Math.max(h.minPolarAngle,Math.min(h.maxPolarAngle,w.phi)),w.makeSafe(),w.radius*=E,w.radius=Math.max(h.minDistance,Math.min(h.maxDistance,w.radius)),!0===h.enableDamping?h.target.addScaledVector(C,h.dampingFactor):h.target.add(C),o.setFromSpherical(w),o.applyQuaternion(i),e.copy(h.target).add(o),h.object.lookAt(h.target),!0===h.enableDamping?(x.theta*=1-h.dampingFactor,x.phi*=1-h.dampingFactor,C.multiplyScalar(1-h.dampingFactor)):(x.set(0,0,0),C.set(0,0,0)),E=1,!!(S||a.distanceToSquared(h.object.position)>v||8*(1-s.dot(h.object.quaternion))>v)&&(h.dispatchEvent(m),a.copy(h.object.position),s.copy(h.object.quaternion),!(S=!1))}),this.dispose=function(){h.domElement.removeEventListener("contextmenu",le),h.domElement.removeEventListener("pointerdown",ee),h.domElement.removeEventListener("wheel",oe),h.domElement.removeEventListener("touchstart",ie),h.domElement.removeEventListener("touchend",se),h.domElement.removeEventListener("touchmove",ae),h.domElement.ownerDocument.removeEventListener("pointermove",te),h.domElement.ownerDocument.removeEventListener("pointerup",ne),null!==h._domElementKeyEvents&&h._domElementKeyEvents.removeEventListener("keydown",re)};var h=this,m={type:"change"},g={type:"start"},_={type:"end"},b={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},y=b.NONE,v=1e-6,w=new u,x=new u,E=1,C=new f,S=!1,T=new p,O=new p,k=new p,A=new p,P=new p,L=new p,R=new p,N=new p,M=new p;function j(){return Math.pow(.95,h.zoomSpeed)}function H(e){x.theta-=e}function B(e){x.phi-=e}var z,D,I,V=(z=new f,function(e,t){z.setFromMatrixColumn(t,0),z.multiplyScalar(-e),C.add(z)}),F=(D=new f,function(e,t){!0===h.screenSpacePanning?D.setFromMatrixColumn(t,1):(D.setFromMatrixColumn(t,0),D.crossVectors(h.object.up,D)),D.multiplyScalar(e),C.add(D)}),G=(I=new f,function(e,t){var n,o=h.domElement;h.object.isPerspectiveCamera?(n=h.object.position,I.copy(n).sub(h.target),n=I.length(),n*=Math.tan(h.object.fov/2*Math.PI/180),V(2*e*n/o.clientHeight,h.object.matrix),F(2*t*n/o.clientHeight,h.object.matrix)):h.object.isOrthographicCamera?(V(e*(h.object.right-h.object.left)/h.object.zoom/o.clientWidth,h.object.matrix),F(t*(h.object.top-h.object.bottom)/h.object.zoom/o.clientHeight,h.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),h.enablePan=!1)});function X(e){h.object.isPerspectiveCamera?E/=e:h.object.isOrthographicCamera?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom*e)),h.object.updateProjectionMatrix(),S=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),h.enableZoom=!1)}function U(e){h.object.isPerspectiveCamera?E*=e:h.object.isOrthographicCamera?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom/e)),h.object.updateProjectionMatrix(),S=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),h.enableZoom=!1)}function W(e){T.set(e.clientX,e.clientY)}function Y(e){A.set(e.clientX,e.clientY)}function q(e){var t;1==e.touches.length?T.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),e=.5*(e.touches[0].pageY+e.touches[1].pageY),T.set(t,e))}function Z(e){var t;1==e.touches.length?A.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),e=.5*(e.touches[0].pageY+e.touches[1].pageY),A.set(t,e))}function K(e){var t=e.touches[0].pageX-e.touches[1].pageX,e=e.touches[0].pageY-e.touches[1].pageY,e=Math.sqrt(t*t+e*e);R.set(0,e)}function J(e){var t;1==e.touches.length?O.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY),O.set(t,n)),k.subVectors(O,T).multiplyScalar(h.rotateSpeed);var n=h.domElement;H(2*Math.PI*k.x/n.clientHeight),B(2*Math.PI*k.y/n.clientHeight),T.copy(O)}function Q(e){var t;1==e.touches.length?P.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),e=.5*(e.touches[0].pageY+e.touches[1].pageY),P.set(t,e)),L.subVectors(P,A).multiplyScalar(h.panSpeed),G(L.x,L.y),A.copy(P)}function $(e){var t=e.touches[0].pageX-e.touches[1].pageX,e=e.touches[0].pageY-e.touches[1].pageY,e=Math.sqrt(t*t+e*e);N.set(0,e),M.set(0,Math.pow(N.y/R.y,h.zoomSpeed)),X(M.y),R.copy(N)}function ee(e){if(!1!==h.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){var t;switch(e.preventDefault(),(h.domElement.focus?h.domElement:window).focus(),e.button){case 0:t=h.mouseButtons.LEFT;break;case 1:t=h.mouseButtons.MIDDLE;break;case 2:t=h.mouseButtons.RIGHT;break;default:t=-1}switch(t){case n.DOLLY:if(!1===h.enableZoom)return;!function(e){R.set(e.clientX,e.clientY)}(e),y=b.DOLLY;break;case n.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===h.enablePan)return;Y(e),y=b.PAN}else{if(!1===h.enableRotate)return;W(e),y=b.ROTATE}break;case n.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===h.enableRotate)return;W(e),y=b.ROTATE}else{if(!1===h.enablePan)return;Y(e),y=b.PAN}break;default:y=b.NONE}y!==b.NONE&&(h.domElement.ownerDocument.addEventListener("pointermove",te),h.domElement.ownerDocument.addEventListener("pointerup",ne),h.dispatchEvent(g))}(e)}}function te(e){if(!1!==h.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===h.enabled)return;switch(e.preventDefault(),y){case b.ROTATE:if(!1===h.enableRotate)return;!function(e){O.set(e.clientX,e.clientY),k.subVectors(O,T).multiplyScalar(h.rotateSpeed),e=h.domElement,H(2*Math.PI*k.x/e.clientHeight),B(2*Math.PI*k.y/e.clientHeight),T.copy(O),h.update()}(e);break;case b.DOLLY:if(!1===h.enableZoom)return;!function(e){N.set(e.clientX,e.clientY),M.subVectors(N,R),0<M.y?X(j()):M.y<0&&U(j()),R.copy(N),h.update()}(e);break;case b.PAN:if(!1===h.enablePan)return;!function(e){P.set(e.clientX,e.clientY),L.subVectors(P,A).multiplyScalar(h.panSpeed),G(L.x,L.y),A.copy(P),h.update()}(e)}}(e)}}function ne(e){switch(e.pointerType){case"mouse":case"pen":!function(){if(h.domElement.ownerDocument.removeEventListener("pointermove",te),h.domElement.ownerDocument.removeEventListener("pointerup",ne),!1===h.enabled)return;h.dispatchEvent(_),y=b.NONE}()}}function oe(e){!1===h.enabled||!1===h.enableZoom||y!==b.NONE&&y!==b.ROTATE||(e.preventDefault(),e.stopPropagation(),h.dispatchEvent(g),(e=e).deltaY<0?U(j()):0<e.deltaY&&X(j()),h.update(),h.dispatchEvent(_))}function re(e){!1!==h.enabled&&!1!==h.enablePan&&function(e){var t=!1;switch(e.keyCode){case h.keys.UP:G(0,h.keyPanSpeed),t=!0;break;case h.keys.BOTTOM:G(0,-h.keyPanSpeed),t=!0;break;case h.keys.LEFT:G(h.keyPanSpeed,0),t=!0;break;case h.keys.RIGHT:G(-h.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),h.update())}(e)}function ie(e){if(!1!==h.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(h.touches.ONE){case d.ROTATE:if(!1===h.enableRotate)return;q(e),y=b.TOUCH_ROTATE;break;case d.PAN:if(!1===h.enablePan)return;Z(e),y=b.TOUCH_PAN;break;default:y=b.NONE}break;case 2:switch(h.touches.TWO){case d.DOLLY_PAN:if(!1===h.enableZoom&&!1===h.enablePan)return;t=e,h.enableZoom&&K(t),h.enablePan&&Z(t),y=b.TOUCH_DOLLY_PAN;break;case d.DOLLY_ROTATE:if(!1===h.enableZoom&&!1===h.enableRotate)return;t=e,h.enableZoom&&K(t),h.enableRotate&&q(t),y=b.TOUCH_DOLLY_ROTATE;break;default:y=b.NONE}break;default:y=b.NONE}var t;y!==b.NONE&&h.dispatchEvent(g)}}function ae(e){var t;if(!1!==h.enabled)switch(e.preventDefault(),e.stopPropagation(),y){case b.TOUCH_ROTATE:if(!1===h.enableRotate)return;J(e),h.update();break;case b.TOUCH_PAN:if(!1===h.enablePan)return;Q(e),h.update();break;case b.TOUCH_DOLLY_PAN:if(!1===h.enableZoom&&!1===h.enablePan)return;t=e,h.enableZoom&&$(t),h.enablePan&&Q(t),h.update();break;case b.TOUCH_DOLLY_ROTATE:if(!1===h.enableZoom&&!1===h.enableRotate)return;t=e,h.enableZoom&&$(t),h.enableRotate&&J(t),h.update();break;default:y=b.NONE}}function se(e){!1!==h.enabled&&(h.dispatchEvent(_),y=b.NONE)}function le(e){!1!==h.enabled&&e.preventDefault()}h.domElement.addEventListener("contextmenu",le),h.domElement.addEventListener("pointerdown",ee),h.domElement.addEventListener("wheel",oe),h.domElement.addEventListener("touchstart",ie),h.domElement.addEventListener("touchend",se),h.domElement.addEventListener("touchmove",ae),this.update()}function cn(e,t){ln.call(this,e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=MOUSE.PAN,this.mouseButtons.RIGHT=MOUSE.ROTATE,this.touches.ONE=TOUCH.PAN,this.touches.TWO=TOUCH.DOLLY_ROTATE}var un=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",dn="http://www.w3.org/2000/svg",pn=0,fn=new function e(){S(this,e);var n=this;function m(e,t,n){for(var o in e=document.createElementNS(dn,e),t)e.setAttribute(o,t[o]);"[object Array]"!=Object.prototype.toString.call(n)&&(n=[n]);for(var r=0,i=n[0]&&n.length||0;r<i;r++)e.appendChild(n[r]);return e}this.paletteIndexes={BGYW:0,monochrome:1,bidirectional:2,rainbow:3},this.create=function(e,r){function i(){return"horizontal"===r.orientation}if((r=r||{}).orientation=r.orientation||"horizontal",void 0===r.direction&&(r.direction=!0),r.style=r.style||{},r.style.width=r.style.width||(i()?200:30),r.style.height=r.style.height||(i()?30:200),r.onError=r.onError||function(){},e instanceof HTMLElement!=!0){if("string"!=typeof e)return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e);if(null===(e=document.getElementById(e)))return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e)}for(var t in e.classList.add("slider-wrapper"),r.style)e.style[t]=r.style[t];var o,n,a,s,l,c=r.palette instanceof this.palette?r.palette:new this.palette(r);function u(){return"string"==typeof r.style.height?parseInt(r.style.height):r.style.height}function d(){return f.clientWidth}function p(e,t){var n;void 0!==o?void 0!==(n=c.hsv2rgb(e))?(e=n.percent,void 0===t&&(t=i()?d()*e/100:u()-u()*(r.direction?e:100-e)/100),function(e){if(void 0===o)return;i()?e<0||e>d()?console.error("ColorPicker.positionIndicators: Invalid position = "+e):(o.style.top="0px",o.style.left=(r.direction?e:d()-e)-o.offsetWidth/2+"px"):e<0||e>u()?console.error("ColorPicker.positionIndicators: Invalid position = "+e):(o.style.left="0px",o.style.top=e-o.offsetHeight/2+"px")}(t),void 0!==r.sliderIndicator.callback&&r.sliderIndicator.callback(n)):console.error("ColorPicker.setValue: invalud c = "+n):console.error("Set value of this instance of the ColorPicker is impossible because options.sliderIndicator is not defined.")}if(void 0!==r.sliderIndicator&&((o=document.createElement("div")).className="slider-indicator",i()?o.style.width="10px":o.style.height="10px",e.appendChild(o),o.style.pointerEvents="none"),"SVG"==un){try{var f=m("svg",{xmlns:dn,version:"1.1",width:i()?"100%":r.style.width,height:r.style.height},[m("defs",{},m("linearGradient",{id:"gradient-hsv-"+pn,x1:i()&&r.direction?"100%":"0%",y1:i()||r.direction?"0%":"100%",x2:i()&&!r.direction?"100%":"0%",y2:!i()&&r.direction?"100%":"0%"},c.getPalette())),m("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv-"+pn+")"})]);void 0!==o&&(f.style.cursor=i()?"e-resize":"s-resize",o.style.cursor=f.style.cursor)}catch(e){console.error("Create SVG element failed! "+e.message)}e.appendChild(f),e.style.height=u()+"px",void 0!==o&&(i()?o.style.height=parseInt(r.style.height)-2+"px":o.style.width=parseInt(r.style.width)-2+"px",r.sliderIndicator.value=r.sliderIndicator.value||0,p(r.sliderIndicator.value)),pn++}else console.error("Under constraction");function h(e){var t,n,o;e.x=parseInt(e.x),e.y=parseInt(e.y),i()?(t=e.x,n=d()-1,t>=d()&&(t=n),o=100*t/n,r.direction||(o=100-o,t=n-t)):(t=e.y,n=u()-1,t>=u()&&(t=n),o=100*(1-t/n),r.direction||(o=100-o)),p(o,t)}return void 0!==o&&(n=function(){return function(e){l||h(function(e){if(window.event&&void 0!==window.event.contentOverflow)return{x:window.event.offsetX,y:window.event.offsetY};if(void 0!==e.offsetX&&void 0!==e.offsetY)return{x:e.offsetX,y:e.offsetY};var t=e.target.parentNode.parentNode;return{x:e.layerX-t.offsetLeft,y:e.layerY-t.offsetTop}}(e=e||window.event))}},l=!(s=function(e,r){var t=f;a(t,"touchstart",function(e){}),a(t,"touchmove",function(e){e.preventDefault();var t=e.srcElement.getBoundingClientRect(),n=e.touches[0].clientX-t.left,t=e.touches[0].clientY-t.top;n<0&&(n=0),t<0&&(t=0),h({x:n,y:t})}),a(t,"touchend",function(e){}),a(t,"mousedown",function(e){var n="mouseup",o="mousemove";a(window,n,function e(){function t(e,t,n){null!==e&&(e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener&&e.removeEventListener(t,n,!1))}t(window,n,e),t(window,o,r)}),a(window,o,r)}),a(t,"mouseout",function(e){l=!0}),a(t,"mouseover",function(e){l=!1})}),(a=function(e,t,n){null!==e&&(e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,!1))})(f,"click",n()),s(0,n())),{setValue:p}},this.palette=function(p){function e(e,t,n,o){return{percent:e,r:t,g:n,b:o}}void 0===(p=p||{}).palette&&(p.palette=n.paletteIndexes.BGYW),this.getPaletteIndex=function(){return p.palette};var f=[new e(0,0,0,255),new e(33,0,255,0),new e(66,255,255,0),new e(100,255,255,255)];switch(x(p.palette)){case"number":switch(p.palette){case n.paletteIndexes.BGYW:break;case n.paletteIndexes.monochrome:f=[new e(0,0,0,0),new e(100,255,255,255)];break;case n.paletteIndexes.bidirectional:f=[new e(0,255,48,48),new e(50,48,48,48),new e(100,48,255,48)];break;case n.paletteIndexes.rainbow:f=[new e(0,255,50,50),new e(16,252,245,40),new e(32,40,252,40),new e(50,40,252,248),new e(66,39,46,249),new e(82,255,40,251),new e(100,255,50,50)];break;default:console.error("ColorPicker.create.Palette: invalid options.palette = "+p.palette)}break;case"object":if(Array.isArray(p.palette)){f=p.palette;break}default:var t="invalid options.palette = "+p.palette;console.error("ColorPicker.create.Palette: "+t),p.onError(t)}this.getPalette=function(){var t=[];return f.forEach(function(e){t.unshift(m("stop",{offset:100-e.percent+"%","stop-color":"#"+("0"+Number(e.r).toString(16)).slice(-2).toUpperCase()+("0"+Number(e.g).toString(16)).slice(-2).toUpperCase()+("0"+Number(e.b).toString(16)).slice(-2).toUpperCase(),"stop-opacity":"1"}))}),t},this.hsv2rgb=function(e,t,n){var r=parseFloat(e);if(isNaN(r))console.error("ColorPicker.palette.hsv2rgb: stringPercent = "+e);else{void 0!==t&&void 0!==n&&(r=100/(n-t)*(r-t));var o,i,a=f[f.length-1];100!==a.percent&&(o={},Object.keys(a).forEach(function(e){o[e]=a[e]}),o.percent=100,f.push(o));for(var s=0;s<f.length;s++){var l=f[s];if(void 0===i&&(i=l),r>=i.percent&&r<=l.percent){var c=function(e,t,n,o){n-=e;return 0==n?t:Math.round(t+(o-t)/n*(r-e))},u=c(i.percent,i.r,l.percent,l.r),d=c(i.percent,i.g,l.percent,l.g),c=c(i.percent,i.b,l.percent,l.b);return{r:u,g:d,b:c,hex:"#"+(16777216|c|d<<8|u<<16).toString(16).slice(1),percent:r}}i=l}void 0!==p.onError&&p.onError("Invalid color value of the ColorPicker: "+e)}},this.toColor=function(e,t,n){var o=Le.THREE;if(e instanceof o.Color)return e;n=this.hsv2rgb(e,t,n);return void 0===n&&(n={r:255,g:255,b:255}),new o.Color("rgb("+n.r+", "+n.g+", "+n.b+")")}}};
/**
 * @module cookie
 * @description node.js version of the cookie.
 * Cookies let you store user information in web pages.
 * @see {@link https://www.w3schools.com/js/js_cookies.asp}
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
function hn(){return navigator.cookieEnabled}function mn(e,t,n){hn()?(t=t.toString(),void 0===n&&(n=new Date).setTime(n.getTime()+31536e6),document.cookie=e+"="+t+("undefined"==typeof settings?"":settings)+"; expires="+n.toGMTString(),""===document.cookie&&console.error("document.cookie is empty")):bn()}function gn(e,t){if(hn()){e=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return e?unescape(e[2]):void 0===t?"":t}bn()}function _n(e,t){return JSON.parse(gn(e,JSON.stringify(t)))}function bn(){console.error("navigator.cookieEnabled = "+navigator.cookieEnabled)}function yn(e){this.get=function(e){return e},this.set=function(){},this.getObject=function(e,n,o){o&&Object.keys(o).forEach(function(e){var t=o[e];void 0!==t&&"function"!=typeof t&&(n[e]=JSON.parse(JSON.stringify(t)))})},this.copyObject=function(e,t){return JSON.parse(JSON.stringify(t))},this.setObject=function(){},this.isTrue=function(e){return e}}
/**
* node.js version of the cookie.
*
* @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
*
* @copyright 2011 Data Arts Team, Google Creative Lab
*
* @license under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*/var vn={set:mn,setObject:function(e,t){mn(e,JSON.stringify(t))},get:gn,getObject:function(e,t,n){(new yn).getObject(e,t,_n(e,n))},copyObject:_n,defaultCookie:yn};
/**
 * @module Localization.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function wn(){return(navigator?void 0!==navigator.languages&&"unknown"!=typeof navigator.languages&&0<navigator.languages.length?navigator.languages[0]:navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage||(console.error("getLocale() failed!"),""):(console.error("getLocale() failed! !navigator"),"")).toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/)[1]}
/**
 * @module CreateFullScreenSettings
 * @description creates functions for resize of the canvas to fullscreen and restore to default size.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function xn(o,r,i,a){var s,t,l,c=!1;a.fullScreen=a.fullScreen||{},a.canvasMenu&&(s=a.canvasMenu),a.stereoEffect&&(t=a.stereoEffect),r.setSize(r.domElement.width,r.domElement.height),this.isFullScreen=function(){return c},this.setStereoEffect=function(e){t=e},this.setFullScreen=function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];setTimeout(function(){n&&a.fullScreen.arrayContainersLength&&1<a.fullScreen.arrayContainersLength()&&(t=!0);var e=new o.Vector2;r.getSize(e),(c=t)?void 0!==l&&(r.setSize(l.sizeOriginal.x,l.sizeOriginal.y),r.domElement.style.position=l.position,r.domElement.style.left=l.left,r.domElement.style.top=l.top,r.domElement.style.width=l.width,r.domElement.style.height=l.height):(void 0===l&&(l={sizeOriginal:new o.Vector2,position:r.domElement.style.position,left:r.domElement.style.left,top:r.domElement.style.top,width:r.domElement.style.width,height:r.domElement.style.height},r.getSize(l.sizeOriginal)),r.setSize(window.innerWidth,window.innerHeight),r.domElement.style.position="fixed",r.domElement.style.left=0,r.domElement.style.top=0,r.domElement.style.width="100%",r.domElement.style.height="100%"),void 0!==a.fullScreen.onFullScreenToggle&&a.fullScreen.onFullScreenToggle(c),i.aspect=e.x/e.y,i.updateProjectionMatrix(),c=!c,s&&s.setFullScreenButton&&s.setFullScreenButton(c),xn.RendererSetSize(r,a.canvasMenu)},0)},this.onclick=function(){return void 0!==t&&parseInt(t.settings.spatialMultiplex)!==Sn.spatialMultiplexsIndexs.Mono&&(t.settings.spatialMultiplex=Sn.spatialMultiplexsIndexs.Mono),this.setFullScreen(c),c}}
/**
 * @module SpriteText
 * @description A sprite based text component. Text that always faces towards the camera.
 * @see {@link https://threejs.org/docs/index.html#api/en/objects/Sprite|THREE.Sprite}
 *
 * @author Andrej Hristoliubov. {@link https://anhr.github.io/AboutMe/|AboutMe}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/
function En(E,C){var S=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e=Le.THREE;C=C||new e.Vector3(0,0,0);var T=new e.Sprite(new e.SpriteMaterial({map:new e.Texture,sizeAttenuation:void 0!==S.sizeAttenuation&&S.sizeAttenuation})),O=document.createElement("canvas");T.material.map.minFilter=e.LinearFilter;var k=O.getContext("2d");return S.name&&(T.name=S.name),T.userData.update=function(){var e={};T.parent?Cn(T.parent,e):S.group&&Cn(S.group,e);var t=S.textHeight||e.textHeight||.04,n=S.fov||e.fov,o=S.sizeAttenuation||e.sizeAttenuation||!1,r=S.rotation||e.rotation||0,i=S.fontFace||e.fontFace||"Arial",a=S.bold||e.bold||!1,s=S.italic||e.italic||!1,l=S.fontProperties||e.fontProperties||"",c=S.rect||e.rect||{},u=S.fontColor||e.fontColor||"rgba(255, 255, 255, 1)",e=En.getCenter(S.center||e.center,C);void 0!==n&&(t=n*t/50),c.displayRect=c.displayRect||!1;var d=c.borderThickness||5,i=l+(a?"bold ":"")+(s?"italic ":"")+"90px "+i;k.font=i;var p,f,h,m,g,_,b,y=0,v=1;if("string"==typeof E?(v=0,(p=E.split(/\r\n|\r|\n/)).forEach(function(e){e=k.measureText(e).width;y<e&&(y=e),v+=1})):y=k.measureText(E).width,y+=2*d,O.width=y,O.height=90*v+2*d,k.font=i,c.displayRect&&(k.fillStyle=c.backgroundColor||"rgba(0, 0, 0, 1)",k.strokeStyle=c.borderColor||u,k.lineWidth=d,f=k,m=h=d/2,g=O.width-d,_=O.height-d,b=void 0===c.borderRadius?0:c.borderRadius,f.beginPath(),f.moveTo(h+b,m),f.lineTo(h+g-b,m),f.quadraticCurveTo(h+g,m,h+g,m+b),f.lineTo(h+g,m+_-b),f.quadraticCurveTo(h+g,m+_,h+g-b,m+_),f.lineTo(h+b,m+_),f.quadraticCurveTo(h,m+_,h,m+_-b),f.lineTo(h,m+b),f.quadraticCurveTo(h,m,h+b,m),f.closePath(),f.fill(),f.stroke()),k.fillStyle=u,k.textBaseline="bottom",1<v)for(var w=0;w<p.length;w++){var x=p[w];k.fillText(x,d,O.height-90*(p.length-w-1)-d)}else k.fillText(E,d,O.height-d);T.material.map.image=O,T.material.map.needsUpdate=!0;t*=v;T.scale.set(t*O.width/O.height,t),T.position.copy(C),T.center=e,T.material.sizeAttenuation=o,T.material.rotation=r,T.material.needsUpdate=!0},T.userData.update(),T.userData.updateText=function(e){E=e;e={};Cn(T.parent,e),T.userData.update(e)},S.group&&S.group.add(T),T.userData.optionsSpriteText=S,T}function Cn(t,n){for(t.userData.optionsSpriteText&&Object.keys(t.userData.optionsSpriteText).forEach(function(e){void 0===n[e]&&(n[e]=t.userData.optionsSpriteText[e])});t.parent;)Cn(t=t.parent,n)}xn.RendererSetSize=function(i,a){i.setSizeOld||(i.setSizeOld=i.setSize,i.setSize=function(e,t,n){i.setSizeOld(e,t,n);var o=i.domElement,r=o.parentElement;setTimeout(function(){r.style.height=o.style.height,r.style.width=o.style.width,r.style.left=o.style.left,r.style.top=o.style.top,r.style.position=o.style.position,a&&a.setSize(e,t)},0)})},En.getCenter=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=Le.THREE,o=e.canvas||void 0;var r,i,a,s=e.canvas?(r=o.width/2,i=o.height/2,(a=(new n.Vector3).copy(t)).project(e.camera),a.x=a.x*r+r,a.y=-a.y*i+i,a):void 0;return e instanceof n.Vector2||"object"===(void 0===e?"undefined":x(e))&&void 0!==e.x&&void 0!==e.y?e:s?new n.Vector2(s.x<o.width/2?0:1,s.y<o.height/2?1:0):new n.Vector2(0,1)},En.updateSpriteTextGroup=function(e){var t=Le.THREE;e.children.forEach(function(e){e instanceof t.Sprite&&void 0!==e.userData.update&&e.userData.update(),En.updateSpriteTextGroup(e)})};
/**
 * @module StereoEffect
 * @description Uses dual PerspectiveCameras for Parallax Barrier effects.
 * @see About {@link https://en.wikipedia.org/wiki/Parallax_barrier|Parallax barrier}.
 *
 * @author {@link https://anhr.github.io/AboutMe/|Andrej Hristoliubov}
 * @author {@link http://alteredqualia.com/|alteredq}
 * @author {@link http://mrdoob.com/|mrdoob}
 * @author {@link http://aleksandarrodic.com/|arodic}
 * @author {@link http://fonserbc.github.io/|fonserbc}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/
var Sn=function e(g){var _,b,y,v,w,x,E=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Ln;function C(t){t=t||{};var n={stereoEffects:"Stereo effects",spatialMultiplexName:"Spatial  multiplex",spatialMultiplexTitle:"Choose a way to do spatial multiplex.",spatialMultiplexs:{Mono:Tn.Mono,"Side by side":Tn.SbS,"Top and bottom":Tn.TaB},eyeSeparationName:"Eye separation",eyeSeparationTitle:"The distance between left and right cameras.",focus:"Focus",focusTitle:"Object distance.",zeroParallaxName:"Zero parallax",zeroParallaxTitle:"Distance to objects with zero parallax.",defaultButton:"Default",defaultTitle:"Restore default stereo effects settings."},e=void 0===t.getLanguageCode?"en":t.getLanguageCode();switch(e){case"ru":n.stereoEffects=" ",n.spatialMultiplexName="",n.spatialMultiplexTitle="    .",n.spatialMultiplexs={"":Tn.Mono," ":Tn.SbS," ":Tn.TaB},n.eyeSeparationName=" ",n.eyeSeparationTitle="     .",n.focus="",n.focusTitle="  .",n.zeroParallaxName=" 0",n.zeroParallaxTitle="     .",n.defaultButton="",n.defaultTitle="     .";break;default:if(void 0===t.lang||t.lang._languageCode!=e)break;Object.keys(t.lang).forEach(function(e){void 0!==n[e]&&(n[e]=t.lang[e])})}return n}S(this,e),g?(E.boOptions||(E=new Ln(E)),!1!==E.stereoEffect&&(E.dat.gui&&(E.dat.mouseenter=!1),_=Le.THREE,On(),E.stereoEffect||(E.stereoEffect={}),b=E.stereoEffect,this.settings=b,(this.options=E).stereoEffect=this,void 0===b.spatialMultiplex&&(b.spatialMultiplex=Tn.Mono),b.stereo=new _.StereoCamera,b.stereo.aspect=b.stereoAspect||1,void 0===b.far&&(b.far=(new _.PerspectiveCamera).focus),b.focus=void 0===b.camera?(new _.PerspectiveCamera).focus:(new _.Vector3).distanceTo(b.camera.position),b.zeroParallax=0,b.eyeSep=b.eyeSep||(new _.StereoCamera).eyeSep/10*b.far,void 0!==b.camera&&(b.camera.focus=b.focus),this.setEyeSeparation=function(e){b.stereo.eyeSep=e},this.setEyeSeparation(b.eyeSep),this.getRendererSize=function(){return Ln.raycaster.EventListeners.getRendererSize(g,b.elParent)},this.render=function(e,t){var n=parseInt(b.spatialMultiplex);b.rememberSize&&!y&&(y=w&&w.getFullScreenSettings?w.getFullScreenSettings(this):new xn(_,g,t,{canvasMenu:w,stereoEffect:this})),e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld();var o=new _.Vector2;g.getSize(o),g.autoClear&&g.clear(),g.setScissorTest(!0);var r=b.zeroParallax;function i(e){return y&&v!==n&&(v=n,e.setControllerSpatialMultiplex?e.setControllerSpatialMultiplex(n):e.setSpatialMultiplex&&e.setSpatialMultiplex(n),1)}function a(e,t){i(t)&&y.setFullScreen(e)}switch(n){case Tn.Mono:return g.setScissor(0,0,o.width,o.height),g.setViewport(0,0,o.width,o.height),g.render(e,t),g.setScissorTest(!1),void(E.canvasMenu?i(this):a(!0,this));case Tn.SbS:var s=o.width/2,l=0+r,c=0,u=s,d=o.height,p=s-r,f=0,h=s,m=o.height;a(!1,this);break;case Tn.TaB:l=0+r,c=0,u=o.width,d=o.height/2,p=0-r,f=o.height/2,h=o.width,m=o.height/2,a(!1,this);break;default:console.error('THREE.StereoEffect.render: Invalid "Spatial  multiplex" parameter: '+n)}b.stereo.update(t),g.setScissor(l,c,u,d),g.setViewport(l,c,u,d),g.render(e,b.stereo.cameraL),g.setScissor(p,f,h,m),g.setViewport(p,f,h,m),g.render(e,b.stereo.cameraR),g.setScissorTest(!1)},this.gui=function(){var e,t,n,o,r,i,a,s,l,c,u,d,p=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},f=p.folder||E.dat.gui;function h(e){e=e==Tn.Mono?"none":"block";a.domElement.style.display=e,void 0!==l&&(l.__li.style.display=e),u.__li.style.display=e,c.__li.style.display=e}function m(e){var t;d&&(t={},Object.keys(o).forEach(function(e){t[e]=b[e]}),E.dat.cookie.setObject(e,t))}f&&!1!==E.dat.stereoEffectsGui&&(e=p.dat||Le.dat,void 0===p&&(p={}),p.scale=p.scale||1,t=E.dat.getCookieName("StereoEffect"),n=C({getLanguageCode:E.getLanguageCode,lang:E.lang}),o={spatialMultiplex:b.spatialMultiplex,eyeSep:(new _.StereoCamera).eyeSep/10*b.far,focus:b.focus,zeroParallax:0},Object.freeze(o),E.dat.cookie.getObject(t,b,o),b.spatialMultiplex=parseInt(b.spatialMultiplex),this.setSpatialMultiplex&&this.setSpatialMultiplex(b.spatialMultiplex),r=f.addFolder(n.stereoEffects),i=r.add(b,"spatialMultiplex",n.spatialMultiplexs).onChange(function(e){h(e=parseInt(e)),m(t),p.onChangeMode&&p.onChangeMode(e),x&&x.select(e)}),e.controllerNameAndTitle(i,n.spatialMultiplexName,n.spatialMultiplexTitle),this.setControllerSpatialMultiplex=function(e){d=!1,i.setValue(e),d=!0},a=r.addFolder(n.eyeSeparationName),e.folderNameAndTitle(a,n.eyeSeparationName,n.eyeSeparationTitle),a.add(new Me(function(e){b.eyeSep+=e,s.setValue(b.eyeSep)},{settings:{offset:.01},min:1e-4,max:.01,step:1e-4})),s=e.controllerZeroStep(a,b.stereo,"eyeSep",function(e){b.eyeSep=e,m(t)}),e.controllerNameAndTitle(s,n.eyeSeparationName,n.eyeSeparationTitle),void 0!==b.camera&&(b.camera.focus=b.focus),b.camera&&(l=r.add(b.camera,"focus",o.focus/10,2*o.focus,o.focus/1e3).onChange(function(e){b.focus=e,m(t)}),e.controllerNameAndTitle(l,n.focus,n.focusTitle)),f=(60-400/9)*p.scale+400/9,c=r.add(b,"zeroParallax",-f,f).onChange(function(e){b.zeroParallax=e,m(t)}),e.controllerNameAndTitle(c,n.zeroParallaxName,n.zeroParallaxTitle),u=r.add({defaultF:function(){b.stereo.eyeSep=o.eyeSep,s.setValue(b.stereo.eyeSep),b.camera&&(b.camera.focus=o.focus,l.setValue(b.camera.focus)),b.zeroParallax=o.zeroParallax,c.setValue(b.zeroParallax)}},"defaultF"),e.controllerNameAndTitle(u,n.defaultButton,n.defaultTitle),h(b.spatialMultiplex),d=!0)},this.createCanvasMenuItem=function(e,t){w=e;var n=C({getLanguageCode:(t=t||{}).getLanguageCode,lang:t.lang}),t=Object.keys(n.spatialMultiplexs);x={name:"",title:n.stereoEffects,id:"menuButtonStereoEffects",drop:"up",items:[{name:t[Tn.Mono],id:"menuButtonStereoEffectsMono",radio:!0,checked:b.spatialMultiplex===Tn.Mono,spatialMultiplex:Tn.Mono,onclick:function(){b.spatialMultiplex=Tn.Mono}},{name:t[Tn.SbS],id:"menuButtonStereoEffectsSbS",radio:!0,checked:b.spatialMultiplex===Tn.SbS,spatialMultiplex:Tn.SbS,onclick:function(){b.spatialMultiplex=Tn.SbS}},{name:t[Tn.TaB],id:"menuButtonStereoEffectsTaB",radio:!0,checked:b.spatialMultiplex===Tn.TaB,spatialMultiplex:Tn.TaB,onclick:function(){b.spatialMultiplex=Tn.TaB}}],select:function(t){x.items.forEach(function(e){e.spatialMultiplex===t&&(e.checked||e.elName.onclick({target:e.elName}))})}},this.setSpatialMultiplex=function(e){x.select(e)},e.menu.push(x)})):console.error("StereoEffect: renderer = "+g)};Sn.spatialMultiplexsIndexs={Mono:0,SbS:1,TaB:2},Object.freeze(Sn.spatialMultiplexsIndexs);var Tn=Sn.spatialMultiplexsIndexs;function On(){var d=Le.THREE;(new d.Raycaster).setStereoEffect||Object.assign(d.Raycaster.prototype,{setStereoEffect:function(n){(n=n||{}).raycasterEvents=void 0===n.raycasterEvents||n.raycasterEvents;var t,o=n.camera,r=n.renderer;n.raycasterEvents&&(t=new d.Vector2,window.addEventListener("mousemove",function(e){t.x=e.clientX/window.innerWidth*2-1,t.y=2*-(e.clientY/window.innerHeight)+1,l.setFromCamera(t,o),l.stereo.onDocumentMouseMove(e)},!1),window.addEventListener("pointerdown",function(e){l.stereo.onDocumentMouseDown(e)},!1));var i,a,s=void 0!==n.stereoEffect?n.stereoEffect:"undefined"!=typeof effect?effect:new Sn(r,n.options),l=this,c=new d.Vector2,u=new d.Vector2;this.stereo={onDocumentMouseMove:function(e){void 0!==i&&(e.preventDefault(),void 0===a&&(a=new d.Vector2),function(){function e(e,t){c.copy(a),u.copy(a);c[e]+=.5,c[e]*=2,u[e]-=.5,u[e]*=2;e=new d.Vector2;r.getSize(e);t=s.settings.zeroParallax/e.x*t;c.x-=t,u.x+=t}switch(s.getRendererSize().getMousePosition(a,event),parseInt(s.settings.spatialMultiplex)){case Tn.Mono:return;case Tn.SbS:e("x",4);break;case Tn.TaB:e("y",2);break;default:console.error("THREE.Raycaster.setStereoEffect.getMousePosition: Invalid effect.settings.spatialMultiplex = "+effect.settings.spatialMultiplex)}}(),function(e){if(void 0!==a){if(e=e||n,parseInt(s.settings.spatialMultiplex)!==Tn.Mono){e=a;return a=c,l.setFromCamera(c,o),t(),a=u,l.setFromCamera(u,o),t(),a=e}l.setFromCamera(a,o),t()}function t(){Ln.raycaster.intersectionsInOut(i,l,r,a,n)}}())},isAddedToParticles:function(e){return!!i&&i.includes(e)},addParticle:function(e){void 0===i&&(i=[]),this.isAddedToParticles(e)?console.error('Duplicate particle "'+e.name+'"'):i.push(e)},addParticles:function(e){var t;if(void 0!==i)return Array.isArray(i)||(t=i,(i=[]).push(t)),void i.push(e);i=e},removeParticle:function(e){for(var t=0;t<i.length;t++)if(Object.is(e,i[t])){i.splice(t,1);break}},removeParticles:function(){i=void 0},getPosition:function(e){var t=e.object.geometry.attributes.position,n=4<=t.itemSize?new d.Vector4(0,0,0,0):new d.Vector3;return void 0!==e.index?(n.fromArray(t.array,e.index*t.itemSize),n.multiply(e.object.scale),n.add(e.object.position)):n=e.object.position,n}}}})}Sn.assign=On;var kn,An={mesh:"Mesh",pointName:"Point Name",color:"olor",opacity:"Opacity"};
/**
 * View and edit some parameters on the web page.
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 * Thanks to https://stackoverflow.com/a/11900218/5175935
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
function Pn(t,e,n,o){var r,i,a,s;t&&("string"==typeof t.controller&&(r=t.controller,t.controller=document.getElementById(t.controller),t.controller||console.warn('createController: invalid settings.controller = "'+r+'"')),t.controller||(null===t.controller&&console.warn("createController: invalid settings.controller = "+t.controller),(e=document.getElementById(e))||(e=document.createElement(o.elementName||"input"),document.querySelector("body").appendChild(e)),t.controller=e),void 0!==o.value&&(i=o.value,void 0!==t.controller.value?t.controller.value=i:t.controller.innerHTML=i),void 0!==o.onchange&&null===t.controller.onchange&&(t.controller.onchange=o.onchange),void 0!==o.title&&""===t.controller.title&&(t.controller.title=o.title),t.elSlider&&("string"==typeof t.elSlider&&(a=t.elSlider,t.elSlider=document.getElementById(t.elSlider),t.elSlider||console.warn('createController: invalid settings.elSlider = "'+a+'"')),t.elSlider&&!0!==t.elSlider||(o.axisName&&(t.elSlider=document.getElementById(o.axisName+"Slider")),t.elSlider||(t.elSlider=document.createElement("div"),(t.controller?t.controller.parentElement:document.querySelector("body")).appendChild(t.elSlider))),t.boSetValue=!0,t.colorpicker||(t.colorpicker=fn.create(t.elSlider,{duplicate:!0,sliderIndicator:{callback:function(e){!t.boSetValue&&t.controller&&(e=e.percent/100,t.controller.onchange({currentTarget:{value:e}}),t.controller.value=e)},value:100*o.value},style:{border:"1px solid black",width:t.controller.clientWidth+"px",height:t.controller.clientHeight+"px"},onError:function(e){alert("Horizontal Colorpicker with slider indicator error: "+e)}})),void 0!==o.value&&((a=100*o.value)<0&&(a=0),100<a&&(a=100),t.boSetValue=!0,t.colorpicker.setValue(a),t.boSetValue=!1)),!1!==t.elName&&(null===t.elName&&console.warn("createController: invalid settings.elName = "+t.elName),"string"==typeof t.elName&&(s=t.elName,t.elName=document.getElementById(t.elName),t.elName||console.warn('createController: invalid settings.elName = "'+s+'"')),s="",t.elName||(o.axisName&&(t.elName=document.getElementById(o.axisName+"Name")),t.elName||(t.elName=document.createElement("span"),t.controller.parentElement.insertBefore(t.elName,t.controller),s=" = ")),""===t.elName.innerHTML&&(t.elName.innerHTML=n()+s)))}
/**
 * options of the canvas
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */"ru"===wn()&&(An.mesh="3D ",An.pointName=" ",An.color="",An.opacity=""),!(Sn.getTextIntersection=function(e,t){var n=Ln.findSpriteTextIntersection(t.spriteOptions.group);if(n)return n;var o=Le.THREE,r=tn(e.object,e.index),i=t.scales||{},a=void 0!==e.index&&void 0!==e.object.userData.player&&void 0!==e.object.userData.player.arrayFuncs,s=a?e.object.userData.player.arrayFuncs:void 0,l=void 0===s||"function"==typeof s?void 0:s[e.index],c=a&&l?l.name:void 0,n=a&&void 0!==l?Array.isArray(l.w)?Player.execFunc(l,"w",group.userData.t,t):l.w:void 0,l=!i.x&&!i.y&&!i.z;return t.spriteOptions.name=Ln.findSpriteTextIntersection.spriteTextIntersectionName,new En((""===e.object.name?"":An.mesh+": "+e.object.name)+(void 0===c?"":"\n"+An.pointName+": "+c)+(l||i.x?"\n"+(i.x&&i.x.name?i.x.name:"X")+": "+r.x:"")+(l||i.y?"\n"+(i.y&&i.y.name?i.y.name:"Y")+": "+r.y:"")+(l||i.z?"\n"+(i.z&&i.z.name?i.z.name:"Z")+": "+r.z:"")+(a&&(s[e.index]instanceof o.Vector4||s[e.index]instanceof o.Vector3||"function"==typeof s)?n instanceof o.Color?"\n"+An.color+": "+new o.Color(n.r,n.g,n.b).getHexString():void 0!==r.w?"\n"+(i.w&&i.w.name?i.w.name:"W")+": "+r.w:"":"")+(void 0===e.object.geometry.attributes.ca||e.object.geometry.attributes.ca.itemSize<4?"":"\n"+An.opacity+": "+(new o.Vector4).fromArray(e.object.geometry.attributes.ca.array,e.index*e.object.geometry.attributes.ca.itemSize).w),r,t.spriteOptions)})===X.isWebGLAvailable()&&(document.body.appendChild(X.getWebGLErrorMessage()),alert(X.getWebGLErrorMessage().innerHTML));var Ln=function e(s){var t;S(this,e);var l,i=this;if((s=s||{}).boOptions)return s;void 0===s.a&&(s.a=1),void 0===s.b&&(s.b=0),this.setW=function(e){(e=e||s).scales=e.scales||{};e.scales.w;e.palette||i.setPalette(e)},s.scales=s.scales||{};var n,o=!s.scales.x&&!s.scales.y&&!s.scales.z;function r(e){o&&(s.scales[e]=s.scales[e]||{}),s.scales[e]}for(n in r("x"),r("y"),r("z"),s.point=s.point||{},s.point.size=s.point.size||5,s.point.sizePointsMaterial=s.point.sizePointsMaterial||100,this.setPalette=function(){s.palette||(s.palette=new fn.palette)},this.createOrbitControls=function(e,t,n){!1!==s.orbitControls&&((ln.prototype=Object.create(Le.THREE.EventDispatcher.prototype)).constructor=ln,(cn.prototype=Object.create(Le.THREE.EventDispatcher.prototype)).constructor=cn,i.orbitControls=new ln(e,t.domElement),i.orbitControls.target.set(2*n.position.x,2*n.position.y,2*n.position.z),i.orbitControls.saveState(),i.orbitControls.update())},this.restoreSceneController=function(e,t){var n,o,r;Le.dat&&(n={defaultButton:"Default",defaultTitle:"Reset player and restore camera position."},"ru"===this.getLanguageCode()&&(n.defaultButton="",n.defaultTitle="    ."),o=(new Le.THREE.Vector3).copy(t.position),r=(new Le.THREE.Vector3).copy(e.position),Le.dat.controllerNameAndTitle(s.dat.gui.add({defaultF:function(){s.player&&s.player.setTime(s.playerOptions.min),e.position.copy(r),t.position.copy(o),!1!==s.orbitControls&&(s.orbitControls.target=new Le.THREE.Vector3,s.orbitControls.object.position.copy(e.position),s.orbitControls.update())}},"defaultF"),n.defaultButton,n.defaultTitle))},Object.defineProperties(this,(a(t={playerOptions:{get:function(){s.playerOptions=s.playerOptions||{};var e,t=s.playerOptions;return t.min=t.min||0,t.max===1/0&&(t.max=null),null!==t.max?(void 0===t.max&&(t.max=1),t.marks=t.marks||10):t.marks=null,null===t.max?t.dt=t.dt||.1:t.dt=(t.max-t.min)/(t.marks-1),t.repeat=t.repeat||!1,t.interval=t.interval||1,t.zoomMultiplier=t.zoomMultiplier||1.1,t.offset=t.offset||.1,t.name=t.name||"",t.cameraTarget||(e=new Nn.cameraTarget,Object.defineProperties(t,{cameraTarget:{get:function(){return e}}})),s.playerOptions},set:function(e){s.playerOptions=e}},a:{get:function(){return s.a}},b:{get:function(){return s.b}},dat:{get:function(){function n(t){if(S(this,n),(t=t||{}).boDat)return t;for(var e in Object.defineProperties(this,{boDat:{get:function(){return!0}},dat:{get:function(){return console.warn("get dat depreacated. Use three.dat = dat."),Le.dat},set:function(e){console.warn("Set dat depreacated. Use three.dat = dat."),e.dat&&e.dat.constructor.name===e.constructor.name&&"Object"!==e.dat.constructor.name&&console.error("duplicate dat."),e.dat=e}},cookieName:{get:function(){return t.cookieName}},gui:{get:function(){var e;return!t.gui&&Le.dat&&(t.gui=new Le.dat.GUI,s.dat.parent&&(e=document.createElement("div"),t.parent.appendChild(e),e.appendChild(t.gui.domElement),e.style.position="absolute",e.style.top="0px",e.style.right="0px")),t.gui}},cookie:{get:function(){return t.cookie},set:function(e){t.cookie=e}},guiSelectPoint:{get:function(){return t.guiSelectPoint},set:function(e){t.guiSelectPoint=e}},cameraGui:{get:function(){return t.cameraGui},set:function(e){t.cameraGui=e}},playerGui:{get:function(){return t.playerGui}},orbitControlsGui:{get:function(){return t.orbitControlsGui}},axesHelperGui:{get:function(){return t.axesHelperGui}},playController:{get:function(){return t.playController}},stereoEffectsGui:{get:function(){return t.playController}},moveScene:{get:function(){return t.moveScene}},spriteTextGui:{get:function(){return t.spriteTextGui}},folderPoint:{get:function(){return t.folderPoint}},pointLightGui:{get:function(){return t.pointLightGui}},parent:{get:function(){return t.parent}}}),t)void 0===this[e]&&console.error("Dat: dat."+e+" key is hidden")}return!1===s.dat||(s.dat=new n(s.dat),s.dat.gui&&(setTimeout(function(){var t=s.dat.gui.domElement.className,n=0;s.dat.gui.domElement.parentElement.childNodes.forEach(function(e){e.className===t&&n++}),1<n&&console.error("Options: duplicate dat.GUI")},0),s.dat.gui.domElement.addEventListener("mouseenter",function(e){s.dat.mouseenter=!0}),s.dat.gui.domElement.addEventListener("mouseleave",function(e){s.dat.mouseenter=!1})),!1===s.dat.cookie?s.dat.cookie=new vn.defaultCookie:void 0===s.dat.cookie&&(s.dat.cookie=vn),s.dat.getCookieName=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=s.dat.cookieName||(s.elContainer?"object"===x(s.elContainer)?s.elContainer.id:"string"==typeof s.elContainer?s.elContainer:"":"");return e+(""!==e&&""!==t?"_":"")+t}),s.dat},set:function(e){s.dat=e}},getLanguageCode:{get:function(){return"string"==typeof s.getLanguageCode?function(){return s.getLanguageCode}:s.getLanguageCode||wn}},scales:{get:function(){function o(t){function r(e,t){S(this,r);var n,o=e[t];for(n in this.isAxis=function(){return!(e&&(e.x||e.y||e.z)&&!o)},Object.defineProperties(this,{boScale:{get:function(){return!0}},min:{get:function(){return o&&o.min?o.min:"w"===t?0:-1}},max:{get:function(){return o&&o.max?o.max:"w"===t?(new Le.THREE.Vector4).w:1}},name:{get:function(){return o&&o.name?o.name:t}},marks:{get:function(){return o.marks||(o.marks=3),o.marks}}}),o)void 0===this[n]&&console.error("Options.Scales: scale."+n+" key is hidden")}S(this,o);var e,n={x:new r(s.scales,"x"),y:new r(s.scales,"y"),z:new r(s.scales,"z"),w:new r(s.scales,"w")};for(e in Object.defineProperties(this,{boScales:{get:function(){return!0}},x:{get:function(){return n.x},set:function(e){t.x=e}},y:{get:function(){return n.y},set:function(e){t.y=e}},z:{get:function(){return n.z},set:function(e){t.z=e}},w:{get:function(){return n.w},set:function(e){t.w=e}},setW:{get:function(){return i.setW}},display:{get:function(){return void 0===t.display&&(t.display=!0),t.display},set:function(e){t.display=e}},text:{get:function(){return void 0===t.text&&(t.text={}),t.text},set:function(e){t.text=e}},posAxesIntersection:{get:function(){return t.posAxesIntersection},set:function(e){t.posAxesIntersection=e}}}),t)void 0===this[e]&&console.error("Options: scales."+e+" key is hidden")}return s.scales.boScales||(s.scales=new o(s.scales)),s.scales},set:function(e){s.scales=e}},palette:{get:function(){switch(void 0===s.palette&&(s.palette=!0),x(s.palette)){case"number":s.palette=new fn.palette({palette:s.palette});break;case"boolean":s.palette&&(s.palette=new fn.palette);break;default:s.palette instanceof fn.palette==!1&&console.error("MyThree: invalid typeof options.palette: "+x(s.palette))}return s.palette}},boOptions:{get:function(){return!0}},point:{get:function(){return s.point}},spriteText:{get:function(){return s.spriteText||{}}},raycaster:{get:function(){if(s.raycaster)return s.raycaster},set:function(e){s.raycaster=e}},camera:{get:function(){return s.camera=s.camera||{},s.camera.position||(s.camera.position=new Le.THREE.Vector3(.4,.4,2)),s.camera.scale||(s.camera.scale=new Le.THREE.Vector3(1,1,1)),s.camera},set:function(e){s.camera=e}},cameraTarget:{get:function(){return s.cameraTarget}},elContainer:{get:function(){return s.elContainer}},canvasMenu:{get:function(){return s.canvasMenu},set:function(e){s.canvasMenu&&!0!==s.canvasMenu&&!1!==s.canvasMenu&&console.warn("Duplicate canvasMenu"),s.canvasMenu=e}},canvas:{get:function(){return s.canvas||{fullScreen:!0}}},frustumPoints:{get:function(){return s.frustumPoints},set:function(e){s.frustumPoints&&s.frustumPoints.constructor.name===e.constructor.name&&"Object"!==s.frustumPoints.constructor.name&&console.error("duplicate frustumPoints."),s.frustumPoints=e}},stereoEffect:{get:function(){return s.stereoEffect},set:function(e){s.stereoEffect&&s.stereoEffect.constructor.name===e.constructor.name&&"Object"!==s.stereoEffect.constructor.name&&console.error("duplicate stereoEffect."),s.stereoEffect=e}},player:{get:function(){return s.player},set:function(e){s.player&&console.error("duplicate player."),s.player=e}},time:{get:function(){return s.player?s.player.getTime():0}},axesHelper:{get:function(){return s.axesHelper},set:function(e){s.axesHelper&&console.error("duplicate axesHelper."),s.axesHelper=e}}},"canvasMenu",{get:function(){return s.canvasMenu},set:function(e){s.canvasMenu&&console.error("duplicate canvasMenu."),s.canvasMenu=e}}),a(t,"orbitControls",{get:function(){return s.orbitControls},set:function(e){s.orbitControls&&s.orbitControls.constructor.name===e.constructor.name&&"Object"!==s.orbitControls.constructor.name&&console.error("duplicate orbitControls."),s.orbitControls=e}}),a(t,"scale",{get:function(){return 1}}),a(t,"pointLight",{get:function(){return s.pointLight}}),a(t,"cameraTarget",{get:function(){return s.cameraTarget}}),a(t,"eventListeners",{get:function(){if(s.eventListeners)return s.eventListeners},set:function(e){s.eventListeners&&console.error("duplicate eventListeners."),s.eventListeners=e}}),a(t,"guiSelectPoint",{get:function(){return s.guiSelectPoint},set:function(e){s.guiSelectPoint&&console.error("duplicate guiSelectPoint."),s.guiSelectPoint=e}}),a(t,"controllers",{get:function(){function n(t){for(var e in S(this,n),t=t||{},Object.defineProperties(this,{boControllers:{get:function(){return!0}},t:{get:function(){null===t.t&&console.error("options.controllers.t = "+t.t);var e=document.getElementById("time");if(!t.t){if(!e)return;t.t={elName:document.getElementById("tName")}}return!t.t.controller&&e&&(t.t.controller=e),t.t&&(Pn(t.t,"t",function(){return s.playerOptions&&s.playerOptions.name?s.playerOptions.name:"t"},{onchange:function(){s.player?!1===s.player.setTime(t.t.controller.value)&&(alert(l.timeAlert+t.t.controller.value),t.t.controller.focus()):console.error("options.controllers.t.onchange: create Player instance first. "+t.t.value)}}),void 0!==l&&""===t.t.controller.title&&(t.t.controller.title=l.controllerTTitle)),t.t}},player:{get:function(){return t.player}}}),t)void 0===this[e]&&console.error("Controllers: controllers."+e+" key is hidden")}var e,t,o,r,i,a;return void 0===kn&&(kn=!0,e=document.getElementById("time"),t=document.getElementById("prev"),o=document.getElementById("play"),r=document.getElementById("next"),i=!!(t||o||r),a=!(!e&&!i),!s.controllers&&a&&(s.controllers={t:{}},e&&(s.controllers.t.controller=e)),s.controllers&&(!s.controllers.player&&i&&(s.controllers.player={}),s.controllers.player&&(!s.controllers.player.buttonPrev&&t&&(s.controllers.player.buttonPrev=t),!s.controllers.player.buttonPlay&&o&&(s.controllers.player.buttonPlay=o),!s.controllers.player.buttonNext&&r&&(s.controllers.player.buttonNext=r)))),s.controllers&&!s.controllers.boControllers&&(s.controllers=new n(s.controllers)),s.controllers}}),t)),s)void 0===this[n]&&console.error("Options: options."+n+" key is hidden");switch(this.playerOptions.cameraTarget.init(this.cameraTarget,this,!1),l={timeAlert:"Invalid time fromat: ",controllerTTitle:"Current time."},this.getLanguageCode()){case"ru":l.timeAlert="  : ",l.controllerTTitle=" .";break;default:if(void 0===s.lang||s.lang.languageCode!=languageCode)break;Object.keys(s.lang).forEach(function(e){void 0!==l[e]&&(l[e]=s.lang[e])})}};Ln.findSpriteTextIntersection=function(e){var t;return e.children.forEach(function(e){"Sprite"===e.type&&e.name===Ln.findSpriteTextIntersection.spriteTextIntersectionName&&(t=e)}),t},Ln.findSpriteTextIntersection.spriteTextIntersectionName="spriteTextIntersection";X=function e(){var l;S(this,e),this.onIntersection=function(e,t,n,o,r){var i,a,s=r.domElement;void 0!==e.object.userData.isInfo&&!e.object.userData.isInfo()||(void 0===(i=Ln.findSpriteTextIntersection(n))?((a=(t=new Ln(t)).spriteText.rect?JSON.parse(JSON.stringify(t.spriteText.rect)):{}).displayRect=!0,a.backgroundColor="rgba(0, 0, 0, 1)",(i=Sn.getTextIntersection(e,{scales:t.scales,spriteOptions:{textHeight:t.spriteText.textHeight,fontColor:t.spriteText.fontColor,rect:a,group:n,center:{camera:o,canvas:s}}})).scale.divide(n.scale),n.add(i),void 0===l&&(l=r.domElement.style.cursor),r.domElement.style.cursor="pointer"):i.position.copy(e.point))},this.onIntersectionOut=function(e,t){var n=!1;do{var o=Ln.findSpriteTextIntersection(e)}while(void 0!==o&&(e.remove(o),n&&console.error("Duplicate spriteTextIntersection"),n=!0),void 0!==o);t.domElement.style.cursor=l},this.onMouseDown=function(e,t){void 0!==e.object.userData.isInfo&&!e.object.userData.isInfo()||(t.guiSelectPoint?t.guiSelectPoint.select(e):t.axesHelper&&t.axesHelper.exposePosition(e))};var d,a=[];function t(o,r){var i,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};S(this,t);var e=Le.THREE,s=new e.Vector2,l=[],c=new e.Raycaster,u=a.options||{};c.params.Points.threshold=void 0!==a.threshold?a.threshold:.03,c.setStereoEffect&&c.setStereoEffect({options:a.options,renderer:r,camera:o,scene:a.scene,stereoEffect:u.stereoEffect,raycasterEvents:!1}),window.addEventListener("mousemove",function(e){var t,n;void 0===c.stereo?(Ln.raycaster.EventListeners.getRendererSize(r).getMousePosition(s,e),c.setFromCamera(s,o),(d=c.intersectObjects(l))&&(0===d.length?i&&(i.userData.raycaster&&i.userData.raycaster.onIntersectionOut?i.userData.raycaster.onIntersectionOut():Ln.raycaster.onIntersectionOut(a.scene,r),i=void 0):((n=(t=d[0]).object).userData.raycaster&&n.userData.raycaster.onIntersection?n.userData.raycaster.onIntersection(t,s):Ln.raycaster.onIntersection(t,u,a.scene,o,r),i=n))):c.stereo.onDocumentMouseMove(e)},!1),window.addEventListener("pointerdown",function(e){var t;void 0!==c&&d&&0<d.length&&((t=d[0]).object.userData.raycaster&&t.object.userData.raycaster.onMouseDown?t.object.userData.raycaster.onMouseDown(t):Ln.raycaster.onMouseDown(t,u))},!1),this.addParticle=function(e){var t;e.userData.boFrustumPoints||(c.stereo?c.stereo.addParticle(e):(t=e,l.includes(t)?console.error('Duplicate particle "'+e.name+'"'):l.push(e)))}}this.intersectionsInOut=function(e,t,o,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};return void 0!==e&&(d=Array.isArray(e)?t.intersectObjects(e):t.intersectObject(e)),d.forEach(function(t){var n=!1;a.forEach(function(e){e.object===t.object&&(n=!0)}),n||a.push(t),t&&t.object.userData.raycaster&&t.object.userData.raycaster.onIntersection?t.object.userData.raycaster.onIntersection(t,r):i.scene?Ln.raycaster.onIntersection(t,i.options,i.scene,i.camera,o):console.error("THREE.Raycaster.setStereoEffect(): settings.scene = "+i.scene)}),a.forEach(function(t){var n=!1;d.forEach(function(e){t.object===e.object&&(n=!0)}),n||(t.object.userData.raycaster&&t.object.userData.raycaster.onIntersectionOut?t.object.userData.raycaster.onIntersectionOut():i.scene&&Ln.raycaster.onIntersectionOut(i.scene,o),a.splice(a.findIndex(function(e){return e===t}),1))}),d},this.EventListeners=(b(t,null,[{key:"getRendererSize",value:function(e,t){(t=t||e.domElement).style.position,t.style.left,t.style.top,t.style.width,t.style.height;var t=t.getBoundingClientRect(),n=Math.round(t.left),o=Math.round(t.top),r=new Le.THREE.Vector2;return e.getSize(r),{getMousePosition:function(e,t){e.x=t.clientX/r.x*2-1-n/r.x*2,e.y=2*-(t.clientY/r.y)+1+o/r.y*2}}}}]),t)};Ln.raycaster=new X;
/**
 * @module Player
 * @description 3D objects animation.
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
var Rn,Nn=function n(o){var f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};S(this,n),Bn(),!f.options&&f.frustumPoints&&(f.options=f.frustumPoints.getOptions()),f.options=f.options||new Ln;var r,i,u,a,s,d,l,h=f.options;function t(e){e=e||0;var t=i.getTime();n.selectPlayScene(o,{t:t,index:e,options:f.options}),i.setIndex(e,(""===h.playerOptions.name?"":h.playerOptions.name+": ")+t),f.onSelectScene&&f.onSelectScene(e,t),h.frustumPoints&&h.frustumPoints.updateCloudPoints()}function e(){h.player.controllers.forEach(function(e){e.onRenamePlayButtons&&e.onRenamePlayButtons(u)})}function c(){u=!1,e(),a=void 0}function p(){if(r++,null!==h.playerOptions.max&&r>=h.playerOptions.marks){if(!h.playerOptions.repeat)return r=h.playerOptions.marks-1,void c();r=0}(-1===r||r===h.playerOptions.marks&&null!==h.playerOptions.max)&&(r=0),t(r)}function m(e){"ru"===e()&&(d.prevSymbolTitle=" ",d.playTitle="",d.nextSymbolTitle=" ",d.pauseTitle="",d.repeatOn=" ",d.repeatOff="  ",d.controllerTitle=" .",d.stereoEffects=" ",d.mono="",d.sideBySide=" ",d.topAndBottom=" ")}function g(e){S(this,g);var r,i,a=h.player,t=h.getLanguageCode;if(a.createControllersButtons(h),!(e=e||h.dat.gui)||!1===h.dat.playController){var n=v(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,{}));return v(n)}function s(e,t,n){var o=document.createElement("span");return o.innerHTML=e,o.title=t,o.style.cursor="pointer",o.style.margin="0px 2px",o.onclick=n,o}m(t);var l="rgb(255,255,255)",c="rgb(128,128,128)",n=v(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,{playRate:1,property:function(){var e,t,n,o={};return r=function(e,t){o.buttonPlay.innerHTML=e,o.buttonPlay.title=t},o.buttonPrev=s(d.prevSymbol,d.prevSymbolTitle,a.prev),o.buttonPlay=s(u?d.pause:d.playSymbol,u?d.pauseTitle:d.playTitle,a.play3DObject),null!==a.getSettings().options.playerOptions.max&&(i=e=function(e){var t,n=e?(t=d.repeatOff,l):(t=d.repeatOn,c);o.buttonRepeat.title!==t&&(o.buttonRepeat.title=t,o.buttonRepeat.style.color=n,a.onChangeRepeat(e))},n=a.getSettings().repeat?(t=d.repeatOff,l):(t=d.repeatOn,c),o.buttonRepeat=s(d.repeat,t,function(){e(o.buttonRepeat.title===d.repeatOn)}),o.buttonRepeat.style.color=n),o.buttonNext=s(d.nextSymbol,d.nextSymbolTitle,a.next),o}},"playRate"));return(a.PlayController=n).lang=d,n.onRenamePlayButtons=function(e){var t,e=e?(t=d.pause,d.pauseTitle):(t=d.playSymbol,d.playTitle);r(t,e,!0)},n.onChangeRepeat=function(){i(a.getSettings().options.playerOptions.repeat)},a.pushController(n),n.setValue=function(e){this._controller.domElement.childNodes[0].value=e},e.add(n).__truncationSuspended=!0,v(n)}function _(){if(l)return l.querySelector("#sliderPosition")}h.boOptions?!1!==h.player&&(h.boPlayer=h.boPlayer||!1,h.player?console.error("Player: duplicate player."):(h.player=this,f.cameraTarget=f.cameraTarget||{},setTimeout(function(){t()},0),r=0,(i=this).getTime=function(){var e=h.playerOptions,t=e.min+r*e.dt;return isNaN(t)&&console.error("Player.getTime(): t = "+t),null!==e.max&&t>e.max&&console.error("Player.getTime(): t = "+t+" playerOptions.max = "+e.max),t<e.min&&null!==e.max&&console.error("Player.getTime(): t = "+t+" playerOptions.min = "+e.min),t},this.setTime=function(e){return this.selectScene(parseInt((e-h.playerOptions.min)/h.playerOptions.dt))},this.selectScene=function(e){if(void 0===e)return t(r),!0;if(isNaN(e))return console.error("Player.selectScene: index = "+e),!1;for(e=parseInt(e),null!==h.playerOptions.max&&(e>=h.playerOptions.marks?e=0:e<0&&(e=h.playerOptions.marks-1),r>h.playerOptions.marks&&(r=h.playerOptions.marks));r!==e;)r<e?r++:r--,t(r);return!0},this.next=function(){i.selectScene(r+1)},this.prev=function(){i.selectScene(r-1)},this.pushController=function(e){void 0!==e.object&&void 0!==e.object.playRate&&(e.object.playRate=h.playerOptions.min),this.controllers.push(e)},u=!(this.controllers=[]),this.play3DObject=function(){u?c():(u=!0,null!==h.playerOptions.max&&r>=h.playerOptions.marks-1&&(r=0),p(),e(),window.requestAnimationFrame(function e(t){if(u?window.requestAnimationFrame(e):a=void 0,void 0===a&&(s=(a=t)+1e3/h.playerOptions.interval),!isNaN(s)&&s!==1/0||(console.error("Player.animate: timeNext = "+s),u=!1),!(t<s)){for(;s<t;)s+=1e3/h.playerOptions.interval;p()}}))},this.repeat=function(){h.playerOptions.repeat=!h.playerOptions.repeat,this.onChangeRepeat(h.playerOptions.repeat)},this.getSettings=function(){return f},this.getSelectSceneIndex=function(){return r},this.onChangeRepeat=function(e){h.playerOptions.repeat=e,this.controllers.forEach(function(e){e.onChangeRepeat&&e.onChangeRepeat()})},d={prevSymbol:"",prevSymbolTitle:"Go to previous animation scene",nextSymbol:"",nextSymbolTitle:"Go to next animation scene",playSymbol:"",playTitle:"Play",pause:"",pauseTitle:"Pause",repeat:"",repeatOn:"Turn repeat on",repeatOff:"Turn repeat off",controllerTitle:"Current time.",stereoEffects:"Stereo effects",mono:"Mono",sideBySide:"Side by side",topAndBottom:"Top and bottom"},this.localization=function(){return m(0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return"en"}),d},this.PlayController=(y(g,Qt.CustomController),b(g,[{key:"controller",set:function(e){this._controller=e,this._controller.onChange(function(e){h.player.setTime(e)}),this._controller.domElement.title=this.lang.controllerTitle},get:function(){return this._controller}}]),g),this.gui=function(e){var r,i,t,n,a,o=h.dat.cookie,s=h.dat.getCookieName("Player"),l=h.getLanguageCode,c=Le.dat;function u(){null===h.playerOptions.max?h.playerOptions.dt=h.playerOptions.dt||.1:h.playerOptions.dt=(h.playerOptions.max-h.playerOptions.min)/(h.playerOptions.marks-1)}function d(){u(),o.setObject(s,h.playerOptions),f.onChangeScaleT&&f.onChangeScaleT(h.playerOptions)}function p(){null!==h.playerOptions.max&&(h.playerOptions.max=h.playerOptions.min+h.playerOptions.dt*(h.playerOptions.marks-1))}(e=e||h.dat.gui)&&!1!==h.dat.playerGui&&(p(),r=JSON.parse(JSON.stringify(h.playerOptions)),i=function(t){var e={player:"Player",playerTitle:"3D objects animation.",min:"Min",max:"Max",dt:"Step",dtTitle:"Time between frames",marks:"Frames",marksTitle:"Player frames count",interval:"Rate",intervalTitle:"Rate of changing of animation scenes per second.",time:"Time",defaultButton:"Default",defaultTitle:"Restore default player settings."},n=void 0===(t=t||{}).getLanguageCode?"en":t.getLanguageCode();switch(n){case"ru":e.player="",e.playerTitle=" 3D .",e.min="",e.max="",e.dt="",e.dtTitle="  ",e.marks="",e.marksTitle="  ",e.interval="",e.intervalTitle="    .",e.time="",e.defaultButton="",e.defaultTitle="    .";break;default:if(void 0===t.lang||t.lang._languageCode!=n)break;Object.keys(t.lang).forEach(function(e){void 0!==_lang[e]&&(_lang[e]=t.lang[e])})}return e}({getLanguageCode:l}),Object.freeze(r),t=h.playerOptions.max,n=h.playerOptions.marks,o.getObject(s,h.playerOptions,h.playerOptions),null!==t&&t!==1/0&&null!==h.playerOptions.max||(h.playerOptions.max=t,h.playerOptions.marks=n),a=e.addFolder(i.player),c.folderNameAndTitle(a,i.player,i.playerTitle),function(){var n=h.playerOptions,o={};function e(e,t){e=e.controller.getValue();n.min=t(n.min,e),o.min.setValue(n.min),n.max&&(n.max=t(n.max,e),u(),o.max.setValue(n.max)),d()}o.folder=a.addFolder(""!==n.name?n.name:i.time),o.scaleController=o.folder.add(new Re(e,{settings:f.options.playerOptions,getLanguageCode:l})).onChange(function(e){n.zoomMultiplier=e,d()});var t=new Me(function(n){e(t,function(e,t){return e+=n})},{settings:f.options.playerOptions,getLanguageCode:l});o.positionController=o.folder.add(t).onChange(function(e){n.offset=e,d()}),o.min=c.controllerZeroStep(o.folder,n,"min",function(e){d()}),c.controllerNameAndTitle(o.min,i.min),p(),null!==n.max?(o.max=c.controllerZeroStep(o.folder,n,"max",function(e){d()}),c.controllerNameAndTitle(o.max,i.max)):(o.dt=c.controllerZeroStep(o.folder,n,"dt",function(e){d()}),c.controllerNameAndTitle(o.dt,i.dt,i.dtTitle)),n.marks&&(o.marks=o.folder.add(n,"marks").onChange(function(e){n.marks=parseInt(n.marks),d();var t=_();t&&(t.max=h.playerOptions.marks-1)}),c.controllerNameAndTitle(o.marks,void 0===n.marksName?i.marks:n.marksName,(void 0===n.marksTitle?i:n).marksTitle)),o.interval=o.folder.add(f.options.playerOptions,"interval",1,25,1).onChange(function(e){d()}),c.controllerNameAndTitle(o.interval,i.interval,i.intervalTitle),c.controllerNameAndTitle(o.folder.add({defaultF:function(){n.zoomMultiplier=r.zoomMultiplier,o.scaleController.setValue(n.zoomMultiplier),n.offset=r.offset,o.positionController.setValue(n.offset),n.min=r.min,o.min.setValue(n.min),o.max&&(n.max=r.max,u(),o.max.setValue(n.max)),o.dt&&(n.dt=r.dt,o.dt.setValue(n.dt)),r.marks&&(n.marks=r.marks,o.marks&&o.marks.setValue(n.marks)),n.interval=r.interval,o.interval.setValue(n.interval),d()}},"defaultF"),i.defaultButton,i.defaultTitle)}())},this.createControllersButtons=function(t){var e,n,o;t.controllers&&t.controllers.player&&(null===(e=t.controllers.player).buttonPrev&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonPrev = "+e.buttonPrev),e.buttonPrev&&(null===(n="string"==typeof e.buttonPrev?document.getElementById(e.buttonPrev):e.buttonPrev)&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonPrev = "+e.buttonPrev),n&&(n.value=d.prevSymbol,n.title=d.prevSymbolTitle,n.onclick=function(e){t.player&&t.player.prev()},e.buttonPrev=n)),null===e.buttonPlay&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonPlay = "+e.buttonPlay),e.buttonPlay&&(null===(o="string"==typeof e.buttonPlay?document.getElementById(e.buttonPlay):e.buttonPlay)&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonPlay = "+e.buttonPlay),o&&(o.value=u?d.pause:d.playSymbol,o.title=u?d.pauseTitle:d.playTitle,o.onclick=function(e){t.player&&t.player.play3DObject()},e.buttonPlay=o)),null===e.buttonNext&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonNext = "+e.buttonNext),e.buttonNext&&(null===(o="string"==typeof e.buttonNext?document.getElementById(e.buttonNext):e.buttonNext)&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonNext = "+e.buttonNext),o&&(o.value=d.nextSymbol,o.title=d.nextSymbolTitle,o.onclick=function(e){t.player&&t.player.next()},e.buttonNext=o)))},this.createCanvasMenuItem=function(o){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return"en"},t=this,n=(l=o).menu,r=t.localization(e);n.push({name:r.prevSymbol,title:r.prevSymbolTitle,onclick:function(){t.prev()}}),n.push({name:u?r.pause:r.playSymbol,title:u?r.pauseTitle:r.playTitle,id:"menuButtonPlay",onclick:function(){t.play3DObject()}}),null!==h.playerOptions.max&&n.push({name:r.repeat,title:this.getSettings().repeat?r.repeatOff:r.repeatOn,id:"menuButtonRepeat",onclick:function(){t.repeat()}}),n.push({name:r.nextSymbol,title:r.nextSymbolTitle,onclick:function(){t.next()}}),this.controllers.push({onRenamePlayButtons:function(e){var t,n=e?(t=r.pause,r.pauseTitle):(t=r.playSymbol,r.playTitle),e=o.querySelector("#menuButtonPlay");e.innerHTML=t,e.title=n,h.controllers&&h.controllers.player&&h.controllers.player.buttonPlay&&(h.controllers.player.buttonPlay.value=t,h.controllers.player.buttonPlay.title=n)},onChangeRepeat:function(){o.querySelector("#menuButtonRepeat").title=h.playerOptions.repeat?r.repeatOff:r.repeatOn}})},this.addSlider=function(){null!==h.playerOptions.max&&l.menu.push({name:'<input type="range" min="0" max="'+(h.playerOptions.marks-1)+'" value="0" class="slider" id="sliderPosition">',style:"float: right;"})},this.addSliderEvents=function(){var t,n,o=_();return o&&(o.onchange=function(e){n.selectScene(parseInt(o.value))},o.oninput=function(e){n.selectScene(parseInt(o.value))},n=this,o.addEventListener("pointerdown",function(e){t=!0}),o.addEventListener("pointerup",function(e){t=!1}),o.addEventListener("mousemove",function(e){t&&n.selectScene((h.playerOptions.marks-1)*e.offsetX/o.clientWidth)})),o},this.setIndex=function(e,t){var n=this.getTime();h.controllers&&h.controllers.t&&(h.controllers.t.controller.value=n),"object"===x(this.PlayController)&&this.PlayController.setValue(n);n=_();n&&(n.value=e,n.title=t)},this.onChangeScale=function(e){_().max=e.marks-1,this.selectScene(0)})):console.error("Player: call options = new Options( options ) first")};Nn.cameraTarget=function e(){S(this,e);var r,o={boLook:!1},t={boLook:o.boLook,getDistanceToCamera:function(){return void 0!==this.distanceToCameraCur?this.distanceToCameraCur:this.distanceToCamera}};o.rotation={};var i,a=(t.rotation={},!1),n=!1;function s(e){Bn(),e=e||o,t.boMaual||(void 0!==e.boLook?t.boLook=e.boLook:t.boLook=o.boLook),o.camera=o.camera||e.camera,t.camera=e.camera||o.camera,t.distanceToCamera=e.distanceToCamera||o.distanceToCamera||t.distanceToCamera||(new jn.Vector3).copy(o.camera.position),e.rotation||(e.rotation={}),void 0!==e.rotation.angle?t.rotation.angle=e.rotation.angle:t.rotation.angle=o.rotation.angle||0,t.rotation.axis=e.rotation.axis||o.rotation.axis||new jn.Vector3(0,1,0)}this.get=function(e){if(e||r?r&&e&&!Object.is(r,e)&&console.error("Player.cameraTarget.get: options is ambiguous"):console.error("Player.cameraTarget.get: options = "+e),r=r||e,t.camera||n||!r.player||(o.camera=r.player.getSettings().cameraTarget.camera,o.camera&&s(),n=!0),t.camera)return t},this.init=function(e,t){var n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];if(e){if(t||r?r&&t&&!Object.is(r,t)&&console.error("Player.cameraTarget.init: options is ambiguous"):console.error("Player.cameraTarget.init: options = "+t),r=r||t,!1!==e.bodefault){if(a)return;void 0!==e.boLook&&(o.boLook=e.boLook,i=e.boLook)}else{if(!0!==e.boLook)return;a&&console.warn("playerCameraTarget().init(...): duplicate target point"),a=!0,void 0===i&&(o.boLook=!0)}o.camera=o.camera||e.camera||(r.player?r.player.getSettings().cameraTarget.camera:void 0),o.camera||!n?(o.distanceToCamera=o.distanceToCamera||e.distanceToCamera,e.rotation=e.rotation||{},o.rotation.angle=o.rotation.angle||e.rotation.angle,o.rotation.axis=o.rotation.axis||e.rotation.axis,s(e)):console.error("playerCameraTarget().init(...): cameraTargetDefault.camera = "+o.camera)}},this.changeTarget=function(e,t,n){Bn();var o=e.userData.player&&"function"!=typeof e.userData.player.arrayFuncs?e.userData.player.arrayFuncs[t]:{};o.cameraTarget||(o.cameraTarget={boLook:!1}),s(o.cameraTarget),(n=(r=r||n).playerOptions.cameraTarget.get(r))&&(n&&n.boLook?(e=en(e,(new jn.Vector3).fromArray(e.geometry.attributes.position.array,t*e.geometry.attributes.position.itemSize)),n.target=e):delete n.target)},this.setCameraTarget=function(n){Bn();var e,t,o,r=n.playerOptions.cameraTarget.get(n),i=(r=r||r||{}).camera;i&&(r.distanceToCamera||(r.distanceToCamera=(new jn.Vector3).copy(i.position)),r.distanceToCameraCur||(r.distanceToCameraCur=new jn.Vector3),e=n.time,t=r.distanceToCamera,o=(new jn.Vector3).copy(r.distanceToCameraCur),r.distanceToCameraCur.set(Nn.execFunc(t,"x",e,n),Nn.execFunc(t,"y",e,n),Nn.execFunc(t,"z",e,n)),r.setCameraPosition||(r.setCameraPosition=function(){var e=r.target;if(r.boLook&&(e||!r.distanceToCameraCur.equals(o))){o.copy(r.distanceToCameraCur);var t=n.time;if(i.position.copy(r.distanceToCameraCur),i.position.applyAxisAngle(r.rotation.axis,Nn.execFunc(r.rotation,"angle",t,n)),!e){if(!Nn.orbitControls)return;e=Nn.orbitControls.target}i.position.add(e),i.lookAt(e),n.orbitControls&&(n.orbitControls.target.equals(e)||(n.orbitControls.target.copy(e),n.orbitControlsGui&&n.orbitControlsGui.setTarget(e)),n.orbitControls._listeners&&n.orbitControls._listeners.change[0]())}}),n.cameraGui&&n.cameraGui.update())}},Nn.execFunc=function(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},r=e[t],i=o.a,a=o.b,s=void 0===r?"undefined":x(r);switch(void 0===n&&(n=o.playerOptions?o.playerOptions.min:0),s){case"undefined":return;case"number":return r;case"string":r=new Function("t","a","b","return "+r);case"function":try{var l=r(n,i,a);if(void 0===l)throw"function returns "+l;if(!Array.isArray(l))return l;r=l}catch(e){throw console.error(e),e}case"object":if(Array.isArray(r)){var c=function(e){return"function"==typeof u[e]?u[e](n,u,a):u[e]instanceof jn.Color?u[e]:void 0};if(0===r.length)return void console.error('Player.execFunc: funcs["'+t+'"] array is empty');for(var u=r,d=r.length-1,p=null===o.playerOptions.max?1/0:o.playerOptions.max,f=o.playerOptions.min,h=(p-f)/d,m=f,g=p,_=0,b=d,y=0;y<r.length;y++)h*y+f<n&&(m=h*(_=y)+f,g=h*(b=y+1)+f);if("number"!=typeof u[_]){if("w"===t)return c(_);if("object"!==x(u[_]))return void console.error('Player.execFunc: funcs["'+t+'"] array item '+_+" typeof = "+x(u[_])+" is not number");for(y=0;y<r.length;y++){if(y===r.length-1)return u[y].v;if(b=(_=y)+1,m=u[_].t,g=u[b].t,m<=n&&n<g){var v=(u[b].v-u[_].v)/(g-m),w=u[_].v-v*m;return v*n+w}}return void console.error("Player.execFunc: value is not detected")}if(b>=r.length&&(b=_),"number"!=typeof u[b]){if("w"===t)return c(b);if("object"!==x(u[b]))return void console.error('Player.execFunc: funcs["'+t+'"] array item '+b+" typeof = "+x(u[b])+" is not number")}v=(u[b]-u[_])/(g-m),w=u[_]-v*m;return(isNaN(v)||isNaN(w))&&console.error("Player.execFunc: invalid x = "+v+" or y = "+w),v*n+w}return r.func?r.func instanceof Function?r.func(n,i,a):r.func:("w"!==t&&console.error('Player.execFunc: funcs["'+t+'"] object is not array'),r);default:console.error('Player.execFunc: Invalud typeof funcs["'+t+'"]: '+s)}};var Mn=new function e(){function t(n){function e(e){var t=n+e;return{get controllerId(){return this.boUsed?void 0:t},get elController(){return document.getElementById(this.controllerId)},nameId:t+"Name",get elName(){return document.getElementById(this.nameId)}}}return{func:e("Func"),position:e("Position"),worldPosition:e("WorldPosition")}}S(this,e),this.x=t("x"),this.y=t("y"),this.z=t("z"),this.w=t("w")};Nn.selectMeshPlayScene=function(f){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};Bn();var t,h=e.t,m=e.options||{dat:!1},m=new Ln(m);function g(e,t,n,o){if(m.palette&&(o=m.palette.toColor(e,m.scales.w.min,m.scales.w.max)),o){!t.material instanceof jn.ShaderMaterial&&t.material.vertexColors!==jn.VertexColors&&console.error("Player.selectMeshPlayScene: Please set the vertexColors parameter of the THREE.PointsMaterial of your points to THREE.VertexColors. Example: vertexColors: THREE.VertexColors");var r=t.geometry.attributes,e=t.userData.player.arrayFuncs;return!Nn.setColorAttribute(r,n,o)&&e[n]instanceof jn.Vector4&&(t.userData.player&&e?(t.geometry.setAttribute("color",new jn.Float32BufferAttribute(Nn.getColors(e,{positions:r.position,options:m}),4)),Nn.setColorAttribute(r,n,o)||console.error('Player.selectMeshPlayScene: the color attribute is not exists. Please use THREE.Vector3 instead THREE.Vector4 in the arrayFuncs or add "color" attribute')):console.error("Player.selectMeshPlayScene: set color attribute failed. Invalid mesh.userData.player.arrayFuncs")),o}}void 0===h&&(h=m.playerOptions.min),m.scales.setW(),!f.userData.player||m&&m.boPlayer&&f.userData.boFrustumPoints||(f.geometry&&(delete f.geometry.boundingSphere,f.geometry.boundingSphere=null),f.userData.player.selectPlayScene&&(t=function(e){for(;f.rotation[e]<0;)f.rotation[e]+=2*Math.PI;for(;f.rotation[e]>2*Math.PI;)f.rotation[e]-=2*Math.PI},f.userData.player.selectPlayScene(h),t("x"),t("y"),t("z")),function(n,r){if(f.geometry){var i,a,s=f.geometry.attributes,l=f.userData.player.arrayFuncs;if(void 0!==l){void 0===h&&console.error("setPosition: t = "+h),m&&void 0!==m.scales.w?(i=m.scales.w.min,a=m.scales.w.max):i=(a=d)-1;for(var c,u,d,p=0;p<l.length;p++)!function(){function e(e,t){e=Nn.execFunc(c,e,h,m);void 0!==e&&(s.position[t](p,e),u=!0)}c=l[p],u=!1,e("x","setX"),e("y","setY"),e("z","setZ"),e("w","setW");var o=void 0;function t(){if(f.userData.player.palette)o=f.userData.player.palette.toColor(d,i,a);else{if(!m.palette){var e=255,t=255,n=255;return o=new jn.Color("rgb("+e+", "+t+", "+n+")")}o=m.palette.toColor(d,i,a)}}"function"==typeof c.w?(d=c.w(h,n,r),a=m.scales.w?(i=m.scales.w.min,m.scales.w.max):(console.warn("Player.selectMeshPlayScene:     "),i=0,100),4<=s.position.itemSize&&s.position.setW(p,d),u=!0,t()):"object"===x(c.w)&&(c.w instanceof jn.Color?o=c.w:(d=Nn.execFunc(c,"w",h,m),void 0!==c.w.min&&(i=c.w.min),void 0!==c.w.max&&(a=c.w.max),t())),o=g(void 0===c.w?(new jn.Vector4).w:"number"==typeof c.w?c.w:Nn.execFunc(c,"w",h,m),f,p,o),u&&(s.position.needsUpdate=!0),c.trace&&!c.line&&(c.line=new Nn.traceLine(m),c.trace=!1),c.line&&c.line.addPoint&&c.line.addPoint(f,p,o),c.cameraTarget&&!0===c.cameraTarget.boLook&&m.playerOptions.cameraTarget.changeTarget(f,p,m)}()}}}(m?m.a:1,m?m.b:0),t="Player.selectMeshPlayScene: invalid mesh.scale.",f.scale.x<=0&&console.error(t+"x = "+f.scale.x),f.scale.y<=0&&console.error(t+"y = "+f.scale.y),f.scale.z<=0&&console.error(t+"z = "+f.scale.z),f.userData.player&&f.userData.player.arrayFuncs&&f.userData.player.arrayFuncs instanceof Array&&f.userData.player.arrayFuncs.forEach(function(i,a){if(i.controllers){var s=function(e,t){var n="x"===t?0:"y"===t?1:"z"===t?2:"w"===t?3:void 0;"w"===t&&(g(e,f,a),m.guiSelectPoint&&m.guiSelectPoint.update());var o=n+f.geometry.attributes.position.itemSize*a,r=f.geometry.attributes.position.array[o];f.geometry.attributes.position.array[o]=e;n=i.controllers[t];if(isNaN(f.geometry.attributes.position.array[o])){alert(Rn.positionAlert+e);e=n.position.controller;return e.focus(),e.value=r,void(f.geometry.attributes.position.array[o]=r)}f.geometry.attributes.position.needsUpdate=!0,m.axesHelper&&m.axesHelper.updateAxes(),m.guiSelectPoint&&m.guiSelectPoint.update(),n.worldPosition&&n.worldPosition.controller&&(n.worldPosition.controller.innerHTML=tn(f,a)[t])},e=function(o){var t,r=i.controllers[o];function e(e){Mn[o][e].elController&&(r[e]||(Mn[o][e].boUsed?console.warn('Player.selectMeshPlayScene createControllers: Same controller is using for different points. Controller ID is "'+Mn[o][e].controllerId+'""'):(r[e]={controller:Mn[o][e].elController,elName:Mn[o][e].elName||!1},Mn[o][e].boUsed=!0,e===t&&"w"===o&&(r[e].elSlider=!0))))}!1!==r&&(t="position",!r&&(Mn[o].func.elController||Mn[o].position.elController||Mn[o].worldPosition.elController)&&(r={},i.controllers[o]=r),r&&(e("func"),e(t),e("worldPosition"),Pn(r.func,Mn[o].func.controllerId,function(){return m.scales[o].name+" = f(t)"},{value:i[o],title:"x"===o?Rn.controllerXFunctionTitle:"y"===o?Rn.controllerYFunctionTitle:"z"===o?Rn.controllerZFunctionTitle:"w"===o?Rn.controllerWFunctionTitle:"",onchange:function(t){try{i[o]=t.currentTarget.value;var e,n=Nn.execFunc(i,o,m.player.getTime(),m);r.position&&r.position.controller?((e=r.position.controller).onchange({currentTarget:{value:n}}),e.value=n):s(n,o),m.guiSelectPoint&&m.guiSelectPoint.update()}catch(e){alert("Axis: "+m.scales[o].name+'. Function: "'+i[o]+'". '+e),t.currentTarget.focus()}}}),Pn(r.position,o+"Position",function(){return m.scales[o].name},{value:n[o],title:"x"===o?Rn.controllerXTitle:"y"===o?Rn.controllerYTitle:"z"===o?Rn.controllerZTitle:"w"===o?Rn.controllerWTitle:"",onchange:function(e){s(e.currentTarget.value,o)},axisName:o}),Pn(r.worldPosition,o+"WorldPosition",function(){return Rn.controllerWorld+" "+m.scales[o].name},{value:en(f,n)[o],title:"x"===o?Rn.controllerXWorldTitle:"y"===o?Rn.controllerYWorldTitle:"z"===o?Rn.controllerZWorldTitle:"w"===o?Rn.controllerWTitle:""})))};if(!Rn)switch(Rn={controllerXTitle:"X position",controllerYTitle:"Y position",controllerZTitle:"Z position",controllerWTitle:"color index",controllerWorld:"World",controllerXWorldTitle:"X world position",controllerYWorldTitle:"Y world position",controllerZWorldTitle:"Z world position",controllerWWorldTitle:"color index",controllerXFunctionTitle:"X = f(t)",controllerYFunctionTitle:"Y = f(t)",controllerZFunctionTitle:"Z = f(t)",controllerWFunctionTitle:"W = f(t)",positionAlert:"Invalid position fromat: "},m.getLanguageCode()){case"ru":Rn.controllerXTitle=" X",Rn.controllerYTitle=" Y",Rn.controllerZTitle=" Z",Rn.controllerWTitle=" ",Rn.controllerWorld="",Rn.controllerXWorldTitle="  X",Rn.controllerYWorldTitle="  Y",Rn.controllerZWorldTitle="  Z",Rn.controllerWWorldTitle=" ",Rn.positionAlert="   : ";break;default:if(void 0===m.lang||m.lang.languageCode!=languageCode)break;Object.keys(m.lang).forEach(function(e){void 0!==Rn[e]&&(Rn[e]=m.lang[e])})}var t,n=$t(f,a);i.name&&(i.controllers.pointName||(i.controllers.pointName="pointName"),(t="string"==typeof i.controllers.pointName?document.getElementById(i.controllers.pointName):i.controllers.pointName)&&(t.innerHTML=i.name)),e("x"),e("y"),e("z"),e("w")}}),m&&m.guiSelectPoint?(m.guiSelectPoint.setMesh(),-1!==(t=m.guiSelectPoint.getSelectedPointIndex())&&m.guiSelectPoint.isSelectedMesh(f)&&m.guiSelectPoint.setPosition({object:f,index:t})):m.axesHelper&&m.axesHelper.movePosition())},Nn.setColorAttribute=function(e,t,n){"string"==typeof n&&(n=new jn.Color(n));e=e.color||e.ca;return void 0!==e&&(e.setX(t,n.r),e.setY(t,n.g),e.setZ(t,n.b),e.needsUpdate=!0)},Nn.getPoints=function(t,n){Bn(),Array.isArray(t)||(t=[t]),void 0===(n=n||{}).t&&(n.t=n.options&&n.options.player?n.options.player.getSettings().options.playerOptions.min:0);var o=n.options||new Ln,e=new Ln({palette:o.palette});o.setW(e);for(var r=e.scales.w.max,i=0;i<t.length;i++){var a=t[i];Array.isArray(a)?t[i]=new jn.Vector4(void 0===a[0]?0:a[0],void 0===a[1]?0:a[1],void 0===a[2]?0:a[2],void 0===a[3]?r:a[3]):"object"===(void 0===a?"undefined":x(a))&&a instanceof jn.Vector2==!1&&a instanceof jn.Vector3==!1&&a instanceof jn.Vector4==!1&&(void 0===a.vector?t[i]=new jn.Vector4(void 0===a.x?0:a.x,void 0===a.y?0:a.y,void 0===a.z?0:a.z,void 0===a.w?0:a.w):a.vector instanceof jn.Vector2==!0||a.vector instanceof jn.Vector3==!0||a.vector instanceof jn.Vector4==!0?a.vector instanceof jn.Vector2==!0&&(t[i].vector=new jn.Vector3(void 0===a.vector.x?0:a.vector.x,void 0===a.vector.y?0:a.vector.y,void 0===a.vector.z?0:a.vector.z)):4===a.vector.length?t[i].vector=new jn.Vector4(void 0===a.vector[0]?0:a.vector[0],void 0===a.vector[1]?0:a.vector[1],void 0===a.vector[2]?0:a.vector[2],void 0===a.vector[3]?0:a.vector[3]):3===a.vector.length?t[i].vector=new jn.Vector3(void 0===a.vector[0]?0:a.vector[0],void 0===a.vector[1]?0:a.vector[1],void 0===a.vector[2]?0:a.vector[2]):a.vector.length<3?t[i].vector=new jn.Vector4(void 0===a.vector[0]?0:a.vector[0],void 0===a.vector[1]?0:a.vector[1]):console.error("Player.getPoints(...) falied! item.vector.length = "+a.vector.length))}for(var s=[],i=0;i<t.length;i++){var l=function(e){return"number"==typeof c&&(c=new jn.Vector4(c,0,0,0)),c instanceof jn.Vector2||c instanceof jn.Vector3||c instanceof jn.Vector4?Nn.execFunc(c,e,n.t,o):void 0!==c.vector?(void 0!==c.name&&(c.vector.name=c.name),c.trace&&(c.vector.trace=c.trace),c.controllers&&(c.vector.controllers=c.controllers),c.cameraTarget&&(c.vector.cameraTarget=c.cameraTarget,delete c.cameraTarget),t[i]=c.vector,c=c.vector,Nn.execFunc(c,e,n.t,o)):void console.error("Player.getAxis().getPoints(): funcs.vector = "+c.vector)},c=t[i],l=c.vector instanceof jn.Vector3==!0?new jn.Vector3(l("x"),l("y"),l("z")):new jn.Vector4(l("x"),l("y"),l("z"),l("w"));c.cameraTarget&&(c.cameraTarget.bodefault=!1,void 0===c.cameraTarget.boLook&&(c.cameraTarget.boLook=!0),o.playerOptions.cameraTarget.init(c.cameraTarget,o)),s.push(l)}return s};var jn,Hn=!0;function Bn(){Le.isThree()?(jn=Le.THREE,Object.assign(jn.BufferGeometry.prototype,{setFromPoints:function(e,t){t=t||3;for(var n=[],o=0,r=e.length;o<r;o++){var i=e[o];n.push(i.x,i.y,i.z||0),4<=t&&n.push(i.w||0)}return this.setAttribute("position",new jn.Float32BufferAttribute(n,t)),this}}),Object.assign(jn.Vector4.prototype,{multiply:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,void 0!==e.w&&(this.w*=e.w),this}}),Object.assign(jn.Vector4.prototype,{add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,void 0!==e.w&&(this.w+=e.w),this)}}),Object.assign(jn.Points.prototype,{raycast:function(e,t){var n=new jn.Matrix4,l=new jn.Ray,o=new jn.Sphere,r=new jn.Vector3;function i(e,t,n,o,r,i,a){var s=l.distanceSqToPoint(e);s<n&&(n=new jn.Vector3,l.closestPointToPoint(e,n),n.applyMatrix4(o),(o=r.ray.origin.distanceTo(n))<r.near||o>r.far||i.push({distance:o,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:a}))}var a=this.geometry,s=this.matrixWorld,c=e.params.Points.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),o.copy(a.boundingSphere),o.applyMatrix4(s),o.radius+=c,!1!==e.ray.intersectsSphere(o)){n.copy(s).invert(),l.copy(e.ray).applyMatrix4(n);var n=c/((this.scale.x+this.scale.y+this.scale.z)/3),u=n*n;if(a.isBufferGeometry){var c=a.index,n=a.attributes,d=n.position.array,p=n.position.itemSize;if(null!==c)for(var f=c.array,h=0,m=f.length;h<m;h++){var g=f[h];r.fromArray(d,g*p),i(r,g,u,s,e,t,this)}else for(var _=0,b=d.length/p;_<b;_++)r.fromArray(d,_*p),i(r,_,u,s,e,t,this)}else for(var y=a.vertices,v=0,w=y.length;v<w;v++)i(y[v],v,u,s,e,t,this)}}})):console.warn("Player: can not assign. Set THREE first.")}Nn.getColors=function(e,o){if(Bn(),Array.isArray(e)||(e=[e]),(o=o||{}).options=o.options||{},void 0!==o.positions&&Array.isArray(e)&&e.length!==o.positions.count)return console.error("getColors failed! arrayFuncs.length: "+e.length+" != positions.count: "+o.positions.count),o.colors;var t=Array.isArray(e)?e.length:o.positions.count;o.colors=o.colors||[],o.options.palette||o.options.setPalette();for(var r=0;r<t;r++){var n,i,a,s,l,c,u,d=Array.isArray(e)?e[r]:void 0;d instanceof jn.Vector4||o.positions&&4===o.positions.itemSize?(l=i=void 0,a=d.w,d.w instanceof Object&&d.w.func?(d.w.max&&(l=d.w.max),d.w.min&&(i=d.w.min),a=d.w.func):(o.options.setW(),i=o.options.scales.w.min,l=o.options.scales.w.max),a instanceof Function&&!o.options.player&&Hn&&(Hn=!1),s=o.options.playerOptions?o.options.playerOptions.min:0,l=o.options.palette.toColor(void 0===d?(new jn.Vector4).fromBufferAttribute(o.positions,r).w:a instanceof Function?a(s):"string"==typeof a?Nn.execFunc(d,"w",s,o.options):void 0===a?(new jn.Vector4).w:a,i,l),o.colors.push(l.r,l.g,l.b)):o.colors instanceof jn.Float32BufferAttribute?n=new jn.Vector3(1,1,1):o.colors.push(1,1,1),void 0!==o.opacity?(c=0,u=getStandardNormalDistribution(0),group.children.forEach(function(e){if(e.userData.cloud)for(var t=0;t<e.geometry.attributes.position.count;t++){var n=tn(e,t);c+=getStandardNormalDistribution(5*en(camera,(new jn.Vector3).fromBufferAttribute(o.positions,r)).distanceTo(n))/u}}),void 0!==debug.opacity&&(c=debug.opacity),o.colors instanceof jn.Float32BufferAttribute?o.colors.setXYZW(r,n.x,n.y,n.z,c):o.colors.push(c)):o.colors.push(1)}return o.colors},Nn.traceLine=function e(c){var u;S(this,e);var d=[];Bn(),c.player&&(this.isVisible=function(){return!!c.player&&(u?u.visible:0!==d.length&&d[0].visible)},this.visible=function(t){if(!c.player)return!1;u?u.visible=t:d.forEach(function(e){e.visible=t})},this.addPoint=function(e,t,n){var o=e.geometry.attributes.position,r=4<=o.itemSize?new jn.Vector4(0,0,0,0):new jn.Vector3;r.fromArray(o.array,t*o.itemSize);var i=c.player?c.player.getSelectSceneIndex():0;if(null===c.playerOptions.max){if((i=Math.abs(i))<d.length-1){for(;i<d.length-1;)e.remove(d[d.length-1]),d.pop();return}var a=new jn.BufferGeometry,s=new Float32Array(6);a.setAttribute("position",new jn.BufferAttribute(s,3));s=new Float32Array(6);a.setAttribute("color",new jn.Float32BufferAttribute(s,3));s=new jn.Line(a,new jn.LineBasicMaterial({vertexColors:jn.VertexColors}));e.add(s),d[0]&&(s.visible=d[0].visible),r=(new jn.Vector3).copy(r);a=s.geometry.attributes.position.itemSize;return r.toArray(s.geometry.attributes.position.array,+a),(0===d.length?r:(new jn.Vector3).fromArray(d[d.length-1].geometry.attributes.position.array,+a)).toArray(s.geometry.attributes.position.array,0*a),s.geometry.attributes.position.needsUpdate=!0,void 0===n&&(n=new jn.Color(1,1,1)),Nn.setColorAttribute(s.geometry.attributes,0,0===d.length?n:(new jn.Color).fromArray(d[d.length-1].geometry.attributes.color.array,+a)),Nn.setColorAttribute(s.geometry.attributes,1,n),void d.push(s)}if(void 0===u){a=new jn.BufferGeometry;if(null!==c.playerOptions.max)if(c.playerOptions&&c.playerOptions.marks)l=c.playerOptions.marks;else{if(!c.player||!c.player.marks)return void console.error("Player.traceLine: MAX_POINTS = "+l+". Create Player first or remove all trace = true from all items of the arrayFuncs");l=c.player.marks}else l=i+1;s=new Float32Array(3*l);a.setAttribute("position",new jn.BufferAttribute(s,3));var l=new Float32Array(3*l);a.setAttribute("color",new jn.Float32BufferAttribute(l,3)),a.setDrawRange(i,i),(u=new jn.Line(a,new jn.LineBasicMaterial({vertexColors:jn.VertexColors}))).visible=!0,e.add(u)}u.geometry&&(delete u.geometry.boundingSphere,u.geometry.boundingSphere=null),(r=(new jn.Vector3).copy(r)).toArray(u.geometry.attributes.position.array,i*u.geometry.attributes.position.itemSize),u.geometry.attributes.position.needsUpdate=!0,void 0===n&&(n=new jn.Color(1,1,1)),Nn.setColorAttribute(u.geometry.attributes,i,n);r=u.geometry.drawRange.start,n=i+1-r;i<r&&(n=r+u.geometry.drawRange.count-(r=i)),u.geometry.setDrawRange(r,n)},this.remove=function(){void 0!==u&&(u.geometry.dispose(),u.material.dispose(),u.parent.remove(u))})},Nn.getItemSize=function(e){Bn();for(var t=0;t<e.length;t++)if(e[t]instanceof jn.Vector4)return 4;return 3},Nn.selectPlayScene=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=void 0!==t.t?t.t:0,o=void 0!==t.index?t.index:void 0,r=t.options||new Ln;e.userData.t=n,Nn.selectMeshPlayScene(e,{t:n,options:r}),function t(e){e.children.forEach(function(e){e instanceof jn.Group?t(e):Nn.selectMeshPlayScene(e,{t:n,options:r})})}(e),r.playerOptions.cameraTarget.setCameraTarget(r);e=r.playerOptions.cameraTarget.get();e&&e.setCameraPosition&&e.setCameraPosition(void 0===o)},Nn.assign=function(){Bn()},e.default=Nn,Object.defineProperty(e,"__esModule",{value:!0})});
