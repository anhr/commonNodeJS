/**
 * @module Player
 * @description 3D objects animation.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.player={})}(this,function(e){"use strict";
/**
 * @module cookie
 * @description node.js version of the cookie.
 * Cookies let you store user information in web pages.
 * @see {@link https://www.w3schools.com/js/js_cookies.asp}
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
/**
* node.js version of the cookie.
*
* @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
*
* @copyright 2011 Data Arts Team, Google Creative Lab
*
* @license under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*/function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},K=function(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e},n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t};function i(e,t){var o=e.__state.conversionName.toString(),n=Math.round(e.r),i=Math.round(e.g),r=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===o||"SIX_CHAR_HEX"===o){for(var d=e.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}return"CSS_RGB"===o?"rgb("+n+","+i+","+r+")":"CSS_RGBA"===o?"rgba("+n+","+i+","+r+","+a+")":"HEX"===o?"0x"+e.hex.toString(16):"RGB_ARRAY"===o?"["+n+","+i+","+r+"]":"RGBA_ARRAY"===o?"["+n+","+i+","+r+","+a+"]":"RGB_OBJ"===o?"{r:"+n+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===o?"{r:"+n+",g:"+i+",b:"+r+",a:"+a+"}":"HSV_OBJ"===o?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===o?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var r,a=Array.prototype.forEach,s=Array.prototype.slice,_={BREAK:{},extend:function(o){return this.each(s.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(t[e])||(o[e]=t[e])}.bind(this))},this),o},defaults:function(o){return this.each(s.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(o[e])&&(o[e]=t[e])}.bind(this))},this),o},compose:function(){var o=s.call(arguments);return function(){for(var e=s.call(arguments),t=o.length-1;0<=t;t--)e=[o[t].apply(this,e)];return e[0]}},each:function(e,t,o){if(e)if(a&&e.forEach&&e.forEach===a)e.forEach(t,o);else if(e.length===e.length+0){for(var n=void 0,n=0,i=e.length;n<i;n++)if(n in e&&t.call(o,e[n],n)===this.BREAK)return}else for(var r in e)if(t.call(o,e[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(n,i,r){var a=void 0;return function(){var e=this,t=arguments;var o=r||!a;clearTimeout(a),a=setTimeout(function(){a=null,r||n.apply(e,t)},i),o&&n.apply(e,t)}},toArray:function(e){return e.toArray?e.toArray():s.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:(r=function(e){return isNaN(e)},l.toString=function(){return r.toString()},l),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}};function l(e){return r.apply(this,arguments)}var c,d=[{litmus:_.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:i},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:i},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:i},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:i}}},{litmus:_.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:_.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:_.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(_.isNumber(e.r)&&_.isNumber(e.g)&&_.isNumber(e.b)&&_.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(_.isNumber(e.r)&&_.isNumber(e.g)&&_.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(_.isNumber(e.h)&&_.isNumber(e.s)&&_.isNumber(e.v)&&_.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(_.isNumber(e.h)&&_.isNumber(e.s)&&_.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],u=void 0,f=void 0,h=function(e){f=!1;var o=1<arguments.length?_.toArray(arguments):e;return _.each(d,function(e){if(e.litmus(o))return _.each(e.conversions,function(e,t){if(u=e.read(o),!1===f&&!1!==u)return(f=u).conversionName=t,u.conversion=e,_.BREAK}),_.BREAK}),f},p={hsv_to_rgb:function(e,t,o){var n=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),r=o*(1-t),a=o*(1-i*t),s=o*(1-(1-i)*t),l=[[o,s,r],[a,o,r],[r,o,s],[r,a,o],[s,r,o],[o,r,a]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,o){var n=Math.min(e,t,o),i=Math.max(e,t,o),r=i-n,a=void 0;return 0===i?{h:NaN,s:0,v:0}:(a=e===i?(t-o)/r:t===i?2+(o-e)/r:4+(e-t)/r,(a/=6)<0&&(a+=1),{h:360*a,s:r/i,v:i/255})},rgb_to_hex:function(e,t,o){var n=this.hex_with_component(0,2,e),n=this.hex_with_component(n,1,t);return this.hex_with_component(n,0,o)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,o){return o<<(c=8*t)|e&~(255<<c)}},v="function"==typeof Symbol&&"symbol"===y(Symbol.iterator)?function(e){return void 0===e?"undefined":y(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":y(e)},m=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},g=function(e,t,o){return t&&b(e.prototype,t),o&&b(e,o),e};function b(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function w(e,t,o){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:w(i,t,o)}if("value"in n)return n.value;var r=n.get;return void 0!==r?r.call(o):void 0}function x(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":y(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var E=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":y(t))&&"function"!=typeof t?e:t},C=(g(S,[{key:"toString",value:function(){return i(this)}},{key:"toHexString",value:function(){return i(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),S);function S(){if(m(this,S),this.__state=h.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}function A(e,t,o){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||C.recalculateRGB(this,t,o),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(C.recalculateRGB(this,t,o),this.__state.space="RGB"),this.__state[t]=e}})}function k(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||C.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(C.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}C.recalculateRGB=function(e,t,o){if("HEX"===e.__state.space)e.__state[t]=p.component_from_hex(e.__state.hex,o);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");_.extend(e.__state,p.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},C.recalculateHSV=function(e){var t=p.rgb_to_hsv(e.r,e.g,e.b);_.extend(e.__state,{s:t.s,v:t.v}),_.isNaN(t.h)?_.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},C.COMPONENTS=["r","g","b","h","s","v","hex","a"],A(C.prototype,"r",2),A(C.prototype,"g",1),A(C.prototype,"b",0),k(C.prototype,"h"),k(C.prototype,"s"),k(C.prototype,"v"),Object.defineProperty(C.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(C.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=p.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var T=(g(P,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),P);function P(e,t){m(this,P),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}var O={};_.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){_.each(e,function(e){O[e]=t})});var R=/(\d+(\.\d+)?)px/;function V(e){if("0"===e||_.isUndefined(e))return 0;var t=e.match(R);return _.isNull(t)?0:parseFloat(t[1])}var L={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,o){var n=o,i=t;_.isUndefined(i)&&(i=!0),_.isUndefined(n)&&(n=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,o,n){var i=o||{},r=O[t];if(!r)throw new Error("Event type "+t+" not supported.");var a=document.createEvent(r);switch(r){case"MouseEvents":var s=i.x||i.clientX||0,l=i.y||i.clientY||0;a.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,s,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=a.initKeyboardEvent||a.initKeyEvent;_.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:a.initEvent(t,i.bubbles||!1,i.cancelable||!0)}_.defaults(a,n),e.dispatchEvent(a)},bind:function(e,t,o,n){var i=n||!1;return e.addEventListener?e.addEventListener(t,o,i):e.attachEvent&&e.attachEvent("on"+t,o),L},unbind:function(e,t,o,n){var i=n||!1;return e.removeEventListener?e.removeEventListener(t,o,i):e.detachEvent&&e.detachEvent("on"+t,o),L},addClass:function(e,t){var o;return void 0===e.className?e.className=t:e.className===t||-1===(o=e.className.split(/ +/)).indexOf(t)&&(o.push(t),e.className=o.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")),L},removeClass:function(e,t){var o,n;return t?e.className===t?e.removeAttribute("class"):-1!==(n=(o=e.className.split(/ +/)).indexOf(t))&&(o.splice(n,1),e.className=o.join(" ")):e.className=void 0,L},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return V(t["border-left-width"])+V(t["border-right-width"])+V(t["padding-left"])+V(t["padding-right"])+V(t.width)},getHeight:function(e){var t=getComputedStyle(e);return V(t["border-top-width"])+V(t["border-bottom-width"])+V(t["padding-top"])+V(t["padding-bottom"])+V(t.height)},getOffset:function(e){var t=e,o={left:0,top:0};if(t.offsetParent)for(;o.left+=t.offsetLeft,o.top+=t.offsetTop,t=t.offsetParent;);return o},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},D=(x(F,T),g(F,[{key:"setValue",value:function(e){var t=w(F.prototype.__proto__||Object.getPrototypeOf(F.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),t}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),w(F.prototype.__proto__||Object.getPrototypeOf(F.prototype),"updateDisplay",this).call(this)}}]),F);function F(e,t){m(this,F);var o=E(this,(F.__proto__||Object.getPrototypeOf(F)).call(this,e,t)),n=o;return o.__prev=o.getValue(),o.__checkbox=document.createElement("input"),o.__checkbox.setAttribute("type","checkbox"),L.bind(o.__checkbox,"change",function(){n.setValue(!n.__prev)},!1),o.domElement.appendChild(o.__checkbox),o.updateDisplay(),o}var j=(x(N,T),g(N,[{key:"setValue",value:function(e){var t=w(N.prototype.__proto__||Object.getPrototypeOf(N.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),t}},{key:"updateDisplay",value:function(){return L.isActive(this.__select)?this:(this.__select.value=this.getValue(),w(N.prototype.__proto__||Object.getPrototypeOf(N.prototype),"updateDisplay",this).call(this))}}]),N);function N(e,t,o){m(this,N);var n,i=E(this,(N.__proto__||Object.getPrototypeOf(N)).call(this,e,t)),r=o,a=i;return i.__select=document.createElement("select"),_.isArray(r)&&(n={},_.each(r,function(e){n[e]=e}),r=n),_.each(r,function(e,t){var o=document.createElement("option");o.innerHTML=t,o.setAttribute("value",e),a.__select.appendChild(o)}),i.updateDisplay(),L.bind(i.__select,"change",function(){var e=this.options[this.selectedIndex].value;a.setValue(e)}),i.domElement.appendChild(i.__select),i}var M=(x(H,T),g(H,[{key:"updateDisplay",value:function(){return L.isActive(this.__input)||(this.__input.value=this.getValue()),w(H.prototype.__proto__||Object.getPrototypeOf(H.prototype),"updateDisplay",this).call(this)}}]),H);function H(e,t){m(this,H);var o=E(this,(H.__proto__||Object.getPrototypeOf(H)).call(this,e,t)),n=o;function i(){n.setValue(n.__input.value)}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),L.bind(o.__input,"keyup",i),L.bind(o.__input,"change",i),L.bind(o.__input,"blur",function(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}),L.bind(o.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}function z(e){var t=e.toString();return-1<t.indexOf(".")?t.length-t.indexOf(".")-1:0}var B=(x(I,T),g(I,[{key:"setValue",value:function(e){var t=e;return void 0!==this.__min&&t<this.__min?t=this.__min:void 0!==this.__max&&t>this.__max&&(t=this.__max),void 0!==this.__step&&t%this.__step!=0&&(t=Math.round(t/this.__step)*this.__step),w(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"setValue",this).call(this,t)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=z(e),this}}]),I);function I(e,t,o){m(this,I);var n=E(this,(I.__proto__||Object.getPrototypeOf(I)).call(this,e,t)),i=o||{};return n.__min=i.min,n.__max=i.max,n.__step=i.step,_.isUndefined(n.__step)?0===n.initialValue?n.__impliedStep=1:n.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(n.initialValue))/Math.LN10))/10:n.__impliedStep=n.__step,n.__precision=z(n.__impliedStep),n}var X=(x(q,B),g(q,[{key:"updateDisplay",value:function(){var e,t,o;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),t=this.__precision,o=Math.pow(10,t),Math.round(e*o)/o),w(q.prototype.__proto__||Object.getPrototypeOf(q.prototype),"updateDisplay",this).call(this)}}]),q);function q(e,t,o){m(this,q);var n=E(this,(q.__proto__||Object.getPrototypeOf(q)).call(this,e,t,o));n.__truncationSuspended=!1;var i=n,r=void 0;function a(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}function s(e){var t=r-e.clientY;i.setValue(i.getValue()+t*i.__impliedStep),r=e.clientY}function l(){L.unbind(window,"mousemove",s),L.unbind(window,"mouseup",l),a()}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),L.bind(n.__input,"change",function(){var e=parseFloat(i.__input.value);_.isNaN(e)||i.setValue(e)}),L.bind(n.__input,"blur",function(){a()}),L.bind(n.__input,"mousedown",function(e){L.bind(window,"mousemove",s),L.bind(window,"mouseup",l),r=e.clientY}),L.bind(n.__input,"keydown",function(e){13===e.keyCode&&(i.__truncationSuspended=!0,this.blur(),i.__truncationSuspended=!1,a())}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}function U(e,t,o,n,i){return n+(e-t)/(o-t)*(i-n)}var G=(x(W,B),g(W,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",w(W.prototype.__proto__||Object.getPrototypeOf(W.prototype),"updateDisplay",this).call(this)}}]),W);function W(e,t,o,n,i){m(this,W);var r=E(this,(W.__proto__||Object.getPrototypeOf(W)).call(this,e,t,{min:o,max:n,step:i})),a=r;function s(e){e.preventDefault();var t=a.__background.getBoundingClientRect();return a.setValue(U(e.clientX,t.left,t.right,a.__min,a.__max)),!1}function l(){L.unbind(window,"mousemove",s),L.unbind(window,"mouseup",l),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function c(e){var t=e.touches[0].clientX,o=a.__background.getBoundingClientRect();a.setValue(U(t,o.left,o.right,a.__min,a.__max))}function d(){L.unbind(window,"touchmove",c),L.unbind(window,"touchend",d),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return r.__background=document.createElement("div"),r.__foreground=document.createElement("div"),L.bind(r.__background,"mousedown",function(e){document.activeElement.blur(),L.bind(window,"mousemove",s),L.bind(window,"mouseup",l),s(e)}),L.bind(r.__background,"touchstart",function(e){if(1!==e.touches.length)return;L.bind(window,"touchmove",c),L.bind(window,"touchend",d),c(e)}),L.addClass(r.__background,"slider"),L.addClass(r.__foreground,"slider-fg"),r.updateDisplay(),r.__background.appendChild(r.__foreground),r.domElement.appendChild(r.__background),r}var Y=(x(Z,T),g(Z,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),Z);function Z(e,t,o){m(this,Z);var n=E(this,(Z.__proto__||Object.getPrototypeOf(Z)).call(this,e,t)),i=n;return n.__button=document.createElement("div"),n.__button.innerHTML=void 0===o?"Fire":o,L.bind(n.__button,"click",function(e){return e.preventDefault(),i.fire(),!1}),L.addClass(n.__button,"button"),n.domElement.appendChild(n.__button),n}var J=(x(Q,T),g(Q,[{key:"updateDisplay",value:function(){var t,o=h(this.getValue());!1!==o&&(t=!1,_.each(C.COMPONENTS,function(e){if(!_.isUndefined(o[e])&&!_.isUndefined(this.__color.__state[e])&&o[e]!==this.__color.__state[e])return t=!0,{}},this),t&&_.extend(this.__color.__state,o)),_.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var e=this.__color.v<.5||.5<this.__color.s?255:0,n=255-e;_.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+e+","+e+","+e+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,ee(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),_.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+e+","+e+","+e+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),Q);function Q(e,t){m(this,Q);var o=E(this,(Q.__proto__||Object.getPrototypeOf(Q)).call(this,e,t));o.__color=new C(o.getValue()),o.__temp=new C(0);var s=o;o.domElement=document.createElement("div"),L.makeSelectable(o.domElement,!1),o.__selector=document.createElement("div"),o.__selector.className="selector",o.__saturation_field=document.createElement("div"),o.__saturation_field.className="saturation-field",o.__field_knob=document.createElement("div"),o.__field_knob.className="field-knob",o.__field_knob_border="2px solid ",o.__hue_knob=document.createElement("div"),o.__hue_knob.className="hue-knob",o.__hue_field=document.createElement("div"),o.__hue_field.className="hue-field",o.__input=document.createElement("input"),o.__input.type="text",o.__input_textShadow="0 1px 1px ",L.bind(o.__input,"keydown",function(e){13===e.keyCode&&d.call(this)}),L.bind(o.__input,"blur",d),L.bind(o.__selector,"mousedown",function(){L.addClass(this,"drag").bind(window,"mouseup",function(){L.removeClass(s.__selector,"drag")})}),L.bind(o.__selector,"touchstart",function(){L.addClass(this,"drag").bind(window,"touchend",function(){L.removeClass(s.__selector,"drag")})});var n,i=document.createElement("div");function r(e){f(e),L.bind(window,"mousemove",f),L.bind(window,"touchmove",f),L.bind(window,"mouseup",l),L.bind(window,"touchend",l)}function a(e){p(e),L.bind(window,"mousemove",p),L.bind(window,"touchmove",p),L.bind(window,"mouseup",c),L.bind(window,"touchend",c)}function l(){L.unbind(window,"mousemove",f),L.unbind(window,"touchmove",f),L.unbind(window,"mouseup",l),L.unbind(window,"touchend",l),u()}function c(){L.unbind(window,"mousemove",p),L.unbind(window,"touchmove",p),L.unbind(window,"mouseup",c),L.unbind(window,"touchend",c),u()}function d(){var e=h(this.value);!1!==e?(s.__color.__state=e,s.setValue(s.__color.toOriginal())):this.value=s.__color.toString()}function u(){s.__onFinishChange&&s.__onFinishChange.call(s,s.__color.toOriginal())}function f(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=s.__saturation_field.getBoundingClientRect(),o=e.touches&&e.touches[0]||e,n=o.clientX,i=o.clientY,r=(n-t.left)/(t.right-t.left),a=1-(i-t.top)/(t.bottom-t.top);return 1<a?a=1:a<0&&(a=0),1<r?r=1:r<0&&(r=0),s.__color.v=a,s.__color.s=r,s.setValue(s.__color.toOriginal()),!1}function p(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=s.__hue_field.getBoundingClientRect(),o=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return 1<o?o=1:o<0&&(o=0),s.__color.h=360*o,s.setValue(s.__color.toOriginal()),!1}return _.extend(o.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),_.extend(o.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:o.__field_knob_border+(o.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),_.extend(o.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),_.extend(o.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),_.extend(i.style,{width:"100%",height:"100%",background:"none"}),ee(i,"top","rgba(0,0,0,0)","#000"),_.extend(o.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(n=o.__hue_field).style.background="",n.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",n.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",_.extend(o.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:o.__input_textShadow+"rgba(0,0,0,0.7)"}),L.bind(o.__saturation_field,"mousedown",r),L.bind(o.__saturation_field,"touchstart",r),L.bind(o.__field_knob,"mousedown",r),L.bind(o.__field_knob,"touchstart",r),L.bind(o.__hue_field,"mousedown",a),L.bind(o.__hue_field,"touchstart",a),o.__saturation_field.appendChild(i),o.__selector.appendChild(o.__field_knob),o.__selector.appendChild(o.__saturation_field),o.__selector.appendChild(o.__hue_field),o.__hue_field.appendChild(o.__hue_knob),o.domElement.appendChild(o.__input),o.domElement.appendChild(o.__selector),o.updateDisplay(),o}var $=["-moz-","-o-","-webkit-","-ms-",""];function ee(t,o,n,i){t.style.background="",_.each($,function(e){t.style.cssText+="background: "+e+"linear-gradient("+o+", "+n+" 0%, "+i+" 100%); "})}var te=function(e,t,o,n,i){var r=e[t];return _.isArray(o)||_.isObject(o)?new j(e,t,o):_.isNumber(r)?_.isNumber(o)&&_.isNumber(n)?_.isNumber(i)?new G(e,t,o,n,i):new G(e,t,o,n):_.isNumber(i)?new X(e,t,{min:o,max:n,step:i}):new X(e,t,{min:o,max:n}):_.isString(r)?new M(e,t):_.isFunction(r)?new Y(e,t,""):_.isBoolean(r)?new D(e,t):null},oe=(x(ne,T),g(ne,[{key:"controller",set:function(e){this._controller=e},get:function(){return this._controller}}]),ne);function ne(e,t){m(this,ne);var o=E(this,(ne.__proto__||Object.getPrototypeOf(ne)).call(this,e,t));return o.arguments={object:e,property:t,opts:Array.prototype.slice.call(arguments,2)},e.property&&(o.property=e.property(o)),o}var ie=function(e,t){var o=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e;var i=o.getElementsByTagName("head")[0];try{i.appendChild(n)}catch(e){}};var re=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},ae=(g(se,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),_.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",L.unbind(t.domElement,"webkitTransitionEnd",e),L.unbind(t.domElement,"transitionend",e),L.unbind(t.domElement,"oTransitionEnd",e)}var t=this;L.bind(this.domElement,"webkitTransitionEnd",e),L.bind(this.domElement,"transitionend",e),L.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-L.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-L.getHeight(this.domElement)/2+"px"}}]),se);function se(){m(this,se),this.backgroundElement=document.createElement("div"),_.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),L.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),_.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;L.bind(this.backgroundElement,"click",function(){e.hide()})}ie(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var le="Default",ce=function(){try{return!!window.localStorage}catch(e){return!1}}(),de=void 0,ue=!0,fe=void 0,pe=!1,he=[],me=function t(e){var o=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),L.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=_.defaults(n,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),n=_.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),_.isUndefined(n.load)?n.load={preset:le}:n.preset&&(n.load.preset=n.preset),_.isUndefined(n.parent)&&n.hideable&&he.push(this),n.resizable=_.isUndefined(n.parent)&&n.resizable,n.autoPlace&&_.isUndefined(n.scrollable)&&(n.scrollable=!0);var i,r,a,s,l,c=ce&&"true"===localStorage.getItem(we(0,"isLocal")),d=void 0,u=void 0;function f(e){return e.preventDefault(),a.width+=s-e.clientX,a.onResize(),s=e.clientX,!1}function p(){L.removeClass(a.__closeButton,me.CLASS_DRAG),L.unbind(window,"mousemove",f),L.unbind(window,"mouseup",p)}function h(e){return e.preventDefault(),s=e.clientX,L.addClass(a.__closeButton,me.CLASS_DRAG),L.bind(window,"mousemove",f),L.bind(window,"mouseup",p),!1}Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return o.parent?o.getRoot().preset:n.load.preset},set:function(e){o.parent?o.getRoot().preset=e:n.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),o.revert()}},width:{get:function(){return n.width},set:function(e){n.width=e,Ce(o,e)}},name:{get:function(){return n.name},set:function(e){n.name=e,u&&(u.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(e){n.closed=e,n.closed?L.addClass(o.__ul,t.CLASS_CLOSED):L.removeClass(o.__ul,t.CLASS_CLOSED),this.onResize(),o.__closeButton&&(o.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return c},set:function(e){ce&&((c=e)?L.bind(window,"unload",d):L.unbind(window,"unload",d),localStorage.setItem(we(0,"isLocal"),e))}}}),_.isUndefined(n.parent)?(this.closed=n.closed||!1,L.addClass(this.domElement,t.CLASS_MAIN),L.makeSelectable(this.domElement,!1),ce&&c&&(o.useLocalStorage=!0,(i=localStorage.getItem(we(0,"gui")))&&(n.load=JSON.parse(i))),this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,L.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),n.closeOnTop?(L.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(L.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),L.bind(this.__closeButton,"click",function(){o.closed=!o.closed})):(void 0===n.closed&&(n.closed=!0),r=document.createTextNode(n.name),L.addClass(r,"controller-name"),u=_e(o,r),L.addClass(this.__ul,t.CLASS_CLOSED),L.addClass(u,"title"),L.bind(u,"click",function(e){return e.preventDefault(),o.closed=!o.closed,!1}),n.closed||(this.closed=!1)),n.autoPlace&&(_.isUndefined(n.parent)&&(ue&&(fe=document.createElement("div"),L.addClass(fe,"dg"),L.addClass(fe,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(fe),ue=!1),fe.appendChild(this.domElement),L.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||Ce(o,n.width)),this.__resizeHandler=function(){o.onResizeDebounced()},L.bind(window,"resize",this.__resizeHandler),L.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),L.bind(this.__ul,"transitionend",this.__resizeHandler),L.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&(s=void 0,(a=this).__resize_handle=document.createElement("div"),_.extend(a.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),L.bind(a.__resize_handle,"mousedown",h),L.bind(a.__closeButton,"mousedown",h),a.domElement.insertBefore(a.__resize_handle,a.domElement.firstElementChild)),d=function(){ce&&"true"===localStorage.getItem(we(0,"isLocal"))&&localStorage.setItem(we(0,"gui"),JSON.stringify(o.getSaveObject()))},this.saveToLocalStorageIfPossible=d,n.parent||((l=o.getRoot()).width+=1,_.defer(function(){--l.width}))};function _e(e,t,o){var n=document.createElement("li");return t&&n.appendChild(t),o?e.__ul.insertBefore(n,o):e.__ul.appendChild(n),e.onResize(),n}function ve(e){L.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&L.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function ge(e,t){var o=e.__preset_select[e.__preset_select.selectedIndex];o.innerHTML=t?o.value+"*":o.value}function ye(e,t){var o=e.getRoot(),n=o.__rememberedObjects.indexOf(t.object);if(-1!==n){var i=o.__rememberedObjectIndecesToControllers[n];if(void 0===i&&(i={},o.__rememberedObjectIndecesToControllers[n]=i),i[t.property]=t,o.load&&o.load.remembered){var r,a=o.load.remembered,s=void 0;if(a[e.preset])s=a[e.preset];else{if(!a[le])return;s=a[le]}s[n]&&void 0!==s[n][t.property]&&(r=s[n][t.property],t.initialValue=r,t.setValue(r))}}}function be(e,t,o,n){var i;if(t.arguments&&(t=(i=t).arguments.object,o=i.arguments.property,n={factoryArgs:i.arguments.opts}),void 0===i&&void 0===t[o])throw new Error('Object "'+t+'" has no property "'+o+'"');var r,a=void 0;null===(a=n.color?new J(t,o):void 0!==i&&"string"==typeof i.property?i:(r=[t,o].concat(n.factoryArgs),te.apply(e,r)))?a=i:void 0!==i&&(i.controller=a),n.before instanceof T&&(n.before=n.before.__li),ye(e,a),L.addClass(a.domElement,"c");var s=document.createElement("span");if(L.addClass(s,"property-name"),void 0!==i&&"object"===v(i.property))for(var l in i.property)s.appendChild(i.property[l]);else s.innerHTML=a.property;var c=document.createElement("div");c.appendChild(s),c.appendChild(a.domElement);var d,u,f,p,h,m=_e(e,c,n.before);return L.addClass(m,me.CLASS_CONTROLLER_ROW),a instanceof J?L.addClass(m,"color"):L.addClass(m,v(a.getValue())),d=e,u=m,(f=a).__li=u,f.__gui=d,_.extend(f,{options:function(e){if(1<arguments.length){var t=f.__li.nextElementSibling;return f.remove(),be(d,f.object,f.property,{before:t,factoryArgs:[_.toArray(arguments)]})}if(_.isArray(e)||_.isObject(e)){var o=f.__li.nextElementSibling;return f.remove(),be(d,f.object,f.property,{before:o,factoryArgs:[e]})}},name:function(e){return f.__li.firstElementChild.firstElementChild.innerHTML=e,f},listen:function(){return f.__gui.listen(f),f},remove:function(){return f.__gui.remove(f),f}}),f instanceof G?(p=new X(f.object,f.property,{min:f.__min,max:f.__max,step:f.__step}),_.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=f[e],o=p[e];f[e]=p[e]=function(){var e=Array.prototype.slice.call(arguments);return o.apply(p,e),t.apply(f,e)}}),L.addClass(u,"has-slider"),f.domElement.insertBefore(p.domElement,f.domElement.firstElementChild)):f instanceof X?(h=function(e){if(_.isNumber(f.__min)&&_.isNumber(f.__max)){var t=f.__li.firstElementChild.firstElementChild.innerHTML,o=-1<f.__gui.__listening.indexOf(f);f.remove();var n=be(d,f.object,f.property,{before:f.__li.nextElementSibling,factoryArgs:[f.__min,f.__max,f.__step]});return n.name(t),o&&n.listen(),n}return e},f.min=_.compose(h,f.min),f.max=_.compose(h,f.max)):f instanceof D?(L.bind(u,"click",function(){L.fakeEvent(f.__checkbox,"click")}),L.bind(f.__checkbox,"click",function(e){e.stopPropagation()})):f instanceof Y?(L.bind(u,"click",function(){L.fakeEvent(f.__button,"click")}),L.bind(u,"mouseover",function(){L.addClass(f.__button,"hover")}),L.bind(u,"mouseout",function(){L.removeClass(f.__button,"hover")})):f instanceof J&&(L.addClass(u,"color"),f.updateDisplay=_.compose(function(e){return u.style.borderLeftColor=f.__color.toString(),e},f.updateDisplay),f.updateDisplay()),f.setValue=_.compose(function(e){return d.getRoot().__preset_select&&f.isModified()&&ge(d.getRoot(),!0),e},f.setValue),e.__controllers.push(a),a}function we(e,t){return document.location.href+"."+t}function xe(e,t,o){var n=document.createElement("option");n.innerHTML=t,n.value=t,e.__preset_select.appendChild(n),o&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function Ee(e,t){t.style.display=e.useLocalStorage?"block":"none"}function Ce(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function Se(i,r){var a={};return _.each(i.__rememberedObjects,function(e,t){var o={},n=i.__rememberedObjectIndecesToControllers[t];_.each(n,function(e,t){o[t]=r?e.initialValue:e.getValue()}),a[t]=o}),a}me.toggleHide=function(){pe=!pe,_.each(he,function(e){e.domElement.style.display=pe?"none":""})},me.CLASS_AUTO_PLACE="a",me.CLASS_AUTO_PLACE_CONTAINER="ac",me.CLASS_MAIN="main",me.CLASS_CONTROLLER_ROW="cr",me.CLASS_TOO_TALL="taller-than-window",me.CLASS_CLOSED="closed",me.CLASS_CLOSE_BUTTON="close-button",me.CLASS_CLOSE_TOP="close-top",me.CLASS_CLOSE_BOTTOM="close-bottom",me.CLASS_DRAG="drag",me.DEFAULT_WIDTH=245,me.TEXT_CLOSED="Close Controls",me.TEXT_OPEN="Open Controls",me._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||me.toggleHide()},L.bind(window,"keydown",me._keydownHandler,!1),_.extend(me.prototype,{add:function(e,t){return be(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return be(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;_.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&fe.removeChild(this.domElement);var t=this;_.each(this.__folders,function(e){t.removeFolder(e)}),L.unbind(window,"keydown",me._keydownHandler,!1),ve(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var o=new me(t);this.__folders[e]=o;var n=_e(this,o.domElement);return L.addClass(n,"folder"),o},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],ve(t);var e=this;_.each(t.__folders,function(e){t.removeFolder(e)}),_.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e,t,o=this.getRoot();o.scrollable&&(e=L.getOffset(o.__ul).top,t=0,_.each(o.__ul.childNodes,function(e){o.autoPlace&&e===o.__save_row||(t+=L.getHeight(e))}),window.innerHeight-e-20<t?(L.addClass(o.domElement,me.CLASS_TOO_TALL),o.__ul.style.height=window.innerHeight-e-20+"px"):(L.removeClass(o.domElement,me.CLASS_TOO_TALL),o.__ul.style.height="auto")),o.__resize_handle&&_.defer(function(){o.__resize_handle.style.height=o.__ul.offsetHeight+"px"}),o.__closeButton&&(o.__closeButton.style.width=o.width+"px")},onResizeDebounced:_.debounce(function(){this.onResize()},50),remember:function(){if(_.isUndefined(de)&&((de=new ae).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;_.each(Array.prototype.slice.call(arguments),function(e){0===t.__rememberedObjects.length&&function(o){var e=o.__save_row=document.createElement("li");L.addClass(o.domElement,"has-save"),o.__ul.insertBefore(e,o.__ul.firstChild),L.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",L.addClass(t,"button gears");var n=document.createElement("span");n.innerHTML="Save",L.addClass(n,"button"),L.addClass(n,"save");var i=document.createElement("span");i.innerHTML="New",L.addClass(i,"button"),L.addClass(i,"save-as");var r=document.createElement("span");r.innerHTML="Revert",L.addClass(r,"button"),L.addClass(r,"revert");var a=o.__preset_select=document.createElement("select");o.load&&o.load.remembered?_.each(o.load.remembered,function(e,t){xe(o,t,t===o.preset)}):xe(o,le,!1);{var s,l;L.bind(a,"change",function(){for(var e=0;e<o.__preset_select.length;e++)o.__preset_select[e].innerHTML=o.__preset_select[e].value;o.preset=this.value}),e.appendChild(a),e.appendChild(t),e.appendChild(n),e.appendChild(i),e.appendChild(r),ce&&(s=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage"),document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(we(0,"isLocal"))&&l.setAttribute("checked","checked"),Ee(o,s),L.bind(l,"change",function(){o.useLocalStorage=!o.useLocalStorage,Ee(o,s)}))}var c=document.getElementById("dg-new-constructor");L.bind(c,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||de.hide()}),L.bind(t,"click",function(){c.innerHTML=JSON.stringify(o.getSaveObject(),void 0,2),de.show(),c.focus(),c.select()}),L.bind(n,"click",function(){o.save()}),L.bind(i,"click",function(){var e=prompt("Enter a new preset name.");e&&o.saveAs(e)}),L.bind(r,"click",function(){o.revert()})}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&Ce(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var o=this.load;return o.closed=this.closed,0<this.__rememberedObjects.length&&(o.preset=this.preset,o.remembered||(o.remembered={}),o.remembered[this.preset]=Se(this)),o.folders={},_.each(this.__folders,function(e,t){o.folders[t]=e.getSaveObject()}),o},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Se(this),ge(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[le]=Se(this,!0)),this.load.remembered[e]=Se(this),this.preset=e,xe(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(t){_.each(this.__controllers,function(e){this.getRoot().load.remembered?ye(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),_.each(this.__folders,function(e){e.revert(e)}),t||ge(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&re.call(window,function(){e(t)});_.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){_.each(this.__controllers,function(e){e.updateDisplay()}),_.each(this.__folders,function(e){e.updateDisplay()})}});var Ae,ke={Controller:T,BooleanController:D,OptionController:j,StringController:M,NumberController:B,NumberControllerBox:X,NumberControllerSlider:G,FunctionController:Y,ColorController:J,CustomController:oe};
/**
 * Modify of the dat object.
 * @see {@link https://github.com/dataarts/dat.gui} about dat.gui
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
function Te(){}void 0!==Te&&(Ae=function(e,t,o){void 0===t&&console.warn("elNameAndTitle: name = "+t),e.innerHTML=t,void 0!==o&&(e.title=o)},Te.GUI=me,void 0===Te.controllerNameAndTitle?Te.controllerNameAndTitle=function(e,t,o){Ae(e.__li.querySelector(".property-name"),t,o)}:console.error("Duplicate dat.controllerNameAndTitle method."),void 0===Te.folderNameAndTitle?Te.folderNameAndTitle=function(e,t,o){Ae(e.__ul.querySelector("li.title"),t,o)}:console.error("Duplicate dat.folderNameAndTitle method."),void 0===Te.controllerZeroStep?Te.controllerZeroStep=function(e,t,o,n){var i=e.add(t,o),r=i.__input;return i.__input=document.createElement("input"),r.value=t[o],r.onchange=function(e){t[o]=parseFloat(r.value),void 0!==n&&n(t[o])},i.setValue=function(e){r.value=t[o]=e},i}:console.error("Duplicate dat.controllerZeroStep method."),void 0===Te.controllerSetValue?Te.controllerSetValue=function(e,t){e.setValue(t),e.__li.querySelector("select").selectedIndex=t}:console.error("Duplicate dat.controllerSetValue method.")
/**
* custom controller, allow to user to change a value step by step.
*
* @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
*
* @copyright 2011 Data Arts Team, Google Creative Lab
*
* @license under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*/);var Pe={addButton:function(e,o){o=o||{};var t,n=document.createElement("span");return n.innerHTML=e,void 0!==o.title&&(n.title=o.title),void 0!==o.onclick&&(n.style.cursor="pointer",n.onclick=o.onclick),void 0!==o.onwheel&&(t=function(e){var t=(e=e||window.event).deltaY||e.detail||e.wheelDelta;o.onwheel(t)},n.style.cursor="n-resize",n.addEventListener?"onwheel"in document?n.addEventListener("wheel",t):"onmousewheel"in document?n.addEventListener("mousewheel",t):n.addEventListener("MozMousePixelScroll",t):n.attachEvent("onmousewheel",t)),n.style.margin="0px 2px",n}},Oe=(t(Re,ke.CustomController),Re);
/**
 * @module ScaleController
 * @description is dat.GUI graphical user interface controller for control of the scale of threejs 3D object
 *
 * @see {@link https://threejs.org/} about threejs
 * @see {@link https://github.com/dataarts/dat.gui} about dat.GUI
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function Re(r,a){o(this,Re),(a=a||{}).settings=a.settings||{},a.settings.zoomMultiplier=a.settings.zoomMultiplier||1.1;var e=n(this,(Re.__proto__||Object.getPrototypeOf(Re)).call(this,{multiplier:a.settings.zoomMultiplier,property:function(e){var t={zoom:"Zoom",in:"in",out:"out",wheelZoom:"Scroll the mouse wheel to zoom"},o=void 0===a.getLanguageCode?"en":a.getLanguageCode();switch(o){case"ru":t.zoom="Изменить",t.in="увеличить",t.out="уменьшить",t.wheelZoom="Прокрутите колесико мыши для изменения масштаба";break;default:if(void 0===a.lang||a.lang.languageCode!=o)break;Object.keys(a.lang).forEach(function(e){void 0!==t[e]&&(t[e]=a.lang[e])})}var n={},i=Pe.addButton;return n.zoomLabel=i(t.zoom,{title:t.wheelZoom,onwheel:function(o){r(e,function(e,t){return 0<o?e*=t:e/=t,e})}}),n.in=i("↑",{title:t.in,onclick:function(){r(e,function(e,t){return e*=t})}}),n.out=i("↓",{title:t.out,onclick:function(){r(e,function(e,t){return e/=t})}}),n}},"multiplier",1.1,10,.1));return void 0===e.property&&console.error("init() returns "+e.property),e}
/**
 * PositionController is dat.GUI graphical user interface controller for control of the position of threejs 3D object
 *
 * @see {@link https://threejs.org/} about threejs
 * @see {@link https://github.com/dataarts/dat.gui} about dat.GUI
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
var Ve=(t(Le,ke.CustomController),Le);
/**
 * node.js version of the synchronous download of the file.
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function Le(r,a){o(this,Le),(a=a||{}).settings=a.settings||{};var e=a.settings;a.min=a.min||.1,a.max=a.max||10,e.offset=e.offset||.1,a.step=a.step||.1;var t=n(this,(Le.__proto__||Object.getPrototypeOf(Le)).call(this,{offset:e.offset,property:function(o){var t={offset:"Offset",add:"add",subtract:"subtract",wheelPosition:"Scroll the mouse wheel to change the position"},e=void 0===a.getLanguageCode?"en":a.getLanguageCode();switch(e){case"ru":t.offset="Сдвиг",t.add="добавить",t.subtract="вычесть",t.wheelPosition="Прокрутите колесико мыши для изменения позиции";break;default:if(void 0===a.lang||a.lang.languageCode!=e)break;Object.keys(a.lang).forEach(function(e){void 0!==t[e]&&(t[e]=a.lang[e])})}var n={},i=Pe.addButton;return n.Label=i(t.offset,{title:t.wheelPosition,onwheel:function(e){var t=o.controller.getValue();r(0<e?t:-t)}}),n.in=i("↑",{title:t.add,onclick:function(){r(o.controller.getValue())}}),n.out=i("↓",{title:t.subtract,onclick:function(){r(-o.controller.getValue())}}),n}},"offset",a.min,a.max,a.step));return void 0===t.property&&console.error("init() returns "+t.property),t}function De(t){if(this.loadXMLDoc=function(){var e;if(window.XMLHttpRequest){if(!(e=new XMLHttpRequest))throw"new XMLHttpRequest() failed!"}else{if(!window.ActiveXObject)throw"myRequest.loadXMLDoc(...) failed!";if(!(e=this.NewActiveXObject()))throw"NewActiveXObject() failed!"}return e},this.NewActiveXObject=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}return a('This browser does not support XMLHttpRequest. Probably, your security settings do not allow Web sites to use ActiveX controls installed on your computer. Refresh your Web page to find out the current status of your Web page or enable the "Initialize and script ActiveX controls not marked as safe" and "Run Active X controls and plug-ins" of the Security settings of the Internet zone of your browser.'),null},this.XMLHttpRequestStart=function(e,t){this.XMLHttpRequestStop(),this.req.onreadystatechange=e,"onerror"in this.req&&(this.req.onerror=function(e){a("XMLHttpRequest error. url: "+this.url)}),this.XMLHttpRequestReStart(t)},this.getUrl=function(){return void 0!==this.url&&null!=this.url||(this.url="XMLHttpRequest.xml"),this.url+(this.params?this.params:"")},this.XMLHttpRequestReStart=function(e){try{void 0===e&&(e=!0),this.req.open("GET",this.getUrl(),e),e&&("timeout"in this.req&&(this.req.timeout=9e4),"ontimeout"in this.req?this.req.ontimeout=function(){a("XMLHttpRequest timeout")}:(clearTimeout(this.timeout_id_SendReq),this.timeout_id_SendReq=setTimeout(function(){a("XMLHttpRequest timeout 2")},9e4))),this.req.send(null)}catch(e){a(e.message+" url: "+this.url)}},this.XMLHttpRequestStop=function(){null!=this.req&&this.req.abort()},this.ProcessReqChange=function(e){var t=this.req;switch(t.readyState){case 4:if("unknown"==typeof t.status)return consoleError('typeof XMLHttpRequest status == "unknown"'),!0;if(200==t.status)return clearTimeout(this.timeout_id_SendReq),e(this);a("Invalid XMLHttpRequest status : "+t.status+" url: "+this.url);break;case 1:case 2:case 3:break;case 0:default:throw"processReqChange(); req.readyState = "+t.readyState}return!0},this.processStatus200Error=function(){var e=this.GetElementText("error",!0);return!!e&&(a(e),!0)},this.GetElementText=function(e,t){var o=this.req;if(!o.responseXML)return 1!=t&&a("GetXMLElementText(xmlhttp, "+e+"); xmlhttp.responseXML is null.\nxmlhttp.responseText:\n"+o.responseText),null;var n=o.responseXML.getElementsByTagName(e);if(0==n.length)return 1!=t&&a('GetXMLElementText(xmlhttp, "'+e+'"); element.length == '+n.length),"";for(var i="",r=0;r<n.length;r++)if(void 0===n[r].textContent){if(void 0===n[r].text)return a("GetXMLElementText(xmlhttp, "+e+"); element["+r+"].text) == undefined"),"";""!=i&&(i+=" "),i+=n[r].text}else i+=n[r].textContent;return i},t.data)this.req=t.data.req,this.url=t.data.url,this.params=t.data.params;else try{this.req=this.loadXMLDoc()}catch(e){var o;return o=void 0===e.message?e:e.message,void a("Your browser is too old and is not compatible with our site.\n\n"+window.navigator.appName+" "+window.navigator.appVersion+"\n\n"+o)}function a(e){console.error(e),t.onerror(e)}this.req||consoleError("Invalid myRequest.req: "+this.req)}function Fe(t,o){(o=o||{}).onload=o.onload||function(){},o.onerror=o.onerror||function(){};var n,e=new De(o);return e.url=t,e.XMLHttpRequestStart(function(){e.ProcessReqChange(function(e){e.processStatus200Error()||(n=e.req.responseText,o.onload(n,t))})},!1),n}
/**
 * node.js version of the load JavaScript file
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * Thanks to:
 *http://javascript.ru/forum/events/21439-dinamicheskaya-zagruzka-skriptov.html
 *https://learn.javascript.ru/onload-onerror
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function je(e,t){if(t.tag=t.tag||{},"string"==typeof t.tag){if("style"!==t.tag)return void console.error("Invalid options.tag: "+t.tag);t.tag={name:"style",attribute:{name:"rel",value:"stylesheet"}}}t.tag.name=t.tag.name||"script";var o=document.createElement(t.tag.name);t.tag.attribute=t.tag.attribute||{},t.tag.attribute.name=t.tag.attribute.name||"type",t.tag.attribute.value=t.tag.attribute.value||"text/javascript",o.setAttribute(t.tag.attribute.name,t.tag.attribute.value),e(o),t.appendTo.appendChild(o)}function Ne(e,t){for(var o=e.querySelectorAll("script"),n=0;n<o.length;n++){if(o[n].id===t)return 1}}var Me,He={sync:function(t,o){if((o=o||{}).onload=o.onload||function(){},o.onerror=o.onerror||function(){},o.appendTo=o.appendTo||document.getElementsByTagName("head")[0],Ne(o.appendTo,t))o.onload();else if(t instanceof Array){for(var n,i={appendTo:o.appendTo,tag:o.tag,onload:function(e,t){console.log("loadScript.sync.onload: "+t)},onerror:function(e){o.onerror(e),n=e}},e=0;e<t.length;e++){var r=t[e];if(je(function(e){e.setAttribute("id",r),e.innerHTML=Fe(r,i)},i),void 0!==n)break}void 0===n&&o.onload()}else je(function(e){e.setAttribute("id",t),e.innerHTML=Fe(t,o)},o)},async:function(e,n){var i;function r(t){function o(){e instanceof Array&&i<e.length-1?r(e[++i]):n.onload()}Ne(n.appendTo,t,n.onload)?o():je(function(e){e.setAttribute("id",t),e.readyState&&!e.onload?e.onreadystatechange=function(){"complete"==e.readyState&&void 0!==n.onload&&n.onload(),"loaded"==e.readyState&&(setTimeout(n.onload,0),this.onreadystatechange=null)}:(e.onload=function(){console.log("loadScript.async.onload() "+t),void 0!==n.onload&&o()},e.onerror=function(e){var t='loadScript: "'+this.src+'" failed';void 0!==n.onerror&&n.onerror(t,e),console.error(t)}),e.src=t},n)}(n=n||{}).appendTo=n.appendTo||document.getElementsByTagName("head")[0],n.onload=n.onload||function(){},e instanceof Array?r(e[i=0]):r(e)}},ze=(Me=function(){if(document.currentScript&&""!==document.currentScript.src)return document.currentScript.src;var e=document.getElementsByTagName("script");return""!==e[e.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]}()).substring(0,Me.lastIndexOf("/"));
/**
 * @module ColorPicker
 * @description Pure JavaScript color picker.
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 * @See Thanks to [FlexiColorPicker]{@link https://github.com/DavidDurman/FlexiColorPicker}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */He.sync(ze+"/colorpicker.css",{tag:"style"});var Be,Ie=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",Xe="http://www.w3.org/2000/svg",qe=0,Ue={BGRW:0,monochrome:1,bidirectional:2,rainbow:3};function Ge(e,t,o){for(var n in e=document.createElementNS(Xe,e),t)e.setAttribute(n,t[n]);"[object Array]"!=Object.prototype.toString.call(o)&&(o=[o]);for(var i=0,r=o[0]&&o.length||0;i<r;i++)e.appendChild(o[i]);return e}function We(p){function e(e,t,o,n){return{percent:e,r:t,g:o,b:n}}void 0===(p=p||{}).palette&&(p.palette=Ue.BGRW);var h=[new e(0,0,0,255),new e(33,0,255,0),new e(66,255,255,0),new e(100,255,255,255)];switch(y(p.palette)){case"number":switch(p.palette){case Ue.BGRW:break;case Ue.monochrome:h=[new e(0,0,0,0),new e(100,255,255,255)];break;case Ue.bidirectional:h=[new e(0,255,48,48),new e(50,48,48,48),new e(100,48,255,48)];break;case Ue.rainbow:h=[new e(0,255,50,50),new e(16,252,245,40),new e(32,40,252,40),new e(50,40,252,248),new e(66,39,46,249),new e(82,255,40,251),new e(100,255,50,50)];break;default:console.error("ColorPicker.create.Palette: invalid options.palette = "+p.palette)}break;case"object":if(Array.isArray(p.palette)){h=p.palette;break}default:var t="invalid options.palette = "+p.palette;console.error("ColorPicker.create.Palette: "+t),p.onError(t)}this.getPalette=function(){var t=[];return h.forEach(function(e){t.unshift(Ge("stop",{offset:100-e.percent+"%","stop-color":"#"+("0"+Number(e.r).toString(16)).slice(-2).toUpperCase()+("0"+Number(e.g).toString(16)).slice(-2).toUpperCase()+("0"+Number(e.b).toString(16)).slice(-2).toUpperCase(),"stop-opacity":"1"}))}),t},this.hsv2rgb=function(e,t,o){var r=parseFloat(e);void 0!==t&&void 0!==o&&(r=100/(o-t)*(r-t));var n,i,a=h[h.length-1];100!==a.percent&&(n={},Object.keys(a).forEach(function(e){n[e]=a[e]}),n.percent=100,h.push(n));for(var s=0;s<h.length;s++){var l=h[s];if(void 0===i&&(i=l),r>=i.percent&&r<=l.percent){var c=function(e,t,o,n){var i=o-e;return 0==i?t:Math.round(t+(n-t)/i*(r-e))},d=c(i.percent,i.r,l.percent,l.r),u=c(i.percent,i.g,l.percent,l.g),f=c(i.percent,i.b,l.percent,l.b);return{r:d,g:u,b:f,hex:"#"+(16777216|f|u<<8|d<<16).toString(16).slice(1),percent:r}}i=l}void 0!==p.onError&&p.onError("Invalid color value of the ColorPicker: "+e)},this.toColor=function(e,t,o){if(void 0!==Be){if(e instanceof Be.Color)return e;var n=this.hsv2rgb(e,t,o);return void 0===n&&(n={r:255,g:255,b:255}),new Be.Color("rgb("+n.r+", "+n.g+", "+n.b+")")}console.error("Call ColorPicker.palette.setTHREE(THREE) first.")}}We.setTHREE=function(e){Be?Object.is(Be,e)||console.error("Palette.setTHREE: duplicate THREE. Please use one instance of the THREE library."):Be=e};
/**
* @module ColorPicker
* @description Pure JavaScript color picker.
* @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
*
* Thanks to https://github.com/DavidDurman/FlexiColorPicker
*
* @copyright 2011 Data Arts Team, Google Creative Lab
*
* @license under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
*/
var Ye,Ze,Ke={create:function(e,i){function r(){return"horizontal"===i.orientation}if((i=i||{}).orientation=i.orientation||"horizontal",void 0===i.direction&&(i.direction=!0),i.style=i.style||{},i.style.width=i.style.width||(r()?200:30),i.style.height=i.style.height||(r()?30:200),i.onError=i.onError||function(){},e instanceof HTMLElement!=!0){if("string"!=typeof e)return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e);if(null===(e=document.getElementById(e)))return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e)}for(var t in e.classList.add("slider-wrapper"),i.style)e.style[t]=i.style[t];var n,o,a,s,l,c,d=i.palette instanceof We?i.palette:new We(i);function u(){return"string"==typeof i.style.height?parseInt(i.style.height):i.style.height}function f(){return h.clientWidth}function p(e,t){var o;void 0!==n?void 0!==(o=d.hsv2rgb(e))?(e=o.percent,void 0===t&&(t=r()?f()*e/100:u()-u()*(i.direction?e:100-e)/100),function(e){if(void 0===n)return;if(r()){if(e<0||e>f())return console.error("ColorPicker.positionIndicators: Invalid position = "+e);n.style.top="0px",n.style.left=(i.direction?e:f()-e)-n.offsetWidth/2+"px"}else{if(e<0||e>u())return console.error("ColorPicker.positionIndicators: Invalid position = "+e);n.style.left="0px",n.style.top=e-n.offsetHeight/2+"px"}}(t),void 0!==i.sliderIndicator.callback&&i.sliderIndicator.callback(o)):console.error("ColorPicker.setValue: invalud c = "+o):console.error("Set value of this instance of the ColorPicker is impossible because options.sliderIndicator is not defined.")}if(void 0!==i.sliderIndicator&&((n=document.createElement("div")).className="slider-indicator",r()?n.style.width="10px":n.style.height="10px",e.appendChild(n),n.style.pointerEvents="none"),"SVG"==Ie){try{var h=Ge("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:r()?"100%":i.style.width,height:i.style.height},[Ge("defs",{},Ge("linearGradient",{id:"gradient-hsv-"+qe,x1:r()&&i.direction?"100%":"0%",y1:r()||i.direction?"0%":"100%",x2:r()&&!i.direction?"100%":"0%",y2:!r()&&i.direction?"100%":"0%"},d.getPalette())),Ge("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv-"+qe+")"})]);void 0!==n&&(h.style.cursor=r()?"e-resize":"s-resize",n.style.cursor=h.style.cursor)}catch(e){console.error("Create SVG element failed! "+e.message)}e.appendChild(h),e.style.height=u()+"px",void 0!==n&&(r()?n.style.height=parseInt(i.style.height)-2+"px":n.style.width=parseInt(i.style.width)-2+"px",i.sliderIndicator.value=i.sliderIndicator.value||0,p(i.sliderIndicator.value)),qe++}else console.error("Under constraction");function m(e){var t,o,n;e.x=parseInt(e.x),e.y=parseInt(e.y),r()?(t=e.x,o=f()-1,t>=f()&&(t=o),n=100*t/o,i.direction||(n=100-n,t=o-t)):(t=e.y,o=u()-1,t>=u()&&(t=o),n=100*(1-t/o),i.direction||(n=100-n)),p(n,t)}return void 0!==n&&(s=!(o=function(){return function(e){s||m(function(e){if(window.event&&void 0!==window.event.contentOverflow)return{x:window.event.offsetX,y:window.event.offsetY};if(void 0!==e.offsetX&&void 0!==e.offsetY)return{x:e.offsetX,y:e.offsetY};var t=e.target.parentNode.parentNode;return{x:e.layerX-t.offsetLeft,y:e.layerY-t.offsetTop}}(e=e||window.event))}}),(a=function(e,t,o){null!==e&&(e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener&&e.addEventListener(t,o,!1))})(h,"click",o()),l=o(),a(c=h,"touchstart",function(e){}),a(c,"touchmove",function(e){e.preventDefault();var t=e.srcElement.getBoundingClientRect(),o=e.touches[0].clientX-t.left,n=e.touches[0].clientY-t.top;o<0&&(o=0),n<0&&(n=0),m({x:o,y:n})}),a(c,"touchend",function(e){}),a(c,"mousedown",function(e){var o="mouseup",n="mousemove";a(window,o,function e(){function t(e,t,o){null!==e&&(e.detachEvent?e.detachEvent("on"+t,o):e.removeEventListener&&e.removeEventListener(t,o,!1))}t(window,o,e),t(window,n,l)}),a(window,n,l)}),a(c,"mouseout",function(e){s=!0}),a(c,"mouseover",function(e){s=!1})),{setValue:p}},paletteIndexes:Ue,palette:We};
/**
 * @module GuiSelectPoint
 *
 * @description A dat.gui based graphical user interface for select a point from the mesh.
 *
 * @see {@link https://github.com/anhr/dat.gui|dat.gui}, {@link https://threejs.org/docs/index.html#api/en/objects/Mesh|three.js mesh}.
 *
 * @author Andrej Hristoliubov. {@link https://anhr.github.io/AboutMe/|AboutMe}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/function Je(e,f){Je.setTHREE(e);var p,h=(f=f||{}).axesHelper,m=f.options||(h?h.options:void 0)||{scales:{x:{name:"x",min:-1,max:1},y:{name:"y",min:-1,max:1},z:{name:"z",min:-1,max:1}}},n=this,_=f.getLanguageCode||function(){return"en"},v={meshs:"Meshs",notSelected:"Not selected",select:"Select",position:"Position",rotation:"Rotation",points:"Points",point:"Point Local Position",pointTitle:"The position attribute of the selected point",pointWorld:"Point World Position",pointWorldTitle:"The position of the selected point after scaling, moving and rotation of the mesh",mesh:"Mesh",scale:"Scale",color:"Сolor",opacity:"Opacity",opacityTitle:"Float in the range of 0.0 - 1.0 indicating how transparent the material is. A value of 0.0 indicates fully transparent, 1.0 is fully opaque.",defaultButton:"Default",defaultScaleTitle:"Restore default 3d object scale.",defaultPositionTitle:"Restore default 3d object position.",default3DObjectTitle:"Restore default settings of all 3d objects.",defaultRotationTitle:"Restore default 3d object rotation.",defaultLocalPositionTitle:"Restore default local position.",moveGroup:"Move Scene"},t=_();switch(t){case"ru":v.meshs="3D объекты",v.notSelected="Не выбран",v.select="Выбрать",v.position="Позиция",v.rotation="Вращение",v.points="Точки",v.point="Локальная позиция точки",v.pointTitle="Position attribute выбранной точки",v.pointWorld="Абсолютная позиция точки",v.pointWorldTitle="Позиция выбранной точки после масштабирования, перемещения и вращения 3D объекта",v.mesh="3D объект",v.scale="Масштаб",v.color="Цвет",v.opacity="Непрозрачность",v.opacityTitle="Число в диапазоне 0,0 - 1,0, указывающий, насколько прозрачен материал. Значение 0.0 означает полностью прозрачный, 1.0 - полностью непрозрачный.",v.defaultButton="Восстановить",v.defaultScaleTitle="Восстановить масштаб 3D объекта по умолчанию.",v.defaultPositionTitle="Восстановить позицию 3D объекта по умолчанию.",v.default3DObjectTitle="Восстановить настройки всех 3D объектов по умолчанию.",v.defaultRotationTitle="Восстановить поворот 3D объекта по умолчанию.",v.defaultLocalPositionTitle="Восстановить локальную позицию точки по умолчанию.";break;default:if(void 0===f.lang||f.lang.languageCode!=t)break;Object.keys(f.lang).forEach(function(e){void 0!==v[e]&&(v[e]=f.lang[e])})}var g,y,b,w,x,E,C,S,A,k,T,P,O,R,V,L,D,F,j,N,M=this,H=new Ye.Vector3,z=new Ye.Vector3,B=new Ye.Vector3,I=!1;function X(e,t){if(void 0!==e){"boolean"==typeof t&&(t=t?"block":"none");for(var o=e.domElement;"LI"!==o.tagName.toUpperCase();)o=o.parentElement;o.style.display=t}}function q(e){var t,o;void 0===e&&(e=n.getSelectedPointIndex()),-1!==e&&(o=$e(t=E.__select.options[E.__select.options.selectedIndex].mesh,e),void 0!==h&&h.exposePosition({object:t,index:e}),B.x&&B.x.setValue(o.x),B.y&&B.y.setValue(o.y),B.z&&B.z.setValue(o.z))}function U(e,t){if(e){var o=e.domElement.querySelector("input"),n=o.readOnly;return o.readOnly=!1,e.object[e.property]=t,e.__onChange&&e.__onChange.call(e,t),e.initialValue=t,e.updateDisplay(),o.readOnly=n,e}}function r(e){var t=Qe(e.object,e.index);U(O,t.x),U(R,t.y),U(V,t.z);var o=$e(e.object,e.index);U(B.x,o.x),U(B.y,o.y),U(B.z,o.z);var n="none",i="block";"function"==typeof S.object.userData.arrayFuncs&&console.error('arrayFuncs === "function" under constraction');var r,a,s,l,c,d,u=e.object.userData.arrayFuncs?e.object.userData.arrayFuncs[e.index]:void 0,f=void 0===u?void 0:Array.isArray(u.w)||"function"==typeof u.w?execFunc(u,"w",group.userData.t,m.a,m.b):u.w;void 0===f&&(void 0===e.object.geometry.attributes.ca?console.warn("Under constraction. цвет frustumPoints не известен потому что он вычисляется в шейдере D:My documentsMyProjectswebgl\three.jsGitHubmyThreejsmaster\frustumPoints\vertex.c"):(r=(new Ye.Vector4).fromArray(e.object.geometry.attributes.ca.array,e.index*e.object.geometry.attributes.ca.itemSize),f=new Ye.Color(r.x,r.y,r.z),a=r.w)),f instanceof Ye.Color?(l=n,d=c=i,void 0===e.object.userData.arrayFuncs?d=c=n:(s="#"+f.getHexString(),j.initialValue=s,j.setValue(s),j.userData={intersection:e},void 0!==a?U(N,a):d=n,N.userData={intersection:e})):(l=void 0===L||void 0===f?n:(U(L,f),i),d=c=n),X(L,l),X(j,c),X(N,d);var p=!0===e.object.userData.boFrustumPoints;O&&(O.domElement.querySelector("input").readOnly=p),R&&(R.domElement.querySelector("input").readOnly=p),V&&(V.domElement.querySelector("input").readOnly=p),L&&(L.domElement.querySelector("input").readOnly=p),j.domElement.querySelector("input").readOnly=p,N.domElement.querySelector("input").readOnly=p}function G(){if(-1!==E.__select.options.selectedIndex)return E.__select.options[E.__select.options.selectedIndex].mesh}function o(){return void 0===G()}function W(){var e;o()||(e=G(),A&&A.setValue(e.scale.x),k&&k.setValue(e.scale.y),T&&T.setValue(e.scale.z))}function Y(){var e;o()||(e=G(),H.x&&H.x.setValue(e.position.x),H.y&&H.y.setValue(e.position.y),H.z&&H.z.setValue(e.position.z))}function Z(){var e;o()||(e=G(),z.x&&z.x.setValue(e.rotation.x),z.y&&z.y.setValue(e.rotation.y),z.z&&z.z.setValue(e.rotation.z))}return m.arrayCloud&&(p=new m.arrayCloud.cFrustumPointsF(M)),this.setMesh=function(){I=!0,W(),Y(),Z(),q(),I=!1},this.setPosition=function(e,t){for(var o=0;o<E.__select.length;o++){var n=E.__select[o];n.selected&&Object.is(n.mesh,t.object)&&r(t)}},this.update=function(){var e,t,o=E.__select.options[E.__select.options.selectedIndex].mesh;!o||-1!==(e=this.getSelectedPointIndex())&&(t=$e(o,e),B.x.setValue(t.x),B.y.setValue(t.y),B.z.setValue(t.z))},this.getMeshIndex=function(e){if(void 0===e)return e;for(var t=0;t<E.__select.options.length;t++){var o=E.__select.options[t];if(Object.is(o.mesh,e))return t}},this.setIndexMesh=function(e,t){void 0!==e&&(E.__select.options[e].mesh=t,this.selectPoint(-1))},this.selectPoint=function(e){P.__onChange(e),P.__select[e+1].selected=!0},this.removeMesh=function(e){var t=this.getMeshIndex(e),o=E.__select.selectedIndex;E.__select.remove(t),o===t&&(P.__onChange(-1),M.removePoints())},this.addMesh=function(e){for(var t=0;t<E.__select.options.length;t++){var o=E.__select.options[t];if(e.userData.boFrustumPoints&&void 0!==o.mesh&&o.mesh.userData.boFrustumPoints)return;if(void 0!==o.mesh&&""!==e.name&&o.mesh.name===e.name)return}var n=document.createElement("option");n.innerHTML=E.__select.length+" "+(""===e.name?e.constructor.name:e.name),(n.mesh=e).userData.default=e.userData.default||{scale:(new Ye.Vector3).copy(e.scale),position:e.position instanceof Ye.Vector3?(new Ye.Vector3).copy(e.position):e.position instanceof Ye.Vector4?(new Ye.Vector4).copy(e.position):void 0,rotation:(new Ye.Euler).copy(e.rotation)},E.__select.appendChild(n)},this.select=function(i){Qe(i.object,i.index);void 0===g&&console.error("Не знаю как сюда попасть");var e=this.getMeshIndex(i.object);e&&(!1===E.__select[e].selected&&(E.__select[e].selected=!0,E.__onChange(e-1)),this.selectPoint2=function(e){var t,o,n;void 0===i.index||isNaN(i.index)||void 0!==e&&!Object.is(i.object,e)||(i.object.userData.boFrustumPoints?p.pointIndexes(i.object.userData.pointIndexes(i.index)):P.__select[i.index+1].selected=!0,t="block",y.domElement.style.display=t,w.domElement.style.display=t,S=i,f.setIntersection&&f.setIntersection(i),r(i),n=void 0===(o=G()).userData.arrayFuncs||"function"==typeof S.object.userData.arrayFuncs?void 0:o.userData.arrayFuncs[i.index].line,D&&D.setValue(void 0!==n&&n.isVisible()),b.domElement.parentElement.parentElement.style.display=void 0===S.object.userData.arrayFuncs?"none":t)},this.selectPoint2())},this.isSelectedMesh=function(e){return G()===e},this.getSelectedPointIndex=function(){if(void 0!==p&&p.isDisplay()&&m.arrayCloud.frustumPoints.isDisplay()){var e=p.getSelectedIndex();return null===e?-1:e}return void 0===P?-1:P.__select.selectedOptions[0].index-1},this.add=function(e){var l,c,d,u;g=e.addFolder(v.meshs),E=g.add({Meshs:v.notSelected},"Meshs",K({},v.notSelected,-1)).onChange(function(e){var t;if(e=parseInt(e),void 0===(l=G()))t="none",(l=void 0)!==h&&h.exposePosition($e(G(),e));else{var o=void 0===l.userData.default?"none":"block";c.domElement.parentElement.parentElement.style.display=o,d.domElement.parentElement.parentElement.style.display=o,u.domElement.parentElement.parentElement.style.display=o;var n="none",i=t="block";if(P.__onChange(-1),M.removePoints(),void 0!==l.userData.controllers)l.userData.controllers();else{n="block",i="none";for(var r=0;r<l.geometry.attributes.position.count;r++){var a=document.createElement("option"),s=void 0===l.userData.arrayFuncs?void 0:void 0===l.userData.pointName?"function"==typeof l.userData.arrayFuncs?void 0:l.userData.arrayFuncs[r].name:l.userData.pointName(r);a.innerHTML=r+(void 0===s?"":" "+s),a.setAttribute("value",r),P.__select.appendChild(a)}}P.domElement.parentElement.parentElement.style.display=n,F&&(F.domElement.parentElement.parentElement.style.display=n),void 0!==p&&p.display(i),W(),Y(),Z()}C.domElement.style.display=t,void 0!==l&&void 0!==l.userData.traceAll&&F.setValue(l.userData.traceAll)}),Te.controllerNameAndTitle(E,v.select),(C=g.addFolder(v.mesh)).domElement.style.display="none",C.open();var t=C.addFolder(v.scale);t.add(new Oe(function(e,t){var o=e.controller.getValue();l.scale.x=t(l.scale.x,o),l.scale.y=t(l.scale.y,o),l.scale.z=t(l.scale.z,o),l.needsUpdate=!0,W(),q(),void 0!==m.arrayCloud&&void 0!==m.arrayCloud.frustumPoints&&m.arrayCloud.frustumPoints.updateCloudPoint(l)},{settings:{zoomMultiplier:1.1},getLanguageCode:_}));var o=new Ye.Vector3;function n(e,t){l.scale[e]=t,l.needsUpdate=!0,q(),void 0!==m.arrayCloud&&void 0!==m.arrayCloud.frustumPoints&&m.arrayCloud.frustumPoints.updateCloudPoint(l)}m.scales.x&&(A=Te.controllerZeroStep(t,o,"x",function(e){n("x",e)}),Te.controllerNameAndTitle(A,m.scales.x.name)),m.scales.y&&(k=Te.controllerZeroStep(t,o,"y",function(e){n("y",e)}),Te.controllerNameAndTitle(k,m.scales.y.name)),m.scales.z&&(T=Te.controllerZeroStep(t,o,"z",function(e){n("z",e)}),Te.controllerNameAndTitle(T,m.scales.z.name)),c=t.add({defaultF:function(){l.scale.copy(l.userData.default.scale),l.needsUpdate=!0,W(),q()}},"defaultF"),Te.controllerNameAndTitle(c,v.defaultButton,v.defaultScaleTitle);var r=C.addFolder(v.position);function i(o){var e,t,n,i=m.scales[o];i&&(e=i.name,(t=r.addFolder(e)).add(new Ve(function(e){l.position[o]+=e,l.needsUpdate=!0,Y(),q(),void 0!==m.arrayCloud&&void 0!==m.arrayCloud.frustumPoints&&m.arrayCloud.frustumPoints.updateCloudPoint(l)},{getLanguageCode:_})),n=new Ye.Vector3,H[o]=Te.controllerZeroStep(t,n,o,function(e){var t;t=e,l.position[o]=t,l.needsUpdate=!0,q()}),Te.controllerNameAndTitle(H[o],e))}i("x"),i("y"),i("z"),d=r.add({defaultF:function(){l.position.copy(l.userData.default.position),l.needsUpdate=!0,Y(),q()}},"defaultF"),Te.controllerNameAndTitle(d,v.defaultButton,v.defaultPositionTitle);var a=C.addFolder(v.rotation);function s(o){var e=m.scales[o];e&&(z[o]=a.add(new Ye.Vector3,o,0,2*Math.PI,1/360).onChange(function(e){var t=G();t.userData.boFrustumPoints||(t.rotation[o]=e,t.needsUpdate=!0),I||q(),void 0!==m.arrayCloud&&void 0!==m.arrayCloud.frustumPoints&&m.arrayCloud.frustumPoints.updateCloudPoint(t)}),Te.controllerNameAndTitle(z[o],e.name))}s("x"),s("y"),s("z"),u=a.add({defaultF:function(){l.rotation.copy(l.userData.default.rotation),l.needsUpdate=!0,Z(),q()}},"defaultF"),Te.controllerNameAndTitle(u,v.defaultButton,v.defaultRotationTitle),x=C.addFolder(v.points),(P=x.add({Points:v.notSelected},"Points",K({},v.notSelected,-1)).onChange(function(e){var t;-1===(e=parseInt(e))?t="none":(t="block",M.select({object:G(),index:e})),void 0!==h&&h.exposePosition($e(G(),e)),y.domElement.style.display=t,w.domElement.style.display=t})).__select[0].selected=!0,Te.controllerNameAndTitle(P,v.select),void 0!==p&&p.create(x,_()),f.myThreejs&&(f.myThreejs.cFrustumPoints=p),y=x.addFolder(v.point),Te.folderNameAndTitle(y,v.point,v.pointTitle),y.domElement.style.display="none",w=x.addFolder(v.pointWorld),Te.folderNameAndTitle(w,v.pointWorld,v.pointWorldTitle),w.domElement.style.display="none",w.open(),f.pointsControls&&(F=f.pointsControls(x,X,G)),Te.controllerNameAndTitle(g.add({defaultF:function(){for(var e=0;e<E.__select.options.length;e++){var t=E.__select.options[e].mesh;t&&(t.scale.copy(t.userData.default.scale),t.position.copy(t.userData.default.position),t.rotation.copy(t.userData.default.rotation),t.needsUpdate=!0)}W(),Y(),Z(),q()}},"defaultF"),v.defaultButton,v.default3DObjectTitle),function(){function r(e){return e.domElement.querySelector("input").readOnly&&(e.getValue()!==e.initialValue&&void 0===e.boSetValue&&(e.boSetValue=!0,U(e,e.initialValue),e.boSetValue=void 0,e.initialValue=e.getValue()),1)}function e(n){if("w"===n){if(void 0===m.scales.w)return;var e,t=m.scales.w,i=y.add({value:t.min},"value",t.min,t.max,(t.max-t.min)/100).onChange(function(e){var t=m.palette.toColor(e,i.__min,i.__max),o=S.object.geometry.attributes,n=S.index;M.setColorAttribute(o,n,t),o.position.setW(n,e),void 0!==m.arrayCloud&&void 0!==m.arrayCloud.frustumPoints&&m.arrayCloud.frustumPoints.updateCloudPointItem(S.object,S.index)});m.palette instanceof Ke.palette&&(i.domElement.querySelector(".slider-fg").style.height="40%",e=i.domElement.querySelector(".slider"),Ke.create(e,{palette:m.palette,style:{}}))}else(t=void 0===h?m.scales[n]:h.options?h.options.scales[n]:void 0)&&(i=y.add({value:t.min},"value",t.min,t.max,(t.max-t.min)/100).onChange(function(e){var t,o;r(i)||(t=S.object,o="x"===n?0:"y"===n?1:"z"===n?2:"w"===n?3:console.error("axisName:"+n),t.geometry.attributes.position.array[o+S.index*t.geometry.attributes.position.itemSize]=e,t.geometry.attributes.position.needsUpdate=!0,q(S.index),void 0!==m.arrayCloud&&void 0!==m.arrayCloud.frustumPoints&&m.arrayCloud.frustumPoints.updateCloudPointItem(t,S.index))}));return t&&Te.controllerNameAndTitle(i,t.name),i}O=e("x"),R=e("y"),V=e("z"),L=e("w"),j=y.addColor({color:"#FFFFFF"},"color").onChange(function(e){var t;r(j)||void 0!==j.userData&&(t=j.userData.intersection,M.setColorAttribute(t.object.geometry.attributes,t.index,e))}),Te.controllerNameAndTitle(j,v.color),N=y.add({opasity:1},"opasity",0,1,.01).onChange(function(e){var t,o;r(N)||void 0!==(o=(t=j.userData.intersection).object).geometry.attributes.ca&&(o.geometry.attributes.ca.array[3+t.index*o.geometry.attributes.ca.itemSize]=e,o.geometry.attributes.ca.needsUpdate=!0)}),Te.controllerNameAndTitle(N,v.opacity,v.opacityTitle),f.pointControls&&(D=f.pointControls(y,X,G,S));function t(e){var t=void 0===h?m.scales[e]:h.options?h.options.scales[e]:void 0;if(t){var o=Te.controllerZeroStep(w,{value:t.min},"value");return o.domElement.querySelector("input").readOnly=!0,Te.controllerNameAndTitle(o,t.name),o}}B.x=t("x"),B.y=t("y"),B.z=t("z"),b=y.add({defaultF:function(){var e=S.object.userData.arrayFuncs[S.index];O.setValue("function"==typeof e.x?e.x(group.userData.t,m.a,m.b):e.x),R.setValue("function"==typeof e.y?e.y(group.userData.t,m.a,m.b):e.y),V.setValue("function"==typeof e.z?e.z(group.userData.t,m.a,m.b):void 0===e.z?0:e.z),void 0!==e.w?void 0!==e.w.r?j.setValue("#"+new Ye.Color(e.w.r,e.w.g,e.w.b).getHexString()):"function"==typeof e.w?U(L,e.w(group.userData.t)):console.error("Restore default local position: Invalid W axis."):(j.setValue(j.initialValue),N.setValue(N.initialValue))}},"defaultF"),Te.controllerNameAndTitle(b,v.defaultButton,v.defaultLocalPositionTitle)}()},this.setColorAttribute=function(e,t,o){"string"==typeof o&&(o=new Ye.Color(o));var n=e.color||e.ca;void 0!==n&&(n.setX(t,o.r),n.setY(t,o.g),n.setZ(t,o.b),n.needsUpdate=!0)},this.removePoints=function(){P.domElement.querySelectorAll("select option").forEach(function(e){return e.remove()});var e=document.createElement("option");e.innerHTML=v.notSelected,e.setAttribute("value",-1),P.__select.appendChild(e)},this.getFrustumPoints=function(){return p},this.windowRange=function(e){pointLight1.windowRange(e.scales),pointLight2.windowRange(e.scales),O.min(e.scales.x.min),O.max(e.scales.x.max),O.updateDisplay(),R.min(e.scales.y.min),R.max(e.scales.y.max),R.updateDisplay(),V.min(e.scales.z.min),V.max(e.scales.z.max),V.updateDisplay(),void 0!==L&&(L.min(e.scales.w.min),L.max(e.scales.w.max),L.updateDisplay())},this}function Qe(e,t){if(Ye){var o=e.geometry.attributes.position,n=4<=o.itemSize?new Ye.Vector4(0,0,0,0):new Ye.Vector3;return n.fromArray(o.array,t*o.itemSize),n}console.error("getObjectLocalPosition: call GuiSelectPoint.setTHREE( THREE ); first")}function $e(e,t){if(-1!==t)return void 0===t?e.position:function(e,t){for(var o,n,i,r,a=t.clone();o=e,n=a,r=i=void 0,i=new Ye.Vector3,r=new Ye.Vector3,(i=n.clone()).multiply(o.scale),r.copy(i),r.applyEuler(o.rotation),i.x=r.x,i.y=r.y,i.z=r.z,i.add(o.position),a=i,e=e.parent;);return a}(e,Qe(e,t))}function et(t,l){(Ze=(l=l||{}).settings||{}).min=Ze.min||0,Ze.max=Ze.max||1,Ze.marks=Ze.marks||10,Ze.repeat=Ze.repeat||!1,Ze.interval=Ze.interval||1,Ze.zoomMultiplier=Ze.zoomMultiplier||1.1,Ze.offset=Ze.offset||.1;var o=0,e=this;function n(){return(Ze.max-Ze.min)/(Ze.marks-1)*o+Ze.min}this.selectScene=function(e){for(e>=Ze.marks?e=0:e<0&&(e=Ze.marks-1),o>Ze.marks&&(o=Ze.marks);o!==e;)o<e?o++:o--,t(o,n())},this.next=function(){e.selectScene(o+1)},this.prev=function(){e.selectScene(o-1)},this.pushController=function(e){void 0!==e.object&&void 0!==e.object.playRate&&(e.object.playRate=Ze.interval),s.push(e)};var i,r,a=!(this.controllers=[]),s=this.controllers,c=l.cookie,d="Player"+(l.cookieName||"");function u(){s.forEach(function(e){e.onRenamePlayButtons(a)})}function f(){a=!1,u(),i=void 0}function p(){if(++o>=Ze.marks){if(!Ze.repeat)return void f();o=0}-1!==o&&o!==Ze.marks||(o=0),t(o,n())}function h(){c.setObject(d,l.settings),l.onChangeScaleT(l.settings)}this.play3DObject=function(){a?f():(a=!0,o>=Ze.marks&&(o=-1),p(),u(),s.forEach(function(e){void 0===e.controller||(Ze.interval=e.controller.getValue())}),window.requestAnimationFrame(function e(t){if(a?window.requestAnimationFrame(e):i=void 0,void 0===i&&(r=(i=t)+1e3/Ze.interval),isNaN(r)&&console.error("Player.animate: timeNext = "+r),!(t<r)){for(;r<t;)r+=1e3/Ze.interval;p()}}))},this.repeat=function(){Ze.repeat=!Ze.repeat,this.onChangeRepeat(Ze.repeat)},this.getOptions=function(){return l},this.getSettings=function(){return l.settings},this.getSelectSceneIndex=function(){return o},this.onChangeTimerId=function(e){Ze.interval=e,h()},this.onChangeRepeat=function(e){Ze.repeat=e,this.controllers.forEach(function(e){e.onChangeRepeat()})},this.gui=function(e,o){var r={player:"Player",playerTitle:"3D objects animation.",min:"Min",max:"Max",marks:"Frames",marksTitle:"Player frames count",defaultButton:"Default",defaultTitle:"Restore default player settings."},t=void 0===o?"en":o();switch(t){case"ru":r.player="Проигрыватель",r.playerTitle="Анимация 3D объектов.",r.min="Минимум",r.max="Максимум",r.marks="Кадры",r.marksTitle="Количество кадров проигрывателя",r.defaultButton="Восстановить",r.defaultTitle="Восстановить настройки проигрывателя по умолчанию.";break;default:if(void 0===l.lang||l.lang.languageCode!=t)break;Object.keys(l.lang).forEach(function(e){void 0!==r[e]&&(r[e]=l.lang[e])})}var a=e.addFolder(r.player);Te.folderNameAndTitle(a,r.player,r.playerTitle);var s=this.PlayController;!function(){var n=l.settings,i={};function e(e,t){var o=e.controller.getValue();n.min=t(n.min,o),i.min.setValue(n.min),n.max=t(n.max,o),i.max.setValue(n.max),h()}i.folder=a.addFolder(n.name),i.scaleController=i.folder.add(new Oe(e,{settings:l.settings,getLanguageCode:o})).onChange(function(e){n.zoomMultiplier=e,h()});var t=new Ve(function(o){e(t,function(e,t){return e+=o})},{settings:l.settings,getLanguageCode:o});i.positionController=i.folder.add(t).onChange(function(e){n.offset=e,h()}),i.min=Te.controllerZeroStep(i.folder,n,"min",function(e){h()}),Te.controllerNameAndTitle(i.min,r.min),i.max=Te.controllerZeroStep(i.folder,n,"max",function(e){h()}),Te.controllerNameAndTitle(i.max,r.max),void 0!==n.marks&&(i.marks=Te.controllerZeroStep(i.folder,n,"marks",function(e){h()}),Te.controllerNameAndTitle(i.marks,void 0===n.marksName?r.marks:n.marksName,void 0===n.marksTitle?r.marksTitle:n.marksTitle)),Te.controllerNameAndTitle(i.folder.add({defaultF:function(){s.setValue(axesDefault.interval),n.zoomMultiplier=axesDefault.zoomMultiplier,i.scaleController.setValue(n.zoomMultiplier),n.offset=axesDefault.offset,i.positionController.setValue(n.offset),n.min=axesDefault.min,i.min.setValue(n.min),n.max=axesDefault.max,i.max.setValue(n.max),void 0!==axesDefault.marks&&(n.marks=axesDefault.marks,i.marks.setValue(n.marks)),h()}},"defaultF"),r.defaultButton,r.defaultTitle)}()}}function tt(){var e;this.get=function(){return e=e||new Ke.palette}}Je.setTHREE=function(e){Ye?Object.is(Ye,e)||console.error("GuiSelectPoint.setTHREE: duplicate THREE. Please use one instance of the THREE library."):Ye=e},et.execFunc=function(e,t,o,n,i){n=n||1,i=i||0;var r=e[t],a=void 0===r?"undefined":y(r);switch(a){case"undefined":return;case"function":return r(o,n,i);case"number":return r;case"object":if(Array.isArray(r)){var s=function(e){return"function"==typeof n[e]?n[e](o,n,i):n[e]instanceof THREE.Color?n[e]:void 0};if(0===r.length)return void console.error('Player.execFunc: funcs["'+t+'"] array is empty');for(var n=r,l=r.length-1,c=options.player.max,d=options.player.min,u=(c-d)/l,f=d,p=c,h=0,m=l,_=0;_<r.length;_++)u*_+d<o&&(f=u*(h=_)+d,p=u*(m=_+1)+d);if("number"!=typeof n[h])return"w"===t?s(h):void console.error('Player.execFunc: funcs["'+t+'"] array item '+h+" typeof = "+y(n[h])+" is not number");if("number"!=typeof n[m])return"w"===t?s(m):void console.error('Player.execFunc: funcs["'+t+'"] array item '+m+" typeof = "+y(n[m])+" is not number");var v=(n[m]-n[h])/(p-f),g=n[h]-v*f;return v*o+g}return r.func?r.func instanceof Function?r.func(o,n,i):r.func:void("w"!==t&&console.error('Player.execFunc: funcs["'+t+'"] object is not array'));default:console.error('Player.execFunc: Invalud typeof funcs["'+t+'"]: '+a)}},tt=new tt,et.selectPlayScene=function(p,e,h,m,_){Ke.palette.setTHREE(p),(_=_||{}).boPlayer=_.boPlayer||!1,_.a=_.a||1,_.b=_.b||0,_.palette=_.palette||tt.get(),_.scales=_.scales||{},e.userData.t=h,e.children.forEach(function(f){var e,t,o;!f.userData.player||_.boPlayer&&f.userData.boFrustumPoints||(delete f.geometry.boundingSphere,f.geometry.boundingSphere=null,f.userData.player.selectPlayScene&&f.userData.player.selectPlayScene(h),function(n,i){var e,t,r=f.geometry.attributes,o=f.userData.player.arrayFuncs;if(void 0!==o){void 0===h&&console.error("setPosition: t = "+h),void 0!==_.scales.w?(e=_.scales.w.min,t=_.scales.w.max):e=(t=d)-1;for(var a=0;a<o.length;a++){var s=function(e,t){var o=et.execFunc(l,e,h,n,i);void 0!==o&&(r.position[t](a,o),c=!0)},l=o[a],c=!1;s("x","setX"),s("y","setY"),s("z","setZ");var d,u=void 0;"function"==typeof l.w?(d=l.w(h,n,i),r.position.setW(a,d),c=!0,_.palette&&(u=_.palette.toColor(d,e,t))):"object"===y(l.w)?l.w instanceof p.Color?u=l.w:_.palette&&("object"===y(l.w)&&(l.w.min&&(e=l.w.min),l.w.max&&(t=l.w.max)),u=_.palette.toColor(et.execFunc(l,"w",h,n,i),e,t)):"number"==typeof l.w&&_.palette&&(u=_.palette.toColor(l.w,e,t)),u&&(!f.material instanceof p.ShaderMaterial&&f.material.vertexColors!==p.VertexColors&&console.error("Player.selectPlayScene: Please set the vertexColors parameter of the THREE.PointsMaterial of your points to THREE.VertexColors. Example: vertexColors: THREE.VertexColors"),!et.setColorAttribute(r,a,u)&&l instanceof p.Vector4&&(f.geometry.setAttribute("color",new p.Float32BufferAttribute(et.getColors(p,o,{positions:f.geometry.attributes.position,scale:{min:e,max:t},palette:_.palette}),3)),et.setColorAttribute(r,a,u)||console.error('Player.selectPlayScene: the color attribute is not exists. Please use THREE.Vector3 instead THREE.Vector4 in the arrayFuncs or add "color" attribute'))),c&&(r.position.needsUpdate=!0),void 0!==l.line&&l.line.addPoint($e(f,a),m,u)}}}(_.a,_.b),e="Player.selectPlayScene: invalid mesh.scale.",f.scale.x<=0&&console.error(e+"x = "+f.scale.x),f.scale.y<=0&&console.error(e+"y = "+f.scale.y),f.scale.z<=0&&console.error(e+"z = "+f.scale.z),_.guiSelectPoint&&(_.guiSelectPoint.setMesh(),-1!==(t=_.guiSelectPoint.getSelectedPointIndex())&&_.guiSelectPoint.isSelectedMesh(f)&&(o=$e(f,t),_.guiSelectPoint.setPosition(o,{object:f,index:t}))))})},et.setColorAttribute=function(e,t,o){"string"==typeof o&&(o=new THREE.Color(o));var n=e.color||e.ca;return void 0!==n&&(n.setX(t,o.r),n.setY(t,o.g),n.setZ(t,o.b),n.needsUpdate=!0)},et.getPoints=function(t,o,n){Je.setTHREE(t),(n=n||{}).t=n.t||0;for(var i=n.options||{},r=i.a||1,a=i.b||0,s=0;s<o.length;s++){var e=o[s];Array.isArray(e)?o[s]=new t.Vector4(void 0===e[0]?0:e[0],void 0===e[1]?0:e[1],void 0===e[2]?0:e[2],void 0===e[3]?0:e[3]):"object"===(void 0===e?"undefined":y(e))&&e instanceof t.Vector2==!1&&e instanceof t.Vector3==!1&&e instanceof t.Vector4==!1&&(void 0===e.vector?o[s]=new t.Vector4(void 0===e.x?0:e.x,void 0===e.y?0:e.y,void 0===e.z?0:e.z,void 0===e.w?0:e.w):e.vector instanceof t.Vector2==!0||e.vector instanceof t.Vector3==!0||e.vector instanceof t.Vector4==!0?e.vector instanceof t.Vector2==!0&&(o[s].vector=new t.Vector3(void 0===e.vector.x?0:e.vector.x,void 0===e.vector.y?0:e.vector.y,void 0===e.vector.z?0:e.vector.z)):4===e.vector.length?o[s].vector=new t.Vector4(void 0===e.vector[0]?0:e.vector[0],void 0===e.vector[1]?0:e.vector[1],void 0===e.vector[2]?0:e.vector[2],void 0===e.vector[3]?0:e.vector[3]):3===e.vector.length?o[s].vector=new t.Vector3(void 0===e.vector[0]?0:e.vector[0],void 0===e.vector[1]?0:e.vector[1],void 0===e.vector[2]?0:e.vector[2]):console.error("options.getPoints(...) falied! item.vector.length = "+e.vector.length))}for(var l=[],s=0;s<o.length;s++){var c=function(e){return"number"==typeof d&&(d=new t.Vector4(d,0,0,0)),d instanceof t.Vector2||d instanceof t.Vector3||d instanceof t.Vector4?et.execFunc(d,e,n.t,r,a):void 0!==d.vector?(void 0!==d.name&&(d.vector.name=d.name),d.trace&&(d.vector.line=new et.traceLine(t,n.group,i)),o[s]=d.vector,d=d.vector,et.execFunc(d,e,n.t,r,a)):void console.error("options.getPoints: funcs.vector = "+d.vector)},d=o[s],u=d.vector instanceof t.Vector3==!0?new t.Vector3(c("x"),c("y"),c("z")):new t.Vector4(c("x"),c("y"),c("z"),c("w"));void 0===d.w&&(u.w={}),l.push(u)}return l},et.getColors=function(n,e,i){if(Ke.palette.setTHREE(n),(i=i||{}).palette=i.palette||tt.get(),void 0!==i.positions&&Array.isArray(e)&&e.length!==i.positions.count)return console.error("getColors failed! arrayFuncs.length: "+e.length+" != positions.count: "+i.positions.count),i.colors;i.colors=i.colors||[];for(var t=Array.isArray(e)?e.length:i.positions.count,r=0;r<t;r++){var o,a,s,l=Array.isArray(e)?e[r]:void 0;if(l instanceof n.Vector4||4===i.positions.itemSize){var c,d,u=l.w;if(l.w instanceof Object&&l.w.func?(l.w.max&&(d=l.w.max),l.w.min&&(c=l.w.min),u=l.w.func):void 0!==i.scale?(c=i.scale.min,d=i.scale.max):c=(d=l instanceof n.Vector4?l.w:1)-1,u instanceof Function&&!Ze)return console.error("Player.getColors: remove all functions from all THREE.Vector4.w items of the arrayFuncs."),console.error(" \tOr create Player."),void console.error("\tIf you use MyPoints for create of the points, please add Player: Player into settings parameter of the MyPoints function after creating of the Player.");var f=i.palette.toColor(void 0===l?(new n.Vector4).fromBufferAttribute(i.positions,r).w:u instanceof Function?u(Ze.min):u,c,d);i.colors.push(f.r,f.g,f.b)}else i.colors instanceof n.Float32BufferAttribute?o=new n.Vector3(1,1,1):i.colors.push(1,1,1);void 0!==i.opacity?(a=0,s=getStandardNormalDistribution(0),group.children.forEach(function(e){if(e.userData.cloud)for(var t=0;t<e.geometry.attributes.position.count;t++){var o=$e(e,t);a+=getStandardNormalDistribution(5*getWorldPosition(camera,(new n.Vector3).fromBufferAttribute(i.positions,r)).distanceTo(o))/s}}),void 0!==debug.opacity&&(a=debug.opacity),i.colors instanceof n.Float32BufferAttribute?i.colors.setXYZW(r,o.x,o.y,o.z,a):i.colors.push(a)):i.colors.push(1)}return i.colors},et.traceLine=function(l,c,e){if(c){if(!Ze)return console.error("Player.traceLine: Remove all trace: true from arrayFunc parameter of the MyPoints or getShaderMaterialPoints method."),console.error("\tOr call Player(...)."),void console.error("\tIf you use getShaderMaterialPoints or MyPoints for create of the points, please add Player: Player into settings parameter of the getShaderMaterialPoints or MyPoints method after creating of the Player.");var d,u;if(Ze&&Ze.marks)d=Ze.marks;else{if(!e.player||!e.player.marks)return void console.error("Player.traceLine: MAX_POINTS = "+d+". Create Player first or remove all trace = true from all items of the arrayFuncs");d=e.player.marks}this.addPoint=function(e,t,o){var n,i,r;void 0===u&&(n=new l.BufferGeometry,i=new Float32Array(3*d),n.setAttribute("position",new l.BufferAttribute(i,3)),r=new Float32Array(3*d),n.setAttribute("color",new l.Float32BufferAttribute(r,3)),n.setDrawRange(t,t),(u=new l.Line(n,new l.LineBasicMaterial({vertexColors:l.VertexColors}))).visible=!0,c.add(u)),(e=(new l.Vector3).copy(e)).toArray(u.geometry.attributes.position.array,t*u.geometry.attributes.position.itemSize),u.geometry.attributes.position.needsUpdate=!0,void 0===o&&(o=new l.Color(1,1,1)),et.setColorAttribute(u.geometry.attributes,t,o);var a=u.geometry.drawRange.start,s=t+1-a;t<a&&(s=a+u.geometry.drawRange.count-(a=t)),u.geometry.setDrawRange(a,s)},this.visible=function(e){u.visible=e},this.isVisible=function(){return u.visible},this.remove=function(){void 0!==u&&(u.geometry.dispose(),u.material.dispose(),c.remove(u))}}else console.error("Player.traceLine: Define optionsPoints.group of the Player.getPoints first.")},e.default=et,Object.defineProperty(e,"__esModule",{value:!0})});
