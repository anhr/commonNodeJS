/**
 * @module Player
 * @description 3D objects animation.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("https://raw.githack.com/anhr/commonNodeJS/master/dat/dat.module.js"),require("https://raw.githack.com/anhr/commonNodeJS/master/ScaleController.js"),require("https://raw.githack.com/anhr/commonNodeJS/master/PositionController.js"),require("https://raw.githack.com/anhr/colorpicker/master/colorpicker.js")):"function"==typeof define&&define.amd?define(["exports","https://raw.githack.com/anhr/commonNodeJS/master/dat/dat.module.js","https://raw.githack.com/anhr/commonNodeJS/master/ScaleController.js","https://raw.githack.com/anhr/commonNodeJS/master/PositionController.js","https://raw.githack.com/anhr/colorpicker/master/colorpicker.js"],t):t(e.player={},e.dat_module_js,e.ScaleController,e.PositionController,e.ColorPicker)}(this,function(e,J,K,Q,$){"use strict";K=K&&K.hasOwnProperty("default")?K.default:K,Q=Q&&Q.hasOwnProperty("default")?Q.default:Q,$=$&&$.hasOwnProperty("default")?$.default:$;var ee,b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te=function(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e};function oe(e,p){oe.setTHREE(e);var f,m=(p=p||{}).axesHelper,v=p.options||(m?m.options:void 0)||{scales:{x:{name:"x",min:-1,max:1},y:{name:"y",min:-1,max:1},z:{name:"z",min:-1,max:1}}},n=this,y=p.getLanguageCode||function(){return"en"},h={meshs:"Meshs",notSelected:"Not selected",select:"Select",position:"Position",rotation:"Rotation",points:"Points",point:"Point Local Position",pointTitle:"The position attribute of the selected point",pointWorld:"Point World Position",pointWorldTitle:"The position of the selected point after scaling, moving and rotation of the mesh",mesh:"Mesh",scale:"Scale",color:"Сolor",opacity:"Opacity",opacityTitle:"Float in the range of 0.0 - 1.0 indicating how transparent the material is. A value of 0.0 indicates fully transparent, 1.0 is fully opaque.",defaultButton:"Default",defaultScaleTitle:"Restore default 3d object scale.",defaultPositionTitle:"Restore default 3d object position.",default3DObjectTitle:"Restore default settings of all 3d objects.",defaultRotationTitle:"Restore default 3d object rotation.",defaultLocalPositionTitle:"Restore default local position.",moveGroup:"Move Scene"},t=y();switch(t){case"ru":h.meshs="3D объекты",h.notSelected="Не выбран",h.select="Выбрать",h.position="Позиция",h.rotation="Вращение",h.points="Точки",h.point="Локальная позиция точки",h.pointTitle="Position attribute выбранной точки",h.pointWorld="Абсолютная позиция точки",h.pointWorldTitle="Позиция выбранной точки после масштабирования, перемещения и вращения 3D объекта",h.mesh="3D объект",h.scale="Масштаб",h.color="Цвет",h.opacity="Непрозрачность",h.opacityTitle="Число в диапазоне 0,0 - 1,0, указывающий, насколько прозрачен материал. Значение 0.0 означает полностью прозрачный, 1.0 - полностью непрозрачный.",h.defaultButton="Восстановить",h.defaultScaleTitle="Восстановить масштаб 3D объекта по умолчанию.",h.defaultPositionTitle="Восстановить позицию 3D объекта по умолчанию.",h.default3DObjectTitle="Восстановить настройки всех 3D объектов по умолчанию.",h.defaultRotationTitle="Восстановить поворот 3D объекта по умолчанию.",h.defaultLocalPositionTitle="Восстановить локальную позицию точки по умолчанию.";break;default:if(void 0===p.lang||p.lang.languageCode!=t)break;Object.keys(p.lang).forEach(function(e){void 0!==h[e]&&(h[e]=p.lang[e])})}var g,b,w,x,P,E,C,S,T,V,j,A,_,D,R,F,M,z,k,q,L=this,H=new ee.Vector3,I=new ee.Vector3,N=new ee.Vector3,X=!1;function O(e,t){if(void 0!==e){"boolean"==typeof t&&(t=t?"block":"none");for(var o=e.domElement;"LI"!==o.tagName.toUpperCase();)o=o.parentElement;o.style.display=t}}function B(e){var t,o;void 0===e&&(e=n.getSelectedPointIndex()),-1!==e&&(o=re(t=E.__select.options[E.__select.options.selectedIndex].mesh,e),void 0!==m&&m.exposePosition({object:t,index:e}),N.x&&N.x.setValue(o.x),N.y&&N.y.setValue(o.y),N.z&&N.z.setValue(o.z))}function U(e,t){if(e){var o=e.domElement.querySelector("input"),n=o.readOnly;return o.readOnly=!1,e.object[e.property]=t,e.__onChange&&e.__onChange.call(e,t),e.initialValue=t,e.updateDisplay(),o.readOnly=n,e}}function i(e){var t=ne(e.object,e.index);U(_,t.x),U(D,t.y),U(R,t.z);var o=re(e.object,e.index);U(N.x,o.x),U(N.y,o.y),U(N.z,o.z);var n="none",r="block";"function"==typeof S.object.userData.arrayFuncs&&console.error('arrayFuncs === "function" under constraction');var i,a,s,l,c,u,d=e.object.userData.arrayFuncs?e.object.userData.arrayFuncs[e.index]:void 0,p=void 0===d?void 0:Array.isArray(d.w)||"function"==typeof d.w?execFunc(d,"w",group.userData.t,v.a,v.b):d.w;void 0===p&&(void 0===e.object.geometry.attributes.ca?console.warn("Under constraction. цвет frustumPoints не известен потому что он вычисляется в шейдере D:My documentsMyProjectswebgl\three.jsGitHubmyThreejsmaster\frustumPoints\vertex.c"):(i=(new ee.Vector4).fromArray(e.object.geometry.attributes.ca.array,e.index*e.object.geometry.attributes.ca.itemSize),p=new ee.Color(i.x,i.y,i.z),a=i.w)),p instanceof ee.Color?(l=n,u=c=r,void 0===e.object.userData.arrayFuncs?u=c=n:(s="#"+p.getHexString(),k.initialValue=s,k.setValue(s),k.userData={intersection:e},void 0!==a?U(q,a):u=n,q.userData={intersection:e})):(l=void 0===F||void 0===p?n:(U(F,p),r),u=c=n),O(F,l),O(k,c),O(q,u);var f=!0===e.object.userData.boFrustumPoints;_&&(_.domElement.querySelector("input").readOnly=f),D&&(D.domElement.querySelector("input").readOnly=f),R&&(R.domElement.querySelector("input").readOnly=f),F&&(F.domElement.querySelector("input").readOnly=f),k.domElement.querySelector("input").readOnly=f,q.domElement.querySelector("input").readOnly=f}function W(){if(-1!==E.__select.options.selectedIndex)return E.__select.options[E.__select.options.selectedIndex].mesh}function o(){return void 0===W()}function G(){var e;o()||(e=W(),T&&T.setValue(e.scale.x),V&&V.setValue(e.scale.y),j&&j.setValue(e.scale.z))}function Y(){var e;o()||(e=W(),H.x&&H.x.setValue(e.position.x),H.y&&H.y.setValue(e.position.y),H.z&&H.z.setValue(e.position.z))}function Z(){var e;o()||(e=W(),I.x&&I.x.setValue(e.rotation.x),I.y&&I.y.setValue(e.rotation.y),I.z&&I.z.setValue(e.rotation.z))}return v.arrayCloud&&(f=new v.arrayCloud.cFrustumPointsF(L)),this.setMesh=function(){X=!0,G(),Y(),Z(),B(),X=!1},this.setPosition=function(e,t){for(var o=0;o<E.__select.length;o++){var n=E.__select[o];n.selected&&Object.is(n.mesh,t.object)&&i(t)}},this.update=function(){var e,t,o=E.__select.options[E.__select.options.selectedIndex].mesh;!o||-1!==(e=this.getSelectedPointIndex())&&(t=re(o,e),N.x.setValue(t.x),N.y.setValue(t.y),N.z.setValue(t.z))},this.getMeshIndex=function(e){if(void 0===e)return e;for(var t=0;t<E.__select.options.length;t++){var o=E.__select.options[t];if(Object.is(o.mesh,e))return t}},this.setIndexMesh=function(e,t){void 0!==e&&(E.__select.options[e].mesh=t,this.selectPoint(-1))},this.selectPoint=function(e){A.__onChange(e),A.__select[e+1].selected=!0},this.removeMesh=function(e){var t=this.getMeshIndex(e),o=E.__select.selectedIndex;E.__select.remove(t),o===t&&(A.__onChange(-1),L.removePoints())},this.addMesh=function(e){for(var t=0;t<E.__select.options.length;t++){var o=E.__select.options[t];if(e.userData.boFrustumPoints&&void 0!==o.mesh&&o.mesh.userData.boFrustumPoints)return;if(void 0!==o.mesh&&""!==e.name&&o.mesh.name===e.name)return}var n=document.createElement("option");n.innerHTML=E.__select.length+" "+(""===e.name?e.constructor.name:e.name),(n.mesh=e).userData.default=e.userData.default||{scale:(new ee.Vector3).copy(e.scale),position:e.position instanceof ee.Vector3?(new ee.Vector3).copy(e.position):e.position instanceof ee.Vector4?(new ee.Vector4).copy(e.position):void 0,rotation:(new ee.Euler).copy(e.rotation)},E.__select.appendChild(n)},this.select=function(r){ne(r.object,r.index);void 0===g&&console.error("Не знаю как сюда попасть");var e=this.getMeshIndex(r.object);e&&(!1===E.__select[e].selected&&(E.__select[e].selected=!0,E.__onChange(e-1)),this.selectPoint2=function(e){var t,o,n;void 0===r.index||isNaN(r.index)||void 0!==e&&!Object.is(r.object,e)||(r.object.userData.boFrustumPoints?f.pointIndexes(r.object.userData.pointIndexes(r.index)):A.__select[r.index+1].selected=!0,t="block",b.domElement.style.display=t,x.domElement.style.display=t,S=r,p.setIntersection&&p.setIntersection(r),i(r),n=void 0===(o=W()).userData.arrayFuncs||"function"==typeof S.object.userData.arrayFuncs?void 0:o.userData.arrayFuncs[r.index].line,M&&M.setValue(void 0!==n&&n.isVisible()),w.domElement.parentElement.parentElement.style.display=void 0===S.object.userData.arrayFuncs?"none":t)},this.selectPoint2())},this.isSelectedMesh=function(e){return W()===e},this.getSelectedPointIndex=function(){if(void 0!==f&&f.isDisplay()&&v.arrayCloud.frustumPoints.isDisplay()){var e=f.getSelectedIndex();return null===e?-1:e}return void 0===A?-1:A.__select.selectedOptions[0].index-1},this.add=function(e){var l,c,u,d;g=e.addFolder(h.meshs),E=g.add({Meshs:h.notSelected},"Meshs",te({},h.notSelected,-1)).onChange(function(e){var t;if(e=parseInt(e),void 0===(l=W()))t="none",(l=void 0)!==m&&m.exposePosition(re(W(),e));else{var o=void 0===l.userData.default?"none":"block";c.domElement.parentElement.parentElement.style.display=o,u.domElement.parentElement.parentElement.style.display=o,d.domElement.parentElement.parentElement.style.display=o;var n="none",r=t="block";if(A.__onChange(-1),L.removePoints(),void 0!==l.userData.controllers)l.userData.controllers();else{n="block",r="none";for(var i=0;i<l.geometry.attributes.position.count;i++){var a=document.createElement("option"),s=void 0===l.userData.arrayFuncs?void 0:void 0===l.userData.pointName?"function"==typeof l.userData.arrayFuncs?void 0:l.userData.arrayFuncs[i].name:l.userData.pointName(i);a.innerHTML=i+(void 0===s?"":" "+s),a.setAttribute("value",i),A.__select.appendChild(a)}}A.domElement.parentElement.parentElement.style.display=n,z&&(z.domElement.parentElement.parentElement.style.display=n),void 0!==f&&f.display(r),G(),Y(),Z()}C.domElement.style.display=t,void 0!==l&&void 0!==l.userData.traceAll&&z.setValue(l.userData.traceAll)}),J.dat.controllerNameAndTitle(E,h.select),(C=g.addFolder(h.mesh)).domElement.style.display="none",C.open();var t=C.addFolder(h.scale);t.add(new K(function(e,t){var o=e.controller.getValue();l.scale.x=t(l.scale.x,o),l.scale.y=t(l.scale.y,o),l.scale.z=t(l.scale.z,o),l.needsUpdate=!0,G(),B(),void 0!==v.arrayCloud&&void 0!==v.arrayCloud.frustumPoints&&v.arrayCloud.frustumPoints.updateCloudPoint(l)},{settings:{zoomMultiplier:1.1},getLanguageCode:y}));var o=new ee.Vector3;function n(e,t){l.scale[e]=t,l.needsUpdate=!0,B(),void 0!==v.arrayCloud&&void 0!==v.arrayCloud.frustumPoints&&v.arrayCloud.frustumPoints.updateCloudPoint(l)}v.scales.x&&(T=J.dat.controllerZeroStep(t,o,"x",function(e){n("x",e)}),J.dat.controllerNameAndTitle(T,v.scales.x.name)),v.scales.y&&(V=J.dat.controllerZeroStep(t,o,"y",function(e){n("y",e)}),J.dat.controllerNameAndTitle(V,v.scales.y.name)),v.scales.z&&(j=J.dat.controllerZeroStep(t,o,"z",function(e){n("z",e)}),J.dat.controllerNameAndTitle(j,v.scales.z.name)),c=t.add({defaultF:function(){l.scale.copy(l.userData.default.scale),l.needsUpdate=!0,G(),B()}},"defaultF"),J.dat.controllerNameAndTitle(c,h.defaultButton,h.defaultScaleTitle);var i=C.addFolder(h.position);function r(o){var e,t,n,r=v.scales[o];r&&(e=r.name,(t=i.addFolder(e)).add(new Q(function(e){l.position[o]+=e,l.needsUpdate=!0,Y(),B(),void 0!==v.arrayCloud&&void 0!==v.arrayCloud.frustumPoints&&v.arrayCloud.frustumPoints.updateCloudPoint(l)},{getLanguageCode:y})),n=new ee.Vector3,H[o]=J.dat.controllerZeroStep(t,n,o,function(e){var t;t=e,l.position[o]=t,l.needsUpdate=!0,B()}),J.dat.controllerNameAndTitle(H[o],e))}r("x"),r("y"),r("z"),u=i.add({defaultF:function(){l.position.copy(l.userData.default.position),l.needsUpdate=!0,Y(),B()}},"defaultF"),J.dat.controllerNameAndTitle(u,h.defaultButton,h.defaultPositionTitle);var a=C.addFolder(h.rotation);function s(o){var e=v.scales[o];e&&(I[o]=a.add(new ee.Vector3,o,0,2*Math.PI,1/360).onChange(function(e){var t=W();t.userData.boFrustumPoints||(t.rotation[o]=e,t.needsUpdate=!0),X||B(),void 0!==v.arrayCloud&&void 0!==v.arrayCloud.frustumPoints&&v.arrayCloud.frustumPoints.updateCloudPoint(t)}),J.dat.controllerNameAndTitle(I[o],e.name))}s("x"),s("y"),s("z"),d=a.add({defaultF:function(){l.rotation.copy(l.userData.default.rotation),l.needsUpdate=!0,Z(),B()}},"defaultF"),J.dat.controllerNameAndTitle(d,h.defaultButton,h.defaultRotationTitle),P=C.addFolder(h.points),(A=P.add({Points:h.notSelected},"Points",te({},h.notSelected,-1)).onChange(function(e){var t;-1===(e=parseInt(e))?t="none":(t="block",L.select({object:W(),index:e})),void 0!==m&&m.exposePosition(re(W(),e)),b.domElement.style.display=t,x.domElement.style.display=t})).__select[0].selected=!0,J.dat.controllerNameAndTitle(A,h.select),void 0!==f&&f.create(P,y()),p.myThreejs&&(p.myThreejs.cFrustumPoints=f),b=P.addFolder(h.point),J.dat.folderNameAndTitle(b,h.point,h.pointTitle),b.domElement.style.display="none",x=P.addFolder(h.pointWorld),J.dat.folderNameAndTitle(x,h.pointWorld,h.pointWorldTitle),x.domElement.style.display="none",x.open(),p.pointsControls&&(z=p.pointsControls(P,O,W)),J.dat.controllerNameAndTitle(g.add({defaultF:function(){for(var e=0;e<E.__select.options.length;e++){var t=E.__select.options[e].mesh;t&&(t.scale.copy(t.userData.default.scale),t.position.copy(t.userData.default.position),t.rotation.copy(t.userData.default.rotation),t.needsUpdate=!0)}G(),Y(),Z(),B()}},"defaultF"),h.defaultButton,h.default3DObjectTitle),function(){function i(e){return e.domElement.querySelector("input").readOnly&&(e.getValue()!==e.initialValue&&void 0===e.boSetValue&&(e.boSetValue=!0,U(e,e.initialValue),e.boSetValue=void 0,e.initialValue=e.getValue()),1)}function e(n){if("w"===n){if(void 0===v.scales.w)return;var e,t=v.scales.w,r=b.add({value:t.min},"value",t.min,t.max,(t.max-t.min)/100).onChange(function(e){var t=v.palette.toColor(e,r.__min,r.__max),o=S.object.geometry.attributes,n=S.index;L.setColorAttribute(o,n,t),o.position.setW(n,e),void 0!==v.arrayCloud&&void 0!==v.arrayCloud.frustumPoints&&v.arrayCloud.frustumPoints.updateCloudPointItem(S.object,S.index)});v.palette instanceof $.palette&&(r.domElement.querySelector(".slider-fg").style.height="40%",e=r.domElement.querySelector(".slider"),$.create(e,{palette:v.palette,style:{}}))}else(t=void 0===m?v.scales[n]:m.options?m.options.scales[n]:void 0)&&(r=b.add({value:t.min},"value",t.min,t.max,(t.max-t.min)/100).onChange(function(e){var t,o;i(r)||(t=S.object,o="x"===n?0:"y"===n?1:"z"===n?2:"w"===n?3:console.error("axisName:"+n),t.geometry.attributes.position.array[o+S.index*t.geometry.attributes.position.itemSize]=e,t.geometry.attributes.position.needsUpdate=!0,B(S.index),void 0!==v.arrayCloud&&void 0!==v.arrayCloud.frustumPoints&&v.arrayCloud.frustumPoints.updateCloudPointItem(t,S.index))}));return t&&J.dat.controllerNameAndTitle(r,t.name),r}_=e("x"),D=e("y"),R=e("z"),F=e("w"),k=b.addColor({color:"#FFFFFF"},"color").onChange(function(e){var t;i(k)||void 0!==k.userData&&(t=k.userData.intersection,L.setColorAttribute(t.object.geometry.attributes,t.index,e))}),J.dat.controllerNameAndTitle(k,h.color),q=b.add({opasity:1},"opasity",0,1,.01).onChange(function(e){var t,o;i(q)||void 0!==(o=(t=k.userData.intersection).object).geometry.attributes.ca&&(o.geometry.attributes.ca.array[3+t.index*o.geometry.attributes.ca.itemSize]=e,o.geometry.attributes.ca.needsUpdate=!0)}),J.dat.controllerNameAndTitle(q,h.opacity,h.opacityTitle),p.pointControls&&(M=p.pointControls(b,O,W,S));function t(e){var t=void 0===m?v.scales[e]:m.options?m.options.scales[e]:void 0;if(t){var o=J.dat.controllerZeroStep(x,{value:t.min},"value");return o.domElement.querySelector("input").readOnly=!0,J.dat.controllerNameAndTitle(o,t.name),o}}N.x=t("x"),N.y=t("y"),N.z=t("z"),w=b.add({defaultF:function(){var e=S.object.userData.arrayFuncs[S.index];_.setValue("function"==typeof e.x?e.x(group.userData.t,v.a,v.b):e.x),D.setValue("function"==typeof e.y?e.y(group.userData.t,v.a,v.b):e.y),R.setValue("function"==typeof e.z?e.z(group.userData.t,v.a,v.b):void 0===e.z?0:e.z),void 0!==e.w?void 0!==e.w.r?k.setValue("#"+new ee.Color(e.w.r,e.w.g,e.w.b).getHexString()):"function"==typeof e.w?U(F,e.w(group.userData.t)):console.error("Restore default local position: Invalid W axis."):(k.setValue(k.initialValue),q.setValue(q.initialValue))}},"defaultF"),J.dat.controllerNameAndTitle(w,h.defaultButton,h.defaultLocalPositionTitle)}()},this.setColorAttribute=function(e,t,o){"string"==typeof o&&(o=new ee.Color(o));var n=e.color||e.ca;void 0!==n&&(n.setX(t,o.r),n.setY(t,o.g),n.setZ(t,o.b),n.needsUpdate=!0)},this.removePoints=function(){A.domElement.querySelectorAll("select option").forEach(function(e){return e.remove()});var e=document.createElement("option");e.innerHTML=h.notSelected,e.setAttribute("value",-1),A.__select.appendChild(e)},this.getFrustumPoints=function(){return f},this.windowRange=function(e){pointLight1.windowRange(e.scales),pointLight2.windowRange(e.scales),_.min(e.scales.x.min),_.max(e.scales.x.max),_.updateDisplay(),D.min(e.scales.y.min),D.max(e.scales.y.max),D.updateDisplay(),R.min(e.scales.z.min),R.max(e.scales.z.max),R.updateDisplay(),void 0!==F&&(F.min(e.scales.w.min),F.max(e.scales.w.max),F.updateDisplay())},this}function ne(e,t){if(ee){var o=e.geometry.attributes.position,n=4<=o.itemSize?new ee.Vector4(0,0,0,0):new ee.Vector3;return n.fromArray(o.array,t*o.itemSize),n}console.error("getObjectLocalPosition: call GuiSelectPoint.setTHREE( THREE ); first")}function re(e,t){if(-1!==t)return void 0===t?e.position:function(e,t){for(var o,n,r,i,a=t.clone();o=e,n=a,i=r=void 0,r=new ee.Vector3,i=new ee.Vector3,(r=n.clone()).multiply(o.scale),i.copy(r),i.applyEuler(o.rotation),r.x=i.x,r.y=i.y,r.z=i.z,r.add(o.position),a=r,e=e.parent;);return a}(e,ne(e,t))}
/**
 * node.js version of the synchronous download of the file.
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
function r(t){if(this.loadXMLDoc=function(){var e;if(window.XMLHttpRequest){if(!(e=new XMLHttpRequest))throw"new XMLHttpRequest() failed!"}else{if(!window.ActiveXObject)throw"myRequest.loadXMLDoc(...) failed!";if(!(e=this.NewActiveXObject()))throw"NewActiveXObject() failed!"}return e},this.NewActiveXObject=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}return a('This browser does not support XMLHttpRequest. Probably, your security settings do not allow Web sites to use ActiveX controls installed on your computer. Refresh your Web page to find out the current status of your Web page or enable the "Initialize and script ActiveX controls not marked as safe" and "Run Active X controls and plug-ins" of the Security settings of the Internet zone of your browser.'),null},this.XMLHttpRequestStart=function(e,t){this.XMLHttpRequestStop(),this.req.onreadystatechange=e,"onerror"in this.req&&(this.req.onerror=function(e){a("XMLHttpRequest error. url: "+this.url)}),this.XMLHttpRequestReStart(t)},this.getUrl=function(){return void 0!==this.url&&null!=this.url||(this.url="XMLHttpRequest.xml"),this.url+(this.params?this.params:"")},this.XMLHttpRequestReStart=function(e){try{void 0===e&&(e=!0),this.req.open("GET",this.getUrl(),e),e&&("timeout"in this.req&&(this.req.timeout=9e4),"ontimeout"in this.req?this.req.ontimeout=function(){a("XMLHttpRequest timeout")}:(clearTimeout(this.timeout_id_SendReq),this.timeout_id_SendReq=setTimeout(function(){a("XMLHttpRequest timeout 2")},9e4))),this.req.send(null)}catch(e){a(e.message+" url: "+this.url)}},this.XMLHttpRequestStop=function(){null!=this.req&&this.req.abort()},this.ProcessReqChange=function(e){var t=this.req;switch(t.readyState){case 4:if("unknown"==typeof t.status)return consoleError('typeof XMLHttpRequest status == "unknown"'),!0;if(200==t.status)return clearTimeout(this.timeout_id_SendReq),e(this);a("Invalid XMLHttpRequest status : "+t.status+" url: "+this.url);break;case 1:case 2:case 3:break;case 0:default:throw"processReqChange(); req.readyState = "+t.readyState}return!0},this.processStatus200Error=function(){var e=this.GetElementText("error",!0);return!!e&&(a(e),!0)},this.GetElementText=function(e,t){var o=this.req;if(!o.responseXML)return 1!=t&&a("GetXMLElementText(xmlhttp, "+e+"); xmlhttp.responseXML is null.\nxmlhttp.responseText:\n"+o.responseText),null;var n=o.responseXML.getElementsByTagName(e);if(0==n.length)return 1!=t&&a('GetXMLElementText(xmlhttp, "'+e+'"); element.length == '+n.length),"";for(var r="",i=0;i<n.length;i++)if(void 0===n[i].textContent){if(void 0===n[i].text)return a("GetXMLElementText(xmlhttp, "+e+"); element["+i+"].text) == undefined"),"";""!=r&&(r+=" "),r+=n[i].text}else r+=n[i].textContent;return r},t.data)this.req=t.data.req,this.url=t.data.url,this.params=t.data.params;else try{this.req=this.loadXMLDoc()}catch(e){var o;return o=void 0===e.message?e:e.message,void a("Your browser is too old and is not compatible with our site.\n\n"+window.navigator.appName+" "+window.navigator.appVersion+"\n\n"+o)}function a(e){console.error(e),t.onerror(e)}this.req||consoleError("Invalid myRequest.req: "+this.req)}function a(t,o){(o=o||{}).onload=o.onload||function(){},o.onerror=o.onerror||function(){};var n,e=new r(o);return e.url=t,e.XMLHttpRequestStart(function(){e.ProcessReqChange(function(e){e.processStatus200Error()||(n=e.req.responseText,o.onload(n,t))})},!1),n}
/**
 * node.js version of the load JavaScript file
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * Thanks to:
 *http://javascript.ru/forum/events/21439-dinamicheskaya-zagruzka-skriptov.html
 *https://learn.javascript.ru/onload-onerror
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function s(e,t){if(t.tag=t.tag||{},"string"==typeof t.tag){if("style"!==t.tag)return void console.error("Invalid options.tag: "+t.tag);t.tag={name:"style",attribute:{name:"rel",value:"stylesheet"}}}t.tag.name=t.tag.name||"script";var o=document.createElement(t.tag.name);t.tag.attribute=t.tag.attribute||{},t.tag.attribute.name=t.tag.attribute.name||"type",t.tag.attribute.value=t.tag.attribute.value||"text/javascript",o.setAttribute(t.tag.attribute.name,t.tag.attribute.value),e(o),t.appendTo.appendChild(o)}function l(e,t){for(var o=e.querySelectorAll("script"),n=0;n<o.length;n++){if(o[n].id===t)return 1}}oe.setTHREE=function(e){ee?Object.is(ee,e)||console.error("GuiSelectPoint.setTHREE: duplicate THREE. Please use one instance of the THREE library."):ee=e};({sync:function(t,o){if((o=o||{}).onload=o.onload||function(){},o.onerror=o.onerror||function(){},o.appendTo=o.appendTo||document.getElementsByTagName("head")[0],l(o.appendTo,t))o.onload();else if(t instanceof Array){for(var n,r={appendTo:o.appendTo,tag:o.tag,onload:function(e,t){console.log("loadScript.sync.onload: "+t)},onerror:function(e){o.onerror(e),n=e}},e=0;e<t.length;e++){var i=t[e];if(s(function(e){e.setAttribute("id",i),e.innerHTML=a(i,r)},r),void 0!==n)break}void 0===n&&o.onload()}else s(function(e){e.setAttribute("id",t),e.innerHTML=a(t,o)},o)},async:function(e,n){var r;function i(t){function o(){e instanceof Array&&r<e.length-1?i(e[++r]):n.onload()}l(n.appendTo,t,n.onload)?o():s(function(e){e.setAttribute("id",t),e.readyState&&!e.onload?e.onreadystatechange=function(){"complete"==e.readyState&&void 0!==n.onload&&n.onload(),"loaded"==e.readyState&&(setTimeout(n.onload,0),this.onreadystatechange=null)}:(e.onload=function(){console.log("loadScript.async.onload() "+t),void 0!==n.onload&&o()},e.onerror=function(e){var t='loadScript: "'+this.src+'" failed';void 0!==n.onerror&&n.onerror(t,e),console.error(t)}),e.src=t},n)}(n=n||{}).appendTo=n.appendTo||document.getElementsByTagName("head")[0],n.onload=n.onload||function(){},e instanceof Array?i(e[r=0]):i(e)}}).sync("/anhr/colorpicker/master/colorpicker.css",{tag:"style"});var i,y=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",c="http://www.w3.org/2000/svg",h=0,o={BGRW:0,monochrome:1,bidirectional:2,rainbow:3};function g(e,t,o){for(var n in e=document.createElementNS(c,e),t)e.setAttribute(n,t[n]);"[object Array]"!=Object.prototype.toString.call(o)&&(o=[o]);for(var r=0,i=o[0]&&o.length||0;r<i;r++)e.appendChild(o[r]);return e}function w(f){function e(e,t,o,n){return{percent:e,r:t,g:o,b:n}}void 0===(f=f||{}).palette&&(f.palette=o.BGRW);var m=[new e(0,0,0,255),new e(33,0,255,0),new e(66,255,255,0),new e(100,255,255,255)];switch(b(f.palette)){case"number":switch(f.palette){case o.BGRW:break;case o.monochrome:m=[new e(0,0,0,0),new e(100,255,255,255)];break;case o.bidirectional:m=[new e(0,255,48,48),new e(50,48,48,48),new e(100,48,255,48)];break;case o.rainbow:m=[new e(0,255,50,50),new e(16,252,245,40),new e(32,40,252,40),new e(50,40,252,248),new e(66,39,46,249),new e(82,255,40,251),new e(100,255,50,50)];break;default:console.error("ColorPicker.create.Palette: invalid options.palette = "+f.palette)}break;case"object":if(Array.isArray(f.palette)){m=f.palette;break}default:var t="invalid options.palette = "+f.palette;console.error("ColorPicker.create.Palette: "+t),f.onError(t)}this.getPalette=function(){var t=[];return m.forEach(function(e){t.unshift(g("stop",{offset:100-e.percent+"%","stop-color":"#"+("0"+Number(e.r).toString(16)).slice(-2).toUpperCase()+("0"+Number(e.g).toString(16)).slice(-2).toUpperCase()+("0"+Number(e.b).toString(16)).slice(-2).toUpperCase(),"stop-opacity":"1"}))}),t},this.hsv2rgb=function(e,t,o){var i=parseFloat(e);void 0!==t&&void 0!==o&&(i=100/(o-t)*(i-t));var n,r,a=m[m.length-1];100!==a.percent&&(n={},Object.keys(a).forEach(function(e){n[e]=a[e]}),n.percent=100,m.push(n));for(var s=0;s<m.length;s++){var l=m[s];if(void 0===r&&(r=l),i>=r.percent&&i<=l.percent){var c=function(e,t,o,n){var r=o-e;return 0==r?t:Math.round(t+(n-t)/r*(i-e))},u=c(r.percent,r.r,l.percent,l.r),d=c(r.percent,r.g,l.percent,l.g),p=c(r.percent,r.b,l.percent,l.b);return{r:u,g:d,b:p,hex:"#"+(16777216|p|d<<8|u<<16).toString(16).slice(1),percent:i}}r=l}void 0!==f.onError&&f.onError("Invalid color value of the ColorPicker: "+e)},this.toColor=function(e,t,o){if(void 0!==i){if(e instanceof i.Color)return e;var n=this.hsv2rgb(e,t,o);return void 0===n&&(n={r:255,g:255,b:255}),new i.Color("rgb("+n.r+", "+n.g+", "+n.b+")")}console.error("Call ColorPicker.palette.setTHREE(THREE) first.")}}w.setTHREE=function(e){i?Object.is(i,e)||console.error("Palette.setTHREE: duplicate THREE. Please use one instance of the THREE library."):i=e};
/**
* @module ColorPicker
* @description Pure JavaScript color picker.
* @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
*
* Thanks to https://github.com/DavidDurman/FlexiColorPicker
*
* @copyright 2011 Data Arts Team, Google Creative Lab
*
* @license under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
*/
var p,t={create:function(e,r){function i(){return"horizontal"===r.orientation}if((r=r||{}).orientation=r.orientation||"horizontal",void 0===r.direction&&(r.direction=!0),r.style=r.style||{},r.style.width=r.style.width||(i()?200:30),r.style.height=r.style.height||(i()?30:200),r.onError=r.onError||function(){},e instanceof HTMLElement!=!0){if("string"!=typeof e)return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e);if(null===(e=document.getElementById(e)))return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e)}for(var t in e.classList.add("slider-wrapper"),r.style)e.style[t]=r.style[t];var n,o,a,s,l,c,u=r.palette instanceof w?r.palette:new w(r);function d(){return"string"==typeof r.style.height?parseInt(r.style.height):r.style.height}function p(){return m.clientWidth}function f(e,t){var o;void 0!==n?void 0!==(o=u.hsv2rgb(e))?(e=o.percent,void 0===t&&(t=i()?p()*e/100:d()-d()*(r.direction?e:100-e)/100),function(e){if(void 0===n)return;if(i()){if(e<0||e>p())return console.error("ColorPicker.positionIndicators: Invalid position = "+e);n.style.top="0px",n.style.left=(r.direction?e:p()-e)-n.offsetWidth/2+"px"}else{if(e<0||e>d())return console.error("ColorPicker.positionIndicators: Invalid position = "+e);n.style.left="0px",n.style.top=e-n.offsetHeight/2+"px"}}(t),void 0!==r.sliderIndicator.callback&&r.sliderIndicator.callback(o)):console.error("ColorPicker.setValue: invalud c = "+o):console.error("Set value of this instance of the ColorPicker is impossible because options.sliderIndicator is not defined.")}if(void 0!==r.sliderIndicator&&((n=document.createElement("div")).className="slider-indicator",i()?n.style.width="10px":n.style.height="10px",e.appendChild(n),n.style.pointerEvents="none"),"SVG"==y){try{var m=g("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:i()?"100%":r.style.width,height:r.style.height},[g("defs",{},g("linearGradient",{id:"gradient-hsv-"+h,x1:i()&&r.direction?"100%":"0%",y1:i()||r.direction?"0%":"100%",x2:i()&&!r.direction?"100%":"0%",y2:!i()&&r.direction?"100%":"0%"},u.getPalette())),g("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv-"+h+")"})]);void 0!==n&&(m.style.cursor=i()?"e-resize":"s-resize",n.style.cursor=m.style.cursor)}catch(e){console.error("Create SVG element failed! "+e.message)}e.appendChild(m),e.style.height=d()+"px",void 0!==n&&(i()?n.style.height=parseInt(r.style.height)-2+"px":n.style.width=parseInt(r.style.width)-2+"px",r.sliderIndicator.value=r.sliderIndicator.value||0,f(r.sliderIndicator.value)),h++}else console.error("Under constraction");function v(e){var t,o,n;e.x=parseInt(e.x),e.y=parseInt(e.y),i()?(t=e.x,o=p()-1,t>=p()&&(t=o),n=100*t/o,r.direction||(n=100-n,t=o-t)):(t=e.y,o=d()-1,t>=d()&&(t=o),n=100*(1-t/o),r.direction||(n=100-n)),f(n,t)}return void 0!==n&&(s=!(o=function(){return function(e){s||v(function(e){if(window.event&&void 0!==window.event.contentOverflow)return{x:window.event.offsetX,y:window.event.offsetY};if(void 0!==e.offsetX&&void 0!==e.offsetY)return{x:e.offsetX,y:e.offsetY};var t=e.target.parentNode.parentNode;return{x:e.layerX-t.offsetLeft,y:e.layerY-t.offsetTop}}(e=e||window.event))}}),(a=function(e,t,o){null!==e&&(e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener&&e.addEventListener(t,o,!1))})(m,"click",o()),l=o(),a(c=m,"touchstart",function(e){}),a(c,"touchmove",function(e){e.preventDefault();var t=e.srcElement.getBoundingClientRect(),o=e.touches[0].clientX-t.left,n=e.touches[0].clientY-t.top;o<0&&(o=0),n<0&&(n=0),v({x:o,y:n})}),a(c,"touchend",function(e){}),a(c,"mousedown",function(e){var o="mouseup",n="mousemove";a(window,o,function e(){function t(e,t,o){null!==e&&(e.detachEvent?e.detachEvent("on"+t,o):e.removeEventListener&&e.removeEventListener(t,o,!1))}t(window,o,e),t(window,n,l)}),a(window,n,l)}),a(c,"mouseout",function(e){s=!0}),a(c,"mouseover",function(e){s=!1})),{setValue:f}},paletteIndexes:o,palette:w};
/**
 * @module Player
 * @description 3D objects animation.
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function x(t,o){(p=t.settings||{}).min=p.min||0,p.max=p.max||1,p.marks=p.marks||2,p.repeat=p.repeat||!1,p.interval=p.interval||25,p.zoomMultiplier=p.zoomMultiplier||1.1,p.offset=p.offset||.1;var n=0,e=this;function r(){return(p.max-p.min)/(p.marks-1)*n+p.min}this.selectScene=function(e){for(e>=p.marks?e=0:e<0&&(e=p.marks-1),n>p.marks&&(n=p.marks);n!==e;)n<e?n++:n--,o(n,r())},this.next=function(){e.selectScene(n+1)},this.prev=function(){e.selectScene(n-1)},this.pushController=function(e){void 0!==e.object&&void 0!==e.object.playRate&&(e.object.playRate=p.interval),l.push(e)};var i,a,s=!(this.controllers=[]),l=this.controllers;function c(){l.forEach(function(e){e.onRenamePlayButtons(s)})}function u(){s=!1,c(),i=void 0}function d(){if(++n>=p.marks){if(!p.repeat)return void u();n=0}-1!==n&&n!==p.marks||(n=0),o(n,r())}this.animate=function(){if(void 0!==i){var e=(new Date).getTime();if(isNaN(a)&&console.error("Player.animate: timeNext = "+a),!(e<a)){for(;a<e;)a+=1e3/p.interval;d()}}},this.play3DObject=function(){s?u():(s=!0,n>=p.marks&&(n=-1),d(),c(),l.forEach(function(e){void 0===e.controller||(p.interval=e.controller.getValue())}),i=(new Date).getTime(),a=i+1e3/p.interval)},this.repeat=function(){p.repeat=!p.repeat,this.onChangeRepeat(p.repeat)},this.getOptions=function(){return t},this.getSettings=function(){return t.settings},this.getSelectSceneIndex=function(){return n},this.onChangeTimerId=function(e){p.interval=e,cookie.setObject(cookieName,t.settings),t.onChangeScaleT(t.settings)},this.onChangeRepeat=function(e){p.repeat=e,this.controllers.forEach(function(e){e.onChangeRepeat()})}}x.execFunc=function(e,t,o,n,r){n=n||1,r=r||0;var i=e[t],a=void 0===i?"undefined":b(i);switch(a){case"undefined":return;case"function":return i(o,n,r);case"number":return i;case"object":if(Array.isArray(i)){var s=function(e){return"function"==typeof n[e]?n[e](o,n,r):n[e]instanceof THREE.Color?n[e]:void 0};if(0===i.length)return void console.error('Player.execFunc: funcs["'+t+'"] array is empty');for(var n=i,l=i.length-1,c=options.player.max,u=options.player.min,d=(c-u)/l,p=u,f=c,m=0,v=l,y=0;y<i.length;y++)d*y+u<o&&(p=d*(m=y)+u,f=d*(v=y+1)+u);if("number"!=typeof n[m])return"w"===t?s(m):void console.error('Player.execFunc: funcs["'+t+'"] array item '+m+" typeof = "+b(n[m])+" is not number");if("number"!=typeof n[v])return"w"===t?s(v):void console.error('Player.execFunc: funcs["'+t+'"] array item '+v+" typeof = "+b(n[v])+" is not number");var h=(n[v]-n[m])/(f-p),g=n[m]-h*p;return h*o+g}return i.func?i.func(o,n,r):void("w"!==t&&console.error('Player.execFunc: funcs["'+t+'"] object is not array'));default:console.error('Player.execFunc: Invalud typeof funcs["'+t+'"]: '+a)}};var P=new t.palette;x.selectPlayScene=function(f,e,m,v,y){y.boPlayer=y.boPlayer||!1,(y=y||{}).a=y.a||1,y.b=y.b||0,y.palette=y.palette||P,y.scales=y.scales||{},e.userData.t=m,e.children.forEach(function(p){var e,t,o;void 0===p.userData.selectPlayScene||y.boPlayer&&p.userData.boFrustumPoints||(delete p.geometry.boundingSphere,p.geometry.boundingSphere=null,p.userData.selectPlayScene(m),function(n,r){var i=p.geometry.attributes,e=p.userData.arrayFuncs;if(void 0!==e){void 0===m&&console.error("setPosition: t = "+m);for(var a=0;a<e.length;a++){var t=function(e,t){var o=x.execFunc(s,e,m,n,r);void 0!==o&&(i.position[t](a,o),l=!0)},s=e[a],l=!1;t("x","setX"),t("y","setY"),t("z","setZ");var o,c,u,d=void 0;void 0!==y.scales.w?(o=y.scales.w.min,c=y.scales.w.max):o=(c=u)-1,"function"==typeof s.w?(u=s.w(m,n,r),i.position.setW(a,u),l=!0,y.palette&&(d=y.palette.toColor(u,o,c))):"object"===b(s.w)?s.w instanceof f.Color?d=s.w:y.palette&&("object"===b(s.w)&&(s.w.min&&(o=s.w.min),s.w.max&&(c=s.w.max)),d=y.palette.toColor(x.execFunc(s,"w",m,n,r),o,c)):"number"==typeof s.w&&y.palette&&(d=y.palette.toColor(s.w,o,c)),d&&(p.material.vertexColors!==f.VertexColors&&console.error("Player.selectPlayScene: Please set the vertexColors parameter of the THREE.PointsMaterial of your points to THREE.VertexColors. Example: vertexColors: THREE.PointsMaterial"),!x.setColorAttribute(i,a,d)&&s instanceof f.Vector4&&(p.geometry.setAttribute("color",new f.Float32BufferAttribute(x.getColors(f,e,{positions:p.geometry.attributes.position,scale:{min:o,max:c},palette:y.palette}),3)),x.setColorAttribute(i,a,d)||console.error('Player.selectPlayScene: the color attribute is not exists. Please use THREE.Vector3 instead THREE.Vector4 in the arrayFuncs or add "color" attribute'))),l&&(i.position.needsUpdate=!0),void 0!==s.line&&s.line.addPoint(re(p,a),v,d)}}}(y.a,y.b),e="Player.selectPlayScene: invalid mesh.scale.",p.scale.x<=0&&console.error(e+"x = "+p.scale.x),p.scale.y<=0&&console.error(e+"y = "+p.scale.y),p.scale.z<=0&&console.error(e+"z = "+p.scale.z),y.guiSelectPoint&&(y.guiSelectPoint.setMesh(),-1!==(t=y.guiSelectPoint.getSelectedPointIndex())&&y.guiSelectPoint.isSelectedMesh(p)&&(o=re(p,t),y.guiSelectPoint.setPosition(o,{object:p,index:t}))))})},x.setColorAttribute=function(e,t,o){"string"==typeof o&&(o=new THREE.Color(o));var n=e.color||e.ca;return void 0!==n&&(n.setX(t,o.r),n.setY(t,o.g),n.setZ(t,o.b),n.needsUpdate=!0)},x.getPoints=function(t,o,n){oe.setTHREE(t),(n=n||{}).t=n.t||0;for(var r=n.options||{},i=r.a||1,a=r.b||0,s=0;s<o.length;s++){var e=o[s];Array.isArray(e)?o[s]=new t.Vector4(void 0===e[0]?0:e[0],void 0===e[1]?0:e[1],void 0===e[2]?0:e[2],void 0===e[3]?0:e[3]):"object"===(void 0===e?"undefined":b(e))&&e instanceof t.Vector2==!1&&e instanceof t.Vector3==!1&&e instanceof t.Vector4==!1&&(void 0===e.vector?o[s]=new t.Vector4(void 0===e.x?0:e.x,void 0===e.y?0:e.y,void 0===e.z?0:e.z,void 0===e.w?0:e.w):e.vector instanceof t.Vector2==!0||e.vector instanceof t.Vector3==!0||e.vector instanceof t.Vector4==!0?e.vector instanceof t.Vector2==!0&&(o[s].vector=new t.Vector3(void 0===e.vector.x?0:e.vector.x,void 0===e.vector.y?0:e.vector.y,void 0===e.vector.z?0:e.vector.z)):4===e.vector.length?o[s].vector=new t.Vector4(void 0===e.vector[0]?0:e.vector[0],void 0===e.vector[1]?0:e.vector[1],void 0===e.vector[2]?0:e.vector[2],void 0===e.vector[3]?0:e.vector[3]):3===e.vector.length?o[s].vector=new t.Vector3(void 0===e.vector[0]?0:e.vector[0],void 0===e.vector[1]?0:e.vector[1],void 0===e.vector[2]?0:e.vector[2]):console.error("options.getPoints(...) falied! item.vector.length = "+e.vector.length))}for(var l=[],s=0;s<o.length;s++){var c=function(e){return"number"==typeof u&&(u=new t.Vector4(u,0,0,0)),u instanceof t.Vector2||u instanceof t.Vector3||u instanceof t.Vector4?x.execFunc(u,e,n.t,i,a):void 0!==u.vector?(void 0!==u.name&&(u.vector.name=u.name),u.trace&&(u.vector.line=new x.traceLine(t,n.group,r)),o[s]=u.vector,u=u.vector,x.execFunc(u,e,n.t,i,a)):void console.error("options.getPoints: funcs.vector = "+u.vector)},u=o[s],d=u.vector instanceof t.Vector3==!0?new t.Vector3(c("x"),c("y"),c("z")):new t.Vector4(c("x"),c("y"),c("z"),c("w"));void 0===u.w&&(d.w={}),l.push(d)}return l},x.getColors=function(n,e,r){if((r=r||{}).palette=r.palette||P,void 0!==r.positions&&Array.isArray(e)&&e.length!==r.positions.count)return console.error("getColors failed! arrayFuncs.length: "+e.length+" != positions.count: "+r.positions.count),r.colors;r.colors=r.colors||[];for(var t=Array.isArray(e)?e.length:r.positions.count,i=0;i<t;i++){var o,a,s,l,c,u,d=Array.isArray(e)?e[i]:void 0;d instanceof n.Vector4||4===r.positions.itemSize?(void 0!==r.scale?(a=r.scale.min,s=r.scale.max):a=(s=d instanceof n.Vector4?d.w:1)-1,l=r.palette.toColor(void 0===d?(new n.Vector4).fromBufferAttribute(r.positions,i).w:d.w,a,s),r.colors.push(l.r,l.g,l.b)):r.colors instanceof n.Float32BufferAttribute?o=new n.Vector3(1,1,1):r.colors.push(1,1,1),void 0!==r.opacity?(c=0,u=getStandardNormalDistribution(0),group.children.forEach(function(e){if(e.userData.cloud)for(var t=0;t<e.geometry.attributes.position.count;t++){var o=re(e,t);c+=getStandardNormalDistribution(5*getWorldPosition(camera,(new n.Vector3).fromBufferAttribute(r.positions,i)).distanceTo(o))/u}}),void 0!==debug.opacity&&(c=debug.opacity),r.colors instanceof n.Float32BufferAttribute?r.colors.setXYZW(i,o.x,o.y,o.z,c):r.colors.push(c)):r.colors.push(1)}return r.colors},x.traceLine=function(l,c,e){var u,d;c?p?(u=p.marks,this.addPoint=function(e,t,o){var n,r,i;void 0===d&&(n=new l.BufferGeometry,r=new Float32Array(3*u),n.setAttribute("position",new l.BufferAttribute(r,3)),i=new Float32Array(3*u),n.setAttribute("color",new l.Float32BufferAttribute(i,3)),n.setDrawRange(t,t),(d=new l.Line(n,new l.LineBasicMaterial({vertexColors:l.VertexColors}))).visible=!0,c.add(d)),(e=(new l.Vector3).copy(e)).toArray(d.geometry.attributes.position.array,t*d.geometry.attributes.position.itemSize),d.geometry.attributes.position.needsUpdate=!0,void 0===o&&(o=new l.Color(1,1,1)),x.setColorAttribute(d.geometry.attributes,t,o);var a=d.geometry.drawRange.start,s=t+1-a;t<a&&(s=a+d.geometry.drawRange.count-(a=t)),d.geometry.setDrawRange(a,s)},this.visible=function(e){d.visible=e},this.isVisible=function(){return d.visible},this.remove=function(){void 0!==d&&(d.geometry.dispose(),d.material.dispose(),c.remove(d))}):console.error("Player.traceLine: call Player(...) first."):console.error("Player.traceLine: Define optionsPoints.group of the Player.getPoints first.")},e.default=x,Object.defineProperty(e,"__esModule",{value:!0})});
