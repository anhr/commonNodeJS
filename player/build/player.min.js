/**
 * @module Player
 * @description 3D objects animation.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.player={})}(this,function(e){"use strict";var x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},v=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var w=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t};function t(e,t){var n=e.__state.conversionName.toString(),o=Math.round(e.r),i=Math.round(e.g),r=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===n?"rgb("+o+","+i+","+r+")":"CSS_RGBA"===n?"rgba("+o+","+i+","+r+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+o+","+i+","+r+"]":"RGBA_ARRAY"===n?"["+o+","+i+","+r+","+a+"]":"RGB_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var n,s=Array.prototype.forEach,i=Array.prototype.slice,f={BREAK:{},extend:function(n){return this.each(i.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(t[e])||(n[e]=t[e])}.bind(this))},this),n},defaults:function(n){return this.each(i.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(n[e])&&(n[e]=t[e])}.bind(this))},this),n},compose:function(){var n=i.call(arguments);return function(){for(var e=i.call(arguments),t=n.length-1;0<=t;t--)e=[n[t].apply(this,e)];return e[0]}},each:function(e,t,n){if(e)if(s&&e.forEach&&e.forEach===s)e.forEach(t,n);else if(e.length===e.length+0){for(var o=void 0,o=0,i=e.length;o<i;o++)if(o in e&&t.call(n,e[o],o)===this.BREAK)return}else for(var r in e)if(t.call(n,e[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(o,i,r){var a=void 0;return function(){var e=this,t=arguments;var n=r||!a;clearTimeout(a),a=setTimeout(function(){a=null,r||o.apply(e,t)},i),n&&o.apply(e,t)}},toArray:function(e){return e.toArray?e.toArray():i.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:(n=function(e){return isNaN(e)},r.toString=function(){return n.toString()},r),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}};function r(e){return n.apply(this,arguments)}var l,c=[{litmus:f.isString,conversions:{THREE_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:t},SIX_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:t},CSS_RGB:{read:function(e){e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:t},CSS_RGBA:{read:function(e){e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:t}}},{litmus:f.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:f.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:f.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(f.isNumber(e.r)&&f.isNumber(e.g)&&f.isNumber(e.b)&&f.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(f.isNumber(e.r)&&f.isNumber(e.g)&&f.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(f.isNumber(e.h)&&f.isNumber(e.s)&&f.isNumber(e.v)&&f.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(f.isNumber(e.h)&&f.isNumber(e.s)&&f.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],u=void 0,d=void 0,p=function(e){d=!1;var n=1<arguments.length?f.toArray(arguments):e;return f.each(c,function(e){if(e.litmus(n))return f.each(e.conversions,function(e,t){if(u=e.read(n),!1===d&&!1!==u)return(d=u).conversionName=t,u.conversion=e,f.BREAK}),f.BREAK}),d},h={hsv_to_rgb:function(e,t,n){var o=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),r=n*(1-t),e=n*(1-i*t),t=n*(1-(1-i)*t),o=[[n,t,r],[e,n,r],[r,n,t],[r,e,n],[t,r,n],[n,r,e]][o];return{r:255*o[0],g:255*o[1],b:255*o[2]}},rgb_to_hsv:function(e,t,n){var o=Math.min(e,t,n),i=Math.max(e,t,n),r=i-o,o=void 0;return 0===i?{h:NaN,s:0,v:0}:(o=e===i?(t-n)/r:t===i?2+(n-e)/r:4+(e-t)/r,(o/=6)<0&&(o+=1),{h:360*o,s:r/i,v:i/255})},rgb_to_hex:function(e,t,n){e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t);return e=this.hex_with_component(e,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(l=8*t)|e&~(255<<l)}},m="function"==typeof Symbol&&"symbol"===x(Symbol.iterator)?function(e){return void 0===e?"undefined":x(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":x(e)},_=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},g=function(e,t,n){return t&&E(e.prototype,t),n&&E(e,n),e};function E(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function C(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0!==o){if("value"in o)return o.value;o=o.get;return void 0!==o?o.call(n):void 0}if(e=Object.getPrototypeOf(e),null!==e)return C(e,t,n)}var O=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":x(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},A=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":x(t))&&"function"!=typeof t?e:t},k=(g(S,[{key:"toString",value:function(){return t(this)}},{key:"toHexString",value:function(){return t(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),S);function S(){if(_(this,S),this.__state=p.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}function T(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||k.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(k.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function L(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||k.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(k.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}k.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=h.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");f.extend(e.__state,h.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},k.recalculateHSV=function(e){var t=h.rgb_to_hsv(e.r,e.g,e.b);f.extend(e.__state,{s:t.s,v:t.v}),f.isNaN(t.h)?f.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},k.COMPONENTS=["r","g","b","h","s","v","hex","a"],T(k.prototype,"r",2),T(k.prototype,"g",1),T(k.prototype,"b",0),L(k.prototype,"h"),L(k.prototype,"s"),L(k.prototype,"v"),Object.defineProperty(k.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(k.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=h.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var P=(g(R,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),R);function R(e,t){_(this,R),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}var N={};f.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){f.each(e,function(e){N[e]=t})});var j=/(\d+(\.\d+)?)px/;function H(e){if("0"===e||f.isUndefined(e))return 0;e=e.match(j);return f.isNull(e)?0:parseFloat(e[1])}var M={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){f.isUndefined(t)&&(t=!0),f.isUndefined(n)&&(n=!0),e.style.position="absolute",t&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,o){var i=n||{},n=N[t];if(!n)throw new Error("Event type "+t+" not supported.");var r=document.createEvent(n);switch(n){case"MouseEvents":var a=i.x||i.clientX||0,s=i.y||i.clientY||0;r.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,a,s,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":s=r.initKeyboardEvent||r.initKeyEvent;f.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),s(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:r.initEvent(t,i.bubbles||!1,i.cancelable||!0)}f.defaults(r,o),e.dispatchEvent(r)},bind:function(e,t,n,o){o=o||!1;return e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on"+t,n),M},unbind:function(e,t,n,o){o=o||!1;return e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on"+t,n),M},addClass:function(e,t){var n;return void 0===e.className?e.className=t:e.className===t||-1===(n=e.className.split(/ +/)).indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")),M},removeClass:function(e,t){var n;return t?e.className===t?e.removeAttribute("class"):-1!==(t=(n=e.className.split(/ +/)).indexOf(t))&&(n.splice(t,1),e.className=n.join(" ")):e.className=void 0,M},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){e=getComputedStyle(e);return H(e["border-left-width"])+H(e["border-right-width"])+H(e["padding-left"])+H(e["padding-right"])+H(e.width)},getHeight:function(e){e=getComputedStyle(e);return H(e["border-top-width"])+H(e["border-bottom-width"])+H(e["padding-top"])+H(e["padding-bottom"])+H(e.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)for(;n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent,t;);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},B=(O(V,P),g(V,[{key:"setValue",value:function(e){e=C(V.prototype.__proto__||Object.getPrototypeOf(V.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),C(V.prototype.__proto__||Object.getPrototypeOf(V.prototype),"updateDisplay",this).call(this)}}]),V);function V(e,t){_(this,V);var t=A(this,(V.__proto__||Object.getPrototypeOf(V)).call(this,e,t)),n=t;return t.__prev=t.getValue(),t.__checkbox=document.createElement("input"),t.__checkbox.setAttribute("type","checkbox"),M.bind(t.__checkbox,"change",function(){n.setValue(!n.__prev)},!1),t.domElement.appendChild(t.__checkbox),t.updateDisplay(),t}var F=(O(D,P),g(D,[{key:"setValue",value:function(e){e=C(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e}},{key:"updateDisplay",value:function(){return M.isActive(this.__select)?this:(this.__select.value=this.getValue(),C(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"updateDisplay",this).call(this))}}]),D);function D(e,t,n){_(this,D);var o,t=A(this,(D.__proto__||Object.getPrototypeOf(D)).call(this,e,t)),n=n,i=t;return t.__select=document.createElement("select"),f.isArray(n)&&(o={},f.each(n,function(e){o[e]=e}),n=o),f.each(n,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),i.__select.appendChild(n)}),t.updateDisplay(),M.bind(t.__select,"change",function(){var e=this.options[this.selectedIndex].value;i.setValue(e)}),t.domElement.appendChild(t.__select),t}var z=(O(I,P),g(I,[{key:"updateDisplay",value:function(){return M.isActive(this.__input)||(this.__input.value=this.getValue()),C(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"updateDisplay",this).call(this)}}]),I);function I(e,t){_(this,I);var t=A(this,(I.__proto__||Object.getPrototypeOf(I)).call(this,e,t)),n=t;function o(){n.setValue(n.__input.value)}return t.__input=document.createElement("input"),t.__input.setAttribute("type","text"),M.bind(t.__input,"keyup",o),M.bind(t.__input,"change",o),M.bind(t.__input,"blur",function(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}),M.bind(t.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),t.updateDisplay(),t.domElement.appendChild(t.__input),t}function G(e){e=e.toString();return-1<e.indexOf(".")?e.length-e.indexOf(".")-1:0}var X=(O(U,P),g(U,[{key:"setValue",value:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),C(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"setValue",this).call(this,e)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=G(e),this}}]),U);function U(e,t,n){_(this,U);t=A(this,(U.__proto__||Object.getPrototypeOf(U)).call(this,e,t)),n=n||{};return t.__min=n.min,t.__max=n.max,t.__step=n.step,f.isUndefined(t.__step)?0===t.initialValue?t.__impliedStep=1:t.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(t.initialValue))/Math.LN10))/10:t.__impliedStep=t.__step,t.__precision=G(t.__impliedStep),t}var Y=(O(W,X),g(W,[{key:"updateDisplay",value:function(){var e,t;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),t=this.__precision,t=Math.pow(10,t),Math.round(e*t)/t),C(W.prototype.__proto__||Object.getPrototypeOf(W.prototype),"updateDisplay",this).call(this)}}]),W);function W(e,t,n){_(this,W);n=A(this,(W.__proto__||Object.getPrototypeOf(W)).call(this,e,t,n));n.__truncationSuspended=!1;var o=n,i=void 0;function r(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function a(e){var t=i-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),i=e.clientY}function s(){M.unbind(window,"mousemove",a),M.unbind(window,"mouseup",s),r()}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),M.bind(n.__input,"change",function(){var e=parseFloat(o.__input.value);f.isNaN(e)||o.setValue(e)}),M.bind(n.__input,"blur",function(){r()}),M.bind(n.__input,"mousedown",function(e){M.bind(window,"mousemove",a),M.bind(window,"mouseup",s),i=e.clientY}),M.bind(n.__input,"keydown",function(e){13===e.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,r())}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}function q(e,t,n,o,i){return o+(e-t)/(n-t)*(i-o)}var K=(O(J,X),g(J,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",C(J.prototype.__proto__||Object.getPrototypeOf(J.prototype),"updateDisplay",this).call(this)}}]),J);function J(e,t,n,o,i){_(this,J);var i=A(this,(J.__proto__||Object.getPrototypeOf(J)).call(this,e,t,{min:n,max:o,step:i})),r=i;function a(e){e.preventDefault();var t=r.__background.getBoundingClientRect();return r.setValue(q(e.clientX,t.left,t.right,r.__min,r.__max)),!1}function s(){M.unbind(window,"mousemove",a),M.unbind(window,"mouseup",s),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function l(e){var t=e.touches[0].clientX,e=r.__background.getBoundingClientRect();r.setValue(q(t,e.left,e.right,r.__min,r.__max))}function c(){M.unbind(window,"touchmove",l),M.unbind(window,"touchend",c),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}return i.__background=document.createElement("div"),i.__foreground=document.createElement("div"),M.bind(i.__background,"mousedown",function(e){document.activeElement.blur(),M.bind(window,"mousemove",a),M.bind(window,"mouseup",s),a(e)}),M.bind(i.__background,"touchstart",function(e){if(1!==e.touches.length)return;M.bind(window,"touchmove",l),M.bind(window,"touchend",c),l(e)}),M.addClass(i.__background,"slider"),M.addClass(i.__foreground,"slider-fg"),i.updateDisplay(),i.__background.appendChild(i.__foreground),i.domElement.appendChild(i.__background),i}var Z=(O(Q,P),g(Q,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),Q);function Q(e,t,n){_(this,Q);var t=A(this,(Q.__proto__||Object.getPrototypeOf(Q)).call(this,e,t)),o=t;return t.__button=document.createElement("div"),t.__button.innerHTML=void 0===n?"Fire":n,M.bind(t.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),M.addClass(t.__button,"button"),t.domElement.appendChild(t.__button),t}var $=(O(ee,P),g(ee,[{key:"updateDisplay",value:function(){var t,n=p(this.getValue());!1!==n&&(t=!1,f.each(k.COMPONENTS,function(e){if(!f.isUndefined(n[e])&&!f.isUndefined(this.__color.__state[e])&&n[e]!==this.__color.__state[e])return t=!0,{}},this),t&&f.extend(this.__color.__state,n)),f.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var e=this.__color.v<.5||.5<this.__color.s?255:0,o=255-e;f.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+e+","+e+","+e+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,ne(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),f.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+e+","+e+","+e+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]),ee);function ee(e,t){_(this,ee);var n=A(this,(ee.__proto__||Object.getPrototypeOf(ee)).call(this,e,t));n.__color=new k(n.getValue()),n.__temp=new k(0);var o=n;n.domElement=document.createElement("div"),M.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",M.bind(n.__input,"keydown",function(e){13===e.keyCode&&l.call(this)}),M.bind(n.__input,"blur",l),M.bind(n.__selector,"mousedown",function(){M.addClass(this,"drag").bind(window,"mouseup",function(){M.removeClass(o.__selector,"drag")})}),M.bind(n.__selector,"touchstart",function(){M.addClass(this,"drag").bind(window,"touchend",function(){M.removeClass(o.__selector,"drag")})});e=document.createElement("div");function i(e){u(e),M.bind(window,"mousemove",u),M.bind(window,"touchmove",u),M.bind(window,"mouseup",a),M.bind(window,"touchend",a)}function r(e){d(e),M.bind(window,"mousemove",d),M.bind(window,"touchmove",d),M.bind(window,"mouseup",s),M.bind(window,"touchend",s)}function a(){M.unbind(window,"mousemove",u),M.unbind(window,"touchmove",u),M.unbind(window,"mouseup",a),M.unbind(window,"touchend",a),c()}function s(){M.unbind(window,"mousemove",d),M.unbind(window,"touchmove",d),M.unbind(window,"mouseup",s),M.unbind(window,"touchend",s),c()}function l(){var e=p(this.value);!1!==e?(o.__color.__state=e,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function c(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function u(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,e=n.clientX,n=n.clientY,e=(e-t.left)/(t.right-t.left),t=1-(n-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),1<e?e=1:e<0&&(e=0),o.__color.v=t,o.__color.s=e,o.setValue(o.__color.toOriginal()),!1}function d(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__hue_field.getBoundingClientRect(),t=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),o.__color.h=360*t,o.setValue(o.__color.toOriginal()),!1}return f.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),f.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),f.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),f.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),f.extend(e.style,{width:"100%",height:"100%",background:"none"}),ne(e,"top","rgba(0,0,0,0)","#000"),f.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(t=n.__hue_field).style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",f.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),M.bind(n.__saturation_field,"mousedown",i),M.bind(n.__saturation_field,"touchstart",i),M.bind(n.__field_knob,"mousedown",i),M.bind(n.__field_knob,"touchstart",i),M.bind(n.__hue_field,"mousedown",r),M.bind(n.__hue_field,"touchstart",r),n.__saturation_field.appendChild(e),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}var te=["-moz-","-o-","-webkit-","-ms-",""];function ne(t,n,o,i){t.style.background="",f.each(te,function(e){t.style.cssText+="background: "+e+"linear-gradient("+n+", "+o+" 0%, "+i+" 100%); "})}var oe=function(e,t,n,o,i){var r=e[t];return f.isArray(n)||f.isObject(n)?new F(e,t,n):f.isNumber(r)?f.isNumber(n)&&f.isNumber(o)?f.isNumber(i)?new K(e,t,n,o,i):new K(e,t,n,o):f.isNumber(i)?new Y(e,t,{min:n,max:o,step:i}):new Y(e,t,{min:n,max:o}):f.isString(r)?new z(e,t):f.isFunction(r)?new Z(e,t,""):f.isBoolean(r)?new B(e,t):null},ie=(O(re,P),g(re,[{key:"controller",set:function(e){this._controller=e},get:function(){return this._controller}}]),re);function re(e,t){_(this,re);var n=A(this,(re.__proto__||Object.getPrototypeOf(re)).call(this,e,t));return n.arguments={object:e,property:t,opts:Array.prototype.slice.call(arguments,2)},e.property&&(n.property=e.property(n)),n}O=function(e,t){var t=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e;var o=t.getElementsByTagName("head")[0];try{o.appendChild(n)}catch(e){}};var ae=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},se=(g(le,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),f.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",M.unbind(t.domElement,"webkitTransitionEnd",e),M.unbind(t.domElement,"transitionend",e),M.unbind(t.domElement,"oTransitionEnd",e)}var t=this;M.bind(this.domElement,"webkitTransitionEnd",e),M.bind(this.domElement,"transitionend",e),M.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-M.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-M.getHeight(this.domElement)/2+"px"}}]),le);function le(){_(this,le),this.backgroundElement=document.createElement("div"),f.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),M.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),f.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;M.bind(this.backgroundElement,"click",function(){e.hide()})}O(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var ce="Default",ue=function(){try{return!!window.localStorage}catch(e){return!1}}(),de=void 0,pe=!0,he=void 0,fe=!1,me=[],_e=function t(e){var n=this,o=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),M.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],o=f.defaults(o,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),o=f.defaults(o,{resizable:o.autoPlace,hideable:o.autoPlace}),f.isUndefined(o.load)?o.load={preset:ce}:o.preset&&(o.load.preset=o.preset),f.isUndefined(o.parent)&&o.hideable&&me.push(this),o.resizable=f.isUndefined(o.parent)&&o.resizable,o.autoPlace&&f.isUndefined(o.scrollable)&&(o.scrollable=!0);var i,r,a,s,l=ue&&"true"===localStorage.getItem(xe(0,"isLocal")),c=void 0,u=void 0;function d(e){return e.preventDefault(),r.width+=a-e.clientX,r.onResize(),a=e.clientX,!1}function p(){M.removeClass(r.__closeButton,_e.CLASS_DRAG),M.unbind(window,"mousemove",d),M.unbind(window,"mouseup",p)}function h(e){return e.preventDefault(),a=e.clientX,M.addClass(r.__closeButton,_e.CLASS_DRAG),M.bind(window,"mousemove",d),M.bind(window,"mouseup",p),!1}Object.defineProperties(this,{parent:{get:function(){return o.parent}},scrollable:{get:function(){return o.scrollable}},autoPlace:{get:function(){return o.autoPlace}},closeOnTop:{get:function(){return o.closeOnTop}},preset:{get:function(){return(n.parent?n.getRoot():o.load).preset},set:function(e){n.parent?n.getRoot().preset=e:o.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return o.width},set:function(e){o.width=e,Oe(n,e)}},name:{get:function(){return o.name},set:function(e){o.name=e,u&&(u.innerHTML=o.name)}},closed:{get:function(){return o.closed},set:function(e){o.closed=e,o.closed?M.addClass(n.__ul,t.CLASS_CLOSED):M.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return o.load}},useLocalStorage:{get:function(){return l},set:function(e){ue&&((l=e)?M.bind(window,"unload",c):M.unbind(window,"unload",c),localStorage.setItem(xe(0,"isLocal"),e))}}}),f.isUndefined(o.parent)?(this.closed=o.closed||!1,M.addClass(this.domElement,t.CLASS_MAIN),M.makeSelectable(this.domElement,!1),ue&&l&&(n.useLocalStorage=!0,(i=localStorage.getItem(xe(0,"gui")))&&(o.load=JSON.parse(i))),this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,M.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),o.closeOnTop?(M.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(M.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),M.bind(this.__closeButton,"click",function(){n.closed=!n.closed})):(void 0===o.closed&&(o.closed=!0),i=document.createTextNode(o.name),M.addClass(i,"controller-name"),u=ge(n,i),M.addClass(this.__ul,t.CLASS_CLOSED),M.addClass(u,"title"),M.bind(u,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1}),o.closed||(this.closed=!1)),o.autoPlace&&(f.isUndefined(o.parent)&&(pe&&(he=document.createElement("div"),M.addClass(he,"dg"),M.addClass(he,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(he),pe=!1),he.appendChild(this.domElement),M.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||Oe(n,o.width)),this.__resizeHandler=function(){n.onResizeDebounced()},M.bind(window,"resize",this.__resizeHandler),M.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),M.bind(this.__ul,"transitionend",this.__resizeHandler),M.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),o.resizable&&(a=void 0,(r=this).__resize_handle=document.createElement("div"),f.extend(r.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),M.bind(r.__resize_handle,"mousedown",h),M.bind(r.__closeButton,"mousedown",h),r.domElement.insertBefore(r.__resize_handle,r.domElement.firstElementChild)),c=function(){ue&&"true"===localStorage.getItem(xe(0,"isLocal"))&&localStorage.setItem(xe(0,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=c,o.parent||((s=n.getRoot()).width+=1,f.defer(function(){--s.width}))};function ge(e,t,n){var o=document.createElement("li");return t&&o.appendChild(t),n?e.__ul.insertBefore(o,n):e.__ul.appendChild(o),e.onResize(),o}function be(e){M.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&M.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function ve(e,t){e=e.__preset_select[e.__preset_select.selectedIndex];e.innerHTML=t?e.value+"*":e.value}function ye(e,t){var n=e.getRoot(),o=n.__rememberedObjects.indexOf(t.object);if(-1!==o){var i=n.__rememberedObjectIndecesToControllers[o];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[o]=i),i[t.property]=t,n.load&&n.load.remembered){i=n.load.remembered,n=void 0;if(i[e.preset])n=i[e.preset];else{if(!i[ce])return;n=i[ce]}n[o]&&void 0!==n[o][t.property]&&(o=n[o][t.property],t.initialValue=o,t.setValue(o))}}}function we(e,t,n,o){var i;if(t.arguments&&(t=(i=t).arguments.object,n=i.arguments.property,o={factoryArgs:i.arguments.opts}),void 0===i&&void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var r=void 0;null===(r=o.color?new $(t,n):void 0!==i&&"string"==typeof i.property?i:(l=[t,n].concat(o.factoryArgs),oe.apply(e,l)))?r=i:void 0!==i&&(i.controller=r),o.before instanceof P&&(o.before=o.before.__li),ye(e,r),M.addClass(r.domElement,"c");var a=document.createElement("span");if(M.addClass(a,"property-name"),void 0!==i&&"object"===m(i.property))for(var s in i.property)a.appendChild(i.property[s]);else a.innerHTML=r.property;var l=document.createElement("div");l.appendChild(a),l.appendChild(r.domElement);var c,u,d,p,o=ge(e,l,o.before);return M.addClass(o,_e.CLASS_CONTROLLER_ROW),r instanceof $?M.addClass(o,"color"):M.addClass(o,m(r.getValue())),c=e,u=o,(d=r).__li=u,d.__gui=c,f.extend(d,{options:function(e){if(1<arguments.length){var t=d.__li.nextElementSibling;return d.remove(),we(c,d.object,d.property,{before:t,factoryArgs:[f.toArray(arguments)]})}if(f.isArray(e)||f.isObject(e)){t=d.__li.nextElementSibling;return d.remove(),we(c,d.object,d.property,{before:t,factoryArgs:[e]})}},name:function(e){return d.__li.firstElementChild.firstElementChild.innerHTML=e,d},listen:function(){return d.__gui.listen(d),d},remove:function(){return d.__gui.remove(d),d}}),d instanceof K?(p=new Y(d.object,d.property,{min:d.__min,max:d.__max,step:d.__step}),f.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=d[e],n=p[e];d[e]=p[e]=function(){var e=Array.prototype.slice.call(arguments);return n.apply(p,e),t.apply(d,e)}}),M.addClass(u,"has-slider"),d.domElement.insertBefore(p.domElement,d.domElement.firstElementChild)):d instanceof Y?(o=function(e){if(f.isNumber(d.__min)&&f.isNumber(d.__max)){var t=d.__li.firstElementChild.firstElementChild.innerHTML,n=-1<d.__gui.__listening.indexOf(d);d.remove();var o=we(c,d.object,d.property,{before:d.__li.nextElementSibling,factoryArgs:[d.__min,d.__max,d.__step]});return o.name(t),n&&o.listen(),o}return e},d.min=f.compose(o,d.min),d.max=f.compose(o,d.max)):d instanceof B?(M.bind(u,"click",function(){M.fakeEvent(d.__checkbox,"click")}),M.bind(d.__checkbox,"click",function(e){e.stopPropagation()})):d instanceof Z?(M.bind(u,"click",function(){M.fakeEvent(d.__button,"click")}),M.bind(u,"mouseover",function(){M.addClass(d.__button,"hover")}),M.bind(u,"mouseout",function(){M.removeClass(d.__button,"hover")})):d instanceof $&&(M.addClass(u,"color"),d.updateDisplay=f.compose(function(e){return u.style.borderLeftColor=d.__color.toString(),e},d.updateDisplay),d.updateDisplay()),d.setValue=f.compose(function(e){return c.getRoot().__preset_select&&d.isModified()&&ve(c.getRoot(),!0),e},d.setValue),e.__controllers.push(r),r}function xe(e,t){return document.location.href+"."+t}function Ee(e,t,n){var o=document.createElement("option");o.innerHTML=t,o.value=t,e.__preset_select.appendChild(o),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function Ce(e,t){t.style.display=e.useLocalStorage?"block":"none"}function Oe(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function Ae(i,r){var a={};return f.each(i.__rememberedObjects,function(e,t){var n={},o=i.__rememberedObjectIndecesToControllers[t];f.each(o,function(e,t){n[t]=r?e.initialValue:e.getValue()}),a[t]=n}),a}_e.toggleHide=function(){fe=!fe,f.each(me,function(e){e.domElement.style.display=fe?"none":""})},_e.CLASS_AUTO_PLACE="a",_e.CLASS_AUTO_PLACE_CONTAINER="ac",_e.CLASS_MAIN="main",_e.CLASS_CONTROLLER_ROW="cr",_e.CLASS_TOO_TALL="taller-than-window",_e.CLASS_CLOSED="closed",_e.CLASS_CLOSE_BUTTON="close-button",_e.CLASS_CLOSE_TOP="close-top",_e.CLASS_CLOSE_BOTTOM="close-bottom",_e.CLASS_DRAG="drag",_e.DEFAULT_WIDTH=245,_e.TEXT_CLOSED="Close Controls",_e.TEXT_OPEN="Open Controls",_e._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||_e.toggleHide()},M.bind(window,"keydown",_e._keydownHandler,!1),f.extend(_e.prototype,{add:function(e,t){return we(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return we(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;f.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&he.removeChild(this.domElement);var t=this;f.each(this.__folders,function(e){t.removeFolder(e)}),M.unbind(window,"keydown",_e._keydownHandler,!1),be(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);t=new _e(t);this.__folders[e]=t;e=ge(this,t.domElement);return M.addClass(e,"folder"),t},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],be(t);var e=this;f.each(t.__folders,function(e){t.removeFolder(e)}),f.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e,t,n=this.getRoot();n.scrollable&&(e=M.getOffset(n.__ul).top,t=0,f.each(n.__ul.childNodes,function(e){n.autoPlace&&e===n.__save_row||(t+=M.getHeight(e))}),window.innerHeight-e-20<t?(M.addClass(n.domElement,_e.CLASS_TOO_TALL),n.__ul.style.height=window.innerHeight-e-20+"px"):(M.removeClass(n.domElement,_e.CLASS_TOO_TALL),n.__ul.style.height="auto")),n.__resize_handle&&f.defer(function(){n.__resize_handle.style.height=n.__ul.offsetHeight+"px"}),n.__closeButton&&(n.__closeButton.style.width=n.width+"px")},onResizeDebounced:f.debounce(function(){this.onResize()},50),remember:function(){if(f.isUndefined(de)&&((de=new se).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;f.each(Array.prototype.slice.call(arguments),function(e){0===t.__rememberedObjects.length&&function(n){var e=n.__save_row=document.createElement("li");M.addClass(n.domElement,"has-save"),n.__ul.insertBefore(e,n.__ul.firstChild),M.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",M.addClass(t,"button gears");var o=document.createElement("span");o.innerHTML="Save",M.addClass(o,"button"),M.addClass(o,"save");var i=document.createElement("span");i.innerHTML="New",M.addClass(i,"button"),M.addClass(i,"save-as");var r=document.createElement("span");r.innerHTML="Revert",M.addClass(r,"button"),M.addClass(r,"revert");var a=n.__preset_select=document.createElement("select");n.load&&n.load.remembered?f.each(n.load.remembered,function(e,t){Ee(n,t,t===n.preset)}):Ee(n,ce,!1);{var s;M.bind(a,"change",function(){for(var e=0;e<n.__preset_select.length;e++)n.__preset_select[e].innerHTML=n.__preset_select[e].value;n.preset=this.value}),e.appendChild(a),e.appendChild(t),e.appendChild(o),e.appendChild(i),e.appendChild(r),ue&&(s=document.getElementById("dg-local-explain"),e=document.getElementById("dg-local-storage"),document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(xe(0,"isLocal"))&&e.setAttribute("checked","checked"),Ce(n,s),M.bind(e,"change",function(){n.useLocalStorage=!n.useLocalStorage,Ce(n,s)}))}var l=document.getElementById("dg-new-constructor");M.bind(l,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||de.hide()}),M.bind(t,"click",function(){l.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),de.show(),l.focus(),l.select()}),M.bind(o,"click",function(){n.save()}),M.bind(i,"click",function(){var e=prompt("Enter a new preset name.");e&&n.saveAs(e)}),M.bind(r,"click",function(){n.revert()})}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&Oe(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var n=this.load;return n.closed=this.closed,0<this.__rememberedObjects.length&&(n.preset=this.preset,n.remembered||(n.remembered={}),n.remembered[this.preset]=Ae(this)),n.folders={},f.each(this.__folders,function(e,t){n.folders[t]=e.getSaveObject()}),n},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Ae(this),ve(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[ce]=Ae(this,!0)),this.load.remembered[e]=Ae(this),this.preset=e,Ee(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(t){f.each(this.__controllers,function(e){this.getRoot().load.remembered?ye(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),f.each(this.__folders,function(e){e.revert(e)}),t||ve(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&ae.call(window,function(){e(t)});f.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){f.each(this.__controllers,function(e){e.updateDisplay()}),f.each(this.__folders,function(e){e.updateDisplay()})}});var ke,Se,g={Controller:P,BooleanController:B,OptionController:F,StringController:z,NumberController:X,NumberControllerBox:Y,NumberControllerSlider:K,FunctionController:Z,ColorController:$,CustomController:ie},Te={addButton:function(e,t){t=t||{};var n=document.createElement("span");return n.innerHTML=e,void 0!==t.title&&(n.title=t.title),void 0!==t.onclick&&(n.style.cursor="pointer",n.onclick=t.onclick),void 0!==t.onwheel&&(e=function(e){e=(e=e||window.event).deltaY||e.detail||e.wheelDelta;t.onwheel(e)},n.style.cursor="n-resize",n.addEventListener?"onwheel"in document?n.addEventListener("wheel",e):"onmousewheel"in document?n.addEventListener("mousewheel",e):n.addEventListener("MozMousePixelScroll",e):n.attachEvent("onmousewheel",e)),n.style.margin="0px 2px",n}},O=(v(Le,[{key:"THREE",set:function(e){ke?Object.is(e,ke)||console.error("three: duplicate THREE. Please use one instance of the THREE library."):ke=e},get:function(){return void 0===ke&&console.error("three: invalid _THREE = "+ke+". Call three.THREE = THREE first."),ke}},{key:"dat",set:function(e){Se?Object.is(e,Se)||console.error("three: duplicate dat. Please use one instance of the dat library."):Se=e},get:function(){return Se}}]),Le);
/**
* custom controller, allow to user to change a value step by step.
*
* @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
*
* @copyright 2011 Data Arts Team, Google Creative Lab
*
* @license under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*/function Le(){b(this,Le)}O=new O,window.__myThree__=window.__myThree__||{},window.__myThree__.boThree&&console.error("three: duplicate three. Please use one instance of the three class."),window.__myThree__.boThree=!0,O.isThree=function(){return ke};var Pe=O,Re=(y(Ne,g.CustomController),Ne);
/**
 * @module ScaleController
 * @description is dat.GUI graphical user interface controller for control of the scale of threejs 3D object
 *
 * @see {@link https://threejs.org/} about threejs
 * @see {@link https://github.com/dataarts/dat.gui} about dat.GUI
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function Ne(r,a){b(this,Ne),(a=a||{}).settings=a.settings||{},a.settings.zoomMultiplier=a.settings.zoomMultiplier||1.1;var e=w(this,(Ne.__proto__||Object.getPrototypeOf(Ne)).call(this,{multiplier:a.settings.zoomMultiplier,property:function(e){var t={zoom:"Zoom",in:"in",out:"out",wheelZoom:"Scroll the mouse wheel to zoom"},n=void 0===a.getLanguageCode?"en":a.getLanguageCode();switch(n){case"ru":t.zoom="Изменить",t.in="увеличить",t.out="уменьшить",t.wheelZoom="Прокрутите колесико мыши для изменения масштаба";break;default:if(void 0===a.lang||a.lang.languageCode!=n)break;Object.keys(a.lang).forEach(function(e){void 0!==t[e]&&(t[e]=a.lang[e])})}var o={},i=Te.addButton;return o.zoomLabel=i(t.zoom,{title:t.wheelZoom,onwheel:function(n){r(e,function(e,t){return 0<n?e*=t:e/=t,e})}}),o.in=i("↑",{title:t.in,onclick:function(){r(e,function(e,t){return e*=t})}}),o.out=i("↓",{title:t.out,onclick:function(){r(e,function(e,t){return e/=t})}}),o}},"multiplier",1.1,10,.1));return void 0===e.property&&console.error("init() returns "+e.property),e}
/**
 * PositionController is dat.GUI graphical user interface controller for control of the position of threejs 3D object
 *
 * @see {@link https://threejs.org/} about threejs
 * @see {@link https://github.com/dataarts/dat.gui} about dat.GUI
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
var je=(y(He,g.CustomController),He);function He(r,a){b(this,He),(a=a||{}).settings=a.settings||{};var e=a.settings;a.min=a.min||.1,a.max=a.max||10,e.offset=e.offset||.1,a.step=a.step||.1;e=w(this,(He.__proto__||Object.getPrototypeOf(He)).call(this,{offset:e.offset,property:function(n){var t={offset:"Offset",add:"add",subtract:"subtract",wheelPosition:"Scroll the mouse wheel to change the position"},e=void 0===a.getLanguageCode?"en":a.getLanguageCode();switch(e){case"ru":t.offset="Сдвиг",t.add="добавить",t.subtract="вычесть",t.wheelPosition="Прокрутите колесико мыши для изменения позиции";break;default:if(void 0===a.lang||a.lang.languageCode!=e)break;Object.keys(a.lang).forEach(function(e){void 0!==t[e]&&(t[e]=a.lang[e])})}var o={},i=Te.addButton;return o.Label=i(t.offset,{title:t.wheelPosition,onwheel:function(e){var t=n.controller.getValue();r(0<e?t:-t)}}),o.in=i("↑",{title:t.add,onclick:function(){r(n.controller.getValue())}}),o.out=i("↓",{title:t.subtract,onclick:function(){r(-n.controller.getValue())}}),o}},"offset",a.min,a.max,a.step));return void 0===e.property&&console.error("init() returns "+e.property),e}function Me(e,t){var n=e.__state.conversionName.toString(),o=Math.round(e.r),i=Math.round(e.g),r=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===n?"rgb("+o+","+i+","+r+")":"CSS_RGBA"===n?"rgba("+o+","+i+","+r+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+o+","+i+","+r+"]":"RGBA_ARRAY"===n?"["+o+","+i+","+r+","+a+"]":"RGB_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var Be,Ve=Array.prototype.forEach,Fe=Array.prototype.slice,De={BREAK:{},extend:function(n){return this.each(Fe.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(t[e])||(n[e]=t[e])}.bind(this))},this),n},defaults:function(n){return this.each(Fe.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(n[e])&&(n[e]=t[e])}.bind(this))},this),n},compose:function(){var n=Fe.call(arguments);return function(){for(var e=Fe.call(arguments),t=n.length-1;0<=t;t--)e=[n[t].apply(this,e)];return e[0]}},each:function(e,t,n){if(e)if(Ve&&e.forEach&&e.forEach===Ve)e.forEach(t,n);else if(e.length===e.length+0){for(var o=void 0,o=0,i=e.length;o<i;o++)if(o in e&&t.call(n,e[o],o)===this.BREAK)return}else for(var r in e)if(t.call(n,e[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(o,i,r){var a=void 0;return function(){var e=this,t=arguments;var n=r||!a;clearTimeout(a),a=setTimeout(function(){a=null,r||o.apply(e,t)},i),n&&o.apply(e,t)}},toArray:function(e){return e.toArray?e.toArray():Fe.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:(Be=function(e){return isNaN(e)},ze.toString=function(){return Be.toString()},ze),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}};function ze(e){return Be.apply(this,arguments)}var Ie,Ge=[{litmus:De.isString,conversions:{THREE_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:Me},SIX_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:Me},CSS_RGB:{read:function(e){e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:Me},CSS_RGBA:{read:function(e){e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:Me}}},{litmus:De.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:De.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:De.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(De.isNumber(e.r)&&De.isNumber(e.g)&&De.isNumber(e.b)&&De.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(De.isNumber(e.r)&&De.isNumber(e.g)&&De.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(De.isNumber(e.h)&&De.isNumber(e.s)&&De.isNumber(e.v)&&De.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(De.isNumber(e.h)&&De.isNumber(e.s)&&De.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Xe=void 0,Ue=void 0,Ye=function(e){Ue=!1;var n=1<arguments.length?De.toArray(arguments):e;return De.each(Ge,function(e){if(e.litmus(n))return De.each(e.conversions,function(e,t){if(Xe=e.read(n),!1===Ue&&!1!==Xe)return(Ue=Xe).conversionName=t,Xe.conversion=e,De.BREAK}),De.BREAK}),Ue},We={hsv_to_rgb:function(e,t,n){var o=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),r=n*(1-t),e=n*(1-i*t),t=n*(1-(1-i)*t),o=[[n,t,r],[e,n,r],[r,n,t],[r,e,n],[t,r,n],[n,r,e]][o];return{r:255*o[0],g:255*o[1],b:255*o[2]}},rgb_to_hsv:function(e,t,n){var o=Math.min(e,t,n),i=Math.max(e,t,n),r=i-o,o=void 0;return 0===i?{h:NaN,s:0,v:0}:(o=e===i?(t-n)/r:t===i?2+(n-e)/r:4+(e-t)/r,(o/=6)<0&&(o+=1),{h:360*o,s:r/i,v:i/255})},rgb_to_hex:function(e,t,n){e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t);return e=this.hex_with_component(e,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(Ie=8*t)|e&~(255<<Ie)}},qe="function"==typeof Symbol&&"symbol"===x(Symbol.iterator)?function(e){return void 0===e?"undefined":x(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":x(e)},Ke=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},X=function(e,t,n){return t&&Je(e.prototype,t),n&&Je(e,n),e};function Je(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ze(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0!==o){if("value"in o)return o.value;o=o.get;return void 0!==o?o.call(n):void 0}if(e=Object.getPrototypeOf(e),null!==e)return Ze(e,t,n)}var ie=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":x(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Qe=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":x(t))&&"function"!=typeof t?e:t},$e=(X(et,[{key:"toString",value:function(){return Me(this)}},{key:"toHexString",value:function(){return Me(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),et);function et(){if(Ke(this,et),this.__state=Ye.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}function tt(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||$e.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&($e.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function nt(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||$e.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&($e.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}$e.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=We.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");De.extend(e.__state,We.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},$e.recalculateHSV=function(e){var t=We.rgb_to_hsv(e.r,e.g,e.b);De.extend(e.__state,{s:t.s,v:t.v}),De.isNaN(t.h)?De.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},$e.COMPONENTS=["r","g","b","h","s","v","hex","a"],tt($e.prototype,"r",2),tt($e.prototype,"g",1),tt($e.prototype,"b",0),nt($e.prototype,"h"),nt($e.prototype,"s"),nt($e.prototype,"v"),Object.defineProperty($e.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty($e.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=We.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var ot=(X(it,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),it);function it(e,t){Ke(this,it),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}var rt={};De.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){De.each(e,function(e){rt[e]=t})});var at=/(\d+(\.\d+)?)px/;function st(e){if("0"===e||De.isUndefined(e))return 0;e=e.match(at);return De.isNull(e)?0:parseFloat(e[1])}var lt={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){De.isUndefined(t)&&(t=!0),De.isUndefined(n)&&(n=!0),e.style.position="absolute",t&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,o){var i=n||{},n=rt[t];if(!n)throw new Error("Event type "+t+" not supported.");var r=document.createEvent(n);switch(n){case"MouseEvents":var a=i.x||i.clientX||0,s=i.y||i.clientY||0;r.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,a,s,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":s=r.initKeyboardEvent||r.initKeyEvent;De.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),s(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:r.initEvent(t,i.bubbles||!1,i.cancelable||!0)}De.defaults(r,o),e.dispatchEvent(r)},bind:function(e,t,n,o){o=o||!1;return e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on"+t,n),lt},unbind:function(e,t,n,o){o=o||!1;return e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on"+t,n),lt},addClass:function(e,t){var n;return void 0===e.className?e.className=t:e.className===t||-1===(n=e.className.split(/ +/)).indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")),lt},removeClass:function(e,t){var n;return t?e.className===t?e.removeAttribute("class"):-1!==(t=(n=e.className.split(/ +/)).indexOf(t))&&(n.splice(t,1),e.className=n.join(" ")):e.className=void 0,lt},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){e=getComputedStyle(e);return st(e["border-left-width"])+st(e["border-right-width"])+st(e["padding-left"])+st(e["padding-right"])+st(e.width)},getHeight:function(e){e=getComputedStyle(e);return st(e["border-top-width"])+st(e["border-bottom-width"])+st(e["padding-top"])+st(e["padding-bottom"])+st(e.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)for(;n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent,t;);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},ct=(ie(ut,ot),X(ut,[{key:"setValue",value:function(e){e=Ze(ut.prototype.__proto__||Object.getPrototypeOf(ut.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Ze(ut.prototype.__proto__||Object.getPrototypeOf(ut.prototype),"updateDisplay",this).call(this)}}]),ut);function ut(e,t){Ke(this,ut);var t=Qe(this,(ut.__proto__||Object.getPrototypeOf(ut)).call(this,e,t)),n=t;return t.__prev=t.getValue(),t.__checkbox=document.createElement("input"),t.__checkbox.setAttribute("type","checkbox"),lt.bind(t.__checkbox,"change",function(){n.setValue(!n.__prev)},!1),t.domElement.appendChild(t.__checkbox),t.updateDisplay(),t}var dt=(ie(pt,ot),X(pt,[{key:"setValue",value:function(e){e=Ze(pt.prototype.__proto__||Object.getPrototypeOf(pt.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e}},{key:"updateDisplay",value:function(){return lt.isActive(this.__select)?this:(this.__select.value=this.getValue(),Ze(pt.prototype.__proto__||Object.getPrototypeOf(pt.prototype),"updateDisplay",this).call(this))}}]),pt);function pt(e,t,n){Ke(this,pt);var o,t=Qe(this,(pt.__proto__||Object.getPrototypeOf(pt)).call(this,e,t)),n=n,i=t;return t.__select=document.createElement("select"),De.isArray(n)&&(o={},De.each(n,function(e){o[e]=e}),n=o),De.each(n,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),i.__select.appendChild(n)}),t.updateDisplay(),lt.bind(t.__select,"change",function(){var e=this.options[this.selectedIndex].value;i.setValue(e)}),t.domElement.appendChild(t.__select),t}var ht=(ie(ft,ot),X(ft,[{key:"updateDisplay",value:function(){return lt.isActive(this.__input)||(this.__input.value=this.getValue()),Ze(ft.prototype.__proto__||Object.getPrototypeOf(ft.prototype),"updateDisplay",this).call(this)}}]),ft);function ft(e,t){Ke(this,ft);var t=Qe(this,(ft.__proto__||Object.getPrototypeOf(ft)).call(this,e,t)),n=t;function o(){n.setValue(n.__input.value)}return t.__input=document.createElement("input"),t.__input.setAttribute("type","text"),lt.bind(t.__input,"keyup",o),lt.bind(t.__input,"change",o),lt.bind(t.__input,"blur",function(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}),lt.bind(t.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),t.updateDisplay(),t.domElement.appendChild(t.__input),t}function mt(e){e=e.toString();return-1<e.indexOf(".")?e.length-e.indexOf(".")-1:0}ie(_t,ot),X(_t,[{key:"setValue",value:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),Ze(_t.prototype.__proto__||Object.getPrototypeOf(_t.prototype),"setValue",this).call(this,e)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=mt(e),this}}]),O=_t;function _t(e,t,n){Ke(this,_t);t=Qe(this,(_t.__proto__||Object.getPrototypeOf(_t)).call(this,e,t)),n=n||{};return t.__min=n.min,t.__max=n.max,t.__step=n.step,De.isUndefined(t.__step)?0===t.initialValue?t.__impliedStep=1:t.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(t.initialValue))/Math.LN10))/10:t.__impliedStep=t.__step,t.__precision=mt(t.__impliedStep),t}var gt=(ie(bt,O),X(bt,[{key:"updateDisplay",value:function(){var e,t;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),t=this.__precision,t=Math.pow(10,t),Math.round(e*t)/t),Ze(bt.prototype.__proto__||Object.getPrototypeOf(bt.prototype),"updateDisplay",this).call(this)}}]),bt);function bt(e,t,n){Ke(this,bt);n=Qe(this,(bt.__proto__||Object.getPrototypeOf(bt)).call(this,e,t,n));n.__truncationSuspended=!1;var o=n,i=void 0;function r(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function a(e){var t=i-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),i=e.clientY}function s(){lt.unbind(window,"mousemove",a),lt.unbind(window,"mouseup",s),r()}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),lt.bind(n.__input,"change",function(){var e=parseFloat(o.__input.value);De.isNaN(e)||o.setValue(e)}),lt.bind(n.__input,"blur",function(){r()}),lt.bind(n.__input,"mousedown",function(e){lt.bind(window,"mousemove",a),lt.bind(window,"mouseup",s),i=e.clientY}),lt.bind(n.__input,"keydown",function(e){13===e.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,r())}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}function vt(e,t,n,o,i){return o+(e-t)/(n-t)*(i-o)}var yt=(ie(wt,O),X(wt,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",Ze(wt.prototype.__proto__||Object.getPrototypeOf(wt.prototype),"updateDisplay",this).call(this)}}]),wt);function wt(e,t,n,o,i){Ke(this,wt);var i=Qe(this,(wt.__proto__||Object.getPrototypeOf(wt)).call(this,e,t,{min:n,max:o,step:i})),r=i;function a(e){e.preventDefault();var t=r.__background.getBoundingClientRect();return r.setValue(vt(e.clientX,t.left,t.right,r.__min,r.__max)),!1}function s(){lt.unbind(window,"mousemove",a),lt.unbind(window,"mouseup",s),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function l(e){var t=e.touches[0].clientX,e=r.__background.getBoundingClientRect();r.setValue(vt(t,e.left,e.right,r.__min,r.__max))}function c(){lt.unbind(window,"touchmove",l),lt.unbind(window,"touchend",c),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}return i.__background=document.createElement("div"),i.__foreground=document.createElement("div"),lt.bind(i.__background,"mousedown",function(e){document.activeElement.blur(),lt.bind(window,"mousemove",a),lt.bind(window,"mouseup",s),a(e)}),lt.bind(i.__background,"touchstart",function(e){if(1!==e.touches.length)return;lt.bind(window,"touchmove",l),lt.bind(window,"touchend",c),l(e)}),lt.addClass(i.__background,"slider"),lt.addClass(i.__foreground,"slider-fg"),i.updateDisplay(),i.__background.appendChild(i.__foreground),i.domElement.appendChild(i.__background),i}var xt=(ie(Et,ot),X(Et,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),Et);function Et(e,t,n){Ke(this,Et);var t=Qe(this,(Et.__proto__||Object.getPrototypeOf(Et)).call(this,e,t)),o=t;return t.__button=document.createElement("div"),t.__button.innerHTML=void 0===n?"Fire":n,lt.bind(t.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),lt.addClass(t.__button,"button"),t.domElement.appendChild(t.__button),t}var Ct=(ie(Ot,ot),X(Ot,[{key:"updateDisplay",value:function(){var t,n=Ye(this.getValue());!1!==n&&(t=!1,De.each($e.COMPONENTS,function(e){if(!De.isUndefined(n[e])&&!De.isUndefined(this.__color.__state[e])&&n[e]!==this.__color.__state[e])return t=!0,{}},this),t&&De.extend(this.__color.__state,n)),De.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var e=this.__color.v<.5||.5<this.__color.s?255:0,o=255-e;De.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+e+","+e+","+e+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,kt(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),De.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+e+","+e+","+e+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]),Ot);function Ot(e,t){Ke(this,Ot);var n=Qe(this,(Ot.__proto__||Object.getPrototypeOf(Ot)).call(this,e,t));n.__color=new $e(n.getValue()),n.__temp=new $e(0);var o=n;n.domElement=document.createElement("div"),lt.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",lt.bind(n.__input,"keydown",function(e){13===e.keyCode&&l.call(this)}),lt.bind(n.__input,"blur",l),lt.bind(n.__selector,"mousedown",function(){lt.addClass(this,"drag").bind(window,"mouseup",function(){lt.removeClass(o.__selector,"drag")})}),lt.bind(n.__selector,"touchstart",function(){lt.addClass(this,"drag").bind(window,"touchend",function(){lt.removeClass(o.__selector,"drag")})});e=document.createElement("div");function i(e){u(e),lt.bind(window,"mousemove",u),lt.bind(window,"touchmove",u),lt.bind(window,"mouseup",a),lt.bind(window,"touchend",a)}function r(e){d(e),lt.bind(window,"mousemove",d),lt.bind(window,"touchmove",d),lt.bind(window,"mouseup",s),lt.bind(window,"touchend",s)}function a(){lt.unbind(window,"mousemove",u),lt.unbind(window,"touchmove",u),lt.unbind(window,"mouseup",a),lt.unbind(window,"touchend",a),c()}function s(){lt.unbind(window,"mousemove",d),lt.unbind(window,"touchmove",d),lt.unbind(window,"mouseup",s),lt.unbind(window,"touchend",s),c()}function l(){var e=Ye(this.value);!1!==e?(o.__color.__state=e,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function c(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function u(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,e=n.clientX,n=n.clientY,e=(e-t.left)/(t.right-t.left),t=1-(n-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),1<e?e=1:e<0&&(e=0),o.__color.v=t,o.__color.s=e,o.setValue(o.__color.toOriginal()),!1}function d(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__hue_field.getBoundingClientRect(),t=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),o.__color.h=360*t,o.setValue(o.__color.toOriginal()),!1}return De.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),De.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),De.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),De.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),De.extend(e.style,{width:"100%",height:"100%",background:"none"}),kt(e,"top","rgba(0,0,0,0)","#000"),De.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(t=n.__hue_field).style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",De.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),lt.bind(n.__saturation_field,"mousedown",i),lt.bind(n.__saturation_field,"touchstart",i),lt.bind(n.__field_knob,"mousedown",i),lt.bind(n.__field_knob,"touchstart",i),lt.bind(n.__hue_field,"mousedown",r),lt.bind(n.__hue_field,"touchstart",r),n.__saturation_field.appendChild(e),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}var At=["-moz-","-o-","-webkit-","-ms-",""];function kt(t,n,o,i){t.style.background="",De.each(At,function(e){t.style.cssText+="background: "+e+"linear-gradient("+n+", "+o+" 0%, "+i+" 100%); "})}var St=function(e,t,n,o,i){var r=e[t];return De.isArray(n)||De.isObject(n)?new dt(e,t,n):De.isNumber(r)?De.isNumber(n)&&De.isNumber(o)?De.isNumber(i)?new yt(e,t,n,o,i):new yt(e,t,n,o):De.isNumber(i)?new gt(e,t,{min:n,max:o,step:i}):new gt(e,t,{min:n,max:o}):De.isString(r)?new ht(e,t):De.isFunction(r)?new xt(e,t,""):De.isBoolean(r)?new ct(e,t):null},g=(ie(Tt,ot),X(Tt,[{key:"controller",set:function(e){this._controller=e},get:function(){return this._controller}}]),Tt);function Tt(e,t){Ke(this,Tt);var n=Qe(this,(Tt.__proto__||Object.getPrototypeOf(Tt)).call(this,e,t));return n.arguments={object:e,property:t,opts:Array.prototype.slice.call(arguments,2)},e.property&&(n.property=e.property(n)),n}ie=function(e,t){var t=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e;var o=t.getElementsByTagName("head")[0];try{o.appendChild(n)}catch(e){}};var Lt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},Pt=(X(Rt,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),De.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",lt.unbind(t.domElement,"webkitTransitionEnd",e),lt.unbind(t.domElement,"transitionend",e),lt.unbind(t.domElement,"oTransitionEnd",e)}var t=this;lt.bind(this.domElement,"webkitTransitionEnd",e),lt.bind(this.domElement,"transitionend",e),lt.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-lt.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-lt.getHeight(this.domElement)/2+"px"}}]),Rt);function Rt(){Ke(this,Rt),this.backgroundElement=document.createElement("div"),De.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),lt.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),De.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;lt.bind(this.backgroundElement,"click",function(){e.hide()})}ie(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var Nt="Default",jt=function(){try{return!!window.localStorage}catch(e){return!1}}(),Ht=void 0,Mt=!0,Bt=void 0,Vt=!1,Ft=[],Dt=function t(e){var n=this,o=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),lt.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],o=De.defaults(o,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),o=De.defaults(o,{resizable:o.autoPlace,hideable:o.autoPlace}),De.isUndefined(o.load)?o.load={preset:Nt}:o.preset&&(o.load.preset=o.preset),De.isUndefined(o.parent)&&o.hideable&&Ft.push(this),o.resizable=De.isUndefined(o.parent)&&o.resizable,o.autoPlace&&De.isUndefined(o.scrollable)&&(o.scrollable=!0);var i,r,a,s,l=jt&&"true"===localStorage.getItem(Yt(0,"isLocal")),c=void 0,u=void 0;function d(e){return e.preventDefault(),r.width+=a-e.clientX,r.onResize(),a=e.clientX,!1}function p(){lt.removeClass(r.__closeButton,Dt.CLASS_DRAG),lt.unbind(window,"mousemove",d),lt.unbind(window,"mouseup",p)}function h(e){return e.preventDefault(),a=e.clientX,lt.addClass(r.__closeButton,Dt.CLASS_DRAG),lt.bind(window,"mousemove",d),lt.bind(window,"mouseup",p),!1}Object.defineProperties(this,{parent:{get:function(){return o.parent}},scrollable:{get:function(){return o.scrollable}},autoPlace:{get:function(){return o.autoPlace}},closeOnTop:{get:function(){return o.closeOnTop}},preset:{get:function(){return(n.parent?n.getRoot():o.load).preset},set:function(e){n.parent?n.getRoot().preset=e:o.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return o.width},set:function(e){o.width=e,Kt(n,e)}},name:{get:function(){return o.name},set:function(e){o.name=e,u&&(u.innerHTML=o.name)}},closed:{get:function(){return o.closed},set:function(e){o.closed=e,o.closed?lt.addClass(n.__ul,t.CLASS_CLOSED):lt.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return o.load}},useLocalStorage:{get:function(){return l},set:function(e){jt&&((l=e)?lt.bind(window,"unload",c):lt.unbind(window,"unload",c),localStorage.setItem(Yt(0,"isLocal"),e))}}}),De.isUndefined(o.parent)?(this.closed=o.closed||!1,lt.addClass(this.domElement,t.CLASS_MAIN),lt.makeSelectable(this.domElement,!1),jt&&l&&(n.useLocalStorage=!0,(i=localStorage.getItem(Yt(0,"gui")))&&(o.load=JSON.parse(i))),this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,lt.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),o.closeOnTop?(lt.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(lt.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),lt.bind(this.__closeButton,"click",function(){n.closed=!n.closed})):(void 0===o.closed&&(o.closed=!0),i=document.createTextNode(o.name),lt.addClass(i,"controller-name"),u=zt(n,i),lt.addClass(this.__ul,t.CLASS_CLOSED),lt.addClass(u,"title"),lt.bind(u,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1}),o.closed||(this.closed=!1)),o.autoPlace&&(De.isUndefined(o.parent)&&(Mt&&(Bt=document.createElement("div"),lt.addClass(Bt,"dg"),lt.addClass(Bt,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Bt),Mt=!1),Bt.appendChild(this.domElement),lt.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||Kt(n,o.width)),this.__resizeHandler=function(){n.onResizeDebounced()},lt.bind(window,"resize",this.__resizeHandler),lt.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),lt.bind(this.__ul,"transitionend",this.__resizeHandler),lt.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),o.resizable&&(a=void 0,(r=this).__resize_handle=document.createElement("div"),De.extend(r.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),lt.bind(r.__resize_handle,"mousedown",h),lt.bind(r.__closeButton,"mousedown",h),r.domElement.insertBefore(r.__resize_handle,r.domElement.firstElementChild)),c=function(){jt&&"true"===localStorage.getItem(Yt(0,"isLocal"))&&localStorage.setItem(Yt(0,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=c,o.parent||((s=n.getRoot()).width+=1,De.defer(function(){--s.width}))};function zt(e,t,n){var o=document.createElement("li");return t&&o.appendChild(t),n?e.__ul.insertBefore(o,n):e.__ul.appendChild(o),e.onResize(),o}function It(e){lt.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&lt.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function Gt(e,t){e=e.__preset_select[e.__preset_select.selectedIndex];e.innerHTML=t?e.value+"*":e.value}function Xt(e,t){var n=e.getRoot(),o=n.__rememberedObjects.indexOf(t.object);if(-1!==o){var i=n.__rememberedObjectIndecesToControllers[o];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[o]=i),i[t.property]=t,n.load&&n.load.remembered){i=n.load.remembered,n=void 0;if(i[e.preset])n=i[e.preset];else{if(!i[Nt])return;n=i[Nt]}n[o]&&void 0!==n[o][t.property]&&(o=n[o][t.property],t.initialValue=o,t.setValue(o))}}}function Ut(e,t,n,o){var i;if(t.arguments&&(t=(i=t).arguments.object,n=i.arguments.property,o={factoryArgs:i.arguments.opts}),void 0===i&&void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var r=void 0;null===(r=o.color?new Ct(t,n):void 0!==i&&"string"==typeof i.property?i:(l=[t,n].concat(o.factoryArgs),St.apply(e,l)))?r=i:void 0!==i&&(i.controller=r),o.before instanceof ot&&(o.before=o.before.__li),Xt(e,r),lt.addClass(r.domElement,"c");var a=document.createElement("span");if(lt.addClass(a,"property-name"),void 0!==i&&"object"===qe(i.property))for(var s in i.property)a.appendChild(i.property[s]);else a.innerHTML=r.property;var l=document.createElement("div");l.appendChild(a),l.appendChild(r.domElement);var c,u,d,p,o=zt(e,l,o.before);return lt.addClass(o,Dt.CLASS_CONTROLLER_ROW),r instanceof Ct?lt.addClass(o,"color"):lt.addClass(o,qe(r.getValue())),c=e,u=o,(d=r).__li=u,d.__gui=c,De.extend(d,{options:function(e){if(1<arguments.length){var t=d.__li.nextElementSibling;return d.remove(),Ut(c,d.object,d.property,{before:t,factoryArgs:[De.toArray(arguments)]})}if(De.isArray(e)||De.isObject(e)){t=d.__li.nextElementSibling;return d.remove(),Ut(c,d.object,d.property,{before:t,factoryArgs:[e]})}},name:function(e){return d.__li.firstElementChild.firstElementChild.innerHTML=e,d},listen:function(){return d.__gui.listen(d),d},remove:function(){return d.__gui.remove(d),d}}),d instanceof yt?(p=new gt(d.object,d.property,{min:d.__min,max:d.__max,step:d.__step}),De.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=d[e],n=p[e];d[e]=p[e]=function(){var e=Array.prototype.slice.call(arguments);return n.apply(p,e),t.apply(d,e)}}),lt.addClass(u,"has-slider"),d.domElement.insertBefore(p.domElement,d.domElement.firstElementChild)):d instanceof gt?(o=function(e){if(De.isNumber(d.__min)&&De.isNumber(d.__max)){var t=d.__li.firstElementChild.firstElementChild.innerHTML,n=-1<d.__gui.__listening.indexOf(d);d.remove();var o=Ut(c,d.object,d.property,{before:d.__li.nextElementSibling,factoryArgs:[d.__min,d.__max,d.__step]});return o.name(t),n&&o.listen(),o}return e},d.min=De.compose(o,d.min),d.max=De.compose(o,d.max)):d instanceof ct?(lt.bind(u,"click",function(){lt.fakeEvent(d.__checkbox,"click")}),lt.bind(d.__checkbox,"click",function(e){e.stopPropagation()})):d instanceof xt?(lt.bind(u,"click",function(){lt.fakeEvent(d.__button,"click")}),lt.bind(u,"mouseover",function(){lt.addClass(d.__button,"hover")}),lt.bind(u,"mouseout",function(){lt.removeClass(d.__button,"hover")})):d instanceof Ct&&(lt.addClass(u,"color"),d.updateDisplay=De.compose(function(e){return u.style.borderLeftColor=d.__color.toString(),e},d.updateDisplay),d.updateDisplay()),d.setValue=De.compose(function(e){return c.getRoot().__preset_select&&d.isModified()&&Gt(c.getRoot(),!0),e},d.setValue),e.__controllers.push(r),r}function Yt(e,t){return document.location.href+"."+t}function Wt(e,t,n){var o=document.createElement("option");o.innerHTML=t,o.value=t,e.__preset_select.appendChild(o),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function qt(e,t){t.style.display=e.useLocalStorage?"block":"none"}function Kt(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function Jt(i,r){var a={};return De.each(i.__rememberedObjects,function(e,t){var n={},o=i.__rememberedObjectIndecesToControllers[t];De.each(o,function(e,t){n[t]=r?e.initialValue:e.getValue()}),a[t]=n}),a}Dt.toggleHide=function(){Vt=!Vt,De.each(Ft,function(e){e.domElement.style.display=Vt?"none":""})},Dt.CLASS_AUTO_PLACE="a",Dt.CLASS_AUTO_PLACE_CONTAINER="ac",Dt.CLASS_MAIN="main",Dt.CLASS_CONTROLLER_ROW="cr",Dt.CLASS_TOO_TALL="taller-than-window",Dt.CLASS_CLOSED="closed",Dt.CLASS_CLOSE_BUTTON="close-button",Dt.CLASS_CLOSE_TOP="close-top",Dt.CLASS_CLOSE_BOTTOM="close-bottom",Dt.CLASS_DRAG="drag",Dt.DEFAULT_WIDTH=245,Dt.TEXT_CLOSED="Close Controls",Dt.TEXT_OPEN="Open Controls",Dt._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||Dt.toggleHide()},lt.bind(window,"keydown",Dt._keydownHandler,!1),De.extend(Dt.prototype,{add:function(e,t){return Ut(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return Ut(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;De.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Bt.removeChild(this.domElement);var t=this;De.each(this.__folders,function(e){t.removeFolder(e)}),lt.unbind(window,"keydown",Dt._keydownHandler,!1),It(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);t=new Dt(t);this.__folders[e]=t;e=zt(this,t.domElement);return lt.addClass(e,"folder"),t},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],It(t);var e=this;De.each(t.__folders,function(e){t.removeFolder(e)}),De.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e,t,n=this.getRoot();n.scrollable&&(e=lt.getOffset(n.__ul).top,t=0,De.each(n.__ul.childNodes,function(e){n.autoPlace&&e===n.__save_row||(t+=lt.getHeight(e))}),window.innerHeight-e-20<t?(lt.addClass(n.domElement,Dt.CLASS_TOO_TALL),n.__ul.style.height=window.innerHeight-e-20+"px"):(lt.removeClass(n.domElement,Dt.CLASS_TOO_TALL),n.__ul.style.height="auto")),n.__resize_handle&&De.defer(function(){n.__resize_handle.style.height=n.__ul.offsetHeight+"px"}),n.__closeButton&&(n.__closeButton.style.width=n.width+"px")},onResizeDebounced:De.debounce(function(){this.onResize()},50),remember:function(){if(De.isUndefined(Ht)&&((Ht=new Pt).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;De.each(Array.prototype.slice.call(arguments),function(e){0===t.__rememberedObjects.length&&function(n){var e=n.__save_row=document.createElement("li");lt.addClass(n.domElement,"has-save"),n.__ul.insertBefore(e,n.__ul.firstChild),lt.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",lt.addClass(t,"button gears");var o=document.createElement("span");o.innerHTML="Save",lt.addClass(o,"button"),lt.addClass(o,"save");var i=document.createElement("span");i.innerHTML="New",lt.addClass(i,"button"),lt.addClass(i,"save-as");var r=document.createElement("span");r.innerHTML="Revert",lt.addClass(r,"button"),lt.addClass(r,"revert");var a=n.__preset_select=document.createElement("select");n.load&&n.load.remembered?De.each(n.load.remembered,function(e,t){Wt(n,t,t===n.preset)}):Wt(n,Nt,!1);{var s;lt.bind(a,"change",function(){for(var e=0;e<n.__preset_select.length;e++)n.__preset_select[e].innerHTML=n.__preset_select[e].value;n.preset=this.value}),e.appendChild(a),e.appendChild(t),e.appendChild(o),e.appendChild(i),e.appendChild(r),jt&&(s=document.getElementById("dg-local-explain"),e=document.getElementById("dg-local-storage"),document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(Yt(0,"isLocal"))&&e.setAttribute("checked","checked"),qt(n,s),lt.bind(e,"change",function(){n.useLocalStorage=!n.useLocalStorage,qt(n,s)}))}var l=document.getElementById("dg-new-constructor");lt.bind(l,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Ht.hide()}),lt.bind(t,"click",function(){l.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),Ht.show(),l.focus(),l.select()}),lt.bind(o,"click",function(){n.save()}),lt.bind(i,"click",function(){var e=prompt("Enter a new preset name.");e&&n.saveAs(e)}),lt.bind(r,"click",function(){n.revert()})}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&Kt(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var n=this.load;return n.closed=this.closed,0<this.__rememberedObjects.length&&(n.preset=this.preset,n.remembered||(n.remembered={}),n.remembered[this.preset]=Jt(this)),n.folders={},De.each(this.__folders,function(e,t){n.folders[t]=e.getSaveObject()}),n},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Jt(this),Gt(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Nt]=Jt(this,!0)),this.load.remembered[e]=Jt(this),this.preset=e,Wt(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(t){De.each(this.__controllers,function(e){this.getRoot().load.remembered?Xt(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),De.each(this.__folders,function(e){e.revert(e)}),t||Gt(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&Lt.call(window,function(){e(t)});De.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){De.each(this.__controllers,function(e){e.updateDisplay()}),De.each(this.__folders,function(e){e.updateDisplay()})}});var Zt={Controller:ot,BooleanController:ct,OptionController:dt,StringController:ht,NumberController:O,NumberControllerBox:gt,NumberControllerSlider:yt,FunctionController:xt,ColorController:Ct,CustomController:g};
/**
 * get position functions library
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function Qt(e,t){var n,o,i,r,a=Pe.THREE,s=t.clone();for(;n=e,o=s,r=i=void 0,i=new a.Vector3,r=new a.Vector3,(i=o.clone()).multiply(n.scale),r.copy(i),r.applyEuler(n.rotation),i.x=r.x,i.y=r.y,i.z=r.z,i.add(n.position),s=i,e=e.parent,e&&e.parent;);return s}ie={isWebGLAvailable:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},isWebGL2Available:function(){try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},getWebGLErrorMessage:function(){return this.getErrorMessage(1)},getWebGL2ErrorMessage:function(){return this.getErrorMessage(2)},getErrorMessage:function(e){var t={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext},n='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>',o=document.createElement("div");return o.id="webglmessage",o.style.fontFamily="monospace",o.style.fontSize="13px",o.style.fontWeight="normal",o.style.textAlign="center",o.style.background="#fff",o.style.color="#000",o.style.padding="1.5em",o.style.width="400px",o.style.margin="5em auto 0",n=(n=t[e]?n.replace("$0","graphics card"):n.replace("$0","browser")).replace("$1",{1:"WebGL",2:"WebGL 2"}[e]),o.innerHTML=n,o}};
/**
* node.js version of the synchronous download of the file.
* @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
*
* @copyright 2011 Data Arts Team, Google Creative Lab
*
* @license under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*/function $t(t){if(this.loadXMLDoc=function(){var e;if(window.XMLHttpRequest){if(!(e=new XMLHttpRequest))throw"new XMLHttpRequest() failed!"}else{if(!window.ActiveXObject)throw"myRequest.loadXMLDoc(...) failed!";if(!(e=this.NewActiveXObject()))throw"NewActiveXObject() failed!"}return e},this.NewActiveXObject=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}return a('This browser does not support XMLHttpRequest. Probably, your security settings do not allow Web sites to use ActiveX controls installed on your computer. Refresh your Web page to find out the current status of your Web page or enable the "Initialize and script ActiveX controls not marked as safe" and "Run Active X controls and plug-ins" of the Security settings of the Internet zone of your browser.'),null},this.XMLHttpRequestStart=function(e,t){this.XMLHttpRequestStop(),this.req.onreadystatechange=e,"onerror"in this.req&&(this.req.onerror=function(e){a("XMLHttpRequest error. url: "+this.url)}),this.XMLHttpRequestReStart(t)},this.getUrl=function(){return void 0!==this.url&&null!=this.url||(this.url="XMLHttpRequest.xml"),this.url+(this.params||"")},this.XMLHttpRequestReStart=function(e){try{void 0===e&&(e=!0),this.req.open("GET",this.getUrl(),e),e&&("timeout"in this.req&&(this.req.timeout=9e4),"ontimeout"in this.req?this.req.ontimeout=function(){a("XMLHttpRequest timeout")}:(clearTimeout(this.timeout_id_SendReq),this.timeout_id_SendReq=setTimeout(function(){a("XMLHttpRequest timeout 2")},9e4))),this.req.send(null)}catch(e){a(e.message+" url: "+this.url)}},this.XMLHttpRequestStop=function(){null!=this.req&&this.req.abort()},this.ProcessReqChange=function(e){var t=this.req;switch(t.readyState){case 4:if("unknown"==typeof t.status)return consoleError('typeof XMLHttpRequest status == "unknown"'),!0;if(200==t.status)return clearTimeout(this.timeout_id_SendReq),e(this);a("Invalid XMLHttpRequest status : "+t.status+" url: "+this.url);break;case 1:case 2:case 3:break;case 0:default:throw"processReqChange(); req.readyState = "+t.readyState}return!0},this.processStatus200Error=function(){var e=this.GetElementText("error",!0);return!!e&&(a(e),!0)},this.GetElementText=function(e,t){var n=this.req;if(!n.responseXML)return 1!=t&&a("GetXMLElementText(xmlhttp, "+e+"); xmlhttp.responseXML is null.\nxmlhttp.responseText:\n"+n.responseText),null;var o=n.responseXML.getElementsByTagName(e);if(0==o.length)return 1!=t&&a('GetXMLElementText(xmlhttp, "'+e+'"); element.length == '+o.length),"";for(var i="",r=0;r<o.length;r++)if(void 0===o[r].textContent){if(void 0===o[r].text)return a("GetXMLElementText(xmlhttp, "+e+"); element["+r+"].text) == undefined"),"";""!=i&&(i+=" "),i+=o[r].text}else i+=o[r].textContent;return i},t.data)this.req=t.data.req,this.url=t.data.url,this.params=t.data.params;else try{this.req=this.loadXMLDoc()}catch(e){var n=void 0===e.message?e:e.message;return void a("Your browser is too old and is not compatible with our site.\n\n"+window.navigator.appName+" "+window.navigator.appVersion+"\n\n"+n)}function a(e){console.error(e),t.onerror(e)}this.req||consoleError("Invalid myRequest.req: "+this.req)}function en(t,n){(n=n||{}).onload=n.onload||function(){},n.onerror=n.onerror||function(){};var o,e=new $t(n);return e.url=t,e.XMLHttpRequestStart(function(){e.ProcessReqChange(function(e){e.processStatus200Error()||(o=e.req.responseText,n.onload(o,t))})},!1),o}
/**
 * node.js version of the load JavaScript file
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * Thanks to:
 *http://javascript.ru/forum/events/21439-dinamicheskaya-zagruzka-skriptov.html
 *https://learn.javascript.ru/onload-onerror
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function tn(e,t){if(t.tag=t.tag||{},"string"==typeof t.tag){if("style"!==t.tag)return void console.error("Invalid options.tag: "+t.tag);t.tag={name:"style",attribute:{name:"rel",value:"stylesheet"}}}t.tag.name=t.tag.name||"script";var n=document.createElement(t.tag.name);t.tag.attribute=t.tag.attribute||{},t.tag.attribute.name=t.tag.attribute.name||"type",t.tag.attribute.value=t.tag.attribute.value||"text/javascript",n.setAttribute(t.tag.attribute.name,t.tag.attribute.value),e(n),t.appendTo.appendChild(n)}function nn(e,t){for(var n=e.querySelectorAll("script"),o=0;o<n.length;o++)if(n[o].id===t)return 1}var on,O={sync:function(t,n){if((n=n||{}).onload=n.onload||function(){},n.onerror=n.onerror||function(){},n.appendTo=n.appendTo||document.getElementsByTagName("head")[0],nn(n.appendTo,t))n.onload();else if(t instanceof Array){for(var o,i={appendTo:n.appendTo,tag:n.tag,onload:function(e,t){console.log("loadScript.sync.onload: "+t)},onerror:function(e){n.onerror(e),o=e}},e=0;e<t.length;e++){var r=t[e];if(tn(function(e){e.setAttribute("id",r),e.innerHTML=en(r,i)},i),void 0!==o)break}void 0===o&&n.onload()}else tn(function(e){e.setAttribute("id",t),e.innerHTML=en(t,n)},n)},async:function(e,o){var i;function r(t){function n(){e instanceof Array&&i<e.length-1?r(e[++i]):o.onload()}nn(o.appendTo,t,o.onload)?n():tn(function(e){e.setAttribute("id",t),e.readyState&&!e.onload?e.onreadystatechange=function(){"complete"==e.readyState&&void 0!==o.onload&&o.onload(),"loaded"==e.readyState&&(setTimeout(o.onload,0),this.onreadystatechange=null)}:(e.onload=function(){console.log("loadScript.async.onload() "+t),void 0!==o.onload&&n()},e.onerror=function(e){var t='loadScript: "'+this.src+'" failed';void 0!==o.onerror&&o.onerror(t,e),console.error(t)}),e.src=t},o)}(o=o||{}).appendTo=o.appendTo||document.getElementsByTagName("head")[0],o.onload=o.onload||function(){},e instanceof Array?r(e[i=0]):r(e)}},g=(on=function(){if(document.currentScript&&""!==document.currentScript.src)return document.currentScript.src;var e=document.getElementsByTagName("script");return""!==e[e.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]}()).substring(0,on.lastIndexOf("/"));
/**
 * @module ColorPicker
 * @description Pure JavaScript color picker.
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * Thanks to https://github.com/DavidDurman/FlexiColorPicker
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 */O.sync(g+"/colorpicker.css",{tag:"style"});function rn(e,t){Pe.THREE.EventDispatcher;var o,i,r,a,s,l,n=Pe.THREE.MOUSE,c=Pe.THREE.Quaternion,u=Pe.THREE.Spherical,d=Pe.THREE.TOUCH,p=Pe.THREE.Vector2,h=Pe.THREE.Vector3;void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new h,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:n.ROTATE,MIDDLE:n.DOLLY,RIGHT:n.PAN},this.touches={ONE:d.ROTATE,TWO:d.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return w.phi},this.getAzimuthalAngle=function(){return w.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",ie),this._domElementKeyEvents=e},this.saveState=function(){f.target0.copy(f.target),f.position0.copy(f.object.position),f.zoom0=f.object.zoom},this.reset=function(){f.target.copy(f.target0),f.object.position.copy(f.position0),f.object.zoom=f.zoom0,f.object.updateProjectionMatrix(),f.dispatchEvent(m),f.update(),v=b.NONE},this.update=(o=new h,i=(new c).setFromUnitVectors(e.up,new h(0,1,0)),r=i.clone().invert(),a=new h,s=new c,l=2*Math.PI,function(){var e=f.object.position;o.copy(e).sub(f.target),o.applyQuaternion(i),w.setFromVector3(o),f.autoRotate&&v===b.NONE&&M(2*Math.PI/60/60*f.autoRotateSpeed),f.enableDamping?(w.theta+=x.theta*f.dampingFactor,w.phi+=x.phi*f.dampingFactor):(w.theta+=x.theta,w.phi+=x.phi);var t=f.minAzimuthAngle,n=f.maxAzimuthAngle;return isFinite(t)&&isFinite(n)&&(t<-Math.PI?t+=l:t>Math.PI&&(t-=l),n<-Math.PI?n+=l:n>Math.PI&&(n-=l),w.theta=t<=n?Math.max(t,Math.min(n,w.theta)):w.theta>(t+n)/2?Math.max(t,w.theta):Math.min(n,w.theta)),w.phi=Math.max(f.minPolarAngle,Math.min(f.maxPolarAngle,w.phi)),w.makeSafe(),w.radius*=E,w.radius=Math.max(f.minDistance,Math.min(f.maxDistance,w.radius)),!0===f.enableDamping?f.target.addScaledVector(C,f.dampingFactor):f.target.add(C),o.setFromSpherical(w),o.applyQuaternion(r),e.copy(f.target).add(o),f.object.lookAt(f.target),!0===f.enableDamping?(x.theta*=1-f.dampingFactor,x.phi*=1-f.dampingFactor,C.multiplyScalar(1-f.dampingFactor)):(x.set(0,0,0),C.set(0,0,0)),E=1,!!(O||a.distanceToSquared(f.object.position)>y||8*(1-s.dot(f.object.quaternion))>y)&&(f.dispatchEvent(m),a.copy(f.object.position),s.copy(f.object.quaternion),!(O=!1))}),this.dispose=function(){f.domElement.removeEventListener("contextmenu",le),f.domElement.removeEventListener("pointerdown",ee),f.domElement.removeEventListener("wheel",oe),f.domElement.removeEventListener("touchstart",re),f.domElement.removeEventListener("touchend",se),f.domElement.removeEventListener("touchmove",ae),f.domElement.ownerDocument.removeEventListener("pointermove",te),f.domElement.ownerDocument.removeEventListener("pointerup",ne),null!==f._domElementKeyEvents&&f._domElementKeyEvents.removeEventListener("keydown",ie)};var f=this,m={type:"change"},_={type:"start"},g={type:"end"},b={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},v=b.NONE,y=1e-6,w=new u,x=new u,E=1,C=new h,O=!1,A=new p,k=new p,S=new p,T=new p,L=new p,P=new p,R=new p,N=new p,j=new p;function H(){return Math.pow(.95,f.zoomSpeed)}function M(e){x.theta-=e}function B(e){x.phi-=e}var V,F,D,z=(V=new h,function(e,t){V.setFromMatrixColumn(t,0),V.multiplyScalar(-e),C.add(V)}),I=(F=new h,function(e,t){!0===f.screenSpacePanning?F.setFromMatrixColumn(t,1):(F.setFromMatrixColumn(t,0),F.crossVectors(f.object.up,F)),F.multiplyScalar(e),C.add(F)}),G=(D=new h,function(e,t){var n,o=f.domElement;f.object.isPerspectiveCamera?(n=f.object.position,D.copy(n).sub(f.target),n=D.length(),n*=Math.tan(f.object.fov/2*Math.PI/180),z(2*e*n/o.clientHeight,f.object.matrix),I(2*t*n/o.clientHeight,f.object.matrix)):f.object.isOrthographicCamera?(z(e*(f.object.right-f.object.left)/f.object.zoom/o.clientWidth,f.object.matrix),I(t*(f.object.top-f.object.bottom)/f.object.zoom/o.clientHeight,f.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),f.enablePan=!1)});function X(e){f.object.isPerspectiveCamera?E/=e:f.object.isOrthographicCamera?(f.object.zoom=Math.max(f.minZoom,Math.min(f.maxZoom,f.object.zoom*e)),f.object.updateProjectionMatrix(),O=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),f.enableZoom=!1)}function U(e){f.object.isPerspectiveCamera?E*=e:f.object.isOrthographicCamera?(f.object.zoom=Math.max(f.minZoom,Math.min(f.maxZoom,f.object.zoom/e)),f.object.updateProjectionMatrix(),O=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),f.enableZoom=!1)}function Y(e){A.set(e.clientX,e.clientY)}function W(e){T.set(e.clientX,e.clientY)}function q(e){var t;1==e.touches.length?A.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),e=.5*(e.touches[0].pageY+e.touches[1].pageY),A.set(t,e))}function K(e){var t;1==e.touches.length?T.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),e=.5*(e.touches[0].pageY+e.touches[1].pageY),T.set(t,e))}function J(e){var t=e.touches[0].pageX-e.touches[1].pageX,e=e.touches[0].pageY-e.touches[1].pageY,e=Math.sqrt(t*t+e*e);R.set(0,e)}function Z(e){var t;1==e.touches.length?k.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY),k.set(t,n)),S.subVectors(k,A).multiplyScalar(f.rotateSpeed);var n=f.domElement;M(2*Math.PI*S.x/n.clientHeight),B(2*Math.PI*S.y/n.clientHeight),A.copy(k)}function Q(e){var t;1==e.touches.length?L.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),e=.5*(e.touches[0].pageY+e.touches[1].pageY),L.set(t,e)),P.subVectors(L,T).multiplyScalar(f.panSpeed),G(P.x,P.y),T.copy(L)}function $(e){var t=e.touches[0].pageX-e.touches[1].pageX,e=e.touches[0].pageY-e.touches[1].pageY,e=Math.sqrt(t*t+e*e);N.set(0,e),j.set(0,Math.pow(N.y/R.y,f.zoomSpeed)),X(j.y),R.copy(N)}function ee(e){if(!1!==f.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){var t;switch(e.preventDefault(),(f.domElement.focus?f.domElement:window).focus(),e.button){case 0:t=f.mouseButtons.LEFT;break;case 1:t=f.mouseButtons.MIDDLE;break;case 2:t=f.mouseButtons.RIGHT;break;default:t=-1}switch(t){case n.DOLLY:if(!1===f.enableZoom)return;!function(e){R.set(e.clientX,e.clientY)}(e),v=b.DOLLY;break;case n.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===f.enablePan)return;W(e),v=b.PAN}else{if(!1===f.enableRotate)return;Y(e),v=b.ROTATE}break;case n.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===f.enableRotate)return;Y(e),v=b.ROTATE}else{if(!1===f.enablePan)return;W(e),v=b.PAN}break;default:v=b.NONE}v!==b.NONE&&(f.domElement.ownerDocument.addEventListener("pointermove",te),f.domElement.ownerDocument.addEventListener("pointerup",ne),f.dispatchEvent(_))}(e)}}function te(e){if(!1!==f.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===f.enabled)return;switch(e.preventDefault(),v){case b.ROTATE:if(!1===f.enableRotate)return;!function(e){k.set(e.clientX,e.clientY),S.subVectors(k,A).multiplyScalar(f.rotateSpeed),e=f.domElement,M(2*Math.PI*S.x/e.clientHeight),B(2*Math.PI*S.y/e.clientHeight),A.copy(k),f.update()}(e);break;case b.DOLLY:if(!1===f.enableZoom)return;!function(e){N.set(e.clientX,e.clientY),j.subVectors(N,R),0<j.y?X(H()):j.y<0&&U(H()),R.copy(N),f.update()}(e);break;case b.PAN:if(!1===f.enablePan)return;!function(e){L.set(e.clientX,e.clientY),P.subVectors(L,T).multiplyScalar(f.panSpeed),G(P.x,P.y),T.copy(L),f.update()}(e)}}(e)}}function ne(e){switch(e.pointerType){case"mouse":case"pen":!function(){if(f.domElement.ownerDocument.removeEventListener("pointermove",te),f.domElement.ownerDocument.removeEventListener("pointerup",ne),!1===f.enabled)return;f.dispatchEvent(g),v=b.NONE}()}}function oe(e){!1===f.enabled||!1===f.enableZoom||v!==b.NONE&&v!==b.ROTATE||(e.preventDefault(),e.stopPropagation(),f.dispatchEvent(_),(e=e).deltaY<0?U(H()):0<e.deltaY&&X(H()),f.update(),f.dispatchEvent(g))}function ie(e){!1!==f.enabled&&!1!==f.enablePan&&function(e){var t=!1;switch(e.keyCode){case f.keys.UP:G(0,f.keyPanSpeed),t=!0;break;case f.keys.BOTTOM:G(0,-f.keyPanSpeed),t=!0;break;case f.keys.LEFT:G(f.keyPanSpeed,0),t=!0;break;case f.keys.RIGHT:G(-f.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),f.update())}(e)}function re(e){if(!1!==f.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(f.touches.ONE){case d.ROTATE:if(!1===f.enableRotate)return;q(e),v=b.TOUCH_ROTATE;break;case d.PAN:if(!1===f.enablePan)return;K(e),v=b.TOUCH_PAN;break;default:v=b.NONE}break;case 2:switch(f.touches.TWO){case d.DOLLY_PAN:if(!1===f.enableZoom&&!1===f.enablePan)return;t=e,f.enableZoom&&J(t),f.enablePan&&K(t),v=b.TOUCH_DOLLY_PAN;break;case d.DOLLY_ROTATE:if(!1===f.enableZoom&&!1===f.enableRotate)return;t=e,f.enableZoom&&J(t),f.enableRotate&&q(t),v=b.TOUCH_DOLLY_ROTATE;break;default:v=b.NONE}break;default:v=b.NONE}var t;v!==b.NONE&&f.dispatchEvent(_)}}function ae(e){var t;if(!1!==f.enabled)switch(e.preventDefault(),e.stopPropagation(),v){case b.TOUCH_ROTATE:if(!1===f.enableRotate)return;Z(e),f.update();break;case b.TOUCH_PAN:if(!1===f.enablePan)return;Q(e),f.update();break;case b.TOUCH_DOLLY_PAN:if(!1===f.enableZoom&&!1===f.enablePan)return;t=e,f.enableZoom&&$(t),f.enablePan&&Q(t),f.update();break;case b.TOUCH_DOLLY_ROTATE:if(!1===f.enableZoom&&!1===f.enableRotate)return;t=e,f.enableZoom&&$(t),f.enableRotate&&Z(t),f.update();break;default:v=b.NONE}}function se(e){!1!==f.enabled&&(f.dispatchEvent(g),v=b.NONE)}function le(e){!1!==f.enabled&&e.preventDefault()}f.domElement.addEventListener("contextmenu",le),f.domElement.addEventListener("pointerdown",ee),f.domElement.addEventListener("wheel",oe),f.domElement.addEventListener("touchstart",re),f.domElement.addEventListener("touchend",se),f.domElement.addEventListener("touchmove",ae),this.update()}function an(e,t){rn.call(this,e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=MOUSE.PAN,this.mouseButtons.RIGHT=MOUSE.ROTATE,this.touches.ONE=TOUCH.PAN,this.touches.TWO=TOUCH.DOLLY_ROTATE}var sn=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",ln=0,cn=new function e(){b(this,e);var n=this;function m(e,t,n){for(var o in e=document.createElementNS("http://www.w3.org/2000/svg",e),t)e.setAttribute(o,t[o]);"[object Array]"!=Object.prototype.toString.call(n)&&(n=[n]);for(var i=0,r=n[0]&&n.length||0;i<r;i++)e.appendChild(n[i]);return e}this.paletteIndexes={BGRW:0,monochrome:1,bidirectional:2,rainbow:3},this.create=function(e,i){function r(){return"horizontal"===i.orientation}if((i=i||{}).orientation=i.orientation||"horizontal",void 0===i.direction&&(i.direction=!0),i.style=i.style||{},i.style.width=i.style.width||(r()?200:30),i.style.height=i.style.height||(r()?30:200),i.onError=i.onError||function(){},e instanceof HTMLElement!=!0){if("string"!=typeof e)return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e);if(null===(e=document.getElementById(e)))return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e)}for(var t in e.classList.add("slider-wrapper"),i.style)e.style[t]=i.style[t];var o,n,a,s,l,c=i.palette instanceof this.palette?i.palette:new this.palette(i);function u(){return"string"==typeof i.style.height?parseInt(i.style.height):i.style.height}function d(){return h.clientWidth}function p(e,t){var n;void 0!==o?void 0!==(n=c.hsv2rgb(e))?(e=n.percent,void 0===t&&(t=r()?d()*e/100:u()-u()*(i.direction?e:100-e)/100),function(e){if(void 0===o)return;r()?e<0||e>d()?console.error("ColorPicker.positionIndicators: Invalid position = "+e):(o.style.top="0px",o.style.left=(i.direction?e:d()-e)-o.offsetWidth/2+"px"):e<0||e>u()?console.error("ColorPicker.positionIndicators: Invalid position = "+e):(o.style.left="0px",o.style.top=e-o.offsetHeight/2+"px")}(t),void 0!==i.sliderIndicator.callback&&i.sliderIndicator.callback(n)):console.error("ColorPicker.setValue: invalud c = "+n):console.error("Set value of this instance of the ColorPicker is impossible because options.sliderIndicator is not defined.")}if(void 0!==i.sliderIndicator&&((o=document.createElement("div")).className="slider-indicator",r()?o.style.width="10px":o.style.height="10px",e.appendChild(o),o.style.pointerEvents="none"),"SVG"==sn){try{var h=m("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:r()?"100%":i.style.width,height:i.style.height},[m("defs",{},m("linearGradient",{id:"gradient-hsv-"+ln,x1:r()&&i.direction?"100%":"0%",y1:r()||i.direction?"0%":"100%",x2:r()&&!i.direction?"100%":"0%",y2:!r()&&i.direction?"100%":"0%"},c.getPalette())),m("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv-"+ln+")"})]);void 0!==o&&(h.style.cursor=r()?"e-resize":"s-resize",o.style.cursor=h.style.cursor)}catch(e){console.error("Create SVG element failed! "+e.message)}e.appendChild(h),e.style.height=u()+"px",void 0!==o&&(r()?o.style.height=parseInt(i.style.height)-2+"px":o.style.width=parseInt(i.style.width)-2+"px",i.sliderIndicator.value=i.sliderIndicator.value||0,p(i.sliderIndicator.value)),ln++}else console.error("Under constraction");function f(e){var t,n,o;e.x=parseInt(e.x),e.y=parseInt(e.y),r()?(t=e.x,n=d()-1,t>=d()&&(t=n),o=100*t/n,i.direction||(o=100-o,t=n-t)):(t=e.y,n=u()-1,t>=u()&&(t=n),o=100*(1-t/n),i.direction||(o=100-o)),p(o,t)}return void 0!==o&&(n=function(){return function(e){l||f(function(e){if(window.event&&void 0!==window.event.contentOverflow)return{x:window.event.offsetX,y:window.event.offsetY};if(void 0!==e.offsetX&&void 0!==e.offsetY)return{x:e.offsetX,y:e.offsetY};var t=e.target.parentNode.parentNode;return{x:e.layerX-t.offsetLeft,y:e.layerY-t.offsetTop}}(e=e||window.event))}},l=!(s=function(e,i){var t=h;a(t,"touchstart",function(e){}),a(t,"touchmove",function(e){e.preventDefault();var t=e.srcElement.getBoundingClientRect(),n=e.touches[0].clientX-t.left,t=e.touches[0].clientY-t.top;n<0&&(n=0),t<0&&(t=0),f({x:n,y:t})}),a(t,"touchend",function(e){}),a(t,"mousedown",function(e){var n="mouseup",o="mousemove";a(window,n,function e(){function t(e,t,n){null!==e&&(e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener&&e.removeEventListener(t,n,!1))}t(window,n,e),t(window,o,i)}),a(window,o,i)}),a(t,"mouseout",function(e){l=!0}),a(t,"mouseover",function(e){l=!1})}),(a=function(e,t,n){null!==e&&(e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,!1))})(h,"click",n()),s(0,n())),{setValue:p}},this.palette=function(p){function e(e,t,n,o){return{percent:e,r:t,g:n,b:o}}void 0===(p=p||{}).palette&&(p.palette=n.paletteIndexes.BGRW),this.getPaletteIndex=function(){return p.palette};var h=[new e(0,0,0,255),new e(33,0,255,0),new e(66,255,255,0),new e(100,255,255,255)];switch(x(p.palette)){case"number":switch(p.palette){case n.paletteIndexes.BGRW:break;case n.paletteIndexes.monochrome:h=[new e(0,0,0,0),new e(100,255,255,255)];break;case n.paletteIndexes.bidirectional:h=[new e(0,255,48,48),new e(50,48,48,48),new e(100,48,255,48)];break;case n.paletteIndexes.rainbow:h=[new e(0,255,50,50),new e(16,252,245,40),new e(32,40,252,40),new e(50,40,252,248),new e(66,39,46,249),new e(82,255,40,251),new e(100,255,50,50)];break;default:console.error("ColorPicker.create.Palette: invalid options.palette = "+p.palette)}break;case"object":if(Array.isArray(p.palette)){h=p.palette;break}default:var t="invalid options.palette = "+p.palette;console.error("ColorPicker.create.Palette: "+t),p.onError(t)}this.getPalette=function(){var t=[];return h.forEach(function(e){t.unshift(m("stop",{offset:100-e.percent+"%","stop-color":"#"+("0"+Number(e.r).toString(16)).slice(-2).toUpperCase()+("0"+Number(e.g).toString(16)).slice(-2).toUpperCase()+("0"+Number(e.b).toString(16)).slice(-2).toUpperCase(),"stop-opacity":"1"}))}),t},this.hsv2rgb=function(e,t,n){var i=parseFloat(e);void 0!==t&&void 0!==n&&(i=100/(n-t)*(i-t));var o,r,a=h[h.length-1];100!==a.percent&&(o={},Object.keys(a).forEach(function(e){o[e]=a[e]}),o.percent=100,h.push(o));for(var s=0;s<h.length;s++){var l=h[s];if(void 0===r&&(r=l),i>=r.percent&&i<=l.percent){var c=function(e,t,n,o){n-=e;return 0==n?t:Math.round(t+(o-t)/n*(i-e))},u=c(r.percent,r.r,l.percent,l.r),d=c(r.percent,r.g,l.percent,l.g),c=c(r.percent,r.b,l.percent,l.b);return{r:u,g:d,b:c,hex:"#"+(16777216|c|d<<8|u<<16).toString(16).slice(1),percent:i}}r=l}void 0!==p.onError&&p.onError("Invalid color value of the ColorPicker: "+e)},this.toColor=function(e,t,n){var o=Pe.THREE;if(e instanceof o.Color)return e;n=this.hsv2rgb(e,t,n);return void 0===n&&(n={r:255,g:255,b:255}),new o.Color("rgb("+n.r+", "+n.g+", "+n.b+")")}}};
/**
 * @module cookie
 * @description node.js version of the cookie.
 * Cookies let you store user information in web pages.
 * @see {@link https://www.w3schools.com/js/js_cookies.asp}
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
function un(){return navigator.cookieEnabled}function dn(e,t,n){un()?(t=t.toString(),void 0===n&&(n=new Date).setTime(n.getTime()+31536e6),document.cookie=e+"="+t+("undefined"==typeof settings?"":settings)+"; expires="+n.toGMTString(),""===document.cookie&&console.error("document.cookie is empty")):fn()}function pn(e,t){if(un()){e=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return e?unescape(e[2]):void 0===t?"":t}fn()}function hn(e,t){return JSON.parse(pn(e,JSON.stringify(t)))}function fn(){console.error("navigator.cookieEnabled = "+navigator.cookieEnabled)}function mn(e){this.get=function(e){return e},this.set=function(){},this.getObject=function(e,n,o){o&&Object.keys(o).forEach(function(e){var t=o[e];void 0!==t&&"function"!=typeof t&&(n[e]=JSON.parse(JSON.stringify(t)))})},this.copyObject=function(e,t){return JSON.parse(JSON.stringify(t))},this.setObject=function(){},this.isTrue=function(e){return e}}
/**
* node.js version of the cookie.
*
* @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
*
* @copyright 2011 Data Arts Team, Google Creative Lab
*
* @license under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*/var _n={set:dn,setObject:function(e,t){dn(e,JSON.stringify(t))},get:pn,getObject:function(e,t,n){(new mn).getObject(e,t,hn(e,n))},copyObject:hn,defaultCookie:mn};
/**
 * @module Localization.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function gn(){return(navigator?void 0!==navigator.languages&&"unknown"!=typeof navigator.languages&&0<navigator.languages.length?navigator.languages[0]:navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage||(console.error("getLocale() failed!"),""):(console.error("getLocale() failed! !navigator"),"")).toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/)[1]}
/**
 * options of the canvas
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */!1===ie.isWebGLAvailable()&&(document.body.appendChild(ie.getWebGLErrorMessage()),alert(ie.getWebGLErrorMessage().innerHTML));function bn(r){var e;b(this,bn);var o=this;if((r=r||{}).boOptions)return r;void 0===r.a&&(r.a=1),void 0===r.b&&(r.b=0),this.setW=function(e){(e=e||r).scales=e.scales||{},e.scales.w=e.scales.w||{};var t=e.scales.w;t.name=t.name||"w",e.palette||this.setPalette(e),t.min=void 0===t.min?0:t.min,t.max=void 0===t.max?(new Pe.THREE.Vector4).w:t.max},r.scales=r.scales||{};var t,n=!r.scales.x&&!r.scales.y&&!r.scales.z;function i(e){n&&(r.scales[e]=r.scales[e]||{}),r.scales[e]&&(r.scales[e].name=r.scales[e].name||e,r.scales[e].min=void 0===r.scales[e].min?-1:r.scales[e].min,r.scales[e].max=void 0===r.scales[e].max?1:r.scales[e].max)}for(t in i("x"),i("y"),i("z"),r.scales.setW=function(){o.setW()},r.point=r.point||{},r.point.size=r.point.size||5,r.point.sizePointsMaterial=r.point.sizePointsMaterial||100,this.setPalette=function(){r.palette||(r.palette=new cn.palette)},this.createOrbitControls=function(e,t,n){!1!==r.orbitControls&&((rn.prototype=Object.create(Pe.THREE.EventDispatcher.prototype)).constructor=rn,(an.prototype=Object.create(Pe.THREE.EventDispatcher.prototype)).constructor=an,o.orbitControls=new rn(e,t.domElement),o.orbitControls.target.set(2*n.position.x,2*n.position.y,2*n.position.z),o.orbitControls.saveState(),o.orbitControls.update())},this.restoreSceneController=function(e,t){var n,o,i;Pe.dat&&(n={defaultButton:"Default",defaultTitle:"Reset player and restore camera position."},"ru"===this.getLanguageCode()&&(n.defaultButton="Восстановить",n.defaultTitle="Восстановить положение сцены и проирывателя."),o=(new Pe.THREE.Vector3).copy(t.position),i=(new Pe.THREE.Vector3).copy(e.position),Pe.dat.controllerNameAndTitle(r.dat.gui.add({defaultF:function(){r.player&&r.player.setTime(r.playerOptions.min),e.position.copy(i),t.position.copy(o),!1!==r.orbitControls&&(r.orbitControls.target=new Pe.THREE.Vector3,r.orbitControls.object.position.copy(e.position),r.orbitControls.update())}},"defaultF"),n.defaultButton,n.defaultTitle))},Object.defineProperties(this,(a(e={playerOptions:{get:function(){r.playerOptions=r.playerOptions||{};var e,t=r.playerOptions;return t.min=t.min||0,t.max===1/0&&(t.max=null),null!==t.max?(void 0===t.max&&(t.max=1),t.marks=t.marks||10):t.marks=null,null===t.max?t.dt=t.dt||.1:t.dt=(t.max-t.min)/(t.marks-1),t.repeat=t.repeat||!1,t.interval=t.interval||1,t.zoomMultiplier=t.zoomMultiplier||1.1,t.offset=t.offset||.1,t.name=t.name||"",t.cameraTarget||(e=new vn.cameraTarget,Object.defineProperties(t,{cameraTarget:{get:function(){return e}}})),r.playerOptions},set:function(e){r.playerOptions=e}},a:{get:function(){return r.a}},b:{get:function(){return r.b}},dat:{get:function(){function n(t){if(b(this,n),(t=t||{}).boDat)return t;for(var e in Object.defineProperties(this,{boDat:{get:function(){return!0}},dat:{get:function(){return console.warn("get dat depreacated. Use three.dat = dat."),Pe.dat},set:function(e){console.warn("Set dat depreacated. Use three.dat = dat."),e.dat&&e.dat.constructor.name===e.constructor.name&&"Object"!==e.dat.constructor.name&&console.error("duplicate dat."),e.dat=e}},cookieName:{get:function(){return t.cookieName}},gui:{get:function(){return!t.gui&&Pe.dat&&(t.gui=new Pe.dat.GUI),t.gui}},cookie:{get:function(){return t.cookie},set:function(e){t.cookie=e}},guiSelectPoint:{get:function(){return t.guiSelectPoint},set:function(e){t.guiSelectPoint=e}},cameraGui:{get:function(){return t.cameraGui},set:function(e){t.cameraGui=e}}}),t)void 0===this[e]&&console.error("Dat: dat."+e+" key is hidden")}var t,o;return r.dat=new n(r.dat),r.dat.gui&&(t=r.dat.gui.domElement.className,o=0,r.dat.gui.domElement.parentElement.childNodes.forEach(function(e){e.className===t&&o++}),1<o&&console.error("Options: duplicate dat.GUI"),r.dat.gui.domElement.addEventListener("mouseenter",function(e){r.dat.mouseenter=!0}),r.dat.gui.domElement.addEventListener("mouseleave",function(e){r.dat.mouseenter=!1})),!1===r.dat.cookie?r.dat.cookie=new _n.defaultCookie:void 0===r.dat.cookie&&(r.dat.cookie=_n),r.dat.getCookieName=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=r.dat.cookieName||(r.elContainer?"object"===x(r.elContainer)?r.elContainer.id:"string"==typeof r.elContainer?r.elContainer:"":"");return e+(""!==e&&""!==t?"_":"")+t},r.dat},set:function(e){r.dat=e}},getLanguageCode:{get:function(){return"string"==typeof r.getLanguageCode?function(){return r.getLanguageCode}:r.getLanguageCode||gn}},scales:{get:function(){return r.scales},set:function(e){r.scales=e}},palette:{get:function(){if(void 0!==r.palette)switch(x(r.palette)){case"number":r.palette=new cn.palette({palette:r.palette});break;case"boolean":r.palette&&(r.palette=new cn.palette);break;default:r.palette instanceof cn.palette==!1&&console.error("MyThree: invalid typeof options.palette: "+x(r.palette))}return r.palette}},boOptions:{get:function(){return!0}},point:{get:function(){return r.point}},raycaster:{get:function(){return r.raycaster}},camera:{get:function(){return r.camera=r.camera||{},r.camera.position||(r.camera.position=new Pe.THREE.Vector3(.4,.4,2)),r.camera.scale||(r.camera.scale=new Pe.THREE.Vector3(1,1,1)),r.camera},set:function(e){r.camera=e}},cameraTarget:{get:function(){return r.cameraTarget}},elContainer:{get:function(){return r.elContainer}},canvasMenu:{get:function(){return r.canvasMenu},set:function(e){r.canvasMenu&&!0!==r.canvasMenu&&!1!==r.canvasMenu&&console.warn("Duplicate canvasMenu"),r.canvasMenu=e}},canvas:{get:function(){return r.canvas}},frustumPoints:{get:function(){return r.frustumPoints},set:function(e){r.frustumPoints&&r.frustumPoints.constructor.name===e.constructor.name&&"Object"!==r.frustumPoints.constructor.name&&console.error("duplicate frustumPoints."),r.frustumPoints=e}},stereoEffect:{get:function(){return r.stereoEffect},set:function(e){r.stereoEffect&&r.stereoEffect.constructor.name===e.constructor.name&&"Object"!==r.stereoEffect.constructor.name&&console.error("duplicate stereoEffect."),r.stereoEffect=e}},player:{get:function(){return r.player},set:function(e){r.player&&console.error("duplicate player."),r.player=e}},axesHelper:{get:function(){return r.axesHelper},set:function(e){r.axesHelper&&console.error("duplicate axesHelper."),r.axesHelper=e}}},"canvasMenu",{get:function(){return r.canvasMenu},set:function(e){r.canvasMenu&&console.error("duplicate canvasMenu."),r.canvasMenu=e}}),a(e,"orbitControls",{get:function(){return r.orbitControls},set:function(e){r.orbitControls&&r.orbitControls.constructor.name===e.constructor.name&&"Object"!==r.orbitControls.constructor.name&&console.error("duplicate orbitControls."),r.orbitControls=e}}),a(e,"scale",{get:function(){return 1}}),a(e,"pointLight",{get:function(){return r.pointLight}}),a(e,"cameraTarget",{get:function(){return r.cameraTarget}}),e)),r)void 0===this[t]&&console.error("Options: options."+t+" key is hidden")}var vn=function n(o){var h=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};b(this,n),xn(),!h.options&&h.frustumPoints&&(h.options=h.frustumPoints.getOptions()),h.options=h.options||new bn;var i,r,a,s,l,u,c,f=h.options;function t(e){e=e||0;var t=r.getTime();n.selectPlayScene(o,{t:t,index:e,options:h.options}),r.setIndex(e,(""===f.playerOptions.name?"":f.playerOptions.name+": ")+t),h.onSelectScene&&h.onSelectScene(e,t),f.frustumPoints&&f.frustumPoints.updateCloudPoints()}function e(){f.player.controllers.forEach(function(e){e.onRenamePlayButtons&&e.onRenamePlayButtons(a)})}function d(){a=!1,e(),s=void 0}function p(){if(i++,null!==f.playerOptions.max&&i>=f.playerOptions.marks){if(!f.playerOptions.repeat)return i=f.playerOptions.marks-1,void d();i=0}(-1===i||i===f.playerOptions.marks&&null!==f.playerOptions.max)&&(i=0),t(i)}function m(e){"ru"===e()&&(u.prevSymbolTitle="Кадр назад",u.playTitle="Проиграть",u.nextSymbolTitle="Кадр вперед",u.pauseTitle="Пауза",u.repeatOn="Повторять проигрывание",u.repeatOff="Остановить повтор проигрывания",u.controllerTitle="Текущее время.",u.stereoEffects="Стерео эффекты",u.mono="Моно",u.sideBySide="Слева направо",u.topAndBottom="Сверху вниз")}function _(e){b(this,_);var i,r,a=f.player,t=f.getLanguageCode;if(!(e=e||f.dat.gui)||!1===f.dat.playController){var n=w(this,(_.__proto__||Object.getPrototypeOf(_)).call(this,{}));return w(n)}function s(e,t,n){var o=document.createElement("span");return o.innerHTML=e,o.title=t,o.style.cursor="pointer",o.style.margin="0px 2px",o.onclick=n,o}m(t);var l="rgb(255,255,255)",c="rgb(128,128,128)",n=w(this,(_.__proto__||Object.getPrototypeOf(_)).call(this,{playRate:1,property:function(){var e,t,n,o={};return i=function(e,t){o.buttonPlay.innerHTML=e,o.buttonPlay.title=t},o.buttonPrev=s(u.prevSymbol,u.prevSymbolTitle,a.prev),o.buttonPlay=s(u.playSymbol,u.playTitle,a.play3DObject),null!==a.getSettings().options.playerOptions.max&&(r=e=function(e){var t,n=e?(t=u.repeatOff,l):(t=u.repeatOn,c);o.buttonRepeat.title!==t&&(o.buttonRepeat.title=t,o.buttonRepeat.style.color=n,a.onChangeRepeat(e))},n=a.getSettings().repeat?(t=u.repeatOff,l):(t=u.repeatOn,c),o.buttonRepeat=s(u.repeat,t,function(){e(o.buttonRepeat.title===u.repeatOn)}),o.buttonRepeat.style.color=n),o.buttonNext=s(u.nextSymbol,u.nextSymbolTitle,a.next),o}},"playRate"));return(a.PlayController=n).lang=u,n.onRenamePlayButtons=function(e){var t,e=e?(t=u.pause,u.pauseTitle):(t=u.playSymbol,u.playTitle);i(t,e,!0)},n.onChangeRepeat=function(){r(a.getSettings().options.playerOptions.repeat)},a.pushController(n),n.setValue=function(e){this._controller.domElement.childNodes[0].value=e},e.add(n).__truncationSuspended=!0,w(n)}function g(){if(c)return c.querySelector("#sliderPosition")}f.boOptions?!1!==f.player&&(n.player=this,f.boPlayer=f.boPlayer||!1,f.player?console.error("Player: duplicate player."):(f.player=this,h.cameraTarget=h.cameraTarget||{},setTimeout(function(){t()},0),i=0,(r=this).getTime=function(){var e=f.playerOptions,t=e.min+i*e.dt;return isNaN(t)&&console.error("Player.getTime(): t = "+t),null!==e.max&&t>e.max&&console.error("Player.getTime(): t = "+t+" playerOptions.max = "+e.max),t<e.min&&null!==e.max&&console.error("Player.getTime(): t = "+t+" playerOptions.min = "+e.min),t},this.setTime=function(e){this.selectScene(parseInt((e-f.playerOptions.min)/f.playerOptions.dt))},this.selectScene=function(e){if(void 0!==e)for(e=parseInt(e),null!==f.playerOptions.max&&(e>=f.playerOptions.marks?e=0:e<0&&(e=f.playerOptions.marks-1),i>f.playerOptions.marks&&(i=f.playerOptions.marks));i!==e;)i<e?i++:i--,t(i);else t(i)},this.next=function(){r.selectScene(i+1)},this.prev=function(){r.selectScene(i-1)},this.pushController=function(e){void 0!==e.object&&void 0!==e.object.playRate&&(e.object.playRate=f.playerOptions.min),this.controllers.push(e)},a=!(this.controllers=[]),this.play3DObject=function(){a?d():(a=!0,null!==f.playerOptions.max&&i>=f.playerOptions.marks-1&&(i=0),p(),e(),window.requestAnimationFrame(function e(t){if(a?window.requestAnimationFrame(e):s=void 0,void 0===s&&(l=(s=t)+1e3/f.playerOptions.interval),!isNaN(l)&&l!==1/0||(console.error("Player.animate: timeNext = "+l),a=!1),!(t<l)){for(;l<t;)l+=1e3/f.playerOptions.interval;p()}}))},this.repeat=function(){f.playerOptions.repeat=!f.playerOptions.repeat,this.onChangeRepeat(f.playerOptions.repeat)},this.getSettings=function(){return h},this.getSelectSceneIndex=function(){return i},this.onChangeRepeat=function(e){f.playerOptions.repeat=e,this.controllers.forEach(function(e){e.onChangeRepeat&&e.onChangeRepeat()})},u={prevSymbol:"←",prevSymbolTitle:"Go to previous animation scene",nextSymbol:"→",nextSymbolTitle:"Go to next animation scene",playSymbol:"►",playTitle:"Play",pause:"❚❚",pauseTitle:"Pause",repeat:"⥀",repeatOn:"Turn repeat on",repeatOff:"Turn repeat off",controllerTitle:"Current time.",stereoEffects:"Stereo effects",mono:"Mono",sideBySide:"Side by side",topAndBottom:"Top and bottom"},this.localization=function(){return m(0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return"en"}),u},this.PlayController=(y(_,Zt.CustomController),v(_,[{key:"controller",set:function(e){this._controller=e,this._controller.onChange(function(e){f.player.setTime(e)}),this._controller.domElement.title=this.lang.controllerTitle},get:function(){return this._controller}}]),_),this.gui=function(e){var i,r,t,n,a,o=f.dat.cookie,s=f.dat.getCookieName("Player"),l=f.getLanguageCode,c=Pe.dat;function u(){null===f.playerOptions.max?f.playerOptions.dt=f.playerOptions.dt||.1:f.playerOptions.dt=(f.playerOptions.max-f.playerOptions.min)/(f.playerOptions.marks-1)}function d(){u(),o.setObject(s,f.playerOptions),h.onChangeScaleT&&h.onChangeScaleT(f.playerOptions)}function p(){null!==f.playerOptions.max&&(f.playerOptions.max=f.playerOptions.min+f.playerOptions.dt*(f.playerOptions.marks-1))}(e=e||f.dat.gui)&&!1!==f.dat.playerGui&&(p(),i=JSON.parse(JSON.stringify(f.playerOptions)),r=function(t){var e={player:"Player",playerTitle:"3D objects animation.",min:"Min",max:"Max",dt:"Step",dtTitle:"Time between frames",marks:"Frames",marksTitle:"Player frames count",interval:"Rate",intervalTitle:"Rate of changing of animation scenes per second.",time:"Time",defaultButton:"Default",defaultTitle:"Restore default player settings."},n=void 0===(t=t||{}).getLanguageCode?"en":t.getLanguageCode();switch(n){case"ru":e.player="Проигрыватель",e.playerTitle="Анимация 3D объектов.",e.min="Минимум",e.max="Максимум",e.dt="Шаг",e.dtTitle="Веремя между кадрами",e.marks="Кадры",e.marksTitle="Количество кадров проигрывателя",e.interval="Темп",e.intervalTitle="Скорость смены кадров в секунду.",e.time="Время",e.defaultButton="Восстановить",e.defaultTitle="Восстановить настройки проигрывателя по умолчанию.";break;default:if(void 0===t.lang||t.lang._languageCode!=n)break;Object.keys(t.lang).forEach(function(e){void 0!==_lang[e]&&(_lang[e]=t.lang[e])})}return e}({getLanguageCode:l}),Object.freeze(i),t=f.playerOptions.max,n=f.playerOptions.marks,o.getObject(s,f.playerOptions,f.playerOptions),null!==t&&t!==1/0&&null!==f.playerOptions.max||(f.playerOptions.max=t,f.playerOptions.marks=n),a=e.addFolder(r.player),c.folderNameAndTitle(a,r.player,r.playerTitle),function(){var n=f.playerOptions,o={};function e(e,t){e=e.controller.getValue();n.min=t(n.min,e),o.min.setValue(n.min),n.max&&(n.max=t(n.max,e),u(),o.max.setValue(n.max)),d()}o.folder=a.addFolder(""!==n.name?n.name:r.time),o.scaleController=o.folder.add(new Re(e,{settings:h.options.playerOptions,getLanguageCode:l})).onChange(function(e){n.zoomMultiplier=e,d()});var t=new je(function(n){e(t,function(e,t){return e+=n})},{settings:h.options.playerOptions,getLanguageCode:l});o.positionController=o.folder.add(t).onChange(function(e){n.offset=e,d()}),o.min=c.controllerZeroStep(o.folder,n,"min",function(e){d()}),c.controllerNameAndTitle(o.min,r.min),p(),null!==n.max?(o.max=c.controllerZeroStep(o.folder,n,"max",function(e){d()}),c.controllerNameAndTitle(o.max,r.max)):(o.dt=c.controllerZeroStep(o.folder,n,"dt",function(e){d()}),c.controllerNameAndTitle(o.dt,r.dt,r.dtTitle)),n.marks&&(o.marks=o.folder.add(n,"marks").onChange(function(e){n.marks=parseInt(n.marks),d();var t=g();t&&(t.max=f.playerOptions.marks-1)}),c.controllerNameAndTitle(o.marks,void 0===n.marksName?r.marks:n.marksName,(void 0===n.marksTitle?r:n).marksTitle)),o.interval=o.folder.add(h.options.playerOptions,"interval",1,25,1).onChange(function(e){d()}),c.controllerNameAndTitle(o.interval,r.interval,r.intervalTitle),c.controllerNameAndTitle(o.folder.add({defaultF:function(){n.zoomMultiplier=i.zoomMultiplier,o.scaleController.setValue(n.zoomMultiplier),n.offset=i.offset,o.positionController.setValue(n.offset),n.min=i.min,o.min.setValue(n.min),o.max&&(n.max=i.max,u(),o.max.setValue(n.max)),o.dt&&(n.dt=i.dt,o.dt.setValue(n.dt)),i.marks&&(n.marks=i.marks,o.marks&&o.marks.setValue(n.marks)),n.interval=i.interval,o.interval.setValue(n.interval),d()}},"defaultF"),r.defaultButton,r.defaultTitle)}())},this.createCanvasMenuItem=function(o){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return"en"},t=this,n=(c=o).menu,i=t.localization(e);n.push({name:i.prevSymbol,title:i.prevSymbolTitle,onclick:function(){t.prev()}}),n.push({name:i.playSymbol,title:i.playTitle,id:"menuButtonPlay",onclick:function(){t.play3DObject()}}),null!==f.playerOptions.max&&n.push({name:i.repeat,title:this.getSettings().repeat?i.repeatOff:i.repeatOn,id:"menuButtonRepeat",onclick:function(){t.repeat()}}),n.push({name:i.nextSymbol,title:i.nextSymbolTitle,onclick:function(){t.next()}}),this.controllers.push({onRenamePlayButtons:function(e){var t,n=e?(t=i.pause,i.pauseTitle):(t=i.playSymbol,i.playTitle),e=o.querySelector("#menuButtonPlay");e.innerHTML=t,e.title=n},onChangeRepeat:function(){o.querySelector("#menuButtonRepeat").title=f.playerOptions.repeat?i.repeatOff:i.repeatOn}})},this.addSlider=function(){null!==f.playerOptions.max&&c.menu.push({name:'<input type="range" min="0" max="'+(f.playerOptions.marks-1)+'" value="0" class="slider" id="sliderPosition">',style:"float: right;"})},this.addSliderEvents=function(){var t,n,o=g();return o&&(o.onchange=function(e){n.selectScene(parseInt(o.value))},o.oninput=function(e){n.selectScene(parseInt(o.value))},n=this,o.addEventListener("pointerdown",function(e){t=!0}),o.addEventListener("pointerup",function(e){t=!1}),o.addEventListener("mousemove",function(e){t&&n.selectScene((f.playerOptions.marks-1)*e.offsetX/o.clientWidth)})),o},this.setIndex=function(e,t){"object"===x(this.PlayController)&&this.PlayController.setValue(this.getTime());var n=g();n&&(n.value=e,n.title=t)},this.onChangeScale=function(e){g().max=e.marks-1,this.selectScene(0)})):console.error("Player: call options = new Options( options ) first")};
/**
 * @module Player
 * @description 3D objects animation.
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */vn.cameraTarget=function e(){b(this,e);var i,n={boLook:!1},t={boLook:n.boLook,getDistanceToCamera:function(){return void 0!==this.distanceToCameraCur?this.distanceToCameraCur:this.distanceToCamera}};n.rotation={};var o,r=(t.rotation={},!1),a=!1;function s(e){xn(),e=e||n,t.boMaual||(void 0!==e.boLook?t.boLook=e.boLook:t.boLook=n.boLook),t.camera=e.camera||n.camera,t.distanceToCamera=e.distanceToCamera||n.distanceToCamera||t.distanceToCamera||(new yn.Vector3).copy(n.camera.position),e.rotation||(e.rotation={}),t.rotation.angle=e.rotation.angle||n.rotation.angle||0,t.rotation.axis=e.rotation.axis||n.rotation.axis||new yn.Vector3(0,1,0)}this.get=function(e){if(e||i?i&&e&&!Object.is(i,e)&&console.error("Player.cameraTarget.get: options is ambiguous"):console.error("Player.cameraTarget.get: options = "+e),i=i||e,t.camera||a||!i.player||(n.camera=i.player.getSettings().cameraTarget.camera,n.camera&&s(),a=!0),t.camera)return t},this.init=function(e,t){if(t||i?i&&t&&!Object.is(i,t)&&console.error("Player.cameraTarget.init: options is ambiguous"):console.error("Player.cameraTarget.init: options = "+t),i=i||t,!1!==e.bodefault){if(r)return;void 0!==e.boLook&&(n.boLook=e.boLook,o=e.boLook)}else{if(!0!==e.boLook)return;r&&console.warn("playerCameraTarget().init(...): duplicate target point"),r=!0,void 0===o&&(n.boLook=!0)}n.camera=n.camera||e.camera||(i.player?i.player.getSettings().cameraTarget.camera:void 0),n.camera?(n.distanceToCamera=n.distanceToCamera||e.distanceToCamera,e.rotation=e.rotation||{},n.rotation.angle=n.rotation.angle||e.rotation.angle,n.rotation.axis=n.rotation.axis||e.rotation.axis,s(e)):console.error("playerCameraTarget().init(...): cameraTargetDefault.camera = "+n.camera)},this.changeTarget=function(e,t){xn();var n=i.playerOptions.cameraTarget.get(),o=e.userData.player&&"function"!=typeof e.userData.player.arrayFuncs?e.userData.player.arrayFuncs[t]:{};o.cameraTarget||(o.cameraTarget={boLook:!1}),s(o.cameraTarget),n&&n.boLook?(e=Qt(e,(new yn.Vector3).fromArray(e.geometry.attributes.position.array,t*e.geometry.attributes.position.itemSize)),n.target=e):delete n.target},this.setCameraTarget=function(n){xn();var e,t,o,i=n.playerOptions.cameraTarget.get(n),r=(i=i||i||{}).camera;r&&(i.distanceToCamera||(i.distanceToCamera=(new yn.Vector3).copy(r.position)),i.distanceToCameraCur||(i.distanceToCameraCur=new yn.Vector3),e=vn.getTime(),t=i.distanceToCamera,o=(new yn.Vector3).copy(i.distanceToCameraCur),i.distanceToCameraCur.set(vn.execFunc(t,"x",e,n),vn.execFunc(t,"y",e,n),vn.execFunc(t,"z",e,n)),i.setCameraPosition||(i.setCameraPosition=function(){var e=i.target;if(i.boLook&&(e||!i.distanceToCameraCur.equals(o))){o.copy(i.distanceToCameraCur);var t=vn.getTime();if(r.position.copy(i.distanceToCameraCur),r.position.applyAxisAngle(i.rotation.axis,vn.execFunc(i.rotation,"angle",t,n)),!e){if(!vn.orbitControls)return;e=vn.orbitControls.target}r.position.add(e),r.lookAt(e),n.orbitControls&&(n.orbitControls.target.equals(e)||(n.orbitControls.target.copy(e),n.orbitControlsGui&&n.orbitControlsGui.setTarget(e)),n.orbitControls._listeners&&n.orbitControls._listeners.change[0]())}}),n.cameraGui&&n.cameraGui.update())}},vn.execFunc=function(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=e[t],r=o.a,a=o.b,s=void 0===i?"undefined":x(i);switch(void 0===n&&(n=o.playerOptions?o.playerOptions.min:0),s){case"undefined":return;case"string":i=new Function("t","a","b","return "+i);case"function":try{var l=i(n,r,a);if(void 0===l)throw"function returns "+l;return l}catch(e){throw console.error(e),e}case"number":return i;case"object":if(Array.isArray(i)){var c=function(e){return"function"==typeof u[e]?u[e](n,u,a):u[e]instanceof yn.Color?u[e]:void 0};if(0===i.length)return void console.error('Player.execFunc: funcs["'+t+'"] array is empty');for(var u=i,d=i.length-1,p=null===o.playerOptions.max?1/0:o.playerOptions.max,h=o.playerOptions.min,f=(p-h)/d,m=h,_=p,g=0,b=d,v=0;v<i.length;v++)f*v+h<n&&(m=f*(g=v)+h,_=f*(b=v+1)+h);if("number"!=typeof u[g]){if("w"===t)return c(g);if("object"!==x(u[g]))return void console.error('Player.execFunc: funcs["'+t+'"] array item '+g+" typeof = "+x(u[g])+" is not number");for(v=0;v<i.length;v++){if(v===i.length-1)return u[v].v;if(b=(g=v)+1,m=u[g].t,_=u[b].t,m<=n&&n<_){var y=(u[b].v-u[g].v)/(_-m),w=u[g].v-y*m;return y*n+w}}return void console.error("Player.execFunc: value is not detected")}if(b>=i.length&&(b=g),"number"!=typeof u[b]){if("w"===t)return c(b);if("object"!==x(u[b]))return void console.error('Player.execFunc: funcs["'+t+'"] array item '+b+" typeof = "+x(u[b])+" is not number")}y=(u[b]-u[g])/(_-m),w=u[g]-y*m;return(isNaN(y)||isNaN(w))&&console.error("Player.execFunc: invalid x = "+y+" or y = "+w),y*n+w}return i.func?i.func instanceof Function?i.func(n,r,a):i.func:("w"!==t&&console.error('Player.execFunc: funcs["'+t+'"] object is not array'),i);default:console.error('Player.execFunc: Invalud typeof funcs["'+t+'"]: '+s)}},vn.selectMeshPlayScene=function(h){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};xn();var t,f=e.t,m=e.options||{dat:!1};void 0===f&&(f=m.playerOptions.min),m.scales.setW(),!h.userData.player||m&&m.boPlayer&&h.userData.boFrustumPoints||(h.geometry&&(delete h.geometry.boundingSphere,h.geometry.boundingSphere=null),h.userData.player.selectPlayScene&&(t=function(e){for(;h.rotation[e]<0;)h.rotation[e]+=2*Math.PI;for(;h.rotation[e]>2*Math.PI;)h.rotation[e]-=2*Math.PI},h.userData.player.selectPlayScene(f),t("x"),t("y"),t("z")),function(n,i){if(h.geometry){var r,a,s=h.geometry.attributes,l=h.userData.player.arrayFuncs;if(void 0!==l){void 0===f&&console.error("setPosition: t = "+f),m&&void 0!==m.scales.w?(r=m.scales.w.min,a=m.scales.w.max):r=(a=d)-1;for(var c,u,d,p=0;p<l.length;p++)!function(){function e(e,t){e=vn.execFunc(c,e,f,m);void 0!==e&&(s.position[t](p,e),u=!0)}c=l[p],u=!1,e("x","setX"),e("y","setY"),e("z","setZ");var o=void 0;function t(){if(h.userData.player.palette)o=h.userData.player.palette.toColor(d,r,a);else{if(!m.palette){var e=255,t=255,n=255;return o=new yn.Color("rgb("+e+", "+t+", "+n+")")}o=m.palette.toColor(d,r,a)}}"function"==typeof c.w?(d=c.w(f,n,i),a=m.scales.w?(r=m.scales.w.min,m.scales.w.max):(console.warn("Player.selectMeshPlayScene: Кажется эти экстремумы заданы неверно"),r=0,100),4<=s.position.itemSize&&s.position.setW(p,d),u=!0,t()):"object"===x(c.w)?c.w instanceof yn.Color?o=c.w:(d=vn.execFunc(c,"w",f,m),void 0!==c.w.min&&(r=c.w.min),void 0!==c.w.max&&(a=c.w.max),t()):"number"==typeof c.w&&m.palette&&(o=m.palette.toColor(c.w,r,a)),o&&(!h.material instanceof yn.ShaderMaterial&&h.material.vertexColors!==yn.VertexColors&&console.error("Player.selectMeshPlayScene: Please set the vertexColors parameter of the THREE.PointsMaterial of your points to THREE.VertexColors. Example: vertexColors: THREE.VertexColors"),!vn.setColorAttribute(s,p,o)&&c instanceof yn.Vector4&&(h.geometry.setAttribute("color",new yn.Float32BufferAttribute(vn.getColors(l,{positions:h.geometry.attributes.position,options:m}),4)),vn.setColorAttribute(s,p,o)||console.error('Player.selectMeshPlayScene: the color attribute is not exists. Please use THREE.Vector3 instead THREE.Vector4 in the arrayFuncs or add "color" attribute'))),u&&(s.position.needsUpdate=!0),c.line&&c.line.addPoint&&c.line.addPoint(h,p,o),c.cameraTarget&&!0===c.cameraTarget.boLook&&m.playerOptions.cameraTarget.changeTarget(h,p)}()}}}(m?m.a:1,m?m.b:0),t="Player.selectMeshPlayScene: invalid mesh.scale.",h.scale.x<=0&&console.error(t+"x = "+h.scale.x),h.scale.y<=0&&console.error(t+"y = "+h.scale.y),h.scale.z<=0&&console.error(t+"z = "+h.scale.z),m&&m.guiSelectPoint&&(m.guiSelectPoint.setMesh(),-1!==(t=m.guiSelectPoint.getSelectedPointIndex())&&m.guiSelectPoint.isSelectedMesh(h)&&m.guiSelectPoint.setPosition({object:h,index:t})))},vn.setColorAttribute=function(e,t,n){"string"==typeof n&&(n=new yn.Color(n));e=e.color||e.ca;return void 0!==e&&(e.setX(t,n.r),e.setY(t,n.g),e.setZ(t,n.b),e.needsUpdate=!0)},vn.getPoints=function(t,n){xn(),Array.isArray(t)||(t=[t]),void 0===(n=n||{}).t&&(n.t=n.options&&n.options.player?n.options.player.getSettings().options.playerOptions.min:0);var o=n.options||new bn,e={palette:o.palette};o.setW(e);for(var i=e.scales.w.max,r=0;r<t.length;r++){var a=t[r];Array.isArray(a)?t[r]=new yn.Vector4(void 0===a[0]?0:a[0],void 0===a[1]?0:a[1],void 0===a[2]?0:a[2],void 0===a[3]?i:a[3]):"object"===(void 0===a?"undefined":x(a))&&a instanceof yn.Vector2==!1&&a instanceof yn.Vector3==!1&&a instanceof yn.Vector4==!1&&(void 0===a.vector?t[r]=new yn.Vector4(void 0===a.x?0:a.x,void 0===a.y?0:a.y,void 0===a.z?0:a.z,void 0===a.w?0:a.w):a.vector instanceof yn.Vector2==!0||a.vector instanceof yn.Vector3==!0||a.vector instanceof yn.Vector4==!0?a.vector instanceof yn.Vector2==!0&&(t[r].vector=new yn.Vector3(void 0===a.vector.x?0:a.vector.x,void 0===a.vector.y?0:a.vector.y,void 0===a.vector.z?0:a.vector.z)):4===a.vector.length?t[r].vector=new yn.Vector4(void 0===a.vector[0]?0:a.vector[0],void 0===a.vector[1]?0:a.vector[1],void 0===a.vector[2]?0:a.vector[2],void 0===a.vector[3]?0:a.vector[3]):3===a.vector.length?t[r].vector=new yn.Vector3(void 0===a.vector[0]?0:a.vector[0],void 0===a.vector[1]?0:a.vector[1],void 0===a.vector[2]?0:a.vector[2]):console.error("Player.getPoints(...) falied! item.vector.length = "+a.vector.length))}for(var s=[],r=0;r<t.length;r++){var l=function(e){return"number"==typeof c&&(c=new yn.Vector4(c,0,0,0)),c instanceof yn.Vector2||c instanceof yn.Vector3||c instanceof yn.Vector4?vn.execFunc(c,e,n.t,o):void 0!==c.vector?(void 0!==c.name&&(c.vector.name=c.name),c.trace&&o.player&&(c.vector.line=new vn.traceLine(o)),c.cameraTarget&&(c.vector.cameraTarget=c.cameraTarget,delete c.cameraTarget),t[r]=c.vector,c=c.vector,vn.execFunc(c,e,n.t,o)):void console.error("Player.getAxis().getPoints(): funcs.vector = "+c.vector)},c=t[r],l=c.vector instanceof yn.Vector3==!0?new yn.Vector3(l("x"),l("y"),l("z")):new yn.Vector4(l("x"),l("y"),l("z"),l("w"));c.cameraTarget&&(c.cameraTarget.bodefault=!1,void 0===c.cameraTarget.boLook&&(c.cameraTarget.boLook=!0),o.playerOptions.cameraTarget.init(c.cameraTarget,o)),s.push(l)}return s};var yn,wn=!0;function xn(){Pe.isThree()?(yn=Pe.THREE,Object.assign(yn.BufferGeometry.prototype,{setFromPoints:function(e,t){t=t||3;for(var n=[],o=0,i=e.length;o<i;o++){var r=e[o];n.push(r.x,r.y,r.z||0),4<=t&&n.push(r.w||0)}return this.setAttribute("position",new yn.Float32BufferAttribute(n,t)),this}}),Object.assign(yn.Vector4.prototype,{multiply:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,void 0!==e.w&&(this.w*=e.w),this}}),Object.assign(yn.Vector4.prototype,{add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,void 0!==e.w&&(this.w+=e.w),this)}}),Object.assign(yn.Points.prototype,{raycast:function(e,t){var n=new yn.Matrix4,l=new yn.Ray,o=new yn.Sphere,i=new yn.Vector3;function r(e,t,n,o,i,r,a){var s=l.distanceSqToPoint(e);s<n&&(n=new yn.Vector3,l.closestPointToPoint(e,n),n.applyMatrix4(o),(o=i.ray.origin.distanceTo(n))<i.near||o>i.far||r.push({distance:o,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:a}))}var a=this.geometry,s=this.matrixWorld,c=e.params.Points.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),o.copy(a.boundingSphere),o.applyMatrix4(s),o.radius+=c,!1!==e.ray.intersectsSphere(o)){n.copy(s).invert(),l.copy(e.ray).applyMatrix4(n);var n=c/((this.scale.x+this.scale.y+this.scale.z)/3),u=n*n;if(a.isBufferGeometry){var c=a.index,n=a.attributes,d=n.position.array,p=n.position.itemSize;if(null!==c)for(var h=c.array,f=0,m=h.length;f<m;f++){var _=h[f];i.fromArray(d,_*p),r(i,_,u,s,e,t,this)}else for(var g=0,b=d.length/p;g<b;g++)i.fromArray(d,g*p),r(i,g,u,s,e,t,this)}else for(var v=a.vertices,y=0,w=v.length;y<w;y++)r(v[y],y,u,s,e,t,this)}}})):console.warn("Player: can not assign. Set THREE first.")}vn.getColors=function(e,o){if(xn(),Array.isArray(e)||(e=[e]),(o=o||{}).options=o.options||{},void 0!==o.positions&&Array.isArray(e)&&e.length!==o.positions.count)return console.error("getColors failed! arrayFuncs.length: "+e.length+" != positions.count: "+o.positions.count),o.colors;var t=Array.isArray(e)?e.length:o.positions.count;o.colors=o.colors||[],o.options.palette||o.options.setPalette();for(var i=0;i<t;i++){var n,r,a,s,l,c,u=Array.isArray(e)?e[i]:void 0;u instanceof yn.Vector4||o.positions&&4===o.positions.itemSize?(s=r=void 0,a=u.w,u.w instanceof Object&&u.w.func?(u.w.max&&(s=u.w.max),u.w.min&&(r=u.w.min),a=u.w.func):(o.options.setW(),r=o.options.scales.w.min,s=o.options.scales.w.max),a instanceof Function&&!o.options.player&&wn&&(wn=!1),s=o.options.palette.toColor(void 0===u?(new yn.Vector4).fromBufferAttribute(o.positions,i).w:a instanceof Function?a(o.options.playerOptions?o.options.playerOptions.min:0):a,r,s),o.colors.push(s.r,s.g,s.b)):o.colors instanceof yn.Float32BufferAttribute?n=new yn.Vector3(1,1,1):o.colors.push(1,1,1),void 0!==o.opacity?(l=0,c=getStandardNormalDistribution(0),group.children.forEach(function(e){if(e.userData.cloud)for(var t=0;t<e.geometry.attributes.position.count;t++){var n=getObjectPosition(e,t);l+=getStandardNormalDistribution(5*Qt(camera,(new yn.Vector3).fromBufferAttribute(o.positions,i)).distanceTo(n))/c}}),void 0!==debug.opacity&&(l=debug.opacity),o.colors instanceof yn.Float32BufferAttribute?o.colors.setXYZW(i,n.x,n.y,n.z,l):o.colors.push(l)):o.colors.push(1)}return o.colors},vn.traceLine=function e(c){var u;b(this,e);var d=[];xn(),c.player&&(this.isVisible=function(){return!!c.player&&(u?u.visible:0!==d.length&&d[0].visible)},this.visible=function(t){if(!c.player)return!1;u?u.visible=t:d.forEach(function(e){e.visible=t})},this.addPoint=function(e,t,n){var o=e.geometry.attributes.position,i=4<=o.itemSize?new yn.Vector4(0,0,0,0):new yn.Vector3;i.fromArray(o.array,t*o.itemSize);var r=c.player?c.player.getSelectSceneIndex():0;if(null===c.playerOptions.max){if((r=Math.abs(r))<d.length-1){for(;r<d.length-1;)e.remove(d[d.length-1]),d.pop();return}var a=new yn.BufferGeometry,s=new Float32Array(6);a.setAttribute("position",new yn.BufferAttribute(s,3));s=new Float32Array(6);a.setAttribute("color",new yn.Float32BufferAttribute(s,3));s=new yn.Line(a,new yn.LineBasicMaterial({vertexColors:yn.VertexColors}));e.add(s),d[0]&&(s.visible=d[0].visible),i=(new yn.Vector3).copy(i);a=s.geometry.attributes.position.itemSize;return i.toArray(s.geometry.attributes.position.array,+a),(0===d.length?i:(new yn.Vector3).fromArray(d[d.length-1].geometry.attributes.position.array,+a)).toArray(s.geometry.attributes.position.array,0*a),s.geometry.attributes.position.needsUpdate=!0,void 0===n&&(n=new yn.Color(1,1,1)),vn.setColorAttribute(s.geometry.attributes,0,0===d.length?n:(new yn.Color).fromArray(d[d.length-1].geometry.attributes.color.array,+a)),vn.setColorAttribute(s.geometry.attributes,1,n),void d.push(s)}if(void 0===u){a=new yn.BufferGeometry;if(null!==c.playerOptions.max)if(c.playerOptions&&c.playerOptions.marks)l=c.playerOptions.marks;else{if(!c.player||!c.player.marks)return void console.error("Player.traceLine: MAX_POINTS = "+l+". Create Player first or remove all trace = true from all items of the arrayFuncs");l=c.player.marks}else l=r+1;s=new Float32Array(3*l);a.setAttribute("position",new yn.BufferAttribute(s,3));var l=new Float32Array(3*l);a.setAttribute("color",new yn.Float32BufferAttribute(l,3)),a.setDrawRange(r,r),(u=new yn.Line(a,new yn.LineBasicMaterial({vertexColors:yn.VertexColors}))).visible=!0,e.add(u)}u.geometry&&(delete u.geometry.boundingSphere,u.geometry.boundingSphere=null),(i=(new yn.Vector3).copy(i)).toArray(u.geometry.attributes.position.array,r*u.geometry.attributes.position.itemSize),u.geometry.attributes.position.needsUpdate=!0,void 0===n&&(n=new yn.Color(1,1,1)),vn.setColorAttribute(u.geometry.attributes,r,n);i=u.geometry.drawRange.start,n=r+1-i;r<i&&(n=i+u.geometry.drawRange.count-(i=r)),u.geometry.setDrawRange(i,n)},this.remove=function(){void 0!==u&&(u.geometry.dispose(),u.material.dispose(),u.parent.remove(u))})},vn.getTime=function(){return vn.player?vn.player.getTime():0},vn.getItemSize=function(e){xn();for(var t=0;t<e.length;t++)if(e[t]instanceof yn.Vector4)return 4;return 3},vn.selectPlayScene=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=void 0!==t.t?t.t:0,o=void 0!==t.index?t.index:void 0,i=t.options||new bn;e.userData.t=n,vn.selectMeshPlayScene(e,{t:n,options:i}),e.children.forEach(function(e){vn.selectMeshPlayScene(e,{t:n,options:i})}),i.playerOptions.cameraTarget.setCameraTarget(i);e=i.playerOptions.cameraTarget.get();e&&e.setCameraPosition&&e.setCameraPosition(void 0===o)},vn.assign=function(){xn()},e.default=vn,Object.defineProperty(e,"__esModule",{value:!0})});
