{"version":3,"file":"player.js","sources":["../../guiSelectPoint/guiSelectPoint.js","../../../../loadFileNodeJS/master/index.js","../../../../loadScriptNodeJS/master/index.js","../../../../loadScriptNodeJS/master/loadScript.js","../../../../colorpicker/master/index.js","../../../../colorpicker/master/colorpicker.js","../player.js"],"sourcesContent":["/**\r\n * @module GuiSelectPoint\r\n *\r\n * @description A dat.gui based graphical user interface for select a point from the mesh.\r\n * \r\n * @see {@link https://github.com/anhr/dat.gui|dat.gui}, {@link https://threejs.org/docs/index.html#api/en/objects/Mesh|three.js mesh}.\r\n *\r\n * @author Andrej Hristoliubov. {@link https://anhr.github.io/AboutMe/|AboutMe}\r\n *\r\n * @copyright 2011 Data Arts Team, Google Creative Lab\r\n *\r\n * @license under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n*/\r\n\r\n//import * as THREE from 'https://threejs.org/build/three.module.js';\r\n//import * as THREE from '../../three.js/dev/build/three.module.js';//https://github.com/anhr/three.js;\r\n//import * as THREE from 'https://raw.githack.com/anhr/three.js/dev/build/three.module.js';\r\n//import { THREE } from './three.js';\r\nvar THREE;\r\n\r\n//import { dat } from '../dat/dat.module.js';\r\nimport { dat } from 'https://raw.githack.com/anhr/commonNodeJS/master/dat/dat.module.js';\r\n\r\n//import ScaleController from '../ScaleController.js';\r\nimport ScaleController from 'https://raw.githack.com/anhr/commonNodeJS/master/ScaleController.js';\r\n\r\n//import PositionController from '../PositionController.js';\r\nimport PositionController from 'https://raw.githack.com/anhr/commonNodeJS/master/PositionController.js';\r\n\r\n//import ColorPicker from '../../../colorpicker/master/colorpicker.js';//https://github.com/anhr/colorPicker\r\nimport ColorPicker from 'https://raw.githack.com/anhr/colorpicker/master/colorpicker.js';\r\n\r\n/**\r\n * A dat.gui based graphical user interface for select a point from the mesh.\r\n * @param {THREE} _THREE {@link https://github.com/anhr/three.js|THREE}\r\n * @param {object} [guiParams] Followed parameters is allowed. Default is no parameters\r\n * @param {AxesHelper} [guiParams.axesHelper] An axis object to visualize axes. Default is undefined.\r\n * See {@link https://github.com/anhr/AxesHelper|AxesHelper}.\r\n * @param {string} [guiParams.options] See {@link https://raw.githack.com/anhr/AxesHelper/master/jsdoc/index.html|axesHelper.options} for details. Default is axesHelper.options if axesHelper is defined or { scales: {...} }\r\n * @param {string} [guiParams.cFrustumPoints]\r\n * @param {string} [guiParams.myThreejs] See {@link https://github.com/anhr/myThreejs|myThreejs}.\r\n * @param {Function} [guiParams.pointControls] pointControls( fPoint, dislayEl, getMesh ) Adds the trace \"Display the trace of the point movement\" control checkbox into gui.\r\n * <pre>\r\n * fPoint - parent folder for new control.\r\n * dislayEl( conrtol, true or false ) - function for dislay or hide of the control.\r\n * getMesh() returns the mesh, selected in the GuiSelectPoint.\r\n * Default is undefined.\r\n * </pre>\r\n * @param {Function} [guiParams.pointsControls] pointsControls( fPoints, dislayEl, getMesh ) Adds the trace \"Display the trace of the movement of all points of the mesh.\" control checkbox into gui.\r\n * <pre>\r\n * fPoints - parent folder for new control.\r\n * dislayEl( conrtol, true or false ) - function for dislay or hide of the control.\r\n * getMesh() returns the mesh, selected in the GuiSelectPoint.\r\n * Default is undefined.\r\n * </pre>\r\n * @param {Function} [guiParams.setIntersection] setIntersection( intersection ) sets the intersection value of myThreejs. Default is undefined\r\n * @param {Function} [guiParams.getLanguageCode] Your custom getLanguageCode() function.\r\n * <pre>\r\n * returns the \"primary language\" subtag of the language version of the browser.\r\n * Examples: \"en\" - English language, \"ru\" Russian.\r\n * See the \"Syntax\" paragraph of RFC 4646 {@link https://tools.ietf.org/html/rfc4646#section-2.1|rfc4646 2.1 Syntax} for details.\r\n * Default returns the 'en' is English language.\r\n * You can import { getLanguageCode } from '../../commonNodeJS/master/lang.js';\r\n * </pre>\r\n * @param {object} [guiParams.lang] Object with localized language values\r\n * @example\r\nimport { GuiSelectPoint } from 'https://raw.githack.com/anhr/commonNodeJS/master/guiSelectPoint/guiSelectPoint.js';\r\n\r\nconst guiSelectPoint = new GuiSelectPoint( { axesHelper: axesHelper, } );\r\nguiSelectPoint.add( gui, { getLanguageCode: getLanguageCode, } );\r\nguiSelectPoint.addMesh( points );\r\n * @example //Using of guiParams.lang:\r\nguiParams = {\r\n\r\n\tgetLanguageCode: function() { return 'az'; },//Azerbaijani language\r\n\tlang: { textHeight: 'mətn boyu', languageCode: 'az' },\r\n\r\n}\r\n */\r\nfunction GuiSelectPoint( _THREE, guiParams ) {\r\n\r\n\tGuiSelectPoint.setTHREE( _THREE );\r\n\r\n\tguiParams = guiParams || {};\r\n\r\n\tconst axesHelper = guiParams.axesHelper,\r\n\t\toptions = guiParams.options || ( axesHelper ? axesHelper.options : undefined ) || {\r\n\r\n\t\t\tscales: {\r\n\r\n\t\t\t\tx: {\r\n\r\n\t\t\t\t\tname: 'x',\r\n\t\t\t\t\tmin: -1,\r\n\t\t\t\t\tmax: 1,\r\n\r\n\t\t\t\t},\r\n\t\t\t\ty: {\r\n\r\n\t\t\t\t\tname: 'y',\r\n\t\t\t\t\tmin: -1,\r\n\t\t\t\t\tmax: 1,\r\n\r\n\t\t\t\t},\r\n\t\t\t\tz: {\r\n\r\n\t\t\t\t\tname: 'z',\r\n\t\t\t\t\tmin: -1,\r\n\t\t\t\t\tmax: 1,\r\n\r\n\t\t\t\t},\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n//\t\tcFrustumPoints = guiParams.cFrustumPoints,\r\n//\t\tgui = undefined,\r\n\t\tguiSelectPoint = this;\r\n//\t\tfrustumPoints = undefined;\r\n\tvar cFrustumPoints;\r\n//\toptions.scales = options.scales || {};\r\n\r\n\t//Localization\r\n\r\n\tconst getLanguageCode = guiParams.getLanguageCode || function () { return 'en'; };\r\n\r\n\tconst lang = {\r\n\r\n\t\tmeshs: 'Meshs',\r\n\t\tnotSelected: 'Not selected',\r\n\t\tselect: 'Select',\r\n\t\tposition: 'Position',\r\n\t\trotation: 'Rotation',\r\n\t\tpoints: 'Points',\r\n\r\n\t\tpoint: 'Point Local Position',\r\n\t\tpointTitle: 'The position attribute of the selected point',\r\n\r\n\t\tpointWorld: 'Point World Position',\r\n\t\tpointWorldTitle: 'The position of the selected point after scaling, moving and rotation of the mesh',\r\n\r\n\t\tmesh: 'Mesh',\r\n\t\tscale: 'Scale',\r\n\t\tcolor: 'Сolor',\r\n\r\n\t\topacity: 'Opacity',\r\n\t\topacityTitle: 'Float in the range of 0.0 - 1.0 indicating how transparent the material is. A value of 0.0 indicates fully transparent, 1.0 is fully opaque.',\r\n\r\n\t\tdefaultButton: 'Default',\r\n\t\tdefaultScaleTitle: 'Restore default 3d object scale.',\r\n\t\tdefaultPositionTitle: 'Restore default 3d object position.',\r\n\t\tdefault3DObjectTitle: 'Restore default settings of all 3d objects.',\r\n\t\tdefaultRotationTitle: 'Restore default 3d object rotation.',\r\n\t\tdefaultLocalPositionTitle: 'Restore default local position.',\r\n\r\n\t\tmoveGroup: 'Move Scene',\r\n\r\n\t};\r\n\r\n/*\r\n\tconst _languageCode = guiParams.getLanguageCode === undefined ? 'en'//Default language is English\r\n\t\t: guiParams.getLanguageCode();\r\n*/\r\n\tconst _languageCode = getLanguageCode();\r\n\r\n\tswitch ( _languageCode ) {\r\n\r\n\t\tcase 'ru'://Russian language\r\n\r\n\t\t\tlang.meshs = '3D объекты';\r\n\t\t\tlang.notSelected = 'Не выбран';\r\n\t\t\tlang.select = 'Выбрать';\r\n\t\t\tlang.position = 'Позиция';\r\n\t\t\tlang.rotation = 'Вращение';\r\n\t\t\tlang.points = 'Точки';\r\n\r\n\t\t\tlang.point = 'Локальная позиция точки';\r\n\t\t\tlang.pointTitle = 'Position attribute выбранной точки';\r\n\r\n\t\t\tlang.pointWorld = 'Абсолютная позиция точки';\r\n\t\t\tlang.pointWorldTitle = 'Позиция выбранной точки после масштабирования, перемещения и вращения 3D объекта';\r\n\r\n\t\t\tlang.mesh = '3D объект';\r\n\t\t\tlang.scale = 'Масштаб';\r\n\t\t\tlang.color = 'Цвет';\r\n\r\n\t\t\tlang.opacity = 'Непрозрачность';\r\n\t\t\tlang.opacityTitle = 'Число в диапазоне 0,0 - 1,0, указывающий, насколько прозрачен материал. Значение 0.0 означает полностью прозрачный, 1.0 - полностью непрозрачный.';\r\n\r\n\t\t\tlang.defaultButton = 'Восстановить';\r\n\t\t\tlang.defaultScaleTitle = 'Восстановить масштаб 3D объекта по умолчанию.';\r\n\t\t\tlang.defaultPositionTitle = 'Восстановить позицию 3D объекта по умолчанию.';\r\n\t\t\tlang.default3DObjectTitle = 'Восстановить настройки всех 3D объектов по умолчанию.';\r\n\t\t\tlang.defaultRotationTitle = 'Восстановить поворот 3D объекта по умолчанию.';\r\n\t\t\tlang.defaultLocalPositionTitle = 'Восстановить локальную позицию точки по умолчанию.';\r\n\t\t\tbreak;\r\n\t\tdefault://Custom language\r\n\t\t\tif ( ( guiParams.lang === undefined ) || ( guiParams.lang.languageCode != _languageCode ) )\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tObject.keys( guiParams.lang ).forEach( function ( key ) {\r\n\r\n\t\t\t\tif ( lang[key] === undefined )\r\n\t\t\t\t\treturn;\r\n\t\t\t\tlang[key] = guiParams.lang[key];\r\n\r\n\t\t\t} );\r\n\r\n\t}\r\n\r\n\tvar f3DObjects, fPoint, cRestoreDefaultLocalPosition, fPointWorld, fPoints, cMeshs, fMesh,// mesh,\r\n\t\tintersection, _this = this,\r\n\t\tcScaleX, cScaleY, cScaleZ, cPosition = new THREE.Vector3(), cRotations = new THREE.Vector3(),\r\n\t\tcPoints, selectedPointIndex = -1,\r\n\t\tcontrollerX, controllerY, controllerZ, controllerW, cTrace, cTraceAll, controllerColor, controllerOpacity,\r\n\t\tcontrollerWorld = new THREE.Vector3(),\r\n\t\tboSetMesh = false;//Для предотвращения лишних вызовов exposePosition если выбрать точку и передвинуть камеру с помошью OrbitControls,\r\n\tif ( options.arrayCloud )//Array of points with cloud\r\n\t\tcFrustumPoints = new options.arrayCloud.cFrustumPointsF( _this );\r\n\t//сейчас exposePosition вызывается только один раз из this.setMesh\r\n\tfunction dislayEl( controller, displayController ) {\r\n\r\n\t\tif ( controller === undefined )\r\n\t\t\treturn;\r\n\t\tif ( typeof displayController == \"boolean\" )\r\n\t\t\tdisplayController = displayController ? 'block' : 'none';\r\n\t\tvar el = controller.domElement;\r\n\t\twhile ( el.tagName.toUpperCase() !== \"LI\" ) el = el.parentElement;\r\n\t\tel.style.display = displayController;\r\n\r\n\t}\r\n\tfunction exposePosition( selectedPointIndex ) {\r\n\r\n\t\tif ( selectedPointIndex === undefined )\r\n\t\t\tselectedPointIndex = guiSelectPoint.getSelectedPointIndex();//Эта строка слишком медленно выполняется если число точек frustumPoints велико\r\n\t\t//Поэтому selectedPointIndex беру из intersection.index индекс точки, над которй щелнул мышью\r\n\t\tif ( selectedPointIndex === -1 )\r\n\t\t\treturn;\r\n\r\n\t\tconst mesh = cMeshs.__select.options[cMeshs.__select.options.selectedIndex].mesh,\r\n\t\t\tposition = getObjectPosition( mesh, selectedPointIndex );\r\n\r\n\t\tif ( ( axesHelper !== undefined ) )\r\n\r\n\t\t\t// && ( ( mesh.userData.isInfo === undefined ) || ( mesh.userData.isInfo() ) ) )\r\n\t\t\t//если делать эту проверку, то будут неправильно отображаться пунктирные линии для frustumPoints точки\r\n\t\t\t//когда в настройках frustumPoints не стоит галочка info\r\n\t\t\t//когда в gui пользователь выбрал точку frustumPoints из списка '3D objects'(этот пункт будет недоступен когда я уберу frustumPoints из списка '3D objects' когда в настройках frustumPoints не стоит галочка info)\r\n\t\t\t//и когда пользователь передвигает камеру с помощью orbitControls\r\n\r\n\t\t\taxesHelper.exposePosition( { object: mesh, index: selectedPointIndex } );\r\n\r\n\t\tif ( controllerWorld.x ) controllerWorld.x.setValue( position.x );\r\n\t\tif ( controllerWorld.y ) controllerWorld.y.setValue( position.y );\r\n\t\tif ( controllerWorld.z ) controllerWorld.z.setValue( position.z );\r\n\r\n\t}\r\n\tfunction setValue( controller, v ) {\r\n\r\n\t\tif ( !controller )\r\n\t\t\treturn;\r\n\t\tconst input = controller.domElement.querySelector( 'input' ),\r\n\t\t\treadOnly = input.readOnly;\r\n\t\tinput.readOnly = false;\r\n\t\tcontroller.object[controller.property] = v;\r\n\t\tif ( controller.__onChange )\r\n\t\t\tcontroller.__onChange.call( controller, v );\r\n\t\tcontroller.initialValue = v;\r\n\t\tcontroller.updateDisplay();\r\n\t\tinput.readOnly = readOnly;\r\n\t\treturn controller;\r\n\r\n\t}\r\n\tfunction setPosition( intersectionSelected ) {\r\n\r\n\t\tconst positionLocal = getObjectLocalPosition( intersectionSelected.object, intersectionSelected.index );\r\n\t\tsetValue( controllerX, positionLocal.x );\r\n\t\tsetValue( controllerY, positionLocal.y );\r\n\t\tsetValue( controllerZ, positionLocal.z );\r\n\r\n\t\tconst position = getObjectPosition( intersectionSelected.object, intersectionSelected.index );\r\n\t\tsetValue( controllerWorld.x, position.x );\r\n\t\tsetValue( controllerWorld.y, position.y );\r\n\t\tsetValue( controllerWorld.z, position.z );\r\n\r\n\t\tvar displayControllerW, displayControllerColor, displayControllerOpacity, none = 'none', block = 'block';\r\n\t\tif ( typeof intersection.object.userData.arrayFuncs === \"function\" )\r\n\t\t\tconsole.error( 'arrayFuncs === \"function\" under constraction' );\r\n\t\tvar func = intersectionSelected.object.userData.arrayFuncs ? intersectionSelected.object.userData.arrayFuncs[intersectionSelected.index] : undefined,\r\n\t\t\topasity,\r\n\t\t\tcolor = func === undefined ?\r\n\t\t\t\tundefined :\r\n\t\t\t\tArray.isArray( func.w ) || ( typeof func.w === \"function\" ) ?\r\n\t\t\t\t\texecFunc( func, 'w', group.userData.t, options.a, options.b ) :\r\n\t\t\t\t\tfunc.w;\r\n\r\n\t\tif ( color === undefined ) {\r\n\r\n\t\t\tif ( intersectionSelected.object.geometry.attributes.ca === undefined )\r\n\t\t\t\tconsole.warn( 'Under constraction. цвет frustumPoints не известен потому что он вычисляется в шейдере D:\\My documents\\MyProjects\\webgl\\three.js\\GitHub\\myThreejs\\master\\frustumPoints\\vertex.c' )\r\n\t\t\telse {\r\n\r\n\t\t\t\tconst vColor = new THREE.Vector4().fromArray(\r\n\t\t\t\t\tintersectionSelected.object.geometry.attributes.ca.array,\r\n\t\t\t\t\tintersectionSelected.index * intersectionSelected.object.geometry.attributes.ca.itemSize );\r\n\t\t\t\tcolor = new THREE.Color( vColor.x, vColor.y, vColor.z );\r\n\t\t\t\topasity = vColor.w;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( color instanceof THREE.Color ) {\r\n\r\n\t\t\tdisplayControllerW = none;\r\n\t\t\tdisplayControllerColor = block;\r\n\t\t\tdisplayControllerOpacity = block;\r\n\r\n\t\t\t//color\r\n\t\t\tif ( intersectionSelected.object.userData.arrayFuncs === undefined ) {\r\n\r\n\t\t\t\tdisplayControllerColor = none;\r\n\t\t\t\tdisplayControllerOpacity = none;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconst strColor = '#' + color.getHexString();\r\n\t\t\t\t//Сначала надо установить initialValue потому что для FrustumPoints я устанвил readOnly для controllerColor.\r\n\t\t\t\t//В этом случае я не могу отобразить цвет следующей точки FrustumPoints потому что в режиме readOnly\r\n\t\t\t\t//при изменении цвета восстанвливается старый цвет из initialValue.\r\n\t\t\t\tcontrollerColor.initialValue = strColor;\r\n\t\t\t\tcontrollerColor.setValue( strColor );\r\n\t\t\t\tcontrollerColor.userData = { intersection: intersectionSelected, };\r\n\t\t\t\tif ( opasity !== undefined ) {\r\n\r\n\t\t\t\t\tsetValue( controllerOpacity, opasity );\r\n\r\n\t\t\t\t} else displayControllerOpacity = none;\r\n\t\t\t\tcontrollerOpacity.userData = { intersection: intersectionSelected, };\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( controllerW === undefined )\r\n\t\t\t\tdisplayControllerW = none;\r\n\t\t\telse {\r\n\r\n\t\t\t\tif ( color === undefined )\r\n\t\t\t\t\tdisplayControllerW = none;\r\n\t\t\t\telse {\r\n\r\n\t\t\t\t\tsetValue( controllerW, color );\r\n\t\t\t\t\tdisplayControllerW = block;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tdisplayControllerColor = none;\r\n\t\t\tdisplayControllerOpacity = none;\r\n\r\n\t\t}\r\n\t\tdislayEl( controllerW, displayControllerW );\r\n\t\tdislayEl( controllerColor, displayControllerColor );\r\n\t\tdislayEl( controllerOpacity, displayControllerOpacity );\r\n\r\n\t\tvar boReadOnly = intersectionSelected.object.userData.boFrustumPoints === true ? true : false;\r\n\t\tif ( controllerX ) controllerX.domElement.querySelector( 'input' ).readOnly = boReadOnly;\r\n\t\tif ( controllerY ) controllerY.domElement.querySelector( 'input' ).readOnly = boReadOnly;\r\n\t\tif ( controllerZ ) controllerZ.domElement.querySelector( 'input' ).readOnly = boReadOnly;\r\n\t\tif ( controllerW ) controllerW.domElement.querySelector( 'input' ).readOnly = boReadOnly;\r\n\t\tcontrollerColor.domElement.querySelector( 'input' ).readOnly = boReadOnly;\r\n\t\tcontrollerOpacity.domElement.querySelector( 'input' ).readOnly = boReadOnly;\r\n\r\n\t}\r\n\t/**\r\n\t * Sets controllers to position, scale and rotation of the mesh.  If AxesHelper is exist, expose the mesh to the axes.\r\n\t * @function GuiSelectPoint.\r\n\t *setMesh\r\n\t */\r\n\tthis.setMesh = function () {\r\n\r\n\t\tboSetMesh = true;\r\n\t\tsetScaleControllers();\r\n\t\tsetPositionControllers();\r\n\t\tsetRotationControllers();\r\n\t\texposePosition();\r\n\t\tboSetMesh = false;\r\n\r\n\t}\r\n\t/**\r\n\t * Sets controllers to position, scale and rotation of the mesh.  If AxesHelper is exist, expose the mesh to the axes.\r\n\t * @function GuiSelectPoint.\r\n\t *setPosition\r\n\t * @param position deprecated\r\n\t * @param intersectionSelected [THREE.Raycaster.intersectObject]{@link https://threejs.org/docs/index.html#api/en/core/Raycaster.intersectObject}\r\n\t */\r\n\tthis.setPosition = function ( position, intersectionSelected ) {\r\n\r\n\t\tfor ( var i = 0; i < cMeshs.__select.length; i++ ) {\r\n\r\n\t\t\tvar option = cMeshs.__select[i];\r\n\t\t\t//\t\t\t\t\t\tif ( option.selected && ( parseInt( option.getAttribute( 'value' ) ) === intersectionSelected.object.userData.index - 1 ) )\r\n\t\t\tif ( option.selected && Object.is( option.mesh, intersectionSelected.object ) ) {\r\n\r\n\t\t\t\tsetPosition( intersectionSelected );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\t/**\r\n\t * update the values of the controllers of the world position\r\n\t * @function GuiSelectPoint.\r\n\t *update \r\n\t */\r\n\tthis.update = function () {\r\n\r\n\t\tconst mesh = cMeshs.__select.options[cMeshs.__select.options.selectedIndex].mesh;\r\n\t\tif ( !mesh )\r\n\t\t\treturn;\r\n\t\tconst index = this.getSelectedPointIndex();\r\n\t\tif ( index === -1 )\r\n\t\t\treturn;\r\n\t\tconst position = getObjectPosition( mesh, index );\r\n\t\tcontrollerWorld.x.setValue( position.x );\r\n\t\tcontrollerWorld.y.setValue( position.y );\r\n\t\tcontrollerWorld.z.setValue( position.z );\r\n\r\n\t}\r\n\t/**\r\n\t * get index of the mesh in the cMeshs controller\r\n\t * @function GuiSelectPoint.\r\n\t *getMeshIndex\r\n\t * @param {THREE.Mesh} mesh\r\n\t * See {@link https://threejs.org/docs/index.html#api/en/objects/Mesh|THREE.Mesh}.\r\n\t * @returns index of selectred mesh.\r\n\t */\r\n\tthis.getMeshIndex = function ( mesh ) {\r\n\r\n\t\tif ( mesh === undefined )\r\n\t\t\treturn mesh;\r\n\t\tvar index;// = intersectionSelected.object.userData.index;\r\n\t\tfor ( index = 0; index < cMeshs.__select.options.length; index++ ) {\r\n\r\n\t\t\tvar option = cMeshs.__select.options[index];\r\n\t\t\tif ( Object.is( option.mesh, mesh ) )\r\n\t\t\t\treturn index;\r\n\r\n\t\t}\r\n//\t\tconsole.error( 'Invalid mesh \"' + mesh.name + '\" index' );\r\n\t\t//Сюда попадает когда Mesh проверяется с помощью THREE.Raycaster находится ли он под мышью, но этот Mesh не внесен в список GuiSelectPoint\r\n\r\n\t}\r\n\tthis.setIndexMesh = function ( index, mesh ) {\r\n\r\n\t\tif ( index === undefined )\r\n\t\t\treturn;\r\n\t\tcMeshs.__select.options[index].mesh = mesh;\r\n\t\tthis.selectPoint( -1 );\r\n\r\n\t}\r\n\tthis.selectPoint = function ( index ) {\r\n\r\n\t\tcPoints.__onChange( index );\r\n\t\tcPoints.__select[index + 1].selected = true;\r\n\r\n\t}\r\n\t/**\r\n\t * Removes a mesh from the select point GUI\r\n\t * @function GuiSelectPoint.\r\n\t *removeMesh\r\n\t * @param {THREE.Mesh} mesh mesh for removing.\r\n\t */\r\n\tthis.removeMesh = function ( mesh ) {\r\n\r\n\t\tconst index = this.getMeshIndex( mesh ),\r\n\t\t\tselectedIndex = cMeshs.__select.selectedIndex;\r\n\t\tcMeshs.__select.remove( index );\r\n\t\tif ( selectedIndex === index ) {\r\n\r\n\t\t\tcPoints.__onChange( -1 );\r\n\t\t\t_this.removePoints();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\t/**\r\n\t * Adds new mesh into select point GUI\r\n\t * @function GuiSelectPoint.\r\n\t *addMesh\r\n\t * @param {THREE.Mesh} mesh new mesh.\r\n\t */\r\n\tthis.addMesh = function ( mesh ) {\r\n\r\n\t\t//Test for duplicate item\r\n\t\tfor ( var i = 0; i < cMeshs.__select.options.length; i++ ) {\r\n\r\n\t\t\tvar option = cMeshs.__select.options[i];\r\n\t\t\tif ( mesh.userData.boFrustumPoints && ( option.mesh !== undefined ) && option.mesh.userData.boFrustumPoints )\r\n\t\t\t\treturn;//duplicate FrustumPoints. Сюда попадает когда пользователь меняет количество слоев или Y точек в FrustumPoints.\r\n\t\t\tif (\r\n\t\t\t\t( option.mesh !== undefined ) &&\r\n\t\t\t\t( mesh.name !== '' ) && //если не делать эту проверку то невозможно вставить два mesh без имени\r\n\t\t\t\t( option.mesh.name === mesh.name )\r\n\t\t\t) {\r\n\r\n\t\t\t\t//Нельза добалять два mesh с одинаковым именем\r\n\t\t\t\treturn;//сюда попадает когда создаются точки без shaderMaterial\r\n\t\t\t\t//Сначала вызывается из myPoints create.Points function\r\n\t\t\t\t//Потом из guiSelectPointF.addControllers\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tconst opt = document.createElement( 'option' );\r\n\t\topt.innerHTML = cMeshs.__select.length + ' ' + ( mesh.name === '' ? mesh.constructor.name : mesh.name );\r\n\t\topt.mesh = mesh;\r\n\t\tmesh.userData.default = mesh.userData.default || {\r\n\r\n\t\t\tscale: new THREE.Vector3().copy( mesh.scale ),\r\n\t\t\tposition: mesh.position instanceof THREE.Vector3 ?\r\n\t\t\t\tnew THREE.Vector3().copy( mesh.position ) :\r\n\t\t\t\tmesh.position instanceof THREE.Vector4 ? new THREE.Vector4().copy( mesh.position ) : undefined,\r\n\t\t\trotation: new THREE.Euler().copy( mesh.rotation ),\r\n\r\n\t\t}\r\n\t\tcMeshs.__select.appendChild( opt );\r\n\r\n\t}\r\n\tthis.select = function ( intersectionSelected ) {\r\n\r\n\t\tconst position = getObjectLocalPosition( intersectionSelected.object, intersectionSelected.index );\r\n\t\tif ( f3DObjects === undefined ) {\r\n\r\n\t\t\tconsole.error( 'Не знаю как сюда попасть' );\r\n\r\n\t\t}\r\n\r\n\t\t//f3DObjects.close();//если тут не закрывать папку, то ингода прорпадает скроллинг окна dat.GUI\r\n\t\t//for testing:\r\n\t\t//Open https://raw.githack.com/anhr/myThreejs/master/Examples/html/\r\n\t\t//Set browser window height about 500 pixels.\r\n\t\t//Click Full Screen button.\r\n\t\t//Open Controls\r\n\t\t//Click a point.The \"Meshs\" folder opens and you can see the scrolling of the dat.gui window.\r\n\r\n\t\t//select mesh\r\n\t\tconst index = this.getMeshIndex( intersectionSelected.object );\r\n\t\tif ( !index )\r\n\t\t\treturn;//Сюда попадает когда Mesh проверяется с помощью THREE.Raycaster находится ли он под мышью, но этот Mesh не внесен в список GuiSelectPoint\r\n\t\tif ( cMeshs.__select[index].selected === false ) {\r\n\r\n\t\t\tcMeshs.__select[index].selected = true;\r\n\t\t\tcMeshs.__onChange( index - 1 );\r\n\r\n\t\t}\r\n\r\n\t\tthis.selectPoint2 = function ( selectedMesh ) {\r\n\r\n\t\t\tif ( ( intersectionSelected.index === undefined ) || isNaN( intersectionSelected.index ) )\r\n\t\t\t\treturn;\r\n\r\n\t\t\t//сделал эту проверку потому что не могу придумать как удалить intersectionSelected.index когда пользователь врусную сменил mesh\r\n\t\t\tif ( ( selectedMesh !== undefined ) && !Object.is( intersectionSelected.object, selectedMesh ) )\r\n\t\t\t\treturn;//Сначала пользователь выбрал точку с помошщью мыши\r\n\t\t\t//Потом сменил Meshs/Select\r\n\r\n\t\t\tif ( !intersectionSelected.object.userData.boFrustumPoints ) {\r\n\r\n\t\t\t\t//fPoints.open();много времени на открытие когда много точек\r\n\t\t\t\tcPoints.__select[intersectionSelected.index + 1].selected = true;\r\n\r\n\t\t\t} else {//FrustumPoints\r\n\r\n\t\t\t\tcFrustumPoints.pointIndexes( intersectionSelected.object.userData.pointIndexes( intersectionSelected.index ) );\r\n\r\n\t\t\t}\r\n\t\t\tconst block = 'block';\r\n\t\t\tfPoint.domElement.style.display = block;\r\n\t\t\tfPointWorld.domElement.style.display = block;\r\n\t\t\tintersection = intersectionSelected;\r\n\t\t\tif ( guiParams.setIntersection )\r\n\t\t\t\tguiParams.setIntersection( intersectionSelected );\r\n\t\t\tsetPosition( intersectionSelected );\r\n\r\n\t\t\tconst mesh = getMesh();\r\n\t\t\tconst line = ( mesh.userData.arrayFuncs === undefined ) || ( typeof intersection.object.userData.arrayFuncs === \"function\" ) ?\r\n\t\t\t\tundefined :\r\n\t\t\t\tmesh.userData.arrayFuncs[intersectionSelected.index].line;//You can not trace points if you do not defined the mesh.userData.arrayFuncs\r\n\t\t\tif ( cTrace )\r\n\t\t\t\tcTrace.setValue( line === undefined ? false : line.isVisible() )\r\n\r\n\t\t\tcRestoreDefaultLocalPosition.domElement.parentElement.parentElement.style.display =\r\n\t\t\t\tintersection.object.userData.arrayFuncs === undefined ? 'none' : block;\r\n\r\n\t\t}\r\n\t\tthis.selectPoint2();\r\n\r\n\t}\r\n\t/**\r\n\t * Is mesh selected in the GuiSelectPoint.\r\n\t * @function GuiSelectPoint.\r\n\t *isSelectedMesh\r\n\t * @param {THREE.Mesh} meshCur mesh to be tested\r\n\t * @returns true if meshCur is selected.\r\n\t */\r\n\tthis.isSelectedMesh = function ( meshCur ) { return getMesh() === meshCur }\r\n\t/**\r\n\t * Returns the index of the selected point.\r\n\t * @function GuiSelectPoint.\r\n\t *getSelectedPointIndex\r\n\t * @returns index of the selected point.\r\n\t */\r\n\tthis.getSelectedPointIndex = function () {\r\n\r\n\t\tif ( ( cFrustumPoints !== undefined ) &&\r\n\t\t\tcFrustumPoints.isDisplay() &&//FrustumPoints folder id not visible\r\n\t\t\toptions.arrayCloud.frustumPoints.isDisplay()//The cDisplay checkbox of the frustumPoints' is checked\r\n\t\t) {\r\n\r\n\t\t\tvar selectedIndex = cFrustumPoints.getSelectedIndex();\r\n\t\t\treturn selectedIndex === null ? - 1 : selectedIndex;\r\n\r\n\t\t}\r\n\t\tif ( cPoints === undefined ) {\r\n\r\n\t\t\tif ( selectedPointIndex === undefined )\r\n\t\t\t\tconsole.error( 'myThreejs.create.onloadScripts.init.guiSelectPoint.getSelectedPointIndex:  selectedPointIndex = ' + selectedPointIndex );\r\n\t\t\treturn selectedPointIndex;//options.dat !== true and gui === undefined. Do not use dat.gui\r\n\r\n\t\t}\r\n\t\tconst index = cPoints.__select.selectedOptions[0].index;\r\n\t\treturn index - 1;\r\n\r\n\t}\r\n\tfunction getMesh() {\r\n\r\n\t\tconst selectedIndex = cMeshs.__select.options.selectedIndex;\r\n\t\tif ( selectedIndex !== -1 )\r\n\t\t\treturn cMeshs.__select.options[cMeshs.__select.options.selectedIndex].mesh;\r\n\t\treturn undefined;\r\n\r\n\t}\r\n\tfunction isNotSetControllers() {\r\n\r\n\t\treturn ( getMesh() === undefined )\r\n//\t\t\t|| ( gui === undefined )\r\n\t\t\t;\r\n\t}\r\n\tfunction setScaleControllers() {\r\n\r\n\t\tif ( isNotSetControllers() )\r\n\t\t\treturn;\r\n\t\tconst mesh = getMesh();\r\n\t\tif ( cScaleX ) cScaleX.setValue( mesh.scale.x );\r\n\t\tif ( cScaleY ) cScaleY.setValue( mesh.scale.y );\r\n\t\tif ( cScaleZ ) cScaleZ.setValue( mesh.scale.z );\r\n\r\n\t}\r\n\tfunction setPositionControllers() {\r\n\r\n\t\tif ( isNotSetControllers() )\r\n\t\t\treturn;\r\n\t\tconst mesh = getMesh();\r\n\t\tif ( cPosition.x ) cPosition.x.setValue( mesh.position.x );\r\n\t\tif ( cPosition.y ) cPosition.y.setValue( mesh.position.y );\r\n\t\tif ( cPosition.z ) cPosition.z.setValue( mesh.position.z );\r\n\r\n\t}\r\n\tfunction setRotationControllers() {\r\n\r\n\t\tif ( isNotSetControllers() )\r\n\t\t\treturn;\r\n\t\tconst mesh = getMesh();\r\n\t\tif ( cRotations.x ) cRotations.x.setValue( mesh.rotation.x );\r\n\t\tif ( cRotations.y ) cRotations.y.setValue( mesh.rotation.y );\r\n\t\tif ( cRotations.z ) cRotations.z.setValue( mesh.rotation.z );\r\n\r\n\t}\r\n\t/**\r\n\t * Adds select point GUI into dat.gui folder\r\n\t * @function GuiSelectPoint.\r\n\t *add\r\n\t * @param {GUI} folder dat.gui folder.\r\n\t */\r\n\tthis.add = function ( folder ) {\r\n\r\n\t\tf3DObjects = folder.addFolder( lang.meshs );\r\n\t\tvar mesh, buttonScaleDefault, buttonPositionDefault, buttonRotationDefault;\r\n\r\n\t\tcMeshs = f3DObjects.add( { Meshs: lang.notSelected }, 'Meshs', { [lang.notSelected]: -1 } ).onChange( function ( value ) {\r\n\r\n\t\t\tvalue = parseInt( value );\r\n\t\t\tmesh = getMesh();\r\n\r\n\t\t\tvar display;\r\n\t\t\tif ( mesh === undefined ) {\r\n\r\n\t\t\t\tdisplay = 'none';\r\n\t\t\t\tmesh = undefined;\r\n\t\t\t\tif ( axesHelper !== undefined )\r\n\t\t\t\t\taxesHelper.exposePosition( getObjectPosition( getMesh(), value ) );\r\n\r\n\t\t\t} else {\r\n\r\n\r\n\t\t\t\tconst displayDefaultButtons = mesh.userData.default === undefined ? 'none' : 'block';\r\n\t\t\t\tbuttonScaleDefault.domElement.parentElement.parentElement.style.display = displayDefaultButtons;\r\n\t\t\t\tbuttonPositionDefault.domElement.parentElement.parentElement.style.display = displayDefaultButtons;\r\n\t\t\t\tbuttonRotationDefault.domElement.parentElement.parentElement.style.display = displayDefaultButtons;\r\n\r\n\t\t\t\tdisplay = 'block';\r\n\t\t\t\tvar displayPoints = 'none', displayFrustumPoints = 'block';\r\n\r\n\t\t\t\tcPoints.__onChange( -1 );\r\n\t\t\t\t_this.removePoints();\r\n\r\n\t\t\t\tif ( mesh.userData.controllers !== undefined ) {\r\n\r\n\t\t\t\t\t//FrustumPoints\r\n\t\t\t\t\tmesh.userData.controllers();// cFrustumPoints );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tdisplayPoints = 'block';\r\n\t\t\t\t\tdisplayFrustumPoints = 'none';\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor ( var iPosition = 0; iPosition < mesh.geometry.attributes.position.count; iPosition++ ) {\r\n\r\n\t\t\t\t\t\tvar opt = document.createElement( 'option' ),\r\n\t\t\t\t\t\t\tname = mesh.userData.arrayFuncs === undefined ?\r\n\t\t\t\t\t\t\t\tundefined :\r\n\t\t\t\t\t\t\t\tmesh.userData.pointName === undefined ?\r\n\t\t\t\t\t\t\t\t\ttypeof mesh.userData.arrayFuncs === \"function\" ?\r\n\t\t\t\t\t\t\t\t\t\tundefined :\r\n\t\t\t\t\t\t\t\t\t\tmesh.userData.arrayFuncs[iPosition].name :\r\n\t\t\t\t\t\t\t\t\tmesh.userData.pointName( iPosition );\r\n\t\t\t\t\t\topt.innerHTML = iPosition + ( name === undefined ? '' : ' ' + name );\r\n\t\t\t\t\t\topt.setAttribute( 'value', iPosition );//Эта строка нужна в случае когда пользователь отменил выбор точки. Иначе при движении камеры будут появляться пунктирные линии, указвающие на несуществующую точку\r\n\t\t\t\t\t\tcPoints.__select.appendChild( opt );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\tcPoints.domElement.parentElement.parentElement.style.display = displayPoints;\r\n\t\t\t\tif ( cTraceAll )\r\n\t\t\t\t\tcTraceAll.domElement.parentElement.parentElement.style.display = displayPoints;\r\n\t\t\t\tif ( cFrustumPoints !== undefined )\r\n\t\t\t\t\tcFrustumPoints.display( displayFrustumPoints );\r\n\r\n\t\t\t\tsetScaleControllers();\r\n\t\t\t\tsetPositionControllers();\r\n\t\t\t\tsetRotationControllers();\r\n\r\n\t\t\t}\r\n\t\t\tfMesh.domElement.style.display = display;\r\n\r\n\t\t\tif ( ( mesh !== undefined ) && ( mesh.userData.traceAll !== undefined ) )\r\n\t\t\t\tcTraceAll.setValue( mesh.userData.traceAll );\r\n\r\n\t\t} );\r\n\t\tdat.controllerNameAndTitle( cMeshs, lang.select );\r\n\r\n\t\tfMesh = f3DObjects.addFolder( lang.mesh );\r\n\t\tfMesh.domElement.style.display = 'none';\r\n\t\tfMesh.open();\r\n\r\n\t\t//Scale\r\n\r\n\t\tconst fScale = fMesh.addFolder( lang.scale );\r\n\t\tfScale.add( new ScaleController( function ( customController, action ) {\r\n\r\n\t\t\tconst zoom = customController.controller.getValue();\r\n\t\t\tmesh.scale.x = action( mesh.scale.x, zoom );\r\n\t\t\tmesh.scale.y = action( mesh.scale.y, zoom );\r\n\t\t\tmesh.scale.z = action( mesh.scale.z, zoom );\r\n\t\t\tmesh.needsUpdate = true;\r\n\r\n\t\t\tsetScaleControllers();\r\n\t\t\texposePosition();\r\n\t\t\tif ( ( options.arrayCloud !== undefined ) && ( options.arrayCloud.frustumPoints !== undefined ) )\r\n\t\t\t\toptions.arrayCloud.frustumPoints.updateCloudPoint( mesh );\r\n\r\n\t\t},\r\n\t\t\t{\r\n\r\n\t\t\t\tsettings: { zoomMultiplier: 1.1, },\r\n\t\t\t\tgetLanguageCode: getLanguageCode,\r\n\r\n\t\t\t} ) );\r\n\t\tconst scale = new THREE.Vector3();\r\n\t\tfunction setScale( axesName, value ) {\r\n\r\n\t\t\tmesh.scale[axesName] = value;\r\n\t\t\tmesh.needsUpdate = true;\r\n\t\t\texposePosition();\r\n\t\t\tif ( ( options.arrayCloud !== undefined ) && ( options.arrayCloud.frustumPoints !== undefined ) )\r\n\t\t\t\toptions.arrayCloud.frustumPoints.updateCloudPoint( mesh );\r\n\r\n\t\t}\r\n\t\tif ( options.scales.x ) {\r\n\r\n\t\t\tcScaleX = dat.controllerZeroStep( fScale, scale, 'x', function ( value ) { setScale( 'x', value ); } );\r\n\t\t\tdat.controllerNameAndTitle( cScaleX, options.scales.x.name );\r\n\r\n\t\t}\r\n\t\tif ( options.scales.y ) {\r\n\r\n\t\t\tcScaleY = dat.controllerZeroStep( fScale, scale, 'y', function ( value ) { setScale( 'y', value ); } );\r\n\t\t\tdat.controllerNameAndTitle( cScaleY, options.scales.y.name );\r\n\r\n\t\t}\r\n\t\tif ( options.scales.z ) {\r\n\r\n\t\t\tcScaleZ = dat.controllerZeroStep( fScale, scale, 'z', function ( value ) { setScale( 'z', value ); } );\r\n\t\t\tdat.controllerNameAndTitle( cScaleZ, options.scales.z.name );\r\n\r\n\t\t}\r\n\r\n\t\t//Default scale button\r\n\t\tbuttonScaleDefault = fScale.add( {\r\n\r\n\t\t\tdefaultF: function ( value ) {\r\n\r\n\t\t\t\tmesh.scale.copy( mesh.userData.default.scale );\r\n\t\t\t\tmesh.needsUpdate = true;\r\n\r\n\t\t\t\tsetScaleControllers();\r\n\t\t\t\texposePosition();\r\n\r\n\t\t\t},\r\n\r\n\t\t}, 'defaultF' );\r\n\t\tdat.controllerNameAndTitle( buttonScaleDefault, lang.defaultButton, lang.defaultScaleTitle );\r\n\r\n\t\t//Position\r\n\r\n\t\tconst fPosition = fMesh.addFolder( lang.position );\r\n\r\n\t\tfunction addAxisControllers( name ) {\r\n\r\n\t\t\tconst scale = options.scales[name];\r\n\t\t\tif ( !scale )\r\n\t\t\t\treturn;\r\n\t\t\tconst axesName = scale.name,\r\n\t\t\t\tf = fPosition.addFolder( axesName );\r\n\t\t\tf.add( new PositionController( function ( shift ) {\r\n\r\n\t\t\t\tmesh.position[name] += shift;\r\n\t\t\t\tmesh.needsUpdate = true;\r\n\r\n\t\t\t\tsetPositionControllers();\r\n\t\t\t\texposePosition();\r\n\t\t\t\tif ( ( options.arrayCloud !== undefined ) && ( options.arrayCloud.frustumPoints !== undefined ) )\r\n\t\t\t\t\toptions.arrayCloud.frustumPoints.updateCloudPoint( mesh );\r\n\r\n\t\t\t}, { getLanguageCode: getLanguageCode, } ) );\r\n\r\n\t\t\tfunction setPosition( value ) {\r\n\r\n\t\t\t\tmesh.position[name] = value;\r\n\t\t\t\tmesh.needsUpdate = true;\r\n\t\t\t\texposePosition();\r\n\r\n\t\t\t}\r\n\t\t\tconst position = new THREE.Vector3();\r\n\r\n\t\t\tcPosition[name] = dat.controllerZeroStep( f, position, name, function ( value ) { setPosition( value ); } );\r\n\t\t\tdat.controllerNameAndTitle( cPosition[name], axesName );\r\n\r\n\t\t}\r\n\t\taddAxisControllers( 'x' );\r\n\t\taddAxisControllers( 'y' );\r\n\t\taddAxisControllers( 'z' );\r\n\r\n\t\t//Restore default position.\r\n\t\tbuttonPositionDefault = fPosition.add( {\r\n\r\n\t\t\tdefaultF: function ( value ) {\r\n\r\n\t\t\t\tmesh.position.copy( mesh.userData.default.position );\r\n\t\t\t\tmesh.needsUpdate = true;\r\n\r\n\t\t\t\tsetPositionControllers();\r\n\t\t\t\texposePosition();\r\n\r\n\t\t\t},\r\n\r\n\t\t}, 'defaultF' );\r\n\t\tdat.controllerNameAndTitle( buttonPositionDefault, lang.defaultButton, lang.defaultPositionTitle );\r\n\r\n\t\t//rotation\r\n\r\n\t\tvar fRotation = fMesh.addFolder( lang.rotation );\r\n\t\tfunction addRotationControllers( name ) {\r\n\r\n\t\t\tconst scale = options.scales[name];\r\n\t\t\tif ( !scale )\r\n\t\t\t\treturn;\r\n\t\t\tcRotations[name] = fRotation.add( new THREE.Vector3(), name, 0, Math.PI * 2, 1 / 360 ).\r\n\t\t\t\tonChange( function ( value ) {\r\n\r\n\t\t\t\t\tconst mesh = getMesh();\r\n\t\t\t\t\tif ( !mesh.userData.boFrustumPoints ) {\r\n\r\n\t\t\t\t\t\tmesh.rotation[name] = value;\r\n\t\t\t\t\t\tmesh.needsUpdate = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( !boSetMesh )\r\n\t\t\t\t\t\texposePosition();\r\n\t\t\t\t\tif ( ( options.arrayCloud !== undefined ) && ( options.arrayCloud.frustumPoints !== undefined ) )\r\n\t\t\t\t\t\toptions.arrayCloud.frustumPoints.updateCloudPoint( mesh );\r\n\r\n\t\t\t\t} );\r\n\t\t\tdat.controllerNameAndTitle( cRotations[name], scale.name );\r\n\r\n\t\t}\r\n\t\taddRotationControllers( 'x' );\r\n\t\taddRotationControllers( 'y' );\r\n\t\taddRotationControllers( 'z' );\r\n\r\n\t\t//Default rotation button\r\n\t\tbuttonRotationDefault = fRotation.add( {\r\n\r\n\t\t\tdefaultF: function ( value ) {\r\n\r\n\t\t\t\tmesh.rotation.copy( mesh.userData.default.rotation );\r\n\t\t\t\tmesh.needsUpdate = true;\r\n\r\n\t\t\t\tsetRotationControllers();\r\n\t\t\t\texposePosition();\r\n\r\n\t\t\t},\r\n\r\n\t\t}, 'defaultF' );\r\n\t\tdat.controllerNameAndTitle( buttonRotationDefault, lang.defaultButton, lang.defaultRotationTitle );\r\n\r\n\t\t//Points\r\n\r\n\t\tfPoints = fMesh.addFolder( lang.points );\r\n\r\n\t\tcPoints = fPoints.add( { Points: lang.notSelected }, 'Points', { [lang.notSelected]: -1 } ).onChange( function ( value ) {\r\n\r\n\t\t\tvalue = parseInt( value );\r\n\t\t\tvar display, position;\r\n\t\t\tif ( value === -1 ) {\r\n\r\n\t\t\t\tdisplay = 'none';\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tdisplay = 'block';\r\n\t\t\t\t_this.select( { object: getMesh(), index: value } );\r\n\r\n\t\t\t}\r\n\t\t\tif ( axesHelper !== undefined )\r\n\t\t\t\taxesHelper.exposePosition( getObjectPosition( getMesh(), value ) );\r\n\t\t\tfPoint.domElement.style.display = display;\r\n\t\t\tfPointWorld.domElement.style.display = display;\r\n\r\n\t\t} );\r\n\t\tcPoints.__select[0].selected = true;\r\n\t\tdat.controllerNameAndTitle( cPoints, lang.select );\r\n\r\n\t\tif ( cFrustumPoints !== undefined )\r\n\t\t\tcFrustumPoints.create( fPoints, getLanguageCode() );\r\n\t\tif ( guiParams.myThreejs )\r\n\t\t\tguiParams.myThreejs.cFrustumPoints = cFrustumPoints;\r\n\r\n\t\t//Points attribute position\r\n\t\tfPoint = fPoints.addFolder( lang.point );\r\n\t\tdat.folderNameAndTitle( fPoint, lang.point, lang.pointTitle );\r\n\t\tfPoint.domElement.style.display = 'none';\r\n\t\t//\t\t\t\t\tfPoint.open();\r\n\r\n\t\t//Points world position\r\n\t\tfPointWorld = fPoints.addFolder( lang.pointWorld );\r\n\t\tdat.folderNameAndTitle( fPointWorld, lang.pointWorld, lang.pointWorldTitle );\r\n\t\tfPointWorld.domElement.style.display = 'none';\r\n\t\tfPointWorld.open();\r\n\r\n\t\tif ( guiParams.pointsControls )\r\n\t\t\tcTraceAll = guiParams.pointsControls( fPoints, dislayEl, getMesh );\r\n\r\n\t\t//Restore default settings of all 3d objects button.\r\n\t\tdat.controllerNameAndTitle( f3DObjects.add( {\r\n\r\n\t\t\tdefaultF: function ( value ) {\r\n\r\n\t\t\t\tfor ( var i = 0; i < cMeshs.__select.options.length; i++ ) {\r\n\r\n\t\t\t\t\tconst mesh = cMeshs.__select.options[i].mesh;\r\n\t\t\t\t\tif ( !mesh )\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tmesh.scale.copy( mesh.userData.default.scale );\r\n\t\t\t\t\tmesh.position.copy( mesh.userData.default.position );\r\n\t\t\t\t\tmesh.rotation.copy( mesh.userData.default.rotation );\r\n\t\t\t\t\tmesh.needsUpdate = true;\r\n\r\n\t\t\t\t}\r\n\t\t\t\tsetScaleControllers();\r\n\t\t\t\tsetPositionControllers();\r\n\t\t\t\tsetRotationControllers();\r\n\t\t\t\texposePosition();\r\n\r\n\t\t\t},\r\n\r\n\t\t}, 'defaultF' ), lang.defaultButton, lang.default3DObjectTitle );\r\n\t\taddPointControllers();\r\n\r\n\t}\r\n\tthis.setColorAttribute = function( attributes, i, color ) {\r\n\r\n\t\tif ( typeof color === \"string\" )\r\n\t\t\tcolor = new THREE.Color( color );\r\n\t\tconst colorAttribute = attributes.color || attributes.ca;\r\n\t\tif ( colorAttribute === undefined )\r\n\t\t\treturn;\r\n\t\tcolorAttribute.setX( i, color.r );\r\n\t\tcolorAttribute.setY( i, color.g );\r\n\t\tcolorAttribute.setZ( i, color.b );\r\n\t\tcolorAttribute.needsUpdate = true;\r\n\r\n\t}\r\n\tthis.removePoints = function () {\r\n\r\n\t\t//thanks to https://stackoverflow.com/a/48780352/5175935\r\n\t\tcPoints.domElement.querySelectorAll( 'select option' ).forEach( option => option.remove() );\r\n\t\tconst opt = document.createElement( 'option' );\r\n\t\topt.innerHTML = lang.notSelected;\r\n\t\topt.setAttribute( 'value', -1 );//Эта строка нужна в случае когда пользователь отменил выбор точки. Иначе при движении камеры будут появляться пунктирные линии, указвающие на несуществующую точку\r\n\t\tcPoints.__select.appendChild( opt );\r\n\r\n\t}\r\n\tfunction addPointControllers() {\r\n\r\n\t\tfunction isReadOnlyController( controller ) {\r\n\r\n\t\t\tif ( controller.domElement.querySelector( 'input' ).readOnly ) {\r\n\r\n\t\t\t\tif ( controller.getValue() !== controller.initialValue ) {\r\n\r\n\t\t\t\t\tif ( controller.boSetValue === undefined ) {\r\n\r\n\t\t\t\t\t\tcontroller.boSetValue = true;\r\n\t\t\t\t\t\tsetValue( controller, controller.initialValue );\r\n\t\t\t\t\t\tcontroller.boSetValue = undefined;\r\n\t\t\t\t\t\tcontroller.initialValue = controller.getValue();//Эта строка нужна в случае когда новое зачения невозможно установиь точно таким же, как initialValue\r\n\t\t\t\t\t\t//Иначе перепонится стек\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\t//Point's attribute position axes controllers\r\n\r\n\t\tfunction axesGui( axisName/*axesId, onChange*/ ) {\r\n\r\n\t\t\tvar scale, controller;\r\n\t\t\tif ( axisName === 'w' ){\r\n\r\n\t\t\t\t//W axis\r\n\t\t\t\tif ( options.scales.w === undefined )\r\n\t\t\t\t\treturn;\r\n\t\t\t\tscale = options.scales.w;\r\n\t\t\t\tcontroller = fPoint.add( {\r\n\r\n\t\t\t\t\tvalue: scale.min,\r\n\r\n\t\t\t\t}, 'value',\r\n\t\t\t\t\tscale.min,\r\n\t\t\t\t\tscale.max,\r\n\t\t\t\t\t( scale.max - scale.min ) / 100 ).\r\n\t\t\t\t\tonChange( function ( value ) {\r\n\r\n\t\t\t\t\t\tconst color = options.palette.toColor( value, controller.__min, controller.__max ),\r\n\t\t\t\t\t\t\tattributes = intersection.object.geometry.attributes,\r\n\t\t\t\t\t\t\ti = intersection.index;\r\n\t\t\t\t\t\t_this.setColorAttribute( attributes, i, color );\r\n\t\t\t\t\t\tattributes.position.setW( i, value );\r\n\r\n\t\t\t\t\t\tif ( ( options.arrayCloud !== undefined ) && ( options.arrayCloud.frustumPoints !== undefined ) )\r\n\t\t\t\t\t\t\toptions.arrayCloud.frustumPoints.updateCloudPointItem( intersection.object, intersection.index );\r\n\r\n\t\t\t\t\t} );\r\n\t\t\t\tif ( options.palette instanceof ColorPicker.palette ) {\r\n\r\n\t\t\t\t\tcontroller.domElement.querySelector( '.slider-fg' ).style.height = '40%';\r\n\t\t\t\t\tconst elSlider = controller.domElement.querySelector( '.slider' );\r\n\t\t\t\t\tColorPicker.create( elSlider, {\r\n\r\n\t\t\t\t\t\tpalette: options.palette,\r\n\t\t\t\t\t\tstyle: {\r\n\r\n\t\t\t\t\t\t\t//border: '2px solid #303030',\r\n\t\t\t\t\t\t\t//width: '65%',\r\n\t\t\t\t\t\t\t//height: elSlider.offsetHeight / 2,//'50%',\r\n\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t//onError: function ( message ) { alert( 'Colorpicker error: ' + message ); }\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tscale = axesHelper === undefined ? options.scales[axisName] : //если я буду использовать эту строку то экстремумы шкал буду устанавливатся по умолчанию а не текущие\r\n\t\t\t\t\taxesHelper.options ? axesHelper.options.scales[axisName] : undefined;\r\n\t\t\t\tif ( scale )\r\n\t\t\t\t\tcontroller = fPoint.add( {\r\n\r\n\t\t\t\t\t\tvalue: scale.min,\r\n\r\n\t\t\t\t\t}, 'value',\r\n\t\t\t\t\t\tscale.min,\r\n\t\t\t\t\t\tscale.max,\r\n\t\t\t\t\t\t( scale.max - scale.min ) / 100 ).\r\n\t\t\t\t\t\tonChange( function ( value ) {\r\n\r\n\t\t\t\t\t\t\tif ( isReadOnlyController( controller ) )\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\tconst points = intersection.object,\r\n\t\t\t\t\t\t\t\taxesId = axisName === 'x' ? 0 : axisName === 'y' ? 1 : axisName === 'z' ? 2 : axisName === 'w' ? 3 : console.error( 'axisName:' + axisName );\r\n\t\t\t\t\t\t\tpoints.geometry.attributes.position.array\r\n\t\t\t\t\t\t\t[axesId + intersection.index * points.geometry.attributes.position.itemSize] = value;\r\n\t\t\t\t\t\t\tpoints.geometry.attributes.position.needsUpdate = true;\r\n\r\n\t\t\t\t\t\t\texposePosition( intersection.index );\r\n\r\n\t\t\t\t\t\t\tif ( ( options.arrayCloud !== undefined ) && ( options.arrayCloud.frustumPoints !== undefined ) )\r\n\t\t\t\t\t\t\t\toptions.arrayCloud.frustumPoints.updateCloudPointItem( points, intersection.index );\r\n\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\t\t\tif ( scale )\r\n\t\t\t\tdat.controllerNameAndTitle( controller, scale.name );\r\n\t\t\treturn controller;\r\n\r\n\t\t}\r\n\t\tcontrollerX = axesGui( 'x' );\r\n\t\tcontrollerY = axesGui( 'y' );\r\n\t\tcontrollerZ = axesGui( 'z' );\r\n\t\tcontrollerW = axesGui( 'w' );\r\n\t\tcontrollerColor = fPoint.addColor( {\r\n\r\n\t\t\tcolor: '#FFFFFF',\r\n\r\n\t\t}, 'color' ).\r\n\t\t\tonChange( function ( value ) {\r\n\r\n\t\t\t\tif ( isReadOnlyController( controllerColor ) )\r\n\t\t\t\t\treturn;\r\n\t\t\t\tif ( controllerColor.userData === undefined )\r\n\t\t\t\t\treturn;\r\n\t\t\t\tvar intersection = controllerColor.userData.intersection;\r\n\t\t\t\t_this.setColorAttribute( intersection.object.geometry.attributes, intersection.index, value );\r\n\r\n\t\t\t} );\r\n\t\tdat.controllerNameAndTitle( controllerColor, lang.color );\r\n\t\tcontrollerOpacity = fPoint.add( {\r\n\r\n\t\t\topasity: 1,\r\n\r\n\t\t}, 'opasity', 0, 1, 0.01 ).\r\n\t\t\tonChange( function ( opasity ) {\r\n\r\n\t\t\t\tif ( isReadOnlyController( controllerOpacity ) )\r\n\t\t\t\t\treturn;\r\n\t\t\t\tconst intersection = controllerColor.userData.intersection;\r\n\t\t\t\tconst points = intersection.object;\r\n\t\t\t\tif ( points.geometry.attributes.ca === undefined )\r\n\t\t\t\t\treturn;//no opasity\r\n\t\t\t\tpoints.geometry.attributes.ca.array\r\n\t\t\t\t[3 + intersection.index * points.geometry.attributes.ca.itemSize] = opasity;\r\n\t\t\t\tpoints.geometry.attributes.ca.needsUpdate = true;\r\n\r\n\t\t\t} );\r\n\t\tdat.controllerNameAndTitle( controllerOpacity, lang.opacity, lang.opacityTitle );\r\n\r\n\t\tif ( guiParams.pointControls )\r\n\t\t\tcTrace = guiParams.pointControls( fPoint, dislayEl, getMesh, intersection );\r\n\r\n\t\t//Point's world position axes controllers\r\n\r\n\t\tfunction axesWorldGui( axisName ) {\r\n\r\n\t\t\tconst scale = axesHelper === undefined ? options.scales[axisName] :\r\n\t\t\t\t\taxesHelper.options ? axesHelper.options.scales[axisName] : undefined;\r\n\t\t\tif ( !scale )\r\n\t\t\t\treturn;\r\n\t\t\tconst controller = dat.controllerZeroStep( fPointWorld, { value: scale.min, }, 'value' );\r\n\t\t\tcontroller.domElement.querySelector( 'input' ).readOnly = true;\r\n\t\t\tdat.controllerNameAndTitle( controller, scale.name );\r\n\t\t\treturn controller;\r\n\r\n\t\t}\r\n\t\tcontrollerWorld.x = axesWorldGui( 'x' );\r\n\t\tcontrollerWorld.y = axesWorldGui( 'y' );\r\n\t\tcontrollerWorld.z = axesWorldGui( 'z' );\r\n\r\n\t\t//Restore default local position.\r\n\t\tcRestoreDefaultLocalPosition = fPoint.add( {\r\n\r\n\t\t\tdefaultF: function () {\r\n\r\n\t\t\t\tconst positionDefault = intersection.object.userData.arrayFuncs[intersection.index];\r\n\t\t\t\tcontrollerX.setValue( typeof positionDefault.x === \"function\" ?\r\n\t\t\t\t\tpositionDefault.x( group.userData.t, options.a, options.b ) : positionDefault.x );\r\n\t\t\t\tcontrollerY.setValue( typeof positionDefault.y === \"function\" ?\r\n\t\t\t\t\tpositionDefault.y( group.userData.t, options.a, options.b ) : positionDefault.y );\r\n\t\t\t\tcontrollerZ.setValue( typeof positionDefault.z === \"function\" ?\r\n\t\t\t\t\tpositionDefault.z( group.userData.t, options.a, options.b ) :\r\n\t\t\t\t\tpositionDefault.z === undefined ? 0 ://default Z axis of 2D point is 0\r\n\t\t\t\t\t\tpositionDefault.z );\r\n\r\n\t\t\t\tif ( positionDefault.w !== undefined ) {\r\n\r\n\t\t\t\t\tif ( positionDefault.w.r !== undefined )\r\n\t\t\t\t\t\tcontrollerColor.setValue( '#' +\r\n\t\t\t\t\t\t\tnew THREE.Color( positionDefault.w.r, positionDefault.w.g, positionDefault.w.b ).getHexString() );\r\n\t\t\t\t\telse if ( typeof positionDefault.w === \"function\" )\r\n\t\t\t\t\t\tsetValue( controllerW, positionDefault.w( group.userData.t ) );\r\n\t\t\t\t\telse console.error( 'Restore default local position: Invalid W axis.' );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tcontrollerColor.setValue( controllerColor.initialValue );\r\n\t\t\t\t\tcontrollerOpacity.setValue( controllerOpacity.initialValue );\r\n\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t},\r\n\r\n\t\t}, 'defaultF' );\r\n\t\tdat.controllerNameAndTitle( cRestoreDefaultLocalPosition, lang.defaultButton, lang.defaultLocalPositionTitle );\r\n\r\n\t}\r\n\t/*Пока что не требуется\r\n\tthis.addControllers = function ( group ) {\r\n\r\n\t\tfor ( var i = 0; i < group.children.length; i++ ) {\r\n\r\n\t\t\tvar mesh = group.children[i];\r\n\t\t\tif ( mesh instanceof THREE.Group )\r\n\t\t\t\tcontinue;\r\n\t\t\tthis.addMesh( mesh );\r\n\r\n\t\t}\r\n\t\tthis.addPointControllers();\r\n\r\n\t}\r\n\t*/\r\n\tthis.getFrustumPoints = function () { return cFrustumPoints; }\r\n\tthis.windowRange = function ( options ) {\r\n\r\n\t\tpointLight1.windowRange( options.scales );\r\n\t\tpointLight2.windowRange( options.scales );\r\n\r\n\t\tcontrollerX.min( options.scales.x.min );\r\n\t\tcontrollerX.max( options.scales.x.max );\r\n\t\tcontrollerX.updateDisplay();\r\n\r\n\t\tcontrollerY.min( options.scales.y.min );\r\n\t\tcontrollerY.max( options.scales.y.max );\r\n\t\tcontrollerY.updateDisplay();\r\n\r\n\t\tcontrollerZ.min( options.scales.z.min );\r\n\t\tcontrollerZ.max( options.scales.z.max );\r\n\t\tcontrollerZ.updateDisplay();\r\n\r\n\t\tif ( controllerW !== undefined ) {\r\n\r\n\t\t\tcontrollerW.min( options.scales.w.min );\r\n\t\t\tcontrollerW.max( options.scales.w.max );\r\n\t\t\tcontrollerW.updateDisplay();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\treturn this;\r\n\r\n}\r\n\r\n/**\r\n * gets the position from the geometry.attributes.position of the object.\r\n * @param {THREE.Mesh} object\r\n * @param {number} index index of position in the object.geometry.attributes.position\r\n * @returns position\r\n */\r\nfunction getObjectLocalPosition( object, index ) {\r\n\r\n\tif ( !THREE ) {\r\n\r\n\t\tconsole.error( 'getObjectLocalPosition: call GuiSelectPoint.setTHREE( THREE ); first' );\r\n\t\treturn;\r\n\t\t\r\n\t}\r\n\tconst attributesPosition = object.geometry.attributes.position,\r\n\t\tposition = attributesPosition.itemSize >= 4 ? new THREE.Vector4( 0, 0, 0, 0 ) : new THREE.Vector3();\r\n\tposition.fromArray( attributesPosition.array, index * attributesPosition.itemSize );\r\n\treturn position;\r\n\r\n}\r\n\r\n/**\r\n * gets position of the vector in world coordinates, taking into account the position, scale and rotation of the 3D object\r\n * @param {THREE.Object3D} object\r\n * @param {THREE.Vector3} pos local position\r\n * @returns world position \r\n */\r\nfunction getWorldPosition( object, pos ) {\r\n\r\n\tvar position = pos.clone();\r\n\tfunction getPosition( object, pos ) {\r\n\r\n\t\tvar position = new THREE.Vector3(),\r\n\t\t\tpositionAngle = new THREE.Vector3();\r\n\t\tposition = pos.clone();\r\n\t\t//position.multiply( new THREE.Vector4(0,0,0,0) );\r\n\t\tposition.multiply( object.scale );\r\n\r\n\t\t//rotation\r\n\t\tpositionAngle.copy( position );\r\n\t\tpositionAngle.applyEuler( object.rotation );\r\n\t\tposition.x = positionAngle.x;\r\n\t\tposition.y = positionAngle.y;\r\n\t\tposition.z = positionAngle.z;\r\n\r\n\t\tposition.add( object.position );\r\n\t\treturn position;\r\n\r\n\t}\r\n\tdo {\r\n\r\n\t\tposition = getPosition( object, position );\r\n\t\tobject = object.parent;\r\n\t\t\r\n\t} while ( object );\r\n\treturn position;\r\n\r\n}\r\n\r\n/**\r\n * gets the position from the geometry.attributes.position of the object in world coordinates.\r\n * @param {THREE.Mesh} object\r\n * @param {number} index index of position in the object.geometry.attributes.position\r\n * @returns position\r\n */\r\nfunction getObjectPosition( object, index ) {\r\n\r\n\tif ( index === -1 )\r\n\t\treturn undefined;\r\n\tif ( index === undefined )\r\n\t\treturn object.position;\r\n\treturn getWorldPosition( object, getObjectLocalPosition( object, index ) )\r\n\r\n}\r\n\r\n/**\r\n * set THREE\r\n * @function GuiSelectPoint.\r\n * setTHREE\r\n * @param {THREE} _THREE {@link https://github.com/anhr/three.js|THREE}\r\n */\r\nGuiSelectPoint.setTHREE = function ( _THREE ) {\r\n\r\n\tif ( THREE ) {\r\n\r\n\t\tif ( !Object.is(THREE, _THREE) )\r\n\t\t\tconsole.error( 'GuiSelectPoint.setTHREE: duplicate THREE. Please use one instance of the THREE library.' )\r\n\t\treturn;\r\n\r\n\t}\r\n\tTHREE = _THREE;\r\n\r\n}\r\nexport { GuiSelectPoint, getWorldPosition, getObjectLocalPosition, getObjectPosition };\r\n","/**\r\n * node.js version of the synchronous download of the file.\r\n * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/\r\n *\r\n * @copyright 2011 Data Arts Team, Google Creative Lab\r\n *\r\n * @license under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n */\r\n\r\n//The myRequest is cross-browser XMLHttpRequest wrapper.\r\nfunction myRequest( options ) {\r\n\r\n\tthis.loadXMLDoc = function () {\r\n\t\tvar req;\r\n\r\n\t\tif ( window.XMLHttpRequest ) {\r\n\t\t\treq = new XMLHttpRequest();\r\n\t\t\tif ( !req )\r\n\t\t\t\tthrow \"new XMLHttpRequest() failed!\"\r\n\t\t}\r\n\t\telse if ( window.ActiveXObject ) {\r\n\t\t\treq = this.NewActiveXObject();\r\n\t\t\tif ( !req )\r\n\t\t\t\tthrow \"NewActiveXObject() failed!\"\r\n\t\t}\r\n\t\telse throw \"myRequest.loadXMLDoc(...) failed!\";\r\n\t\treturn req;\r\n\t}\r\n\r\n\tthis.NewActiveXObject = function () {\r\n\t\ttry { return new ActiveXObject( \"Msxml2.XMLHTTP.6.0\" ); }\r\n\t\tcatch ( e ) { }\r\n\t\ttry { return new ActiveXObject( \"Msxml2.XMLHTTP.3.0\" ); }\r\n\t\tcatch ( e ) { }\r\n\t\ttry { return new ActiveXObject( \"Msxml2.XMLHTTP\" ); }\r\n\t\tcatch ( e ) { }\r\n\t\ttry { return new ActiveXObject( \"Microsoft.XMLHTTP\" ); }\r\n\t\tcatch ( e ) { }\r\n\t\tErrorMessage( 'This browser does not support XMLHttpRequest. Probably, your security settings do not allow Web sites to use ActiveX controls installed on your computer. Refresh your Web page to find out the current status of your Web page or enable the \"Initialize and script ActiveX controls not marked as safe\" and \"Run Active X controls and plug-ins\" of the Security settings of the Internet zone of your browser.' );\r\n\t\treturn null;\r\n\t}\r\n\r\n\tthis.XMLHttpRequestStart = function ( onreadystatechange, async ) {\r\n\r\n\t\tthis.XMLHttpRequestStop();//For compatibility with IE Windows Phone\r\n\r\n\t\tthis.req.onreadystatechange = onreadystatechange;\r\n\r\n\t\t//ATTENTION!!! do not works in IE\r\n\t\tif ( \"onerror\" in this.req ) {\r\n\t\t\tthis.req.onerror = function ( event ) {\r\n\t\t\t\tErrorMessage( \"XMLHttpRequest error. url: \" + this.url, false, false );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.XMLHttpRequestReStart( async );\r\n\t}\r\n\r\n\tthis.getUrl = function () {\r\n\t\tif ( ( typeof this.url == 'undefined' ) || ( this.url == null ) ) {\r\n\t\t\tthis.url = \"XMLHttpRequest.xml\";\r\n\t\t}\r\n\t\treturn this.url + ( this.params ? this.params : \"\" );\r\n\t}\r\n\r\n\tthis.XMLHttpRequestReStart = function ( async ) {\r\n\t\ttry {\r\n\t\t\tif ( typeof async == 'undefined' )\r\n\t\t\t\tasync = true;\r\n\t\t\tthis.req.open( \"GET\", this.getUrl(), async );\r\n\t\t\tif ( async ) {\r\n\t\t\t\tvar timeout = ( 60 + 30 ) * 1000;//��������!!! �������� ������ ���� ������ CSocketWaitEvent::WaitResponse\r\n\t\t\t\tif ( \"timeout\" in this.req )//for IE6\r\n\t\t\t\t\tthis.req.timeout = timeout;\r\n\t\t\t\tif ( \"ontimeout\" in this.req )\r\n\t\t\t\t\tthis.req.ontimeout = function () {\r\n\t\t\t\t\t\tErrorMessage( 'XMLHttpRequest timeout', false, false );\r\n\t\t\t\t\t}\r\n\t\t\t\telse {//for Safari, IE6\r\n\t\t\t\t\tclearTimeout( this.timeout_id_SendReq );\r\n\t\t\t\t\tthis.timeout_id_SendReq = setTimeout( function () {\r\n\t\t\t\t\t\tErrorMessage( 'XMLHttpRequest timeout 2', false, false );\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\t, timeout );\r\n\t\t\t\t\t//console.log(\"setTimeout this.req.timeout_id_SendReq = \" + this.req.timeout_id_SendReq);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.req.send( null );\r\n\t\t} catch ( e ) {\r\n\t\t\tErrorMessage( e.message + \" url: \" + this.url, false, false );\r\n\t\t}\r\n\t}\r\n\r\n\tthis.XMLHttpRequestStop = function () {\r\n\t\t//console.log(\"XMLHttpRequestStop(...)\");\r\n\t\tif ( this.req == null )\r\n\t\t\treturn;\r\n\t\tthis.req.abort();\r\n\t}\r\n\r\n\tthis.ProcessReqChange = function ( processStatus200 ) {\r\n\t\tvar req = this.req;\r\n\t\tif ( ( typeof isIE === 'undefined' ) || !isIE ) {\r\n\t\t\t//\tconsole.log(\"processReqChange(); req.statusText: \" + req.statusText + \". req.status = \" + req.status + \". req.readyState = \" + req.readyState + \". req.responseText: \" + req.responseText);\r\n\t\t}\r\n\t\t// only if req shows \"complete\"\r\n\t\t//http://www.w3schools.com/ajax/ajax_xmlhttprequest_onreadystatechange.asp\r\n\t\t//http://xmlhttprequest.ru/w3c\r\n\t\tswitch ( req.readyState ) {\r\n\t\t\tcase 4://request finished and response is ready\r\n\t\t\t\t{\r\n\t\t\t\t\tif ( typeof req.status == \"unknown\" ) {//IE5 timeout\r\n\t\t\t\t\t\tconsoleError( 'typeof XMLHttpRequest status == \"unknown\"' );\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//� �� ���� ��������� switch ���� � ������\r\n\t\t\t\t\tif ( req.status == 200 )//OK)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tclearTimeout( this.timeout_id_SendReq );\r\n\t\t\t\t\t\treturn processStatus200( this );\r\n\t\t\t\t\t}//200://OK\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tErrorMessage( \"Invalid XMLHttpRequest status : \" + req.status + \" url: \" + this.url );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1://server connection established\r\n\t\t\tcase 2://request received\r\n\t\t\tcase 3://processing request\r\n\t\t\t\tbreak;\r\n\t\t\t//\t\tcase 404:\r\n\t\t\tcase 0://request not initialized\r\n\t\t\tdefault:\r\n\t\t\t\tthrow \"processReqChange(); req.readyState = \" + req.readyState;\r\n\t\t\t\tbreak;\r\n\t\t}//switch(req.readyState)\r\n\t\treturn true;\r\n\t}\r\n\r\n\tthis.processStatus200Error = function () {\r\n\t\tvar error = this.GetElementText( 'error', true );\r\n\t\tif ( error ) {\r\n\t\t\tErrorMessage( error );\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tthis.GetElementText = function ( tagName, noDisplayErrorMessage ) {\r\n\t\tvar xmlhttp = this.req;\r\n\t\tif ( !xmlhttp.responseXML ) {\r\n\t\t\tif ( noDisplayErrorMessage != true )\r\n\t\t\t\tErrorMessage( 'GetXMLElementText(xmlhttp, ' + tagName + '); xmlhttp.responseXML is null.\\nxmlhttp.responseText:\\n' + xmlhttp.responseText );\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar element = xmlhttp.responseXML.getElementsByTagName( tagName );\r\n\r\n\t\t//ATTENTION!!! For IE set the content-type m_HttpResponse.SetContentType(\"text/xml\");\r\n\r\n\t\tif ( element.length == 0 ) {\r\n\t\t\tif ( noDisplayErrorMessage != true )\r\n\t\t\t\tErrorMessage( 'GetXMLElementText(xmlhttp, \"' + tagName + '\"); element.length == ' + element.length );\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\t\tvar text = \"\";\r\n\t\tfor ( var i = 0; i < element.length; i++ ) {\r\n\t\t\tif ( typeof ( element[i].textContent ) == 'undefined' ) {\r\n\t\t\t\tif ( typeof ( element[i].text ) == 'undefined' ) {\r\n\t\t\t\t\tErrorMessage( 'GetXMLElementText(xmlhttp, ' + tagName + '); element[' + i + '].text) == undefined' );\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t}\r\n\t\t\t\tif ( text != \"\" )\r\n\t\t\t\t\ttext += \" \";\r\n\t\t\t\ttext += element[i].text;//IE\r\n\t\t\t}\r\n\t\t\telse text += element[i].textContent;//Chrome\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\r\n\tif ( options.data ) {\r\n\t\tthis.req = options.data.req;\r\n\t\tthis.url = options.data.url;\r\n\t\tthis.params = options.data.params;\r\n\t} else {\r\n\t\ttry {\r\n\t\t\tthis.req = this.loadXMLDoc();\r\n\t\t} catch ( e ) {\r\n\t\t\tvar message;\r\n\t\t\tif ( typeof e.message == 'undefined' )\r\n\t\t\t\tmessage = e;\r\n\t\t\telse message = e.message;\r\n\t\t\tErrorMessage( \"Your browser is too old and is not compatible with our site.\\n\\n\"\r\n\t\t\t\t+ window.navigator.appName + \" \" + window.navigator.appVersion + \"\\n\\n\" + message );\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\tif ( !this.req ) {\r\n\t\tconsoleError( \"Invalid myRequest.req: \" + this.req );\r\n\t\treturn;\r\n\t}\r\n\r\n\tfunction ErrorMessage( error ) {\r\n\r\n\t\tconsole.error( error );\r\n\t\toptions.onerror( error );\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * @callback onerror\r\n * @param {string} str - error details\r\n */\r\n\r\n/**\r\n * Synchronous load file\r\n * @param {string} url URL of an external file.\r\n * @param {Object} [options] followed options is available. Optional.\r\n * @param {Function} [options.onload] function () The onload event occurs when a script has been loaded. Optional.\r\n * @param {onerror} [options.onerror] function ( str ) The onerror event occurs when an error has been occured. Optional.\r\n * @returns {string} file content\r\n * @example\r\n * \r\n\t//Simplest example.\r\n\tdocument.getElementById( \"elID\" ).innerHTML = loadFile.sync('element.html');\r\n *\r\n * @example\r\n *\r\n\t//onload, onerror events.\r\n\tdocument.getElementById( \"elID\").innerHTML = loadFile.sync( 'element.html',\r\n\t{\r\n\t\tonload: function ( response ) {\r\n\r\n\t\t\tvar str = 'file has been loaded successfully';\r\n\t\t\tconsole.log( str );\r\n\r\n\t\t},\r\n\t\tonerror: function ( str, e ) {\r\n\r\n\t\t\tconsole.error( str );\r\n\r\n\t\t},\r\n\t}, );\r\n */\r\nfunction sync( url, options ) {\r\n\r\n\toptions = options || {};\r\n\toptions.onload = options.onload || function () { };\r\n\toptions.onerror = options.onerror || function () { };\r\n\r\n\tvar response,\r\n\t\trequest = new myRequest( options );\r\n\trequest.url = url;\r\n\trequest.XMLHttpRequestStart(\r\n\r\n\t\tfunction () {//onreadystatechange\r\n\r\n\t\t\trequest.ProcessReqChange( function ( myRequest ) {//processStatus200\r\n\r\n\t\t\t\tif ( myRequest.processStatus200Error() )\r\n\t\t\t\t\treturn;\r\n\t\t\t\tresponse = myRequest.req.responseText;\r\n\t\t\t\t//console.log( 'loadFile.sync.onload() ' + url );\r\n\t\t\t\toptions.onload( response, url );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\t\t, false//Synchronous mode\r\n\r\n\t);\r\n\t//console.log( 'sync(' + url + ')' );\r\n\treturn response;\r\n\r\n}\r\n\r\n/**\r\n * display a text to HTML\r\n * @param {string} str source text\r\n * @returns {string} escaped text\r\n */\r\nfunction escapeHtml( str ) {\r\n\r\n\treturn str.replace( /[&<>\"'\\/]/g, function ( s ) {\r\n\r\n\t\tvar entityMap = {\r\n\r\n\t\t\t\"&\": \"&amp;\",\r\n\t\t\t\"<\": \"&lt;\",\r\n\t\t\t\">\": \"&gt;\",\r\n\t\t\t'\"': '&quot;',\r\n\t\t\t\"'\": '&#39;',\r\n\t\t\t\"/\": '&#x2F;'\r\n\r\n\t\t};\r\n\r\n\t\treturn entityMap[s];\r\n\r\n\t} );\r\n}\r\n\r\nexport { sync, escapeHtml };\r\n","/**\r\n * node.js version of the load JavaScript file\r\n * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/\r\n *\r\n * Thanks to:\r\n *http://javascript.ru/forum/events/21439-dinamicheskaya-zagruzka-skriptov.html\r\n *https://learn.javascript.ru/onload-onerror\r\n *\r\n * @copyright 2011 Data Arts Team, Google Creative Lab\r\n *\r\n * @license under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n */\r\n\r\n//Please download https://github.com/anhr/loadFileNodeJS into ../loadFileNodeJS folder\r\nimport { sync as loadFileSync, escapeHtml } from '../../loadFileNodeJS/master/index.js';\r\n\r\n/**\r\n * @callback onerror\r\n * @param {string} str - error details\r\n */\r\n\r\n/**\r\n * Synchronous load JavaScript file\r\n * @param {string} src URL of an external script file.\r\n * @param {Object} [options] followed options is available. Optional.\r\n * @param {Function} [options.onload] function () The onload event occurs when a script has been loaded. Optional.\r\n * @param {onerror} [options.onerror] function ( str ) The onerror event occurs when an error has been occured. Optional.\r\n * @param {string}[options.appendTo] The node to which the new script will be append. Optional. Default is head node\r\n * @param {Object|string}[options.tag] The script's tag attributes (Object) or tag type (string). Optional.\r\n * Available tag types:\r\n *\t'style' - load a style file (.css extension)\r\n * @param {string} [options.tag.name] tag name. Default is 'script'\r\n * @param {Object} [options.tag.attribute] tag attribute. Optional.\r\n * @param {string} options.tag.attribute.name attribute name. Default is 'type'\r\n * @param {string} options.tag.attribute.value attribute value. Default is 'text/javascript'\r\n *\r\n * @example\r\n * \r\n\t//Simplest example. Append script into head node.\r\n\tloadScript.sync( 'sync.js' );\r\n\r\n * @example\r\n * \r\n\t//onload, onerror events. Append script into \"appendto\" element\r\n\tloadScript.sync( 'sync.js',\r\n\t\t{\r\n\t\t\tonload: function ( response ) {\r\n\r\n\t\t\t\tvar str = 'file has been loaded successfully';\r\n\t\t\t\tconsole.log( str );\r\n\r\n\t\t\t},\r\n\t\t\tonerror: function ( str, e ) {\r\n\r\n\t\t\t\telSync2Res.style.color = 'red';\r\n\r\n\t\t\t},\r\n\t\t\tappendTo: document.getElementById( \"appendto\" ),\r\n\t\t},\r\n\t);\r\n *\r\n * @example\r\n *\r\n\t//Append style into head node.\r\n\tloadScript.sync( \"controls.css\",\r\n\t{\r\n\t\t//style rel=\"stylesheet\"\r\n\t\ttag: {\r\n\r\n\t\t\tname: 'style',\r\n\t\t\tattribute: {\r\n\r\n\t\t\t\tname: 'rel',\r\n\t\t\t\tvalue: 'stylesheet',\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\r\n */\r\nfunction sync( src, options ) {\r\n\r\n\toptions = options || {};\r\n\toptions.onload = options.onload || function () { };\r\n\toptions.onerror = options.onerror || function () { };\r\n\toptions.appendTo = options.appendTo || document.getElementsByTagName( 'head' )[0];\r\n\r\n\tif ( isScriptExists( options.appendTo, src ) ) {\r\n\r\n\t\t//options.onerror( 'duplicate downloading of the ' + src + ' file' );\r\n\t\toptions.onload();\r\n\t\treturn;\r\n\r\n\t}\r\n\r\n\tif ( src instanceof Array ) {\r\n\r\n\t\tvar error,\r\n\t\t\toptionsItem = {\r\n\r\n\t\t\t\tappendTo: options.appendTo,\r\n\t\t\t\ttag: options.tag,\r\n\t\t\t\tonload: function ( response, url ) {\r\n\t\t\t\t\r\n\t\t\t\t\tconsole.log( 'loadScript.sync.onload: ' + url );\r\n\t\t\t\t\r\n\t\t\t\t},\r\n\t\t\t\tonerror: function ( str ) {\r\n\r\n\t\t\t\t\toptions.onerror( str );\r\n\t\t\t\t\terror = str;\r\n\r\n\t\t\t\t},\r\n\r\n\t\t\t};\r\n\t\tfor ( var i = 0; i < src.length; i++ ) {\r\n\r\n\t\t\tvar item = src[ i ];\r\n\t\t\tloadScriptBase( function ( script ) {\r\n\r\n\t\t\t\tscript.setAttribute( \"id\", item );\r\n\t\t\t\tscript.innerHTML = loadFileSync( item, optionsItem );\r\n\r\n\t\t\t}, optionsItem );\r\n\t\t\tif ( error !== undefined )\r\n\t\t\t\tbreak;\r\n\r\n\t\t};\r\n\t\tif ( error === undefined )\r\n\t\t\toptions.onload();\r\n\r\n\t} else loadScriptBase( function ( script ) {\r\n\r\n\t\tscript.setAttribute( \"id\", src );\r\n\t\tscript.innerHTML = loadFileSync( src, options );\r\n\r\n\t}, options );\r\n\r\n}\r\n\r\n/**\r\n * @callback onerrorasync\r\n * @param {string} str - error details\r\n * @param {Object} e - event\r\n */\r\n\r\n/**\r\n * Asynchronous load JavaScript file\r\n * @param {string|string[]} src URL of an external script file or array of the script file names.\r\n * @param {Object} [options] followed options is available. Optional.\r\n * @param {Function} [options.onload] function () The onload event occurs when a script has been loaded. Optional.\r\n * @param {onerrorasync} [options.onerror] function ( str, e ) The onerror event occurs when an error has been occured. Optional.\r\n * @param {string}[options.appendTo] The node to which the new script will be append. Optional. Default is head node\r\n * @param {Object}[options.tag] The script's tag attributes. Optional.\r\n * @param {string} options.tag.name tag name. Default is 'script'\r\n * @param {Object} [options.tag.attribute] tag attribute. Optional.\r\n * @param {string} options.tag.attribute.name attribute name. Default is 'type'\r\n * @param {string} options.tag.attribute.value attribute value. Default is 'text/javascript'\r\n*\r\n * @example\r\n * \r\n\t//Simplest example. Append script into head node.\r\n\tloadScript.async( \"JavaScript.js);\r\n * \r\n * @example\r\n *\r\n\t//onload, onerror events. Append script into \"appendto\" element\r\n\tloadScript.async( \"JavaScript.js\",\r\n\t{\r\n \t\tonload: function () {\r\n \r\n \t\t\tvar str = 'file has been loaded successfully';\r\n \t\t\tconsole.log( str );\r\n \r\n \t\t},\r\n \t\tonerror: function ( str, e ) {\r\n \r\n \t\t\tconsole.error( str );\r\n \r\n \t\t},\r\n \t\tappendTo: document.getElementById( \"appendto\" ),\r\n \r\n \t}\r\n \r\n  );\r\n *\r\n * @example\r\n *\r\n\t//loading of array of JavaScript files. Append script into head node.\r\n\tloadScript.async( [\r\n \t\t\"JavaScript1.js\",\r\n \t\t\"JavaScript2.js\",\r\n \t],\r\n \t{\r\n \t\tonload: function () {\r\n \r\n \t\t\tvar str = 'file has been loaded successfully';\r\n \t\t\tconsole.log( str );\r\n \r\n \t\t},\r\n \t\tonerror: function ( str, e ) {\r\n \r\n \t\t\tconsole.error( str );\r\n \r\n \t\t},\r\n \r\n \t}\r\n \r\n  );\r\n */\r\nfunction async( src, options ) {\r\n\r\n\toptions = options || {};\r\n\toptions.appendTo = options.appendTo || document.getElementsByTagName( 'head' )[ 0 ];\r\n\toptions.onload = options.onload || function () {};\r\n\r\n\tvar isrc;\r\n\r\n\tfunction async( srcAsync ) {\r\n\r\n\t\tfunction next() {\r\n\r\n\t\t\tif ( src instanceof Array && ( isrc < ( src.length - 1 ) ) ) {\r\n\r\n\t\t\t\tisrc++;\r\n\t\t\t\tasync( src[isrc] );\r\n\r\n\t\t\t} else options.onload();\r\n\r\n\t\t}\r\n\r\n\t\tif ( isScriptExists( options.appendTo, srcAsync, options.onload ) ) {\r\n\r\n\t\t\tnext();\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tloadScriptBase( function ( script ) {\r\n\r\n\t\t\tscript.setAttribute( \"id\", srcAsync );\r\n\r\n\t\t\tfunction _onload() {\r\n\r\n\t\t\t\tconsole.log( 'loadScript.async.onload() ' + srcAsync );\r\n\t\t\t\tif ( options.onload !== undefined ) {\r\n\r\n\t\t\t\t\tnext();\r\n/*\r\n\t\t\t\t\tif ( src instanceof Array && ( isrc < ( src.length - 1 ) ) ) {\r\n\r\n\t\t\t\t\t\tisrc++;\r\n\t\t\t\t\t\tasync( src[isrc] );\r\n\r\n\t\t\t\t\t} else options.onload();\r\n*/\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( script.readyState && ! script.onload ) {\r\n\r\n\t\t\t\t// IE, Opera\r\n\t\t\t\tscript.onreadystatechange = function () {\r\n\r\n\t\t\t\t\tif ( script.readyState == \"complete\" ) {\r\n\r\n\t\t\t\t\t\t// �� ������ �������� loaded\r\n\t\t\t\t\t\tif ( options.onload !== undefined ) options.onload(); // (2)\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( script.readyState == \"loaded\" ) {\r\n\r\n\t\t\t\t\t\tsetTimeout( options.onload, 0 ); // (1)\r\n\r\n\t\t\t\t\t\t// ������� ����������, ����� �� �������� �� complete\r\n\t\t\t\t\t\tthis.onreadystatechange = null;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// Rest\r\n\t\t\t\tscript.onload = _onload;\r\n\r\n\t\t\t\tscript.onerror = function ( e ) {\r\n\r\n\t\t\t\t\tvar str = 'loadScript: \"' + this.src + '\" failed';\r\n\t\t\t\t\tif ( options.onerror !== undefined )\r\n\t\t\t\t\t\toptions.onerror( str, e );\r\n\t\t\t\t\tconsole.error( str );\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t}\r\n\r\n\t\t\tscript.src = srcAsync;\r\n\r\n\t\t}, options );\r\n\r\n\t}\r\n\r\n\tif ( src instanceof Array ) {\r\n\r\n\t\tisrc = 0;\r\n\t\tasync( src[ isrc ] );\r\n\r\n\t} else async( src );\r\n\r\n}\r\n\r\nfunction loadScriptBase( callback, options ) {\r\n\r\n\toptions.tag = options.tag || {};\r\n\tif ( typeof options.tag === \"string\" ) {\r\n\r\n\t\tswitch ( options.tag ) {\r\n\r\n\t\t\tcase 'style':\r\n\t\t\t\toptions.tag = {\r\n\r\n\t\t\t\t\tname: 'style',\r\n\t\t\t\t\tattribute: {\r\n\r\n\t\t\t\t\t\tname: 'rel',\r\n\t\t\t\t\t\tvalue: 'stylesheet',\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault: console.error( 'Invalid options.tag: ' + options.tag );\r\n\t\t\t\treturn;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\toptions.tag.name = options.tag.name || 'script';\r\n\tvar script = document.createElement( options.tag.name );\r\n\r\n\toptions.tag.attribute = options.tag.attribute || {};\r\n\toptions.tag.attribute.name = options.tag.attribute.name || \"type\";\r\n\toptions.tag.attribute.value = options.tag.attribute.value || 'text/javascript';\r\n\tscript.setAttribute( options.tag.attribute.name, options.tag.attribute.value );\r\n\r\n\tcallback( script );\r\n\toptions.appendTo.appendChild( script );\r\n\r\n}\r\n\r\nfunction isScriptExists( elParent, srcAsync, onload ) {\r\n\r\n\tvar scripts = elParent.querySelectorAll( 'script' );\r\n\tfor ( var i = 0; i < scripts.length; i++ ) {\r\n\r\n\t\tvar child = scripts[i];\r\n\t\tif ( child.id === srcAsync ) {\r\n\r\n/*\r\n\t\t\tif ( onload !== undefined )\r\n\t\t\t\tonload();\r\n*/\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\treturn false;\r\n\r\n}\r\n\r\nexport { async, sync, escapeHtml };\r\n","﻿/**\r\n * node.js version of download of the scripts.\r\n * \r\n * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/\r\n *\r\n * Copyright 2011 Data Arts Team, Google Creative Lab\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n */\r\n\r\nimport { sync, async } from './index.js';\r\n\r\nvar loadScript = {\r\n\r\n\tsync: sync,\r\n\tasync: async,\r\n\r\n}\r\nexport default loadScript;\r\n","/**\r\n * @module ColorPicker\r\n * @description Pure JavaScript color picker.\r\n * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}\r\n * @See Thanks to [FlexiColorPicker]{@link https://github.com/DavidDurman/FlexiColorPicker}\r\n *\r\n * @copyright 2011 Data Arts Team, Google Creative Lab\r\n *\r\n * @license under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n */\r\n\r\n//Please download https://github.com/anhr/loadScriptNodeJS into ../loadScriptNodeJS folder\r\n\r\nimport loadScript from '../../loadScriptNodeJS/master/loadScript.js';\r\n//import loadScript from 'https://raw.githack.com/anhr/loadScriptNodeJS/master/loadScript.js';\r\n\r\nconst optionsStyle = {\r\n\r\n\t//style rel=\"stylesheet\"\r\n\ttag: 'style'\r\n\r\n}\r\n//loadScript.sync( 'https://raw.githack.com/anhr/colorPicker/master/colorpicker.css', optionsStyle );\r\n//loadScript.sync( 'http://localhost/threejs/nodejs/colorpicker/colorpicker.css', optionsStyle );\r\nloadScript.sync( '/anhr/colorpicker/master/colorpicker.css', optionsStyle );\r\n\r\nconst type = ( window.SVGAngle || document.implementation.hasFeature( \"http://www.w3.org/TR/SVG11/feature#BasicStructure\", \"1.1\" ) ? \"SVG\" : \"VML\" ),\r\n\tsvgNS = 'http://www.w3.org/2000/svg';\r\nvar uniqID = 0;\r\n\r\n/**\r\n * enumeration of available palettes.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nconst paletteIndexes = {\r\n\t\r\n\r\n\t/** [blue, green, red, white]{@link https://raw.githack.com/anhr/ColorPicker/master/Example/index.html#BGRW} palette */\r\n\tBGRW: 0,\r\n\t/** [monochrome]{@link https://raw.githack.com/anhr/ColorPicker/master/Example/index.html#Monochrome} palette */\r\n\tmonochrome: 1,\r\n\t/** [red, black, green]{@link https://raw.githack.com/anhr/ColorPicker/master/Example/index.html#Bidirectional} palette */\r\n\tbidirectional: 2,//\r\n\t/** [rainbow]{@link https://raw.githack.com/anhr/ColorPicker/master/Example/index.html#rainbow} palette */\r\n\trainbow: 3,\r\n\r\n}\r\n/**\r\n * @callback callback\r\n * @description Called whenever the color is changed provided chosen color in RGB HEX format. See options.sliderIndicator.callback param of the create method.\r\n * @param {object} c color\r\n * @param {string} c.hex A hexadecimal color is specified with: #RRGGBB, where the RR (red), GG (green) and BB (blue)\r\n * <pre>\r\n * hexadecimal integers specify the components of the color. All values must be between 00 and FF.\r\n * Example #00ff00\r\n * </pre>\r\n * @param {number} c.r red of RGB color value. Must be between 0 and 255.\r\n * @param {number} c.g green of RGB color value. Must be between 0 and 255.\r\n * @param {number} c.b blue of RGB color value. Must be between 0 and 255.\r\n * @param {number} percent position of the mouse pointer in the percents. See details in options.direction param\r\n */\r\n\r\n/**\r\n * @callback onError\r\n * @param {string} message error message\r\n */\r\n\r\n/**\r\n * creates an instance of ColorPicker\r\n * @param {string|HTMLElement} elSliderWrapper id of the ColorPicker element or ColorPicker element\r\n * @param {object} [options] followed options is availablee\r\n * @param {paletteIndexes|object[]|Palette} [options.palette] Palette index or palette array or Palette. The following indexes are available:\r\n * <pre>\r\n * paletteIndexes.BGRW: 0 - blue, green, red, white palette.\r\n * paletteIndexes.monochrome: 1,\r\n * paletteIndexes.bidirectional: 2,//red, black, green\r\n * paletteIndexes.rainbow: 3,\r\n * Default is paletteIndexes.BGRW index.\r\n * Example of palette array:\r\n[\r\n\t{ percent: 0, r: 0, g: 0, b: 0, },\r\n\t{ percent: 10, r: 0xff, g: 255, b: 0xff, },\r\n\t{ percent: 100, r: 0xff, g: 255, b: 0xff, },\r\n]\r\n * Palette see function Palette( options ) for details\r\n * </pre>\r\n * @param {object} [options.orientation] orientation of the element. Available \"horizontal\" or \"vertical\" orientation\r\n * @param {object} [options.direction] true - position of the mouse pointer relative left side for 'horizontal' slider\r\n * or bottom side for 'vertical' slider in the percents.\r\n * <p>\r\n * false - position of the mouse pointer relative right side for 'horizontal' slider\r\n * or relative top side for 'vertical' slider in the percents.\r\n * </p>\r\n * Default is true.\r\n * @param {object} [options.style] style statements\r\n * @param {object} [options.style.width] width of the element. Default is 200px for options.orientation = \"horizontal\"\r\n * and 30px for options.orientation = \"vertical\".\r\n * @param {object} [options.style.height] height of the element. Default is 30px for options.orientation = \"horizontal\"\r\n * and 200px for options.orientation = \"vertical\".\r\n * @param {string} [options.style.border] elSliderWrapper border. Example: '1px solid black'\r\n * @param {object} [options.sliderIndicator] adds a slider-indicator element for choose by mouse a color from palette.\r\n * Default is undefuned\r\n * @param {callback} [options.sliderIndicator.callback] Called whenever the color is changed provided chosen color in RGB HEX format.\r\n * @param {number} [options.sliderIndicator.value] Initial position of the slider indicator in percent. Default is 0.\r\n * @param {onError} [options.onError] Called whenever an error has occurred. Default is undefined.\r\n */\r\nfunction create( elSliderWrapper, options ) {\r\n\r\n\toptions = options || {};\r\n\toptions.orientation = options.orientation || 'horizontal';\r\n\r\n\tfunction isHorizontal() { return options.orientation === \"horizontal\"; }\r\n\r\n\tif ( options.direction === undefined  )\r\n\t\toptions.direction = true;\r\n\toptions.style = options.style || {};\r\n\t//\t\toptions.style.width = options.style.width || ( isHorizontal() ? '200px' : '30px' );\r\n\toptions.style.width = options.style.width || ( isHorizontal() ? 200 : 30 );\r\n\toptions.style.height = options.style.height || ( isHorizontal() ? 30 : 200 );\r\n\r\n\toptions.onError = options.onError || function () {}\r\n\r\n\tif ( elSliderWrapper instanceof HTMLElement !== true ) {\r\n\r\n\t\tif ( typeof elSliderWrapper !== \"string\" ) {\r\n\r\n\t\t\tconsole.error( 'ColorPicker.create: invalid elSliderWrapper = ' + elSliderWrapper );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\t\telSliderWrapper = document.getElementById( elSliderWrapper );\r\n\t\tif ( elSliderWrapper === null ) {\r\n\r\n\t\t\tconsole.error( 'ColorPicker.create: invalid elSliderWrapper = ' + elSliderWrapper );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\telSliderWrapper.classList.add( 'slider-wrapper' );\r\n\tfor ( var style in options.style ) {\r\n\r\n\t\telSliderWrapper.style[style] = options.style[style];\r\n\r\n\t}\r\n\r\n\tconst palette = options.palette instanceof Palette ? options.palette : new Palette( options );\r\n\tvar slide;\r\n\tfunction getSlideHeight() {\r\n\r\n\t\tif ( typeof options.style.height === \"string\" )\r\n\t\t\treturn parseInt( options.style.height );\r\n\t\treturn options.style.height;\r\n\r\n\t}\r\n\tfunction getSlideWidth() { return slide.clientWidth; }\r\n\t/**\r\n\t * sets color from palette\r\n\t * @param {number} value coordinate of color from palette in percent\r\n\t * @param {number} position coordinate of color from palette\r\n\t */\r\n\tfunction setValue( value, position ) {\r\n\r\n\t\tif ( slideIndicator === undefined ) {\r\n\r\n\t\t\tconsole.error( 'Set value of this instance of the ColorPicker is impossible because options.sliderIndicator is not defined.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\t\tconst c = palette.hsv2rgb( value );\r\n\t\tif ( c === undefined ) {\r\n\r\n\t\t\tconsole.error( 'ColorPicker.setValue: invalud c = ' + c );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvalue = c.percent;\r\n\t\tif ( position === undefined )\r\n\t\t\tposition = isHorizontal() ?\r\n\t\t\t\t( getSlideWidth() * value ) / 100 :\r\n\t\t\t\tgetSlideHeight() - ( getSlideHeight() * ( options.direction ? value : 100 - value ) ) / 100;\r\n\t\tpositionIndicators( position );\r\n\t\tif ( options.sliderIndicator.callback !== undefined ) {\r\n\r\n\t\t\t//console.warn( 'callback: ' + c.percent + ' percent c.hex = ' + c.hex );\r\n\t\t\toptions.sliderIndicator.callback( c );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar slideIndicator;\r\n\tif ( options.sliderIndicator !== undefined ) {\r\n\r\n\t\tslideIndicator = document.createElement( 'div' );\r\n\t\tslideIndicator.className = 'slider-indicator';\r\n\t\tif ( isHorizontal() )\r\n\t\t\tslideIndicator.style.width = '10px';\r\n\t\telse slideIndicator.style.height = '10px';\r\n\t\telSliderWrapper.appendChild( slideIndicator );\r\n\t\tslideIndicator.style.pointerEvents = 'none';\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Helper to position indicators.\r\n\t * @param {number} position Coordinates of the mouse cursor in the slide area.\r\n\t */\r\n\tfunction positionIndicators( position ) {\r\n\r\n\t\tif ( slideIndicator === undefined )\r\n\t\t\treturn;\r\n\r\n\t\tif ( isHorizontal() ) {\r\n\r\n\t\t\tif ( ( position < 0 ) || ( position > getSlideWidth() ) ) {\r\n\r\n\t\t\t\tconsole.error( 'ColorPicker.positionIndicators: Invalid position = ' + position );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\t\t\tslideIndicator.style.top = '0px';\r\n\t\t\tslideIndicator.style.left = ( ( options.direction ? position : getSlideWidth() - position ) - slideIndicator.offsetWidth / 2 ) + 'px';\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( ( position < 0 ) || ( position > getSlideHeight() ) ) {\r\n\r\n\t\t\t\tconsole.error( 'ColorPicker.positionIndicators: Invalid position = ' + position );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\t\t\tslideIndicator.style.left = '0px';\r\n\t\t\tslideIndicator.style.top = ( position - slideIndicator.offsetHeight / 2 ) + 'px';\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tif ( type == 'SVG' ) {\r\n\r\n\t\ttry {\r\n\r\n\t\t\tconst linearGradient = 'linearGradient';\r\n\t\t\tslide = CreateSVGElement( 'svg', {\r\n\t\t\t\txmlns: 'http://www.w3.org/2000/svg',\r\n\t\t\t\tversion: '1.1',\r\n\t\t\t\twidth: isHorizontal() ? '100%' : options.style.width,\r\n\t\t\t\theight: options.style.height,\r\n\t\t\t},\r\n\t\t\t\t[\r\n\t\t\t\t\tCreateSVGElement( 'defs', {},\r\n\t\t\t\t\t\tCreateSVGElement( linearGradient, {\r\n\r\n\t\t\t\t\t\t\tid: 'gradient-hsv-' + uniqID,\r\n\t\t\t\t\t\t\tx1: isHorizontal() && options.direction ? '100%' : '0%',\r\n\t\t\t\t\t\t\ty1: !isHorizontal() && !options.direction ? '100%' : '0%',\r\n\t\t\t\t\t\t\tx2: isHorizontal() && !options.direction ? '100%' : '0%',\r\n\t\t\t\t\t\t\ty2: !isHorizontal() && options.direction ? '100%' : '0%',\r\n\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tpalette.getPalette()\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t),\r\n\t\t\t\t\tCreateSVGElement( 'rect', { x: '0', y: '0', width: '100%', height: '100%', fill: 'url(#gradient-hsv-' + uniqID + ')' } )\r\n\t\t\t\t]\r\n\t\t\t);\r\n\t\t\tif ( slideIndicator !== undefined ) {\r\n\r\n\t\t\t\tslide.style.cursor = isHorizontal() ? 'e-resize' : 's-resize';\r\n\t\t\t\tslideIndicator.style.cursor = slide.style.cursor;\r\n\r\n\t\t\t}\r\n\t\t} catch ( e ) {\r\n\r\n\t\t\t//I can not get \r\n\t\t\t// slide.querySelector( linearGradient );\r\n\t\t\t//in Safari 5.1.7 browser for Windows\r\n\t\t\t//Instead I see the error message:\r\n\t\t\t// 'null' is not an object( evaluating 'hsvGradient.id = 'gradient - hsv - ' + uniqID' )\r\n\t\t\tconsole.error( 'Create SVG element failed! ' + e.message );\r\n\r\n\t\t}\r\n\r\n\t\telSliderWrapper.appendChild( slide );\r\n\t\telSliderWrapper.style.height = getSlideHeight() + 'px'; \r\n\r\n\t\tif ( slideIndicator !== undefined ) {\r\n\r\n\t\t\tif ( isHorizontal() )\r\n\t\t\t\tslideIndicator.style.height = ( parseInt( options.style.height ) - 2 ) + 'px';\r\n\t\t\telse slideIndicator.style.width = ( parseInt( options.style.width ) - 2 ) + 'px';\r\n\r\n\t\t\toptions.sliderIndicator.value = options.sliderIndicator.value || 0;\r\n\t\t\tsetValue( options.sliderIndicator.value );\r\n\r\n\t\t}\r\n\t\tuniqID++;\r\n\r\n\t} else {\r\n\r\n\t\tconsole.error( 'Under constraction' );\r\n\r\n\t}\r\n\r\n\tfunction mouseMove( mouse ) {\r\n\r\n\t\t//for IE\r\n\t\tmouse.x = parseInt( mouse.x );\r\n\t\tmouse.y = parseInt( mouse.y );\r\n\r\n\t\tvar position, size, value;\r\n\t\tif ( isHorizontal() ) {\r\n\r\n\t\t\tposition = mouse.x;\r\n\t\t\tsize = getSlideWidth() - 1;\r\n\r\n\t\t\tif ( position >= getSlideWidth() )\r\n\t\t\t\tposition = size;\r\n\t\t\tvalue = ( position * 100 ) / size;\r\n\t\t\tif ( !options.direction ) {\r\n\r\n\t\t\t\tvalue = 100 - value;\r\n\t\t\t\tposition = size - position;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tposition = mouse.y;\r\n\t\t\tsize = getSlideHeight() - 1;\r\n\r\n\t\t\tif ( position >= getSlideHeight() )\r\n\t\t\t\tposition = size;\r\n\t\t\tvalue = ( 1 - position / size ) * 100;\r\n\t\t\tif ( !options.direction ) {\r\n\r\n\t\t\t\tvalue = 100 - value;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tsetValue( value, position );\r\n\r\n\t}\r\n\tif ( slideIndicator !== undefined ) {\r\n\r\n\t\tvar mouseout = false;\r\n\r\n\t\t/**\r\n\t\t * Return click event handler for the slider.\r\n\t\t * Sets picker background color and calls options.sliderIndicator.callback if provided.\r\n\t\t */\r\n\t\tfunction slideListener() {\r\n\r\n\t\t\treturn function ( evt ) {\r\n\r\n\t\t\t\tif ( mouseout )\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tevt = evt || window.event;\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * Return mouse position relative to the element el.\r\n\t\t\t\t */\r\n\t\t\t\tfunction mousePosition( evt ) {\r\n\t\t\t\t\t// IE:\r\n\t\t\t\t\tif ( window.event && window.event.contentOverflow !== undefined ) {\r\n\t\t\t\t\t\treturn { x: window.event.offsetX, y: window.event.offsetY };\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Webkit:\r\n\t\t\t\t\tif ( evt.offsetX !== undefined && evt.offsetY !== undefined ) {\r\n\t\t\t\t\t\treturn { x: evt.offsetX, y: evt.offsetY };\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Firefox:\r\n\t\t\t\t\tvar wrapper = evt.target.parentNode.parentNode;\r\n\t\t\t\t\treturn { x: evt.layerX - wrapper.offsetLeft, y: evt.layerY - wrapper.offsetTop };\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmouseMove( mousePosition( evt ) );\r\n\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction addEventListener( element, event, listener ) {\r\n\r\n\t\t\tif ( element === null )\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif ( element.attachEvent ) {\r\n\r\n\t\t\t\telement.attachEvent( 'on' + event, listener );\r\n\r\n\t\t\t} else if ( element.addEventListener ) {\r\n\r\n\t\t\t\telement.addEventListener( event, listener, false );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\taddEventListener( slide, 'click', slideListener() );\r\n\r\n\t\t/**\r\n\t\t * @callback listener\r\n\t\t*/\r\n\r\n\t\t/**\r\n\t\t * Enable drag&drop color selection.\r\n\t\t * @param {object} ctx ColorPicker instance.\r\n\t\t * @param {listener} listener Function that will be called whenever mouse is dragged over the element with event object as argument.\r\n\t\t */\r\n\t\tfunction enableDragging( ctx, listener ) {\r\n\r\n\t\t\tvar element = slide;\r\n\r\n\t\t\t//Touchscreen support\r\n\r\n\t\t\taddEventListener( element, 'touchstart', function ( evt ) { } );\r\n\t\t\taddEventListener( element, 'touchmove', function ( evt ) {\r\n\r\n\t\t\t\tevt.preventDefault();\r\n\r\n\t\t\t\tvar rect = evt.srcElement.getBoundingClientRect(),\r\n\t\t\t\t\tx = ( evt.touches[0].clientX - rect.left ),\r\n\t\t\t\t\ty = ( evt.touches[0].clientY - rect.top );\r\n\t\t\t\tif ( x < 0 ) x = 0;\r\n\t\t\t\tif ( y < 0 ) y = 0;\r\n\t\t\t\tmouseMove( { x: x, y: y } );\r\n\r\n\t\t\t} );\r\n\t\t\taddEventListener( element, 'touchend', function ( evt ) {\r\n\r\n\r\n\t\t\t} );\r\n\r\n\t\t\t//mouse support\r\n\t\t\taddEventListener( element, 'mousedown', function ( evt ) {\r\n\r\n\t\t\t\tconst mouseup = 'mouseup', mousemove = 'mousemove';\r\n\t\t\t\tfunction onMouseUp() {\r\n\r\n\t\t\t\t\t//console.warn( mouseup );\r\n\t\t\t\t\tfunction removeEventListener( element, event, listener ) {\r\n\r\n\t\t\t\t\t\tif ( element === null )\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tif ( element.detachEvent ) {\r\n\r\n\t\t\t\t\t\t\telement.detachEvent( 'on' + event, listener );\r\n\r\n\t\t\t\t\t\t} else if ( element.removeEventListener ) {\r\n\r\n\t\t\t\t\t\t\telement.removeEventListener( event, listener, false );\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tremoveEventListener( window, mouseup, onMouseUp );\r\n\t\t\t\t\tremoveEventListener( window, mousemove, listener );\r\n\r\n\t\t\t\t}\r\n\t\t\t\taddEventListener( window, mouseup, onMouseUp );\r\n\t\t\t\taddEventListener( window, mousemove, listener );\r\n\r\n\t\t\t} );\r\n\t\t\taddEventListener( element, 'mouseout', function ( evt ) { mouseout = true; } );\r\n\t\t\taddEventListener( element, 'mouseover', function ( evt ) { mouseout = false; } );\r\n\t\t}\r\n\t\tenableDragging( this, slideListener() );\r\n\r\n\t}\r\n\r\n\treturn {\r\n\r\n\t\tsetValue: setValue,\r\n\r\n\t};\r\n}\r\n\r\nfunction CreateSVGElement( el, attrs, children ) {\r\n\r\n\tel = document.createElementNS( svgNS, el );\r\n\tfor ( var key in attrs )\r\n\t\tel.setAttribute( key, attrs[key] );\r\n\tif ( Object.prototype.toString.call( children ) != '[object Array]' ) children = [children];\r\n\tvar i = 0, len = ( children[0] && children.length ) || 0;\r\n\tfor ( ; i < len; i++ )\r\n\t\tel.appendChild( children[i] );\r\n\treturn el;\r\n}\r\n\r\n/**\r\n * create palette\r\n * @param {object} [options] followed options is available\r\n * @param {paletteIndexes|object[]} [options.palette] Palette index or palette array. The following indexes are available:\r\n * <pre>\r\n * paletteIndexes.BGRW: 0 - blue, green, red, white palette.\r\n * paletteIndexes.monochrome: 1,\r\n * paletteIndexes.bidirectional: 2,//red, black, green\r\n * paletteIndexes.rainbow: 3,\r\n * Default is paletteIndexes.BGRW index.\r\n * Example of palette array:\r\n[\r\n\t{ percent: 0, r: 0, g: 0, b: 0, },\r\n\t{ percent: 10, r: 0xff, g: 255, b: 0xff, },\r\n\t{ percent: 100, r: 0xff, g: 255, b: 0xff, },\r\n]\r\n* </pre>\r\n*/\r\nfunction Palette( options ) {\r\n\r\n\tfunction paletteitem( percent, r, g, b ) {\r\n\r\n\t\treturn {\r\n\r\n\t\t\tpercent: percent,\r\n\t\t\tr: r,\r\n\t\t\tg: g,\r\n\t\t\tb: b,\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\toptions = options || {};\r\n\tif ( options.palette === undefined )\r\n\t\toptions.palette = paletteIndexes.BGRW;\r\n\r\n\tvar arrayPalette = [\r\n\r\n\t\tnew paletteitem( 0, 0x00, 0x00, 0xFF ),//blue\r\n\t\tnew paletteitem( 33, 0x00, 0xFF, 0x00 ),//green\r\n\t\tnew paletteitem( 66, 0xFF, 0xFF, 0x00 ),//red\r\n\t\tnew paletteitem( 100, 0xFF, 0xFF, 0xFF ),//white\r\n\r\n\t];\r\n\tswitch ( typeof options.palette ) {\r\n\r\n\t\tcase 'number':\r\n\t\t\tswitch ( options.palette ) {\r\n\r\n\t\t\t\tcase paletteIndexes.BGRW:\r\n\t\t\t\t\tbreak;//default palette\r\n\t\t\t\tcase paletteIndexes.monochrome:\r\n\t\t\t\t\tvar arrayPalette = [\r\n\r\n\t\t\t\t\t\tnew paletteitem( 0, 0x00, 0x00, 0x00 ),//blach\r\n\t\t\t\t\t\tnew paletteitem( 100, 0xFF, 0xFF, 0xFF ),//white\r\n\r\n\t\t\t\t\t];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase paletteIndexes.bidirectional:\r\n\t\t\t\t\tvar arrayPalette = [\r\n\t\t\t\t\t\tnew paletteitem( 0, 0xff, 0x30, 0x30 ),//red\r\n\t\t\t\t\t\tnew paletteitem( 50, 0x30, 0x30, 0x30 ),//gray\r\n\t\t\t\t\t\tnew paletteitem( 100, 0x30, 0xFF, 0x30 ),//green\r\n\r\n\t\t\t\t\t];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase paletteIndexes.rainbow:\r\n\t\t\t\t\tvar arrayPalette = [\r\n\r\n\t\t\t\t\t\tnew paletteitem( 0, 0xff, 0x32, 0x32 ),\r\n\t\t\t\t\t\tnew paletteitem( 16, 0xfc, 0xf5, 0x28 ),\r\n\t\t\t\t\t\tnew paletteitem( 32, 0x28, 0xfc, 0x28 ),\r\n\t\t\t\t\t\tnew paletteitem( 50, 0x28, 0xfc, 0xf8 ),\r\n\t\t\t\t\t\tnew paletteitem( 66, 0x27, 0x2e, 0xf9 ),\r\n\t\t\t\t\t\tnew paletteitem( 82, 0xff, 0x28, 0xfb ),\r\n\t\t\t\t\t\tnew paletteitem( 100, 0xff, 0x32, 0x32 ),\r\n\r\n\t\t\t\t\t];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault: console.error( 'ColorPicker.create.Palette: invalid options.palette = ' + options.palette );\r\n\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase \"object\":\r\n\t\t\tif ( Array.isArray( options.palette ) ) {\r\n\r\n\t\t\t\t//Custom palette\r\n\t\t\t\tarrayPalette = options.palette;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\t\tdefault:\r\n\t\t\tvar message = 'invalid options.palette = ' + options.palette;\r\n\t\t\tconsole.error( 'ColorPicker.create.Palette: ' + message );\r\n\t\t\toptions.onError( message );\r\n\r\n\t}\r\n\t/**\r\n\t* returns palette array.\r\n\t* @function Palette.\r\n\t* getPalette\r\n\t* @returns {object[]} palette array\r\n\t*/\r\n\tthis.getPalette = function () {\r\n\r\n\t\tconst palette = [];\r\n\t\tarrayPalette.forEach( function ( item ) {\r\n\r\n\t\t\tpalette.unshift( CreateSVGElement( 'stop', {\r\n\r\n\t\t\t\toffset: ( 100 - item.percent ) + '%', 'stop-color': '#'\r\n\t\t\t\t\t//Thanks to https://stackoverflow.com/a/13240395/5175935\r\n\t\t\t\t\t+ ( \"0\" + ( Number( item.r ).toString( 16 ) ) ).slice( -2 ).toUpperCase()\r\n\t\t\t\t\t+ ( \"0\" + ( Number( item.g ).toString( 16 ) ) ).slice( -2 ).toUpperCase()\r\n\t\t\t\t\t+ ( \"0\" + ( Number( item.b ).toString( 16 ) ) ).slice( -2 ).toUpperCase(),\r\n\t\t\t\t'stop-opacity': '1'\r\n\r\n\t\t\t} ) );\r\n\r\n\t\t} );\r\n\t\treturn palette;\r\n\r\n\t}\r\n\t/**\r\n\t* converts a percent or value from min to max  to object with r, g, b, hex and percent.\r\n\t* @function Palette.\r\n\t* hsv2rgb\r\n\t* @param {number} stringPercent coordinate of color from palette in percent or value from min to max\r\n\t* @param {number} [min] min stringPercent. Default is undefined.\r\n\t* @param {number} [max] max stringPercent. Default is undefined.\r\n\t* @returns {object} object with r, g, b, hex and percent\r\n\t*/\r\n\tthis.hsv2rgb = function ( stringPercent, min, max ) {\r\n\r\n\t\tvar percent = parseFloat( stringPercent );\r\n\t\tif ( min !== undefined && max !== undefined )\r\n\t\t\tpercent = ( 100 / ( max - min ) ) * ( percent - min );\r\n\t\tvar lastPalette = arrayPalette[arrayPalette.length - 1];\r\n\t\tif ( lastPalette.percent !== 100 ) {\r\n\r\n\t\t\t//not compatible with Safari for Windows\r\n\t\t\t//var lastItem = Object.assign( {}, arrayPalette[arrayPalette.length - 1] );\r\n\r\n\t\t\tconst lastItem = {};\r\n\t\t\tObject.keys( lastPalette ).forEach( function ( key ) {\r\n\r\n\t\t\t\tlastItem[key] = lastPalette[key];\r\n\r\n\t\t\t} );\r\n\t\t\tlastItem.percent = 100;\r\n\t\t\tarrayPalette.push( lastItem );\r\n\r\n\t\t}\r\n\t\tvar itemPrev;\r\n\t\tfor ( var i = 0; i < arrayPalette.length; i++ ) {\r\n\r\n\t\t\tconst item = arrayPalette[i];\r\n\t\t\tif ( itemPrev === undefined )\r\n\t\t\t\titemPrev = item;\r\n\t\t\tif ( ( ( percent >= itemPrev.percent ) && ( percent <= item.percent ) ) ) {\r\n\r\n\t\t\t\tfunction color( percentPrev, prev, percentItem, item ) {\r\n\r\n\t\t\t\t\tvar percentD = percentItem - percentPrev;\r\n\t\t\t\t\tif ( percentD === 0 )\r\n\t\t\t\t\t\treturn prev;\r\n\t\t\t\t\treturn Math.round( prev + ( ( item - prev ) / percentD ) * ( percent - percentPrev ) );\r\n\r\n\t\t\t\t}\r\n\t\t\t\tconst r = color( itemPrev.percent, itemPrev.r, item.percent, item.r ),\r\n\t\t\t\t\tg = color( itemPrev.percent, itemPrev.g, item.percent, item.g ),\r\n\t\t\t\t\tb = color( itemPrev.percent, itemPrev.b, item.percent, item.b );\r\n\t\t\t\treturn {\r\n\r\n\t\t\t\t\tr: r,\r\n\t\t\t\t\tg: g,\r\n\t\t\t\t\tb: b,\r\n\t\t\t\t\thex: \"#\" + ( 16777216 | b | ( g << 8 ) | ( r << 16 ) ).toString( 16 ).slice( 1 ),\r\n\t\t\t\t\tpercent: percent\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t}\r\n\t\t\titemPrev = item;\r\n\r\n\t\t}\r\n\t\tif ( options.onError !== undefined )\r\n\t\t\toptions.onError( 'Invalid color value of the ColorPicker: ' + stringPercent );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* converts a value in percentages to color.\r\n\t* @function Palette.\r\n\t* toColor\r\n\t* @param {number} value coordinate of color from palette in percent\r\n\t* @param {number} min\r\n\t* @param {number} max\r\n\t* @returns {THREE.Color} color\r\n\t*/\r\n\tthis.toColor = function ( value, min, max ) {\r\n\r\n\t\tif ( typeof THREE === 'undefined' ){\r\n\r\n\t\t\tconsole.error( 'Call ColorPicker.palette.setTHREE(THREE) first.' );\r\n\t\t\treturn;\r\n\t\t\t\r\n\t\t}\r\n\t\tif ( value instanceof THREE.Color )\r\n\t\t\treturn value;\r\n\t\tvar c = this.hsv2rgb( value, min, max );\r\n\t\tif ( c === undefined )\r\n\t\t\tc = { r: 255, g: 255, b: 255 }\r\n\t\treturn new THREE.Color( \"rgb(\" + c.r + \", \" + c.g + \", \" + c.b + \")\" );\r\n\r\n\t}\r\n\r\n}\r\n\r\nvar THREE;\r\n/**\r\n * set THREE\r\n * @function Palette.\r\n * setTHREE\r\n * @param {THREE} _THREE {@link https://github.com/anhr/three.js|THREE}\r\n */\r\nPalette.setTHREE = function ( _THREE ) {\r\n\r\n\tif ( THREE ) {\r\n\r\n\t\tif ( !Object.is( THREE, _THREE ) )\r\n\t\t\tconsole.error( 'Palette.setTHREE: duplicate THREE. Please use one instance of the THREE library.' )\r\n\t\treturn;\r\n\r\n\t}\r\n\tTHREE = _THREE;\r\n\r\n}\r\nexport { paletteIndexes, create, Palette };\r\n","﻿/**\r\n * @module ColorPicker\r\n * @description Pure JavaScript color picker.\r\n * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/\r\n *\r\n * Thanks to https://github.com/DavidDurman/FlexiColorPicker\r\n *\r\n * @copyright 2011 Data Arts Team, Google Creative Lab\r\n *\r\n * @license under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n */\r\n\r\nimport { create, paletteIndexes, Palette } from './index.js';\r\n/**\r\n * pure JavaScript color picker without using images, external CSS or 1px divs.\r\n */\r\nvar ColorPicker = {\r\n\r\n\tcreate: create,\r\n\tpaletteIndexes: paletteIndexes,\r\n\tpalette: Palette,\r\n\r\n}\r\nexport default ColorPicker;\r\n","/**\r\n * @module Player\r\n * @description 3D objects animation.\r\n * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}\r\n * @copyright 2011 Data Arts Team, Google Creative Lab\r\n *\r\n * @license under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n */\r\n\r\n//import cookie from '../../../cookieNodeJS/master/cookie.js';\r\n//import cookie from 'https://raw.githack.com/anhr/cookieNodeJS/master/cookie.js';\r\n/*\r\nimport ScaleController from '../ScaleController.js';\r\nimport PositionController from '../PositionController.js';\r\nimport { dat } from '../dat/dat.module.js';\r\n*/\r\n\r\nimport { GuiSelectPoint, getObjectPosition } from '../guiSelectPoint/guiSelectPoint.js';\r\n//import { GuiSelectPoint, getObjectPosition } from 'https://raw.githack.com/anhr/commonNodeJS/master/guiSelectPoint/guiSelectPoint.js';\r\n\r\nimport ColorPicker from '../../../colorpicker/master/colorpicker.js';//https://github.com/anhr/colorPicker\r\n//import ColorPicker from 'https://raw.githack.com/anhr/colorpicker/master/colorpicker.js';\r\n//ColorPicker.palette.setTHREE( THREE );\r\n\r\nvar settings;\r\n\r\n/**\r\n * @callback onSelectScene\r\n * @param {number} index current index of the scene of the animation\r\n */\r\n\r\n/**\r\n * @callback onChangeScaleT\r\n * @param {object} scale the updated time settings\r\n */\r\n\r\n/**\r\n * 3D objects animation.\r\n * @param {object} options followed options is available\r\n * @param {number} [options.settings] time settings.\r\n * @param {number} [options.settings.marks] Number of scenes of 3D objects animation. Default is 2\r\n * @param {boolean} [options.settings.repeat] true - Infinitely repeating 3D objects animation. Default is false.\r\n * @param {number} [options.settings.zoomMultiplier] zoom multiplier of the time. Default is 1.1.\r\n * @param {number} [options.settings.offset] offset of the time. Default is 0.1.\r\n * @param {number} [options.settings.min] Animation start time. Default is 0.\r\n * @param {number} [options.settings.max] Animation end time. Default is 1.\r\n * @param {onChangeScaleT} [options.onChangeScaleT] event. User has updated the time settings.\r\n * @param {object} [options.cookie] Your custom cookie function for saving and loading of the Player settings. Default cookie is not saving settings.\r\n * @param {onSelectScene} onSelectScene event of the changing of scene during animation\r\n */\r\nfunction Player( options, onSelectScene ) {\r\n\r\n\tsettings = options.settings || {};\r\n/*\t\r\n\toptions.min = options.min || 0;\r\n\toptions.max = options.max || 1;\r\n\toptions.marks = options.marks || 2;\r\n\toptions.repeat = options.repeat || false;\r\n\toptions.interval = options.interval || 25;\r\n//\toptions.controllers = [];\r\n*/\r\n\tsettings.min = settings.min || 0;\r\n\tsettings.max = settings.max || 1;\r\n\tsettings.marks = settings.marks || 2;\r\n\tsettings.repeat = settings.repeat || false;\r\n\tsettings.interval = settings.interval || 25;\r\n\tsettings.zoomMultiplier = settings.zoomMultiplier || 1.1;\r\n\tsettings.offset = settings.offset || 0.1;\r\n/*\r\n\tconst axesDefault = JSON.parse( JSON.stringify( settings ) );\r\n\tObject.freeze( axesDefault );\r\n\r\n\toptions.cookie = options.cookie || new cookie.defaultCookie();\r\n*/\r\n\tvar selectSceneIndex = 0,//-1;\r\n\t\t_this = this;\r\n\r\n\tfunction getTime() { return ( ( settings.max - settings.min ) / ( settings.marks - 1 ) ) * selectSceneIndex + settings.min; }\r\n\r\n\t/**\r\n\t * select scene for playing\r\n\t * @param {number} index of the scene. Between 0 and settings.marks - 1\r\n\t */\r\n\tthis.selectScene = function( index ) {\r\n\r\n\t\tif ( index >= settings.marks )\r\n\t\t\tindex = 0;\r\n\t\telse if ( index < 0 )\r\n\t\t\tindex = settings.marks - 1;\r\n\t\tif( selectSceneIndex > settings.marks )\r\n\t\t\tselectSceneIndex = settings.marks;\r\n\t\twhile ( selectSceneIndex !== index ) {\r\n\t\t\tif ( selectSceneIndex < index )\r\n\t\t\t\tselectSceneIndex++;\r\n\t\t\telse selectSceneIndex--;\r\n\t\t\tonSelectScene( selectSceneIndex, getTime() );\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Go to next object 3D\r\n\t */\r\n\tthis.next = function() {\r\n\r\n\t\t_this.selectScene( selectSceneIndex + 1 );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Go to previous object 3D\r\n\t */\r\n\tthis.prev = function () {\r\n\r\n\t\t_this.selectScene( selectSceneIndex - 1 );\r\n\r\n\t}\r\n\tthis.pushController = function ( controller ) {\r\n\r\n\t\tif ( ( controller.object !== undefined ) && ( controller.object.playRate !== undefined ) )\r\n\t\t\tcontroller.object.playRate = settings.interval;\r\n\t\tcontrollers.push( controller );\r\n\r\n\t}\r\n\r\n\t//Play/Pause\r\n\r\n\tthis.controllers = [];\r\n\tvar playing = false, controllers = this.controllers, time, timeNext;\r\n//\t\tcookie = options.cookie, cookieName = 'Player' + ( options.cookieName || '' );\r\n\r\n//\toptions.cookie.getObject( cookieName, settings, settings );\r\n\r\n\tfunction RenamePlayButtons() {\r\n\r\n\t\tcontrollers.forEach( function ( controller ) {\r\n\r\n\t\t\tcontroller.onRenamePlayButtons( playing );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tfunction play() {\r\n\r\n\t\tif ( ( selectSceneIndex === -1 ) || ( selectSceneIndex === settings.marks ) ) {\r\n\r\n\t\t\tselectSceneIndex = 0;\r\n\r\n\t\t}\r\n\t\tonSelectScene( selectSceneIndex, getTime() );\r\n\r\n\t}\r\n\r\n\tfunction pause() {\r\n\r\n\t\tplaying = false;\r\n\t\tRenamePlayButtons();\r\n\r\n\t\ttime = undefined;\r\n\r\n\t}\r\n\tfunction isRepeat() {\r\n\r\n\t\treturn settings.repeat;\r\n\r\n\t}\r\n\r\n\tfunction playNext() {\r\n\r\n\t\tselectSceneIndex++;\r\n\t\tif ( selectSceneIndex >= settings.marks ) {\r\n\r\n\t\t\tif ( isRepeat() )\r\n\t\t\t\tselectSceneIndex = 0;\r\n\t\t\telse {\r\n\r\n\t\t\t\tpause();\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tplay();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Animation of 3D object\r\n\t * call from function animate()\r\n\t */\r\n\tthis.animate = function () {\r\n\r\n\t\tif ( time === undefined )\r\n\t\t\treturn;\r\n\t\tvar timeCur = new Date().getTime();\r\n\t\tif ( isNaN( timeNext ) )\r\n\t\t\tconsole.error( 'Player.animate: timeNext = ' + timeNext );\r\n\t\tif ( timeCur < timeNext )\r\n\t\t\treturn;\r\n\t\twhile ( timeCur > timeNext ) timeNext += 1000 / settings.interval;\r\n\t\tplayNext();\r\n\r\n\t}\r\n\t/**\r\n\t * User has clicked the Play ► / Pause ❚❚ button\r\n\t */\r\n\tthis.play3DObject = function() {\r\n\r\n\t\tif ( playing ) {\r\n\r\n\t\t\tpause();\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tplaying = true;\r\n\t\tif ( selectSceneIndex >= settings.marks )\r\n\t\t\tselectSceneIndex = -1;\r\n\t\tplayNext();\r\n\t\tRenamePlayButtons();\r\n\t\tcontrollers.forEach( function ( controller ) {\r\n\r\n\t\t\tif ( controller.controller !== undefined ) {\r\n\r\n\t\t\t\tsettings.interval = controller.controller.getValue();\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\t\ttime = new Date().getTime();\r\n\t\ttimeNext = time + 1000 / settings.interval;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * User has clicked the repeat ⥀ button\r\n\t */\r\n\tthis.repeat = function () {\r\n\r\n\t\tsettings.repeat = !settings.repeat;\r\n\t\tthis.onChangeRepeat( settings.repeat );\r\n\r\n\t}\r\n\r\n\tthis.getOptions = function () { return options; }\r\n\tthis.getSettings = function () { return options.settings; }\r\n\tthis.getSelectSceneIndex = function () { return selectSceneIndex; }\r\n\r\n\r\n\tfunction setSettings() {\r\n\r\n\t\tcookie.setObject( cookieName, options.settings );\r\n\t\toptions.onChangeScaleT( options.settings );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * User has changed the rate of changing of animation scenes per second.\r\n\t * @param {number} value new rate\r\n\t */\r\n\tthis.onChangeTimerId = function ( value ) {\r\n\r\n\t\tsettings.interval = value;\r\n\t\tsetSettings();\r\n//\t\toptions.cookie.setObject( cookieName, settings );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Event of the changing of the rate of changing of animation scenes per second.\r\n\t * @param {number} value new rate\r\n\t */\r\n\tthis.onChangeRepeat = function ( value ) {\r\n\r\n\t\tsettings.repeat = value;\r\n\t\tthis.controllers.forEach( function ( controller ) {\r\n\r\n\t\t\tcontroller.onChangeRepeat();\r\n\r\n\t\t} );\r\n\r\n\t}\r\n/*\r\n\tthis.gui = function ( folder, getLanguageCode ) {\r\n\r\n//\t\tsettings.t = scalesT;\r\n\r\n\t\t//Localization\r\n\r\n\t\tvar lang = {\r\n\r\n\t\t\tplayer: 'Player',\r\n\t\t\tplayerTitle: '3D objects animation.',\r\n\r\n\t\t\tmin: 'Min',\r\n\t\t\tmax: 'Max',\r\n\r\n\t\t\tmarks: 'Frames',\r\n\t\t\tmarksTitle: 'Player frames count',\r\n\r\n\t\t\tdefaultButton: 'Default',\r\n\t\t\tdefaultTitle: 'Restore default player settings.',\r\n\r\n\t\t};\r\n\r\n\t\tvar languageCode = getLanguageCode === undefined ? 'en'//Default language is English\r\n\t\t\t: getLanguageCode();\r\n\t\tswitch ( languageCode ) {\r\n\r\n\t\t\tcase 'ru'://Russian language\r\n\r\n\t\t\t\tlang.player = 'Проигрыватель';\r\n\t\t\t\tlang.playerTitle = 'Анимация 3D объектов.';\r\n\r\n\t\t\t\tlang.min = 'Минимум';\r\n\t\t\t\tlang.max = 'Максимум';\r\n\r\n\t\t\t\tlang.marks = 'Кадры';\r\n\t\t\t\tlang.marksTitle = 'Количество кадров проигрывателя';\r\n\r\n\t\t\t\tlang.defaultButton = 'Восстановить';\r\n\t\t\t\tlang.defaultTitle = 'Восстановить настройки проигрывателя по умолчанию.';\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tdefault://Custom language\r\n\t\t\t\tif ( ( options.lang === undefined ) || ( options.lang.languageCode != languageCode ) )\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tObject.keys( options.lang ).forEach( function ( key ) {\r\n\r\n\t\t\t\t\tif ( lang[key] === undefined )\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\tlang[key] = options.lang[key];\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tvar fPlayer = folder.addFolder( lang.player );\r\n\t\tdat.folderNameAndTitle( fPlayer, lang.player, lang.playerTitle );\r\n\r\n\t\tvar playController = this.PlayController;\r\n\r\n\t\tfunction scale() {\r\n\r\n\t\t\tvar axes = options.settings, scaleControllers = {};\r\n\t\t\tfunction onclick( customController, action ) {\r\n\r\n\t\t\t\tvar zoom = customController.controller.getValue();\r\n\r\n\t\t\t\taxes.min = action( axes.min, zoom );\r\n\t\t\t\t//\t\t\t\t\t\taxes.min *= zoom;\r\n\t\t\t\tscaleControllers.min.setValue( axes.min );\r\n\r\n\t\t\t\taxes.max = action( axes.max, zoom );\r\n\t\t\t\t//\t\t\t\t\t\taxes.max *= zoom;\r\n\t\t\t\tscaleControllers.max.setValue( axes.max );\r\n\t\t\t\tsetSettings();\r\n\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\tscaleControllers.folder = fPlayer.addFolder( axes.name );\r\n\r\n//\t\t\tlet {default: ScaleController }  = await import('../../commonNodeJS/master/ScaleController.js');\r\n\t\t\tscaleControllers.scaleController = scaleControllers.folder.add( new ScaleController( onclick, \r\n\t\t\t\t{ settings: options.settings, getLanguageCode: getLanguageCode, } ) ).onChange( function ( value ) {\r\n\r\n\t\t\t\taxes.zoomMultiplier = value;\r\n//\t\t\t\toptions.cookie.setObject( cookieName, options.scales );\r\n\t\t\t\tsetSettings();\r\n\r\n\t\t\t} );\r\n\r\n//\t\t\tlet {default: PositionController }  = await import('../../commonNodeJS/master/PositionController.js');\r\n\t\t\tvar positionController = new PositionController( function ( shift ) {\r\n\r\n\t\t\t\t//\t\t\tconsole.warn( 'shift = ' + shift );\r\n\t\t\t\tonclick( positionController, function ( value, zoom ) {\r\n\r\n\t\t\t\t\tvalue += shift;//zoom;\r\n\t\t\t\t\treturn value;\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}, { settings: options.settings, getLanguageCode: getLanguageCode, } );\r\n\t\t\tscaleControllers.positionController = scaleControllers.folder.add( positionController ).onChange( function ( value ) {\r\n\r\n//\t\t\t\taxes.positionOffset = value;\r\n\t\t\t\taxes.offset = value;\r\n//\t\t\t\toptions.cookie.setObject( cookieName, options.scales );\r\n\t\t\t\tsetSettings();\r\n\r\n\t\t\t} );\r\n\r\n\t\t\t//min\r\n\t\t\tscaleControllers.min = dat.controllerZeroStep( scaleControllers.folder, axes, 'min', function ( value ) {\r\n\r\n\t\t\t\tsetSettings();\r\n\r\n\t\t\t} );\r\n\t\t\tdat.controllerNameAndTitle( scaleControllers.min, lang.min );\r\n\r\n\t\t\t//max\r\n\t\t\tscaleControllers.max = dat.controllerZeroStep( scaleControllers.folder, axes, 'max', function ( value ) {\r\n\r\n\t\t\t\tsetSettings();\r\n\r\n\t\t\t} );\r\n\t\t\tdat.controllerNameAndTitle( scaleControllers.max, lang.max );\r\n\r\n\t\t\t//marks\r\n\t\t\tif ( axes.marks !== undefined ) {\r\n\r\n\t\t\t\tscaleControllers.marks = dat.controllerZeroStep( scaleControllers.folder, axes, 'marks', function ( value ) {\r\n\r\n\t\t\t\t\tsetSettings();\r\n\r\n\t\t\t\t} );\r\n\t\t\t\tdat.controllerNameAndTitle( scaleControllers.marks, axes.marksName === undefined ? lang.marks : axes.marksName,\r\n\t\t\t\t\taxes.marksTitle === undefined ? lang.marksTitle : axes.marksTitle );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//Default button\r\n\t\t\tdat.controllerNameAndTitle( scaleControllers.folder.add( {\r\n\r\n\t\t\t\tdefaultF: function ( value ) {\r\n\r\n//\t\t\t\t\tplayController._controller.setValue( axesDefault.interval );\r\n\t\t\t\t\tplayController.setValue( axesDefault.interval );\r\n\t\t\t\t\t\r\n\t\t\t\t\taxes.zoomMultiplier = axesDefault.zoomMultiplier;\r\n\t\t\t\t\tscaleControllers.scaleController.setValue( axes.zoomMultiplier );\r\n\r\n\t\t\t\t\taxes.offset = axesDefault.offset;\r\n\t\t\t\t\tscaleControllers.positionController.setValue( axes.offset );\r\n\r\n\t\t\t\t\taxes.min = axesDefault.min;\r\n\t\t\t\t\tscaleControllers.min.setValue( axes.min );\r\n\r\n\t\t\t\t\taxes.max = axesDefault.max;\r\n\t\t\t\t\tscaleControllers.max.setValue( axes.max );\r\n\r\n\t\t\t\t\tif ( axesDefault.marks !== undefined ) {\r\n\r\n\t\t\t\t\t\taxes.marks = axesDefault.marks;\r\n\t\t\t\t\t\tscaleControllers.marks.setValue( axes.marks );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsetSettings();\r\n\r\n//\t\t\t\t\tonchangeWindowRange( windowRange, axes );\r\n\r\n\t\t\t\t},\r\n\r\n\t\t\t}, 'defaultF' ), lang.defaultButton, lang.defaultTitle );\r\n\r\n\t\t}\r\n\t\tscale();\r\n\r\n\t}\r\n*/\r\n}\r\n/**\r\n * execute function\r\n * @function Player.\r\n * execFunc\r\n * @param {THREE.Vector4} funcs\r\n * @param {string} axisName axis name\r\n * @param {number} t time\r\n * @param {number} a multiplier. Second parameter of the arrayFuncs item function. Default is 1.\r\n * @param {number} b addendum. Third parameter of the arrayFuncs item function. Default is 0.\r\n */\r\nPlayer.execFunc = function ( funcs, axisName, t, a, b ) {\r\n\r\n\ta = a || 1;\r\n\tb = b || 0;\r\n\tvar func = funcs[axisName], typeofFuncs = typeof func;\r\n\tswitch ( typeofFuncs ) {\r\n\r\n\t\tcase \"undefined\":\r\n\t\t\treturn undefined;\r\n\t\tcase \"function\":\r\n\t\t\treturn func( t, a, b );\r\n\t\tcase \"number\":\r\n\t\t\treturn func;\r\n\t\tcase \"object\":\r\n\t\t\tif ( Array.isArray( func ) ) {\r\n\r\n\t\t\t\tif ( func.length === 0 ) {\r\n\r\n\t\t\t\t\tconsole.error( 'Player.execFunc: funcs[\"' + axisName + '\"] array is empty' );\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\t\t\t\tvar a = func,\r\n\t\t\t\t\tl = func.length - 1,\r\n\t\t\t\t\tmax = options.player.max,\r\n\t\t\t\t\tmin = options.player.min,\r\n\t\t\t\t\ttStep = ( max - min ) / l,\r\n\t\t\t\t\ttStart = min, tStop = max,\r\n\t\t\t\t\tiStart = 0, iStop = l;\r\n\t\t\t\tfor ( var i = 0; i < func.length; i++ ) {\r\n\r\n\t\t\t\t\tif ( tStep * i + min < t ) {\r\n\r\n\t\t\t\t\t\tiStart = i;\r\n\t\t\t\t\t\tiStop = i + 1;\r\n\t\t\t\t\t\ttStart = tStep * iStart + min;\r\n\t\t\t\t\t\ttStop = tStep * iStop + min;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\tfunction execW( i ) {\r\n\r\n\t\t\t\t\tif ( typeof a[i] === \"function\" )\r\n\t\t\t\t\t\treturn a[i]( t, a, b );\r\n\t\t\t\t\tif ( a[i] instanceof THREE.Color )\r\n\t\t\t\t\t\treturn a[i];\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif ( typeof a[iStart] !== \"number\" ) {\r\n\r\n\t\t\t\t\tif ( axisName === 'w' ) {\r\n\r\n\t\t\t\t\t\treturn execW( iStart );\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconsole.error( 'Player.execFunc: funcs[\"' + axisName + '\"] array item ' + iStart + ' typeof = ' + ( typeof a[iStart] ) + ' is not number' );\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif ( typeof a[iStop] !== \"number\" ) {\r\n\r\n\t\t\t\t\tif ( axisName === 'w' )\r\n\t\t\t\t\t\treturn execW( iStop );\r\n\t\t\t\t\tconsole.error( 'Player.execFunc: funcs[\"' + axisName + '\"] array item ' + iStop + ' typeof = ' + ( typeof a[iStop] ) + ' is not number' );\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\t\t\t\tvar x = ( a[iStop] - a[iStart] ) / ( tStop - tStart ),\r\n\t\t\t\t\ty = a[iStart] - x * tStart;\r\n\t\t\t\treturn x * t + y;\r\n\r\n\t\t\t}\r\n\t\t\tif ( func.func ) {\r\n\r\n\t\t\t\treturn func.func( t, a, b );\r\n\r\n\t\t\t}\r\n\t\t\tif ( axisName !== 'w' )\r\n\t\t\t\tconsole.error( 'Player.execFunc: funcs[\"' + axisName + '\"] object is not array' );\r\n\t\t\treturn;\r\n\t\tdefault:\r\n\t\t\tconsole.error( 'Player.execFunc: Invalud typeof funcs[\"' + axisName + '\"]: ' + typeofFuncs );\r\n\t}\r\n\treturn;\r\n\r\n}\r\n\r\nconst paletteDefault = new ColorPicker.palette();\r\n\r\n/**\r\n * select a scene for playing\r\n * @function Player.\r\n * selectPlayScene\r\n * @param {THREE} THREE {@link https://github.com/anhr/three.js|THREE}\r\n * @param {THREE.Group} group [THREE.Group]{@link https://threejs.org/docs/index.html#api/en/objects/Group}\r\n * @param {number} t time\r\n * @param {number} index index of the time.\r\n * @param {object} [options] followed options is available\r\n * @param {boolean} [options.boPlayer] true - is not select play scene for mesh.userData.boFrustumPoints = true. Default is false.\r\n * @param {number} [options.a] multiplier. Second parameter of the arrayFuncs item function. Default is 1.\r\n * @param {number} [options.b] addendum. Third parameter of the arrayFuncs item function. Default is 0.\r\n * @param {object} [options.scales] axes scales. See {@link https://raw.githack.com/anhr/AxesHelper/master/jsdoc/module-AxesHelper.html|AxesHelper}. Default is {}\r\n * @param {object} [options.palette] See [ColorPicker.palette]{@link https://raw.githack.com/anhr/colorPicker/master/jsdoc/module-ColorPicker.html#~Palette}.\r\n * <pre>\r\n * Default is\r\n * new ColorPicker.palette();//palette: ColorPicker.paletteIndexes.BGRW \r\n * Example:\r\n * new ColorPicker.palette( { palette: ColorPicker.paletteIndexes.bidirectional } );\r\n * </pre>\r\n * @param {object} [options.guiSelectPoint] See [GuiSelectPoint]{@link https://raw.githack.com/anhr/commonNodeJS/master/guiSelectPoint/jsdoc/module-GuiSelectPoint.html#~GuiSelectPoint}.\r\n * <pre>\r\n * Example:\r\n * new GuiSelectPoint();\r\n * </pre>\r\n */\r\nPlayer.selectPlayScene = function ( THREE, group, t, index, options ) {\r\n\r\n\toptions.boPlayer = options.boPlayer || false;\r\n\r\n\toptions = options || {};\r\n\r\n\toptions.a = options.a || 1;\r\n\toptions.b = options.b || 0;\r\n\r\n\toptions.palette = options.palette || paletteDefault;\r\n\r\n\toptions.scales = options.scales || {};\r\n\t\r\n\tgroup.userData.t = t;\r\n\tgroup.children.forEach( function ( mesh ) {\r\n\r\n\t\tif (\r\n\r\n\t\t\t( mesh.userData.selectPlayScene === undefined ) ||\r\n\t\t\t( options.boPlayer && mesh.userData.boFrustumPoints )\r\n\r\n\t\t)\r\n\t\t\treturn;\r\n\r\n\t\t//Эти строки нужны что бы появлялся текст возле точки, если на нее наведена мышка\r\n\t\t//при условии, что до этого точка была передвинута с помошью проигрывателя.\r\n\t\tdelete mesh.geometry.boundingSphere;\r\n\t\tmesh.geometry.boundingSphere = null;\r\n\r\n\t\tmesh.userData.selectPlayScene( t );\r\n\t\tfunction setAttributes( a, b ) {\r\n\r\n\t\t\tvar attributes = mesh.geometry.attributes,\r\n\t\t\t\tarrayFuncs = mesh.userData.arrayFuncs;\r\n\t\t\tif ( arrayFuncs === undefined )\r\n\t\t\t\treturn;\r\n\t\t\tif ( t === undefined )\r\n\t\t\t\tconsole.error( 'setPosition: t = ' + t );\r\n\r\n\t\t\tfor ( var i = 0; i < arrayFuncs.length; i++ ) {\r\n\r\n\t\t\t\tvar funcs = arrayFuncs[i], needsUpdate = false;\r\n\t\t\t\tfunction setPosition( axisName, fnName ) {\r\n\r\n\t\t\t\t\tvar value = Player.execFunc( funcs, axisName, t, a, b );\r\n\t\t\t\t\tif ( value !== undefined ) {\r\n\r\n\t\t\t\t\t\tattributes.position[fnName]( i, value );\r\n\t\t\t\t\t\tneedsUpdate = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\tsetPosition( 'x', 'setX' );\r\n\t\t\t\tsetPosition( 'y', 'setY' );\r\n\t\t\t\tsetPosition( 'z', 'setZ' );\r\n\t\t\t\tlet color;\r\n\t\t\t\tvar min, max;\r\n\t\t\t\tif ( options.scales.w !== undefined ) {\r\n\r\n\t\t\t\t\tmin = options.scales.w.min; max = options.scales.w.max;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tmax = value;\r\n\t\t\t\t\tmin = max - 1;\r\n\r\n\t\t\t\t}\r\n/*\r\n\t\t\t\tvar boSetColorAttribute = true;\r\n\t\t\t\tif ( typeof funcs.w === \"function\" ) {\r\n\r\n\t\t\t\t\tvar value = funcs.w( t, a, b );\r\n\t\t\t\t\tattributes.position.setW( i, value );\r\n\t\t\t\t\tneedsUpdate = true;\r\n\r\n//\t\t\t\t\tcolor = palette.toColor( value, min, max );\r\n\t\t\t\t\tcolor = options.palette.toColor( value, min, max );\r\n\r\n\t\t\t\t} else if ( typeof funcs.w === \"object\" ) {\r\n\r\n\t\t\t\t\tif ( funcs.w instanceof THREE.Color )\r\n\t\t\t\t\t\tcolor = funcs.w;\r\n\t\t\t\t\telse color = palette.toColor( execFunc( funcs, 'w', t, a, b ), min, max );\r\n\r\n\t\t\t\t} else if ( ( typeof funcs.w === \"number\" ) && options.palette )\r\n\t\t\t\t\tcolor = options.palette.toColor( funcs.w, min, max );\r\n\t\t\t\telse {\r\n\r\n\t\t\t\t\tboSetColorAttribute = false;\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif ( boSetColorAttribute )\r\n\t\t\t\t\tPlayer.setColorAttribute( attributes, i, color );\r\n*/\r\n\t\t\t\tif ( typeof funcs.w === \"function\" ) {\r\n\r\n\t\t\t\t\tvar value = funcs.w( t, a, b );\r\n\t\t\t\t\tattributes.position.setW( i, value );\r\n\t\t\t\t\tneedsUpdate = true;\r\n\r\n\t\t\t\t\tif ( options.palette )\r\n\t\t\t\t\t\tcolor = options.palette.toColor( value, min, max );\r\n\r\n\t\t\t\t} else if ( typeof funcs.w === \"object\" ) {\r\n\r\n\t\t\t\t\tif ( funcs.w instanceof THREE.Color )\r\n\t\t\t\t\t\tcolor = funcs.w;\r\n\t\t\t\t\telse if ( options.palette ) {\r\n\r\n\t\t\t\t\t\tif ( typeof funcs.w === 'object' ) {\r\n\r\n\t\t\t\t\t\t\tif ( funcs.w.min ) min = funcs.w.min;\r\n\t\t\t\t\t\t\tif ( funcs.w.max ) max = funcs.w.max;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcolor = options.palette.toColor( Player.execFunc( funcs, 'w', t, a, b ), min, max );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( ( typeof funcs.w === \"number\" ) && options.palette )\r\n\t\t\t\t\tcolor = options.palette.toColor( funcs.w, min, max );\r\n\t\t\t\tif ( color ) {\r\n\r\n\t\t\t\t\tif ( mesh.material.vertexColors !== THREE.VertexColors )\r\n\t\t\t\t\t\tconsole.error( 'Player.selectPlayScene: Please set the vertexColors parameter of the THREE.PointsMaterial of your points to THREE.VertexColors. Example: vertexColors: THREE.PointsMaterial' );\r\n\t\t\t\t\tif ( ! Player.setColorAttribute( attributes, i, color ) && funcs instanceof THREE.Vector4 ) {\r\n\r\n\t\t\t\t\t\t//console.error( 'Player.selectPlayScene: the color attribute is not exists. Please use THREE.Vector3 instead THREE.Vector4 in the arrayFuncs or add \"color\" or \"ca\" attribute' );\r\n\t\t\t\t\t\tmesh.geometry.setAttribute( 'color',\r\n\t\t\t\t\t\t\tnew THREE.Float32BufferAttribute( Player.getColors( THREE, arrayFuncs,\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tpositions: mesh.geometry.attributes.position,\r\n\t\t\t\t\t\t\t\t\tscale: { min: min, max: max },\r\n\t\t\t\t\t\t\t\t\tpalette: options.palette,\r\n\r\n\t\t\t\t\t\t\t\t} ), 3 ) );\r\n\t\t\t\t\t\tif ( ! Player.setColorAttribute( attributes, i, color ) )\r\n\t\t\t\t\t\t\tconsole.error( 'Player.selectPlayScene: the color attribute is not exists. Please use THREE.Vector3 instead THREE.Vector4 in the arrayFuncs or add \"color\" attribute' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif ( needsUpdate )\r\n\t\t\t\t\tattributes.position.needsUpdate = true;\r\n\r\n\t\t\t\tif ( funcs.line !== undefined )\r\n\t\t\t\t\tfuncs.line.addPoint( getObjectPosition( mesh, i ), index, color );\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\t\tsetAttributes( options.a, options.b );\r\n\t\tvar message = 'Player.selectPlayScene: invalid mesh.scale.';\r\n\t\tif ( mesh.scale.x <= 0 ) console.error( message + 'x = ' + mesh.scale.x );\r\n\t\tif ( mesh.scale.y <= 0 ) console.error( message + 'y = ' + mesh.scale.y );\r\n\t\tif ( mesh.scale.z <= 0 ) console.error( message + 'z = ' + mesh.scale.z );\r\n\r\n\t\tif ( !options.guiSelectPoint )\r\n\t\t\treturn;\r\n\r\n\t\toptions.guiSelectPoint.setMesh();\r\n\r\n\t\tvar selectedPointIndex = options.guiSelectPoint.getSelectedPointIndex();\r\n\t\tif ( ( selectedPointIndex !== -1 ) && options.guiSelectPoint.isSelectedMesh( mesh ) ) {\r\n\r\n\t\t\tvar position = getObjectPosition( mesh, selectedPointIndex );\r\n/*\r\n\t\t\tif ( axesHelper !== undefined )\r\n\t\t\t\taxesHelper.exposePosition( position );\r\n*/\r\n//\t\t\tif ( gui !== undefined )\r\n\t\t\toptions.guiSelectPoint.setPosition( position, {\r\n\r\n\t\t\t\tobject: mesh,\r\n\t\t\t\tindex: selectedPointIndex,\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\r\n}\r\n\r\n/**\r\n * set color attribute \r\n * @function Player.\r\n * setColorAttribute\r\n * @param {Object} attributes geometry.attributes of the mesh\r\n * @param {number} i index of the arrayFuncs.\r\n * @param {THREE.Color} color color.\r\n * @returns true - success\r\n * <p>false - colorAttribute was not detected.</p>\r\n */\r\nPlayer.setColorAttribute = function ( attributes, i, color ) {\r\n\r\n\tif ( typeof color === \"string\" )\r\n\t\tcolor = new THREE.Color( color );\r\n\tvar colorAttribute = attributes.color || attributes.ca;\r\n\tif ( colorAttribute === undefined )\r\n\t\treturn false;\r\n\tcolorAttribute.setX( i, color.r );\r\n\tcolorAttribute.setY( i, color.g );\r\n\tcolorAttribute.setZ( i, color.b );\r\n\tcolorAttribute.needsUpdate = true;\r\n\treturn true;\r\n\r\n}\r\n/*\r\n * @param {[THREE.Vector4|THREE.Vector3|THREE.Vector2]} arrayFuncs points.geometry.attributes.position array\r\n */\r\n\r\n/**\r\n * Get array of THREE.Vector4 points.\r\n * @function Player.\r\n * getPoints\r\n * @param {THREE} THREE {@link https://github.com/anhr/three.js|THREE}\r\n * @param {THREE.Vector4|THREE.Vector3|THREE.Vector2|object|array} arrayFuncs points.geometry.attributes.position array\r\n * <pre>\r\n * THREE.Vector4: 4D point.\r\n * THREE.Vector3: 3D point. w = 1. Default is white color\r\n * THREE.Vector2: 2D point. w = 1, z = 0. Default is white color\r\n * Vector's x, y, z, w is position of the point.\r\n * Can be as:\r\n * float - position of the point.\r\n * [float] - array of positions of the point.\r\n * Function - position of the point is function of the t.\r\n * Example: new Function( 't', 'a', 'b', 'return Math.sin(t*a*2*Math.PI)*0.5+b' )\r\n * \r\n * Vector.w is index of the [palette]{@link https://github.com/anhr/colorPicker}.\r\n * Default range of the Vector.w is from 0 to 100. You can change range by use an object:\r\n * {\r\n *   func: Vector.w\r\n *   max: new max value of tne Vector.w\r\n *   min: new min value of tne Vector.w\r\n * }\r\n * Example:\r\n * {\r\n *\r\n *   func: new Function( 't', 'return 1-2*t' ),\r\n *   min: -1,\r\n *   max: 1,\r\n *\r\n * }\r\n * Vector.w can be as THREE.Color. Example: new THREE.Color( \"rgb(255, 127, 0)\" )\r\n *\r\n * object: {\r\n *   vector: THREE.Vector4|THREE.Vector3|THREE.Vector2 - point position\r\n *   [name]: point name. Default is undefined.\r\n *   [trace]: true - displays the trace of the point movement. Default is undefined.\r\n * }\r\n * or\r\n * object: {\r\n *   x: x axis. Defauilt is 0.\r\n *   y: y axis. Defauilt is 0.\r\n *   z: z axis. Defauilt is 0.\r\n *   w: w axis. Defauilt is 0.\r\n * }\r\n *\r\n * array: [\r\n *   0: x axis. Defauilt is 0.\r\n *   1: y axis. Defauilt is 0.\r\n *   2: z axis. Defauilt is 0.\r\n *   3: w axis. Defauilt is 0.\r\n * ]\r\n * </pre>\r\n * @param {object} [optionsPoints] followed optionsPoints is available\r\n * @param {THREE.Group} [optionsPoints.group] {@link https://threejs.org/docs/index.html#api/en/objects/Group|Group}\r\n * or {@link https://threejs.org/docs/index.html#api/en/scenes/Scene|Scene}.\r\n * Use only if you want trace lines during playing. See trace of the arrayFuncs param above.\r\n * Default is undefined.\r\n * @param {number} [optionsPoints.t] first parameter of the arrayFuncs item function. Start time of animation. Default is 0.\r\n * @param {object} [optionsPoints.options] followed options is available\r\n * @param {number} [optionsPoints.options.a] multiplier. Second parameter of the arrayFuncs item function. Default is 1.\r\n * @param {number} [optionsPoints.options.b] addendum. Third parameter of the arrayFuncs item function. Default is 0.\r\n * @param {object} [optionsPoints.options.player] See Player method above.\r\n * @returns array of THREE.Vector4 points.\r\n */\r\nPlayer.getPoints = function ( THREE, arrayFuncs, optionsPoints ) {\r\n\r\n\tGuiSelectPoint.setTHREE( THREE );\r\n\t\r\n\toptionsPoints = optionsPoints || {};\r\n\toptionsPoints.t = optionsPoints.t || 0;\r\n\tconst options = optionsPoints.options || {},\r\n\t\ta = options.a || 1,\r\n\t\tb = options.b || 0;\r\n/*\t\r\n\tif ( t === undefined )\r\n\t\tconsole.error( 'getPoints: t = ' + t );\r\n*/\r\n\tfor ( var i = 0; i < arrayFuncs.length; i++ ) {\r\n\r\n\t\tvar item = arrayFuncs[i];\r\n\t\tif ( Array.isArray( item ) )\r\n\t\t\tarrayFuncs[i] = new THREE.Vector4(\r\n\r\n\t\t\t\titem[0] === undefined ? 0 : item[0],\r\n\t\t\t\titem[1] === undefined ? 0 : item[1],\r\n\t\t\t\titem[2] === undefined ? 0 : item[2],\r\n\t\t\t\titem[3] === undefined ? 0 : item[3]\r\n\r\n\t\t\t);\r\n\t\telse if (\r\n\r\n\t\t\t( typeof item === \"object\" )\r\n\t\t\t&& ( item instanceof THREE.Vector2 === false )\r\n\t\t\t&& ( item instanceof THREE.Vector3 === false )\r\n\t\t\t&& ( item instanceof THREE.Vector4 === false )\r\n\r\n\t\t) {\r\n\r\n\t\t\tif ( ( item.vector === undefined ) )\r\n\t\t\t\tarrayFuncs[i] = new THREE.Vector4(\r\n\r\n\t\t\t\t\titem.x === undefined ? 0 : item.x,\r\n\t\t\t\t\titem.y === undefined ? 0 : item.y,\r\n\t\t\t\t\titem.z === undefined ? 0 : item.z,\r\n\t\t\t\t\titem.w === undefined ? 0 : item.w\r\n\r\n\t\t\t\t);\r\n\t\t\telse if (\r\n\r\n\t\t\t\t( item.vector instanceof THREE.Vector2 === true )\r\n\t\t\t\t|| ( item.vector instanceof THREE.Vector3 === true )\r\n\t\t\t\t|| ( item.vector instanceof THREE.Vector4 === true )\r\n\r\n\t\t\t) {\r\n\r\n\t\t\t\tif ( item.vector instanceof THREE.Vector2 === true )\r\n\t\t\t\t\tarrayFuncs[i].vector = new THREE.Vector3(\r\n\r\n\t\t\t\t\t\titem.vector.x === undefined ? 0 : item.vector.x,\r\n\t\t\t\t\t\titem.vector.y === undefined ? 0 : item.vector.y,\r\n\t\t\t\t\t\titem.vector.z === undefined ? 0 : item.vector.z,\r\n\r\n\t\t\t\t\t);\r\n/*\r\n\t\t\t\tarrayFuncs[i].vector = new THREE.Vector4(\r\n\r\n\t\t\t\t\titem.vector.x === undefined ? 0 : item.vector.x,\r\n\t\t\t\t\titem.vector.y === undefined ? 0 : item.vector.y,\r\n\t\t\t\t\titem.vector.z === undefined ? 0 : item.vector.z,\r\n\t\t\t\t\titem.vector.w === undefined ? undefined : item.vector.w\r\n\r\n\t\t\t\t);\r\n*/\t\t\t\t\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( item.vector.length === 4 )\r\n\t\t\t\t\tarrayFuncs[i].vector = new THREE.Vector4(\r\n\r\n\t\t\t\t\t\titem.vector[0] === undefined ? 0 : item.vector[0],\r\n\t\t\t\t\t\titem.vector[1] === undefined ? 0 : item.vector[1],\r\n\t\t\t\t\t\titem.vector[2] === undefined ? 0 : item.vector[2],\r\n\t\t\t\t\t\titem.vector[3] === undefined ? 0 : item.vector[3]\r\n\r\n\t\t\t\t\t);\r\n\t\t\t\telse if ( item.vector.length === 3 )\r\n\r\n\t\t\t\t\tarrayFuncs[i].vector = new THREE.Vector3(\r\n\r\n\t\t\t\t\t\titem.vector[0] === undefined ? 0 : item.vector[0],\r\n\t\t\t\t\t\titem.vector[1] === undefined ? 0 : item.vector[1],\r\n\t\t\t\t\t\titem.vector[2] === undefined ? 0 : item.vector[2],\r\n\r\n\t\t\t\t\t);\r\n\t\t\t\telse console.error( 'options.getPoints(...) falied! item.vector.length = ' + item.vector.length );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\tvar points = [];\r\n\tfor ( var i = 0; i < arrayFuncs.length; i++ ) {\r\n\r\n\t\tvar funcs = arrayFuncs[i];\r\n\t\tfunction getAxis( axisName ) {\r\n\r\n\t\t\tif ( typeof funcs === \"number\" )\r\n\t\t\t\tfuncs = new THREE.Vector4( funcs, 0, 0, 0 );\r\n\t\t\tif ( ( funcs instanceof THREE.Vector2 ) || ( funcs instanceof THREE.Vector3 ) || ( funcs instanceof THREE.Vector4 ) ) {\r\n\r\n\t\t\t\treturn Player.execFunc( funcs, axisName, optionsPoints.t, a, b );\r\n\r\n\t\t\t}\r\n\t\t\tif ( funcs.vector === undefined ) {\r\n\r\n\t\t\t\tconsole.error( 'options.getPoints: funcs.vector = ' + funcs.vector );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\t\t\tif ( funcs.name !== undefined )\r\n\t\t\t\tfuncs.vector.name = funcs.name;\r\n\t\t\tif ( funcs.trace ) {\r\n\r\n/*\r\n\t\t\t\tif ( options.player === undefined )\r\n\t\t\t\t\tconsole.warn( 'Please define the options.player for displays the trace of the point movement.' );\r\n\t\t\t\telse {\r\n\r\n\t\t\t\t\tfuncs.vector.line = new Player.traceLine( THREE, group, options );\r\n\r\n\t\t\t\t}\r\n*/\t\t\t\t\r\n\t\t\t\tfuncs.vector.line = new Player.traceLine( THREE, optionsPoints.group, options );\r\n\r\n\t\t\t}\r\n\t\t\tarrayFuncs[i] = funcs.vector;\r\n\t\t\tfuncs = funcs.vector;\r\n\t\t\treturn Player.execFunc( funcs, axisName, optionsPoints.t, a, b );\r\n\r\n\r\n\t\t}\r\n\t\tvar point = funcs.vector instanceof THREE.Vector3 === true ?\r\n\t\t\tnew THREE.Vector3( getAxis( 'x' ), getAxis( 'y' ), getAxis( 'z' ) ) :\r\n\t\t\tnew THREE.Vector4( getAxis( 'x' ), getAxis( 'y' ), getAxis( 'z' ), getAxis( 'w' ) );\r\n\r\n\t\tif ( funcs.w === undefined )\r\n\t\t\tpoint.w = {};//Если тут поставить NaN то в points.geometry.attributes.position.array он преобразуется в 0.\r\n\t\t//Тогда в gui появится ненужный орган управления controllerW\r\n\t\t//от балды поставил пустой объект что бы при создании points.geometry.attributes.position.array\r\n\t\t//это зачение преобразвалось в NaN.\r\n\r\n\t\tpoints.push( point );\r\n\r\n\t}\r\n\treturn points;\r\n\r\n}\r\n//\t* @param { number } [optionsColor.t] first parameter of the arrayFuncs item function.Start time of animation.Default is 0.\r\n\r\n/**\r\n * Get array of mesh colors.\r\n * @function Player.\r\n * getColors\r\n * @param {THREE} THREE {@link https://github.com/anhr/three.js|THREE}\r\n * @param {THREE.Vector4|THREE.Vector3|THREE.Vector2|object|array} arrayFuncs points.geometry.attributes.position array\r\n * <pre>\r\n * THREE.Vector4: 4D point.\r\n * THREE.Vector3: 3D point. w = 1. Default is white color\r\n * THREE.Vector2: 2D point. w = 1, z = 0. Default is white color\r\n * Vector's x, y, z, w is position of the point.\r\n * Can be as:\r\n * float - position of the point.\r\n * [float] - array of positions of the point.\r\n * Function - position of the point is function of the t.\r\n * Example: new Function( 't', 'a', 'b', 'return Math.sin(t*a*2*Math.PI)*0.5+b' )\r\n *\r\n * Vector.w is index of the [palette]{@link https://github.com/anhr/colorPicker}.\r\n * Default range of the Vector.w is from 0 to 100. You can change range by use an object:\r\n * {\r\n *   func: Vector.w\r\n *   max: new max value of tne Vector.w\r\n *   min: new min value of tne Vector.w\r\n * }\r\n * Example:\r\n * {\r\n *\r\n *   func: new Function( 't', 'return 1-2*t' ),\r\n *   min: -1,\r\n *   max: 1,\r\n *\r\n * }\r\n * Vector.w can be as THREE.Color. Example: new THREE.Color( \"rgb(255, 127, 0)\" )\r\n *\r\n * object: {\r\n *   vector: THREE.Vector4|THREE.Vector3|THREE.Vector2 - point position\r\n *   [name]: point name. Default is undefined.\r\n *   [trace]: true - displays the trace of the point movement. Default is undefined.\r\n * }\r\n * or\r\n * object: {\r\n *   x: x axis. Defauilt is 0.\r\n *   y: y axis. Defauilt is 0.\r\n *   z: z axis. Defauilt is 0.\r\n *   w: w axis. Defauilt is 0.\r\n * }\r\n *\r\n * array: [\r\n *   0: x axis. Defauilt is 0.\r\n *   1: y axis. Defauilt is 0.\r\n *   2: z axis. Defauilt is 0.\r\n *   3: w axis. Defauilt is 0.\r\n * ]\r\n * </pre>\r\n * @param {object} [optionsColor] followed options is available:\r\n * @param {object} [optionsColor.palette] [color palette]{@link https://github.com/anhr/colorPicker}.\r\n * @param {object} [optionsColor.scale]\r\n * @param {object} [optionsColor.scale.min] Minimal range of the [color palette]{@link https://github.com/anhr/colorPicker}.\r\n * <p>Default is undefined. Minimal palette range is 0.</p>\r\n * @param {object} [optionsColor.scale.max] Maximal range of the [color palette]{@link https://github.com/anhr/colorPicker}.\r\n * <p>Default is undefined. Maximal palette range is 100</p>\r\n * @param {THREE.BufferAttribute} [optionsColor.positions] geometry.attributes.position of the new mesh. Default is undefined.\r\n * @param {array} [optionsColor.colors] array for mesh colors. Default is undefined.\r\n * @param {boolean} [optionsColor.opacity] if true then opacity of the point is depend from distance to all  meshes points from the group with defined mesh.userData.cloud. Default is undefined.\r\n * @returns array of mesh colors.\r\n */\r\nPlayer.getColors = function ( THREE, arrayFuncs, optionsColor ) {\r\n/*\r\n\tif ( t === undefined )\r\n\t\tconsole.error( 'getColors: t = ' + t );\r\n*/\r\n\toptionsColor = optionsColor || {};\r\n\toptionsColor.palette = optionsColor.palette || paletteDefault;\r\n\t\r\n\tif (\r\n\t\t( optionsColor.positions !== undefined ) &&\r\n\t\tArray.isArray( arrayFuncs ) &&\r\n\t\t( arrayFuncs.length !== optionsColor.positions.count )\r\n\t) {\r\n\r\n\t\tconsole.error( 'getColors failed! arrayFuncs.length: ' + arrayFuncs.length + ' != positions.count: ' + optionsColor.positions.count );\r\n\t\treturn optionsColor.colors;\r\n\r\n\t}\r\n\toptionsColor.colors = optionsColor.colors || [];\r\n\tvar length = Array.isArray( arrayFuncs ) ? arrayFuncs.length : optionsColor.positions.count;\r\n\r\n\tfor( var i = 0; i < length; i++ ) {\r\n\r\n\t\tvar funcs = Array.isArray(arrayFuncs) ? arrayFuncs[i] : undefined,\r\n\t\t\tvector;\r\n\t\tif (\r\n\t\t\t( funcs instanceof THREE.Vector4 ) ||//w of the funcs is color of the point\r\n\t\t\t( optionsColor.positions.itemSize === 4 )//w position of the positions is color of the point\r\n\t\t\t) {\r\n\r\n\t\t\tvar min, max;\r\n\t\t\tif ( optionsColor.scale !== undefined ) {\r\n\r\n\t\t\t\tmin = optionsColor.scale.min; max = optionsColor.scale.max;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmax = funcs instanceof THREE.Vector4 ? funcs.w : 1;\r\n\t\t\t\tmin = max - 1;\r\n\r\n\t\t\t}\r\n\t\t\tvar color = optionsColor.palette.toColor( funcs === undefined ? new THREE.Vector4().fromBufferAttribute( optionsColor.positions, i ).w : funcs.w, min, max );\r\n\t\t\toptionsColor.colors.push( color.r, color.g, color.b );\r\n\r\n\t\t} else if ( optionsColor.colors instanceof THREE.Float32BufferAttribute )\r\n\t\t\tvector = new THREE.Vector3( 1, 1, 1 );\r\n\t\telse optionsColor.colors.push( 1, 1, 1 );//white\r\n\r\n\t\t//opacity\r\n\t\tif ( optionsColor.opacity !== undefined ) {\r\n\r\n\t\t\tvar opacity = 0,\r\n\t\t\t\tstandardNormalDistributionZero = getStandardNormalDistribution( 0 );\r\n\t\t\tgroup.children.forEach( function ( mesh ) {\r\n\r\n\t\t\t\tif ( !mesh.userData.cloud )\r\n\t\t\t\t\treturn;\r\n\t\t\t\tfor ( var iMesh = 0; iMesh < mesh.geometry.attributes.position.count; iMesh++ ) {\r\n\r\n\t\t\t\t\tvar position = getObjectPosition( mesh, iMesh );\r\n\t\t\t\t\topacity += getStandardNormalDistribution(\r\n\t\t\t\t\t\tgetWorldPosition(//myThreejs.getWorldPosition(\r\n\t\t\t\t\t\t\tcamera, new THREE.Vector3().fromBufferAttribute( optionsColor.positions, i )\r\n\t\t\t\t\t\t).distanceTo( position ) * 5\r\n\t\t\t\t\t) / standardNormalDistributionZero;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tif ( debug.opacity !== undefined )\r\n\t\t\t\topacity = debug.opacity;\r\n\r\n\t\t\tif ( optionsColor.colors instanceof THREE.Float32BufferAttribute ) {\r\n\r\n\t\t\t\toptionsColor.colors.setXYZW( i, vector.x, vector.y, vector.z, opacity );\r\n\r\n\t\t\t}\r\n\t\t\telse optionsColor.colors.push( opacity );\r\n\r\n\t\t} else optionsColor.colors.push( 1 );\r\n\r\n\t}\r\n\treturn optionsColor.colors;\r\n\r\n}\r\n\r\n/**\r\n * trace line of moving of the point during playing\r\n * @function Player.\r\n * traceLine\r\n * @param {THREE} THREE {@link https://github.com/anhr/three.js|THREE}\r\n * @param {THREE.Group} group {@link https://threejs.org/docs/index.html#api/en/objects/Group|Group} or {@link https://threejs.org/docs/index.html#api/en/scenes/Scene|Scene}.\r\n * @param {object} options followed options is available\r\n * @param {object} options.player See Player function above.\r\n */\r\nPlayer.traceLine = function ( THREE, group, options ) {\r\n\r\n\tif ( !group ) {\r\n\r\n\t\tconsole.error( 'Player.traceLine: Define optionsPoints.group of the Player.getPoints first.' );\r\n\t\treturn;\r\n\t\t\r\n\t}\r\n\tif ( !settings ) {\r\n\r\n\t\tconsole.error( 'Player.traceLine: call Player(...) first.' );\r\n\t\treturn;\r\n\t\t\r\n\t}\r\n\t//Thanks to https://stackoverflow.com/questions/31399856/drawing-a-line-with-three-js-dynamically/31411794#31411794\r\n//\tvar MAX_POINTS = options.player.marks,\r\n\tvar MAX_POINTS = settings.marks,\r\n\t\tline;//, drawCount = 0;\r\n\tthis.addPoint = function ( point, index, color ) {\r\n\r\n\t\tif ( line === undefined ) {\r\n\r\n\r\n\t\t\t// geometry\r\n\t\t\tvar geometry = new THREE.BufferGeometry();\r\n\r\n\t\t\t// attributes\r\n\t\t\tvar positions = new Float32Array( MAX_POINTS * 3 ); // 3 vertices per point\r\n\t\t\tgeometry.setAttribute( 'position', new THREE.BufferAttribute( positions, 3 ) );\r\n\t\t\tvar colors = new Float32Array( MAX_POINTS * 3 ); // 3 vertices per point\r\n\t\t\tgeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );\r\n\r\n\t\t\t// draw range\r\n\t\t\tgeometry.setDrawRange( index, index );\r\n\r\n\t\t\tline = new THREE.Line( geometry, new THREE.LineBasicMaterial( { vertexColors: THREE.VertexColors } ) );\r\n\t\t\tline.visible = true;\r\n\t\t\tgroup.add( line );\r\n\r\n\t\t}\r\n\r\n\t\t//point position\r\n\t\tpoint = new THREE.Vector3().copy( point );\r\n\t\tpoint.toArray( line.geometry.attributes.position.array, index * line.geometry.attributes.position.itemSize );\r\n\t\tline.geometry.attributes.position.needsUpdate = true;\r\n\r\n\t\t//point color\r\n\t\tif ( color === undefined )\r\n\t\t\tcolor = new THREE.Color( 1, 1, 1 );//White\r\n\t\tPlayer.setColorAttribute( line.geometry.attributes, index, color );\r\n\r\n\t\t//set draw range\r\n\t\tvar start = line.geometry.drawRange.start, count = index + 1 - start;\r\n\t\tif ( start > index ) {\r\n\r\n\t\t\tvar stop = start + line.geometry.drawRange.count;\r\n\t\t\tstart = index;\r\n\t\t\tcount = stop - start;\r\n\r\n\t\t}\r\n\t\tline.geometry.setDrawRange( start, count );\r\n\r\n\t}\r\n\tthis.visible = function ( visible ) { line.visible = visible; }\r\n\tthis.isVisible = function () { return line.visible; }\r\n\tthis.remove = function () {\r\n\r\n\t\tif ( line === undefined )\r\n\t\t\treturn;\r\n\t\tline.geometry.dispose();\r\n\t\tline.material.dispose();\r\n\t\tgroup.remove( line );\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport default Player;\r\n"],"names":["THREE","GuiSelectPoint","_THREE","guiParams","setTHREE","axesHelper","options","undefined","cFrustumPoints","getLanguageCode","lang","_languageCode","meshs","notSelected","select","position","rotation","points","point","pointTitle","pointWorld","pointWorldTitle","mesh","scale","color","opacity","opacityTitle","defaultButton","defaultScaleTitle","defaultPositionTitle","default3DObjectTitle","defaultRotationTitle","defaultLocalPositionTitle","languageCode","keys","forEach","key","f3DObjects","fPoint","cRestoreDefaultLocalPosition","fPointWorld","fPoints","cMeshs","fMesh","_this","cScaleX","cScaleY","cScaleZ","cPosition","Vector3","cRotations","cPoints","selectedPointIndex","controllerX","controllerY","controllerZ","controllerW","cTrace","cTraceAll","controllerColor","controllerOpacity","controllerWorld","boSetMesh","arrayCloud","cFrustumPointsF","dislayEl","controller","displayController","el","domElement","tagName","toUpperCase","parentElement","style","display","exposePosition","guiSelectPoint","getSelectedPointIndex","__select","selectedIndex","getObjectPosition","object","index","x","setValue","y","z","v","input","querySelector","readOnly","property","__onChange","call","initialValue","updateDisplay","setPosition","intersectionSelected","positionLocal","getObjectLocalPosition","displayControllerW","displayControllerColor","displayControllerOpacity","none","block","intersection","userData","arrayFuncs","console","error","func","opasity","Array","isArray","w","execFunc","group","t","a","b","geometry","attributes","ca","warn","vColor","Vector4","fromArray","array","itemSize","Color","strColor","getHexString","boReadOnly","boFrustumPoints","setMesh","i","length","option","selected","Object","is","update","getMeshIndex","setIndexMesh","selectPoint","removeMesh","remove","removePoints","addMesh","name","opt","document","createElement","innerHTML","constructor","default","copy","Euler","appendChild","selectPoint2","selectedMesh","isNaN","pointIndexes","setIntersection","getMesh","line","isVisible","isSelectedMesh","meshCur","isDisplay","frustumPoints","getSelectedIndex","selectedOptions","isNotSetControllers","setScaleControllers","setPositionControllers","setRotationControllers","add","folder","addFolder","buttonScaleDefault","buttonPositionDefault","buttonRotationDefault","Meshs","onChange","value","parseInt","displayDefaultButtons","displayPoints","displayFrustumPoints","controllers","iPosition","count","pointName","setAttribute","traceAll","controllerNameAndTitle","open","fScale","ScaleController","customController","action","zoom","getValue","needsUpdate","updateCloudPoint","zoomMultiplier","setScale","axesName","scales","dat","controllerZeroStep","fPosition","addAxisControllers","f","PositionController","shift","fRotation","addRotationControllers","Math","PI","Points","create","myThreejs","folderNameAndTitle","pointsControls","setColorAttribute","colorAttribute","setX","r","setY","g","setZ","querySelectorAll","addPointControllers","isReadOnlyController","boSetValue","axesGui","axisName","min","max","palette","toColor","__min","__max","setW","updateCloudPointItem","ColorPicker","height","elSlider","axesId","addColor","pointControls","axesWorldGui","positionDefault","getFrustumPoints","windowRange","attributesPosition","getWorldPosition","pos","clone","getPosition","positionAngle","multiply","applyEuler","parent","myRequest","loadXMLDoc","req","window","XMLHttpRequest","ActiveXObject","NewActiveXObject","e","XMLHttpRequestStart","onreadystatechange","async","XMLHttpRequestStop","onerror","event","url","XMLHttpRequestReStart","getUrl","params","timeout","ontimeout","timeout_id_SendReq","setTimeout","send","message","abort","ProcessReqChange","processStatus200","readyState","status","processStatus200Error","GetElementText","noDisplayErrorMessage","xmlhttp","responseXML","ErrorMessage","responseText","element","getElementsByTagName","text","textContent","data","navigator","appName","appVersion","sync","onload","response","request","src","appendTo","isScriptExists","optionsItem","tag","log","str","item","script","loadFileSync","loadScriptBase","isrc","srcAsync","next","_onload","callback","attribute","elParent","scripts","child","id","loadScript","optionsStyle","type","SVGAngle","implementation","hasFeature","svgNS","uniqID","paletteIndexes","elSliderWrapper","orientation","isHorizontal","direction","width","onError","HTMLElement","getElementById","classList","Palette","slide","getSlideHeight","getSlideWidth","clientWidth","slideIndicator","c","hsv2rgb","percent","sliderIndicator","className","pointerEvents","positionIndicators","top","left","offsetWidth","offsetHeight","linearGradient","CreateSVGElement","getPalette","fill","cursor","mouseMove","mouse","size","slideListener","evt","mouseout","mousePosition","contentOverflow","offsetX","offsetY","wrapper","target","parentNode","layerX","offsetLeft","layerY","offsetTop","addEventListener","listener","attachEvent","enableDragging","ctx","preventDefault","rect","srcElement","getBoundingClientRect","touches","clientX","clientY","mouseup","mousemove","onMouseUp","removeEventListener","detachEvent","attrs","children","createElementNS","prototype","toString","len","paletteitem","BGRW","arrayPalette","monochrome","bidirectional","rainbow","unshift","Number","slice","stringPercent","parseFloat","lastPalette","lastItem","push","itemPrev","percentPrev","prev","percentItem","percentD","round","settings","Player","onSelectScene","marks","repeat","interval","offset","selectSceneIndex","getTime","selectScene","pushController","playRate","playing","time","timeNext","RenamePlayButtons","onRenamePlayButtons","play","pause","isRepeat","playNext","animate","timeCur","Date","play3DObject","onChangeRepeat","getOptions","getSettings","getSelectSceneIndex","setSettings","setObject","cookieName","onChangeScaleT","onChangeTimerId","funcs","typeofFuncs","execW","l","player","tStep","tStart","tStop","iStart","iStop","paletteDefault","selectPlayScene","boPlayer","boundingSphere","setAttributes","fnName","babelHelpers.typeof","material","vertexColors","VertexColors","Float32BufferAttribute","getColors","addPoint","getPoints","optionsPoints","Vector2","vector","getAxis","trace","traceLine","optionsColor","positions","colors","fromBufferAttribute","standardNormalDistributionZero","getStandardNormalDistribution","cloud","iMesh","distanceTo","debug","setXYZW","MAX_POINTS","BufferGeometry","Float32Array","BufferAttribute","setDrawRange","Line","LineBasicMaterial","visible","toArray","start","drawRange","stop","dispose"],"mappings":"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"}